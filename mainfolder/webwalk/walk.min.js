(function(){var m=m||{};m.scope={};m.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};m.arrayIterator=function(a){return{next:m.arrayIteratorImpl(a)}};m.ASSUME_ES5=!1;m.ASSUME_NO_NATIVE_MAP=!1;m.ASSUME_NO_NATIVE_SET=!1;m.SIMPLE_FROUND_POLYFILL=!1;m.ISOLATE_POLYFILLS=!1;m.FORCE_POLYFILL_PROMISE=!1;m.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
m.defineProperty=m.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};m.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};m.global=m.getGlobal(this);
m.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");m.TRUST_ES6_POLYFILLS=!m.ISOLATE_POLYFILLS||m.IS_SYMBOL_NATIVE;m.polyfills={};m.propertyToPolyfillSymbol={};m.POLYFILL_PREFIX="$jscp$";m.polyfill=function(a,b,c,d){b&&(m.ISOLATE_POLYFILLS?m.polyfillIsolated(a,b,c,d):m.polyfillUnisolated(a,b,c,d))};
m.polyfillUnisolated=function(a,b){var c=m.global;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&m.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
m.polyfillIsolated=function(a,b,c){var d=a.split(".");a=1===d.length;var e=d[0];e=!a&&e in m.polyfills?m.polyfills:m.global;for(var f=0;f<d.length-1;f++){var g=d[f];if(!(g in e))return;e=e[g]}d=d[d.length-1];c=m.IS_SYMBOL_NATIVE&&"es6"===c?e[d]:null;b=b(c);null!=b&&(a?m.defineProperty(m.polyfills,d,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===m.propertyToPolyfillSymbol[d]&&(a=1E9*Math.random()>>>0,m.propertyToPolyfillSymbol[d]=m.IS_SYMBOL_NATIVE?m.global.Symbol(d):m.POLYFILL_PREFIX+a+"$"+
d),m.defineProperty(e,m.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:b})))};m.initSymbol=function(){};
m.polyfill("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.$jscomp$symbol$id_=f;m.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.$jscomp$symbol$id_};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b},"es6","es3");
m.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=m.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&m.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return m.iteratorPrototype(m.arrayIteratorImpl(this))}})}return a},"es6","es3");
m.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};m.createTemplateTagFirstArg=function(a){return a.raw=a};m.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};m.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if("number"==typeof a.length)return m.arrayIterator(a);throw Error(String(a)+" is not an iterable or ArrayLike");};
m.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};m.arrayFromIterable=function(a){return a instanceof Array?a:m.arrayFromIterator(m.makeIterator(a))};m.objectCreate=m.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};
m.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if(m.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=m.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||e}};m.construct={valueOf:m.getConstructImplementation}.valueOf();
m.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};m.setPrototypeOf=m.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:m.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
m.inherits=function(a,b){a.prototype=m.objectCreate(b.prototype);a.prototype.constructor=a;if(m.setPrototypeOf){var c=m.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};m.generator={};m.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
m.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};m.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};m.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
m.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};m.generator.Context.prototype.next_=function(a){this.yieldResult=a};m.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};m.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
m.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};m.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};m.generator.Context.prototype.yieldAll=function(a,b){a=m.makeIterator(a);var c=a.next();m.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
m.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};m.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};m.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};m.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};m.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
m.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};m.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
m.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};m.generator.Context.prototype.forIn=function(a){return new m.generator.Context.PropertyIterator(a)};
m.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};m.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};m.generator.Engine_=function(a){this.context_=new m.generator.Context;this.program_=a};
m.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};m.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
m.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
m.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);m.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
m.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
m.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};m.generator.createGenerator=function(a,b){b=new m.generator.Generator_(new m.generator.Engine_(b));m.setPrototypeOf&&a.prototype&&m.setPrototypeOf(b,a.prototype);return b};
m.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};m.asyncExecutePromiseGeneratorFunction=function(a){return m.asyncExecutePromiseGenerator(a())};m.asyncExecutePromiseGeneratorProgram=function(a){return m.asyncExecutePromiseGenerator(new m.generator.Generator_(new m.generator.Engine_(a)))};
m.getRestArguments=function(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b};m.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");m.polyfill("Reflect.construct",function(){return m.construct},"es6","es3");m.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if(m.setPrototypeOf){var b=m.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");
m.polyfill("Promise",function(a){function b(g){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var k=this.createResolveAndReject_();try{g(k.resolve,k.reject)}catch(h){k.reject(h)}}function c(){this.batch_=null}function d(g){return g instanceof b?g:new b(function(k){k(g)})}if(a&&(!(m.FORCE_POLYFILL_PROMISE||m.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof m.global.PromiseRejectionEvent)||!m.global.Promise||-1===m.global.Promise.toString().indexOf("[native code]")))return a;
c.prototype.asyncExecute=function(g){if(null==this.batch_){this.batch_=[];var k=this;this.asyncExecuteFunction(function(){k.executeBatch_()})}this.batch_.push(g)};var e=m.global.setTimeout;c.prototype.asyncExecuteFunction=function(g){e(g,0)};c.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var g=this.batch_;this.batch_=[];for(var k=0;k<g.length;++k){var h=g[k];g[k]=null;try{h()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};c.prototype.asyncThrow_=function(g){this.asyncExecuteFunction(function(){throw g;
})};b.prototype.createResolveAndReject_=function(){function g(l){return function(n){h||(h=!0,l.call(k,n))}}var k=this,h=!1;return{resolve:g(this.resolveTo_),reject:g(this.reject_)}};b.prototype.resolveTo_=function(g){if(g===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof b)this.settleSameAsPromise_(g);else{a:switch(typeof g){case "object":var k=null!=g;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(g):this.fulfill_(g)}};
b.prototype.resolveToNonPromiseObj_=function(g){var k=void 0;try{k=g.then}catch(h){this.reject_(h);return}"function"==typeof k?this.settleSameAsThenable_(k,g):this.fulfill_(g)};b.prototype.reject_=function(g){this.settle_(2,g)};b.prototype.fulfill_=function(g){this.settle_(1,g)};b.prototype.settle_=function(g,k){if(0!=this.state_)throw Error("Cannot settle("+g+", "+k+"): Promise already settled in state"+this.state_);this.state_=g;this.result_=k;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};b.prototype.scheduleUnhandledRejectionCheck_=function(){var g=this;e(function(){if(g.notifyUnhandledRejection_()){var k=m.global.console;"undefined"!==typeof k&&k.error(g.result_)}},1)};b.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var g=m.global.CustomEvent,k=m.global.Event,h=m.global.dispatchEvent;if("undefined"===typeof h)return!0;"function"===typeof g?g=new g("unhandledrejection",{cancelable:!0}):"function"===typeof k?
g=new k("unhandledrejection",{cancelable:!0}):(g=m.global.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g));g.promise=this;g.reason=this.result_;return h(g)};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var g=0;g<this.onSettledCallbacks_.length;++g)f.asyncExecute(this.onSettledCallbacks_[g]);this.onSettledCallbacks_=null}};var f=new c;b.prototype.settleSameAsPromise_=function(g){var k=this.createResolveAndReject_();g.callWhenSettled_(k.resolve,
k.reject)};b.prototype.settleSameAsThenable_=function(g,k){var h=this.createResolveAndReject_();try{g.call(k,h.resolve,h.reject)}catch(l){h.reject(l)}};b.prototype.then=function(g,k){function h(r,q){return"function"==typeof r?function(w){try{l(r(w))}catch(x){n(x)}}:q}var l,n,p=new b(function(r,q){l=r;n=q});this.callWhenSettled_(h(g,l),h(k,n));return p};b.prototype.catch=function(g){return this.then(void 0,g)};b.prototype.callWhenSettled_=function(g,k){function h(){switch(l.state_){case 1:g(l.result_);
break;case 2:k(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?f.asyncExecute(h):this.onSettledCallbacks_.push(h);this.isRejectionHandled_=!0};b.resolve=d;b.reject=function(g){return new b(function(k,h){h(g)})};b.race=function(g){return new b(function(k,h){for(var l=m.makeIterator(g),n=l.next();!n.done;n=l.next())d(n.value).callWhenSettled_(k,h)})};b.all=function(g){var k=m.makeIterator(g),h=k.next();return h.done?d([]):new b(function(l,
n){function p(w){return function(x){r[w]=x;q--;0==q&&l(r)}}var r=[],q=0;do r.push(void 0),q++,d(h.value).callWhenSettled_(p(r.length-1),n),h=k.next();while(!h.done)})};return b},"es6","es3");m.polyfill("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var c=Math.floor(Math.abs(b));return 0>b?-c:c}},"es6","es3");m.atMethod=function(a){a=Math.trunc(a)||0;0>a&&(a+=this.length);if(!(0>a||a>=this.length))return this[a]};
m.polyfill("Array.prototype.at",function(a){return a?a:m.atMethod},"es_next","es5");m.typedArrayAt=function(a){return a?a:m.atMethod};m.polyfill("Int8Array.prototype.at",m.typedArrayAt,"es_next","es5");m.polyfill("Uint8Array.prototype.at",m.typedArrayAt,"es_next","es5");m.polyfill("Uint8ClampedArray.prototype.at",m.typedArrayAt,"es_next","es5");m.polyfill("Int16Array.prototype.at",m.typedArrayAt,"es_next","es5");m.polyfill("Uint16Array.prototype.at",m.typedArrayAt,"es_next","es5");
m.polyfill("Int32Array.prototype.at",m.typedArrayAt,"es_next","es5");m.polyfill("Uint32Array.prototype.at",m.typedArrayAt,"es_next","es5");m.polyfill("Float32Array.prototype.at",m.typedArrayAt,"es_next","es5");m.polyfill("Float64Array.prototype.at",m.typedArrayAt,"es_next","es5");m.polyfill("String.prototype.at",function(a){return a?a:m.atMethod},"es_next","es5");
m.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};m.polyfill("Array.prototype.keys",function(a){return a?a:function(){return m.iteratorFromArray(this,function(b){return b})}},"es6","es3");m.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
m.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");
m.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};m.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==m.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
m.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=m.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");m.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new m.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;
m.ES6_CONFORMANCE=m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&m.checkEs6ConformanceViaProxy();m.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
m.polyfill("WeakMap",function(a){function b(l){this.id_=(h+=Math.random()+1).toString();if(l){l=m.makeIterator(l);for(var n;!(n=l.next()).done;)n=n.value,this.set(n[0],n[1])}}function c(){if(!a||!Object.seal)return!1;try{var l=Object.seal({}),n=Object.seal({}),p=new a([[l,2],[n,3]]);if(2!=p.get(l)||3!=p.get(n))return!1;p.delete(l);p.set(n,4);return!p.has(l)&&4==p.get(n)}catch(r){return!1}}function d(){}function e(l){var n=typeof l;return"object"===n&&null!==l||"function"===n}function f(l){if(!m.owns(l,
k)){var n=new d;m.defineProperty(l,k,{value:n})}}function g(l){if(!m.ISOLATE_POLYFILLS){var n=Object[l];n&&(Object[l]=function(p){if(p instanceof d)return p;Object.isExtensible(p)&&f(p);return n(p)})}}if(m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&m.ES6_CONFORMANCE)return a}else if(c())return a;var k="$jscomp_hidden_"+Math.random();g("freeze");g("preventExtensions");g("seal");var h=0;b.prototype.set=function(l,n){if(!e(l))throw Error("Invalid WeakMap key");f(l);if(!m.owns(l,k))throw Error("WeakMap key fail: "+
l);l[k][this.id_]=n;return this};b.prototype.get=function(l){return e(l)&&m.owns(l,k)?l[k][this.id_]:void 0};b.prototype.has=function(l){return e(l)&&m.owns(l,k)&&m.owns(l[k],this.id_)};b.prototype.delete=function(l){return e(l)&&m.owns(l,k)&&m.owns(l[k],this.id_)?delete l[k][this.id_]:!1};return b},"es6","es3");m.MapEntry=function(){};
m.polyfill("Map",function(a){function b(){var h={};return h.previous=h.next=h.head=h}function c(h,l){var n=h.head_;return m.iteratorPrototype(function(){if(n){for(;n.head!=h.head_;)n=n.previous;for(;n.next!=n.head;)return n=n.next,{done:!1,value:l(n)};n=null}return{done:!0,value:void 0}})}function d(h,l){var n=l&&typeof l;"object"==n||"function"==n?g.has(l)?n=g.get(l):(n=""+ ++k,g.set(l,n)):n="p_"+l;var p=h.data_[n];if(p&&m.owns(h.data_,n))for(h=0;h<p.length;h++){var r=p[h];if(l!==l&&r.key!==r.key||
l===r.key)return{id:n,list:p,index:h,entry:r}}return{id:n,list:p,index:-1,entry:void 0}}function e(h){this.data_={};this.head_=b();this.size=0;if(h){h=m.makeIterator(h);for(var l;!(l=h.next()).done;)l=l.value,this.set(l[0],l[1])}}function f(){if(m.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),l=new a(m.makeIterator([[h,"s"]]));if("s"!=l.get(h)||1!=l.size||l.get({x:4})||l.set({x:4},"t")!=l||2!=l.size)return!1;
var n=l.entries(),p=n.next();if(p.done||p.value[0]!=h||"s"!=p.value[1])return!1;p=n.next();return p.done||4!=p.value[0].x||"t"!=p.value[1]||!n.next().done?!1:!0}catch(r){return!1}}if(m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&m.ES6_CONFORMANCE)return a}else if(f())return a;var g=new WeakMap;e.prototype.set=function(h,l){h=0===h?0:h;var n=d(this,h);n.list||(n.list=this.data_[n.id]=[]);n.entry?n.entry.value=l:(n.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:h,value:l},n.list.push(n.entry),
this.head_.previous.next=n.entry,this.head_.previous=n.entry,this.size++);return this};e.prototype.delete=function(h){h=d(this,h);return h.entry&&h.list?(h.list.splice(h.index,1),h.list.length||delete this.data_[h.id],h.entry.previous.next=h.entry.next,h.entry.next.previous=h.entry.previous,h.entry.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=b();this.size=0};e.prototype.has=function(h){return!!d(this,h).entry};e.prototype.get=function(h){return(h=
d(this,h).entry)&&h.value};e.prototype.entries=function(){return c(this,function(h){return[h.key,h.value]})};e.prototype.keys=function(){return c(this,function(h){return h.key})};e.prototype.values=function(){return c(this,function(h){return h.value})};e.prototype.forEach=function(h,l){for(var n=this.entries(),p;!(p=n.next()).done;)p=p.value,h.call(l,p[1],p[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var k=0;return e},"es6","es3");
m.polyfill("Set",function(a){function b(d){this.map_=new Map;if(d){d=m.makeIterator(d);for(var e;!(e=d.next()).done;)this.add(e.value)}this.size=this.map_.size}function c(){if(m.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var d=Object.seal({x:4}),e=new a(m.makeIterator([d]));if(!e.has(d)||1!=e.size||e.add(d)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var f=e.entries(),g=f.next();if(g.done||g.value[0]!=d||g.value[1]!=d)return!1;
g=f.next();return g.done||g.value[0]==d||4!=g.value[0].x||g.value[1]!=g.value[0]?!1:f.next().done}catch(k){return!1}}if(m.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&m.ES6_CONFORMANCE)return a}else if(c())return a;b.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};b.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(d){return this.map_.has(d)};
b.prototype.entries=function(){return this.map_.entries()};b.prototype.values=function(){return this.map_.values()};b.prototype.keys=b.prototype.values;b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(d,e){var f=this;this.map_.forEach(function(g){return d.call(e,g,g,f)})};return b},"es6","es3");m.polyfill("Object.entries",function(a){return a?a:function(b){var c=[],d;for(d in b)m.owns(b,d)&&c.push([d,b[d]]);return c}},"es8","es3");
m.assign=m.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)m.owns(d,e)&&(a[e]=d[e])}return a};m.polyfill("Object.assign",function(a){return a||m.assign},"es6","es3");m.polyfill("Object.setPrototypeOf",function(a){return a||m.setPrototypeOf},"es6","es5");
m.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};m.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return m.findInternal(this,b,c).i}},"es6","es3");m.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return m.findInternal(this,b,c).v}},"es6","es3");
m.polyfill("Array.from",function(a){return a?a:function(b,c,d){c=null!=c?c:function(k){return k};var e=[],f="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof f){b=f.call(b);for(var g=0;!(f=b.next()).done;)e.push(c.call(d,f.value,g++))}else for(f=b.length,g=0;g<f;g++)e.push(c.call(d,b[g],g));return e}},"es6","es3");m.polyfill("Number.EPSILON",function(){return Math.pow(2,-52)},"es6","es3");
m.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");m.polyfill("Number.MIN_SAFE_INTEGER",function(){return-9007199254740991},"es6","es3");m.polyfill("Array.prototype.values",function(a){return a?a:function(){return m.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");m.polyfill("Math.sign",function(a){return a?a:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6","es3");
m.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");m.typedArrayFill=function(a){return a?a:Array.prototype.fill};m.polyfill("Int8Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Uint8Array.prototype.fill",m.typedArrayFill,"es6","es5");
m.polyfill("Uint8ClampedArray.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Int16Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Uint16Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Int32Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Uint32Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Float32Array.prototype.fill",m.typedArrayFill,"es6","es5");m.polyfill("Float64Array.prototype.fill",m.typedArrayFill,"es6","es5");
m.polyfill("Object.values",function(a){return a?a:function(b){var c=[],d;for(d in b)m.owns(b,d)&&c.push(b[d]);return c}},"es8","es3");m.polyfill("Math.log2",function(a){return a?a:function(b){return Math.log(b)/Math.LN2}},"es6","es3");m.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=m.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");
m.polyfill("String.prototype.replaceAll",function(a){return a?a:function(b,c){if(b instanceof RegExp&&!b.global)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument.");return b instanceof RegExp?this.replace(b,c):this.replace(new RegExp(String(b).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"g"),c)}},"es_2021","es3");
m.polyfill("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}},"es9","es3");(function(){function a(N,la,Aa){return N.call.apply(N.bind,arguments)}function b(N,la,Aa){if(!N)throw Error();if(2<arguments.length){var ya=Array.prototype.slice.call(arguments,2);return function(){var Pa=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(Pa,ya);return N.apply(la,Pa)}}return function(){return N.apply(la,arguments)}}function c(N,la,Aa){c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:b;return c.apply(null,arguments)}function d(N,
la){this.a=N;this.m=la||N;this.c=this.m.document}function e(N,la,Aa,ya){la=N.c.createElement(la);if(Aa)for(var Pa in Aa)Aa.hasOwnProperty(Pa)&&("style"==Pa?la.style.cssText=Aa[Pa]:la.setAttribute(Pa,Aa[Pa]));ya&&la.appendChild(N.c.createTextNode(ya));return la}function f(N,la,Aa){(N=N.c.getElementsByTagName(la)[0])||(N=document.documentElement);N.insertBefore(Aa,N.lastChild)}function g(N){N.parentNode&&N.parentNode.removeChild(N)}function k(N,la,Aa){la=la||[];Aa=Aa||[];for(var ya=N.className.split(/\s+/),
Pa=0;Pa<la.length;Pa+=1){for(var Wa=!1,Za=0;Za<ya.length;Za+=1)if(la[Pa]===ya[Za]){Wa=!0;break}Wa||ya.push(la[Pa])}la=[];for(Pa=0;Pa<ya.length;Pa+=1){Wa=!1;for(Za=0;Za<Aa.length;Za+=1)if(ya[Pa]===Aa[Za]){Wa=!0;break}Wa||la.push(ya[Pa])}N.className=la.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function h(N,la){N=N.className.split(/\s+/);for(var Aa=0,ya=N.length;Aa<ya;Aa++)if(N[Aa]==la)return!0;return!1}function l(N){if("string"===typeof N.f)return N.f;var la=N.m.location.protocol;"about:"==
la&&(la=N.a.location.protocol);return"https:"==la?"https:":"http:"}function n(N){return N.m.location.hostname||N.a.location.hostname}function p(N,la,Aa){function ya(){lb&&Pa&&Wa&&(lb(Za),lb=null)}la=e(N,"link",{rel:"stylesheet",href:la,media:"all"});var Pa=!1,Wa=!0,Za=null,lb=Aa||null;jb?(la.onload=function(){Pa=!0;ya()},la.onerror=function(){Pa=!0;Za=Error("Stylesheet failed to load");ya()}):setTimeout(function(){Pa=!0;ya()},0);f(N,"head",la)}function r(N,la,Aa,ya){var Pa=N.c.getElementsByTagName("head")[0];
if(Pa){var Wa=e(N,"script",{src:la}),Za=!1;Wa.onload=Wa.onreadystatechange=function(){Za||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(Za=!0,Aa&&Aa(null),Wa.onload=Wa.onreadystatechange=null,"HEAD"==Wa.parentNode.tagName&&Pa.removeChild(Wa))};Pa.appendChild(Wa);setTimeout(function(){Za||(Za=!0,Aa&&Aa(Error("Script load timeout")))},ya||5E3);return Wa}return null}function q(){this.a=0;this.c=null}function w(N){N.a++;return function(){N.a--;t(N)}}function x(N,la){N.c=la;
t(N)}function t(N){0==N.a&&N.c&&(N.c(),N.c=null)}function A(N){this.a=N||"-"}function D(N,la){this.c=N;this.f=4;this.a="n";(N=(la||"n4").match(/^([nio])([1-9])$/i))&&(this.a=N[1],this.f=parseInt(N[2],10))}function H(N){return W(N)+" "+(N.f+"00 300px ")+G(N.c)}function G(N){var la=[];N=N.split(/,\s*/);for(var Aa=0;Aa<N.length;Aa++){var ya=N[Aa].replace(/['"]/g,"");-1!=ya.indexOf(" ")||/^\d/.test(ya)?la.push("'"+ya+"'"):la.push(ya)}return la.join(",")}function K(N){return N.a+N.f}function W(N){var la=
"normal";"o"===N.a?la="oblique":"i"===N.a&&(la="italic");return la}function O(N,la){this.c=N;this.f=N.m.document.documentElement;this.h=la;this.a=new A("-");this.j=!1!==la.events;this.g=!1!==la.classes}function ea(N){N.g&&k(N.f,[N.a.c("wf","loading")]);va(N,"loading")}function ra(N){if(N.g){var la=h(N.f,N.a.c("wf","active")),Aa=[],ya=[N.a.c("wf","loading")];la||Aa.push(N.a.c("wf","inactive"));k(N.f,Aa,ya)}va(N,"inactive")}function va(N,la,Aa){if(N.j&&N.h[la])if(Aa)N.h[la](Aa.c,K(Aa));else N.h[la]()}
function I(){this.c={}}function V(N,la,Aa){var ya=[],Pa;for(Pa in la)if(la.hasOwnProperty(Pa)){var Wa=N.c[Pa];Wa&&ya.push(Wa(la[Pa],Aa))}return ya}function pa(N,la){this.c=N;this.f=la;this.a=e(this.c,"span",{"aria-hidden":"true"},this.f)}function T(N){f(N.c,"body",N.a)}function P(N){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+G(N.c)+";font-style:"+(W(N)+
";font-weight:"+(N.f+"00;"))}function ca(N,la,Aa,ya,Pa,Wa){this.g=N;this.j=la;this.a=ya;this.c=Aa;this.f=Pa||3E3;this.h=Wa||void 0}function J(N,la,Aa,ya,Pa,Wa,Za){this.v=N;this.B=la;this.c=Aa;this.a=ya;this.s=Za||"BESbswy";this.f={};this.w=Pa||3E3;this.u=Wa||null;this.o=this.j=this.h=this.g=null;this.g=new pa(this.c,this.s);this.h=new pa(this.c,this.s);this.j=new pa(this.c,this.s);this.o=new pa(this.c,this.s);N=new D(this.a.c+",serif",K(this.a));N=P(N);this.g.a.style.cssText=N;N=new D(this.a.c+",sans-serif",
K(this.a));N=P(N);this.h.a.style.cssText=N;N=new D("serif",K(this.a));N=P(N);this.j.a.style.cssText=N;N=new D("sans-serif",K(this.a));N=P(N);this.o.a.style.cssText=N;T(this.g);T(this.h);T(this.j);T(this.o)}function aa(){if(null===Ib){var N=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);Ib=!!N&&(536>parseInt(N[1],10)||536===parseInt(N[1],10)&&11>=parseInt(N[2],10))}return Ib}function na(N,la,Aa){for(var ya in hc)if(hc.hasOwnProperty(ya)&&la===N.f[hc[ya]]&&Aa===N.f[hc[ya]])return!0;
return!1}function L(N){var la=N.g.a.offsetWidth,Aa=N.h.a.offsetWidth,ya;(ya=la===N.f.serif&&Aa===N.f["sans-serif"])||(ya=aa()&&na(N,la,Aa));ya?Va()-N.A>=N.w?aa()&&na(N,la,Aa)&&(null===N.u||N.u.hasOwnProperty(N.a.c))?ia(N,N.v):ia(N,N.B):Q(N):ia(N,N.v)}function Q(N){setTimeout(c(function(){L(this)},N),50)}function ia(N,la){setTimeout(c(function(){g(this.g.a);g(this.h.a);g(this.j.a);g(this.o.a);la(this.a)},N),0)}function Z(N,la,Aa){this.c=N;this.a=la;this.f=0;this.o=this.j=!1;this.s=Aa}function ka(N){0==
--N.f&&N.j&&(N.o?(N=N.a,N.g&&k(N.f,[N.a.c("wf","active")],[N.a.c("wf","loading"),N.a.c("wf","inactive")]),va(N,"active")):ra(N.a))}function ma(N){this.j=N;this.a=new I;this.h=0;this.f=this.g=!0}function M(N,la,Aa,ya,Pa){var Wa=0==--N.h;(N.f||N.g)&&setTimeout(function(){var Za=Pa||null,lb=ya||{};if(0===Aa.length&&Wa)ra(la.a);else{la.f+=Aa.length;Wa&&(la.j=Wa);var xb,Gb=[];for(xb=0;xb<Aa.length;xb++){var Hb=Aa[xb],Jb=lb[Hb.c],nc=la.a,Rb=Hb;nc.g&&k(nc.f,[nc.a.c("wf",Rb.c,K(Rb).toString(),"loading")]);
va(nc,"fontloading",Rb);nc=null;null===Dc&&(Dc=window.FontFace?(Rb=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(Rb[1],10):!0:!1);Dc?nc=new ca(c(la.g,la),c(la.h,la),la.c,Hb,la.s,Jb):nc=new J(c(la.g,la),c(la.h,la),la.c,Hb,la.s,Za,Jb);Gb.push(nc)}for(xb=0;xb<Gb.length;xb++)Gb[xb].start()}},0)}function fa(N,la,Aa){var ya=[],Pa=Aa.timeout;ea(la);ya=V(N.a,Aa,N.c);var Wa=new Z(N.c,la,Pa);N.h=ya.length;la=0;for(Aa=ya.length;la<Aa;la++)ya[la].load(function(Za,lb,xb){M(N,Wa,Za,lb,xb)})}
function ja(N,la){this.c=N;this.a=la}function ta(N,la,Aa){var ya=l(N.c);N=(N.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return ya+"//"+N+"/"+la+".js"+(Aa?"?v="+Aa:"")}function X(N,la){this.c=N;this.a=la}function Y(N,la,Aa){N?this.c=N:this.c=la+U;this.a=[];this.f=[];this.g=Aa||""}function qa(N,la){for(var Aa=la.length,ya=0;ya<Aa;ya++){var Pa=la[ya].split(":");3==Pa.length&&N.f.push(Pa.pop());var Wa="";2==Pa.length&&""!=Pa[1]&&(Wa=":");N.a.push(Pa.join(Wa))}}function za(N){if(0==
N.a.length)throw Error("No fonts to load!");if(-1!=N.c.indexOf("kit="))return N.c;for(var la=N.a.length,Aa=[],ya=0;ya<la;ya++)Aa.push(N.a[ya].replace(/ /g,"+"));la=N.c+"?family="+Aa.join("%7C");0<N.f.length&&(la+="&subset="+N.f.join(","));0<N.g.length&&(la+="&text="+encodeURIComponent(N.g));return la}function Ka(N){this.f=N;this.a=[];this.c={}}function Ba(N){for(var la=N.f.length,Aa=0;Aa<la;Aa++){var ya=N.f[Aa].split(":"),Pa=ya[0].replace(/\+/g," "),Wa=["n4"];if(2<=ya.length){var Za=ya[1];var lb=
[];if(Za){Za=Za.split(",");for(var xb=Za.length,Gb=0;Gb<xb;Gb++){var Hb=Za[Gb];if(Hb.match(/^[\w-]+$/)){var Jb=ab.exec(Hb.toLowerCase());if(null==Jb)Hb="";else{Hb=Jb[2];Hb=null==Hb||""==Hb?"n":eb[Hb];Jb=Jb[1];if(null==Jb||""==Jb)Jb="4";else{var nc=Na[Jb];Jb=nc?nc:isNaN(Jb)?"4":Jb.substr(0,1)}Hb=[Hb,Jb].join("")}}else Hb="";Hb&&lb.push(Hb)}}0<lb.length&&(Wa=lb);3==ya.length&&(ya=ya[2],lb=[],ya=ya?ya.split(","):lb,0<ya.length&&(ya=ua[ya[0]])&&(N.c[Pa]=ya))}N.c[Pa]||(ya=ua[Pa])&&(N.c[Pa]=ya);for(ya=
0;ya<Wa.length;ya+=1)N.a.push(new D(Pa,Wa[ya]))}}function Ea(N,la){this.c=N;this.a=la}function Ga(N,la){this.c=N;this.a=la}function Da(N,la){this.c=N;this.f=la;this.a=[]}var Va=Date.now||function(){return+new Date},jb=!!window.FontFace;A.prototype.c=function(N){for(var la=[],Aa=0;Aa<arguments.length;Aa++)la.push(arguments[Aa].replace(/[\W_]+/g,"").toLowerCase());return la.join(this.a)};ca.prototype.start=function(){var N=this.c.m.document,la=this,Aa=Va(),ya=new Promise(function(Wa,Za){function lb(){Va()-
Aa>=la.f?Za():N.fonts.load(H(la.a),la.h).then(function(xb){1<=xb.length?Wa():setTimeout(lb,25)},function(){Za()})}lb()}),Pa=new Promise(function(Wa,Za){setTimeout(Za,la.f)});Promise.race([Pa,ya]).then(function(){la.g(la.a)},function(){la.j(la.a)})};var hc={D:"serif",C:"sans-serif"},Ib=null;J.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=Va();L(this)};var Dc=null;Z.prototype.g=function(N){var la=this.a;la.g&&k(la.f,[la.a.c("wf",N.c,K(N).toString(),
"active")],[la.a.c("wf",N.c,K(N).toString(),"loading"),la.a.c("wf",N.c,K(N).toString(),"inactive")]);va(la,"fontactive",N);this.o=!0;ka(this)};Z.prototype.h=function(N){var la=this.a;if(la.g){var Aa=h(la.f,la.a.c("wf",N.c,K(N).toString(),"active")),ya=[],Pa=[la.a.c("wf",N.c,K(N).toString(),"loading")];Aa||ya.push(la.a.c("wf",N.c,K(N).toString(),"inactive"));k(la.f,ya,Pa)}va(la,"fontinactive",N);ka(this)};ma.prototype.load=function(N){this.c=new d(this.j,N.context||this.j);this.g=!1!==N.events;this.f=
!1!==N.classes;fa(this,new O(this.c,N),N)};ja.prototype.load=function(N){function la(){if(Wa["__mti_fntLst"+ya]){var Za=Wa["__mti_fntLst"+ya](),lb=[],xb;if(Za)for(var Gb=0;Gb<Za.length;Gb++){var Hb=Za[Gb].fontfamily;void 0!=Za[Gb].fontStyle&&void 0!=Za[Gb].fontWeight?(xb=Za[Gb].fontStyle+Za[Gb].fontWeight,lb.push(new D(Hb,xb))):lb.push(new D(Hb))}N(lb)}else setTimeout(function(){la()},50)}var Aa=this,ya=Aa.a.projectId,Pa=Aa.a.version;if(ya){var Wa=Aa.c.m;r(this.c,ta(Aa,ya,Pa),function(Za){Za?N([]):
(Wa["__MonotypeConfiguration__"+ya]=function(){return Aa.a},la())}).id="__MonotypeAPIScript__"+ya}else N([])};X.prototype.load=function(N){var la,Aa=this.a.urls||[],ya=this.a.families||[],Pa=this.a.testStrings||{},Wa=new q;var Za=0;for(la=Aa.length;Za<la;Za++)p(this.c,Aa[Za],w(Wa));var lb=[];Za=0;for(la=ya.length;Za<la;Za++)if(Aa=ya[Za].split(":"),Aa[1])for(var xb=Aa[1].split(","),Gb=0;Gb<xb.length;Gb+=1)lb.push(new D(Aa[0],xb[Gb]));else lb.push(new D(Aa[0]));x(Wa,function(){N(lb,Pa)})};var U="//fonts.googleapis.com/css",
ua={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Na={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},eb={i:"i",italic:"i",n:"n",normal:"n"},
ab=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,kb={Arimo:!0,Cousine:!0,Tinos:!0};Ea.prototype.load=function(N){var la=new q,Aa=this.c,ya=new Y(this.a.api,l(Aa),this.a.text),Pa=this.a.families;qa(ya,Pa);var Wa=new Ka(Pa);Ba(Wa);p(Aa,za(ya),w(la));x(la,function(){N(Wa.a,Wa.c,kb)})};Ga.prototype.load=function(N){var la=this.a.id,Aa=this.c.m;la?r(this.c,(this.a.api||"https://use.typekit.net")+"/"+la+".js",
function(ya){if(ya)N([]);else if(Aa.Typekit&&Aa.Typekit.config&&Aa.Typekit.config.fn){ya=Aa.Typekit.config.fn;for(var Pa=[],Wa=0;Wa<ya.length;Wa+=2)for(var Za=ya[Wa],lb=ya[Wa+1],xb=0;xb<lb.length;xb++)Pa.push(new D(Za,lb[xb]));try{Aa.Typekit.load({events:!1,classes:!1,async:!0})}catch(Gb){}N(Pa)}},2E3):N([])};Da.prototype.load=function(N){var la=this.f.id,Aa=this.c.m,ya=this;la?(Aa.__webfontfontdeckmodule__||(Aa.__webfontfontdeckmodule__={}),Aa.__webfontfontdeckmodule__[la]=function(Pa,Wa){Pa=0;for(var Za=
Wa.fonts.length;Pa<Za;++Pa){var lb=Wa.fonts[Pa],xb=ya.a,Gb=xb.push,Hb=lb.name;lb="font-weight:"+lb.weight+";font-style:"+lb.style;var Jb=4,nc="n",Rb=null;lb&&((Rb=lb.match(/(normal|oblique|italic)/i))&&Rb[1]&&(nc=Rb[1].substr(0,1).toLowerCase()),(Rb=lb.match(/([1-9]00|normal|bold)/i))&&Rb[1]&&(/bold/i.test(Rb[1])?Jb=7:/[1-9]00/.test(Rb[1])&&(Jb=parseInt(Rb[1].substr(0,1),10))));Gb.call(xb,new D(Hb,nc+Jb))}N(ya.a)},r(this.c,l(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+n(this.c)+"/"+la+".js",
function(Pa){Pa&&N([])})):N([])};var Sb=new ma(window);Sb.a.c.custom=function(N,la){return new X(la,N)};Sb.a.c.fontdeck=function(N,la){return new Da(la,N)};Sb.a.c.monotype=function(N,la){return new ja(la,N)};Sb.a.c.typekit=function(N,la){return new Ga(la,N)};Sb.a.c.google=function(N,la){return new Ea(la,N)};var bb={load:c(Sb.load,Sb)};"function"===typeof define&&define.amd?define(function(){return bb}):"undefined"!==typeof module&&module.exports?module.exports=bb:(window.WebFont=bb,window.WebFontConfig&&
Sb.load(window.WebFontConfig))})();var C={REVISION:"71"};"object"===typeof module&&(module.exports=C);void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});C.log=function(){console.log.apply(console,arguments)};C.warn=function(){console.warn.apply(console,arguments)};C.error=function(){console.error.apply(console,arguments)};C.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};C.CullFaceNone=0;C.CullFaceBack=1;C.CullFaceFront=2;C.CullFaceFrontBack=3;C.FrontFaceDirectionCW=0;C.FrontFaceDirectionCCW=1;C.BasicShadowMap=0;C.PCFShadowMap=1;
C.PCFSoftShadowMap=2;C.FrontSide=0;C.BackSide=1;C.DoubleSide=2;C.NoShading=0;C.FlatShading=1;C.SmoothShading=2;C.NoColors=0;C.FaceColors=1;C.VertexColors=2;C.NoBlending=0;C.NormalBlending=1;C.AdditiveBlending=2;C.SubtractiveBlending=3;C.MultiplyBlending=4;C.CustomBlending=5;C.AddEquation=100;C.SubtractEquation=101;C.ReverseSubtractEquation=102;C.MinEquation=103;C.MaxEquation=104;C.ZeroFactor=200;C.OneFactor=201;C.SrcColorFactor=202;C.OneMinusSrcColorFactor=203;C.SrcAlphaFactor=204;
C.OneMinusSrcAlphaFactor=205;C.DstAlphaFactor=206;C.OneMinusDstAlphaFactor=207;C.DstColorFactor=208;C.OneMinusDstColorFactor=209;C.SrcAlphaSaturateFactor=210;C.MultiplyOperation=0;C.MixOperation=1;C.AddOperation=2;C.UVMapping=300;C.CubeReflectionMapping=301;C.CubeRefractionMapping=302;C.EquirectangularReflectionMapping=303;C.EquirectangularRefractionMapping=304;C.SphericalReflectionMapping=305;C.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
C.Color.prototype={constructor:C.Color,r:1,g:1,b:1,set:function(a){a instanceof C.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(e,f,g){0>g&&(g+=1);1<g&&--g;return g<1/6?e+6*(f-e)*g:.5>g?f:g<2/
3?e+6*(f-e)*(2/3-g):e};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(a))return a=/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(a),this.r=Math.min(100,parseInt(a[1],
10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^#([0-9a-f]{6})$/i.test(a))return a=/^#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(C.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,
b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*
this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,k=(f+e)/2;if(f===e)f=g=0;else{var h=e-f;f=.5>=k?h/(e+f):h/(2-e-f);switch(e){case b:g=(c-d)/h+(c<d?6:0);break;case c:g=(d-b)/h+2;break;case d:g=(b-c)/h+4}g/=6}a.h=g;a.s=f;a.l=k;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},
offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=
(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},clone:function(){return(new C.Color).setRGB(this.r,this.g,this.b)}};
C.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};C.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
C.Quaternion.prototype={constructor:C.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=
a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof C.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),k=Math.sin(a._z/2);"XYZ"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e-f*g*k):"YXZ"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k-f*g*e,
this._w=c*d*e+f*g*k):"ZXY"===a.order?(this._x=f*d*e-c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e-f*g*k):"ZYX"===a.order?(this._x=f*d*e-c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*e+f*g*k):"YZX"===a.order?(this._x=f*d*e+c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*e-f*g*k):"XZY"===a.order&&(this._x=f*d*e-c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e+f*g*k);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){b/=2;var c=
Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],k=b[2],h=b[6];b=b[10];var l=c+f+b;0<l?(c=.5/Math.sqrt(l+1),this._w=.25/c,this._x=(h-g)*c,this._y=(d-k)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(h-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+k)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-k)/c,this._x=(a+e)/c,this._y=.25*c,this._z=
(g+h)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+k)/c,this._y=(g+h)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new C.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(C.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;var f=b._x,g=b._y,k=b._z;b=b._w;this._x=c*b+a*f+d*k-e*g;this._y=d*b+a*g+e*f-c*k;this._z=e*b+a*k+c*g-d*f;this._w=a*b-c*f-d*g-e*k;this.onChangeCallback();return this},multiplyVector3:function(a){C.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;a=Math.acos(g);var k=Math.sqrt(1-g*g);if(.001>Math.abs(k))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;g=Math.sin((1-b)*a)/k;b=
Math.sin(b*a)/k;this._w=f*g+this._w*b;this._x=c*g+this._x*b;this._y=d*g+this._y*b;this._z=e*g+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){},clone:function(){return new C.Quaternion(this._x,this._y,this._z,this._w)}};C.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};C.Vector2=function(a,b){this.x=a||0;this.y=b||0};
C.Vector2.prototype={constructor:C.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==
b)return C.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(a,b){if(void 0!==b)return C.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=
a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);return this},
clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new C.Vector2,b=new C.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);
return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===
a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},clone:function(){return new C.Vector2(this.x,this.y)}};C.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
C.Vector3.prototype={constructor:C.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return C.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return C.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return C.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},
multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof C.Euler&&C.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new C.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new C.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,c));return this}}(),
applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=
(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var k=a*b+f*d-g*c,h=a*c+g*b-e*d,l=a*d+e*c-f*b;b=-e*b-f*c-g*d;this.x=k*a+b*-e+h*-g-l*-f;this.y=h*a+b*-f+l*-e-k*-g;this.z=l*a+b*-g+k*-f-h*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new C.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;
return function(b){void 0===a&&(a=new C.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;
return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new C.Vector3,b=new C.Vector3);a.set(c,
c,c);b.set(d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=
0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=
this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return C.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);b=this.x;var c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*
a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new C.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new C.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=
new C.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());return Math.acos(C.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(){C.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){C.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},
getPositionFromMatrix:function(a){C.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){C.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){C.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){this.x=
a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){a*=4;b=b.elements;this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===
this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this},clone:function(){return new C.Vector3(this.x,this.y,this.z)}};C.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
C.Vector4.prototype={constructor:C.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return C.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return C.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>
b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],f=a[5],g=a[9];var k=a[2];var h=a[6];var l=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-k)&&.01>Math.abs(g-h)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+k)&&.1>Math.abs(g+h)&&.1>Math.abs(b+f+l-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;f=(f+1)/2;l=(l+1)/2;c=(c+e)/4;d=(d+k)/4;g=(g+h)/4;b>f&&b>l?.01>b?(h=0,c=k=.707106781):
(h=Math.sqrt(b),k=c/h,c=d/h):f>l?.01>f?(h=.707106781,k=0,c=.707106781):(k=Math.sqrt(f),h=c/k,c=g/k):.01>l?(k=h=.707106781,c=0):(c=Math.sqrt(l),h=d/c,k=g/c);this.set(h,k,c,a);return this}a=Math.sqrt((h-g)*(h-g)+(d-k)*(d-k)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(h-g)/a;this.y=(d-k)/a;this.z=(e-c)/a;this.w=Math.acos((b+f+l-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&
(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new C.Vector4,b=new C.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},
fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this},clone:function(){return new C.Vector4(this.x,this.y,this.z,this.w)}};
C.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||C.Euler.DefaultOrder};C.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");C.Euler.DefaultOrder="XYZ";
C.Euler.prototype={constructor:C.Euler,_x:0,_y:0,_z:0,_order:C.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=C.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],k=e[1],h=e[5],l=e[9],n=e[2],p=e[6];e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-l,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,h),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(g,e),this._z=Math.atan2(k,h)):
(this._y=Math.atan2(-n,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-n,e),this._z=Math.atan2(-f,h)):(this._y=0,this._z=Math.atan2(k,a))):"ZYX"===b?(this._y=Math.asin(-d(n,-1,1)),.99999>Math.abs(n)?(this._x=Math.atan2(p,e),this._z=Math.atan2(k,a)):(this._x=0,this._z=Math.atan2(-f,h))):"YZX"===b?(this._z=Math.asin(d(k,-1,1)),.99999>Math.abs(k)?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-n,a)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=
Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(p,h),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-l,e),this._y=0)):C.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new C.Matrix4);a.makeRotationFromQuaternion(b);this.setFromRotationMatrix(a,c,d);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},
reorder:function(){var a=new C.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?
a.set(this._x,this._y,this._z):new C.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new C.Euler(this._x,this._y,this._z,this._order)}};C.Line3=function(a,b){this.start=void 0!==a?a:new C.Vector3;this.end=void 0!==b?b:new C.Vector3};
C.Line3.prototype={constructor:C.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new C.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new C.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){b=
b||new C.Vector3;return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new C.Vector3,b=new C.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&(c=C.Math.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new C.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);
return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new C.Line3).copy(this)}};C.Box2=function(a,b){this.min=void 0!==a?a:new C.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new C.Vector2(-Infinity,-Infinity)};
C.Box2.prototype={constructor:C.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new C.Vector2).addVectors(this.min,
this.max).multiplyScalar(.5)},size:function(a){return(a||new C.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&
this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new C.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new C.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new C.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),
intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new C.Box2).copy(this)}};C.Box3=function(a,b){this.min=void 0!==a?a:new C.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new C.Vector3(-Infinity,-Infinity,-Infinity)};
C.Box3.prototype={constructor:C.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||
new C.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new C.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},
containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new C.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:
!0},clampPoint:function(a,b){return(b||new C.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new C.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new C.Vector3;return function(b){b=b||new C.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);
return this},applyMatrix4:function(){var a=[new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3,new C.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,
this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new C.Box3).copy(this)}};C.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&C.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
C.Matrix3.prototype={constructor:C.Matrix3,set:function(a,b,c,d,e,f,g,k,h){var l=this.elements;l[0]=a;l[3]=b;l[6]=c;l[1]=d;l[4]=e;l[7]=f;l[2]=g;l[5]=k;l[8]=h;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){C.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){C.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new C.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],k=a[6],h=
a[7];a=a[8];return b*f*a-b*g*h-c*e*a+c*g*k+d*e*h-d*f*k},getInverse:function(a,b){a=a.elements;var c=this.elements;c[0]=a[10]*a[5]-a[6]*a[9];c[1]=-a[10]*a[1]+a[2]*a[9];c[2]=a[6]*a[1]-a[2]*a[5];c[3]=-a[10]*a[4]+a[6]*a[8];c[4]=a[10]*a[0]-a[2]*a[8];c[5]=-a[6]*a[0]+a[2]*a[4];c[6]=a[9]*a[4]-a[5]*a[8];c[7]=-a[9]*a[0]+a[1]*a[8];c[8]=a[5]*a[0]-a[1]*a[4];a=a[0]*c[0]+a[1]*c[3]+a[2]*c[6];if(0===a){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");C.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");
this.identity();return this}this.multiplyScalar(1/a);return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=
b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new C.Matrix3).fromArray(this.elements)}};C.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&C.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
C.Matrix4.prototype={constructor:C.Matrix4,set:function(a,b,c,d,e,f,g,k,h,l,n,p,r,q,w,x){var t=this.elements;t[0]=a;t[4]=b;t[8]=c;t[12]=d;t[1]=e;t[5]=f;t[9]=g;t[13]=k;t[2]=h;t[6]=l;t[10]=n;t[14]=p;t[3]=r;t[7]=q;t[11]=w;t[15]=x;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){C.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){var d=this.elements;a.set(d[0],d[1],d[2]);b.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new C.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),
f=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*f;c[9]=b[9]*f;c[10]=b[10]*f;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof C.Euler&&C.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c);c=Math.sin(c);var g=Math.cos(d);d=Math.sin(d);var k=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=f*k;var h=f*e,
l=c*k,n=c*e;b[0]=g*k;b[4]=-g*e;b[8]=d;b[1]=h+l*d;b[5]=a-n*d;b[9]=-c*g;b[2]=n-a*d;b[6]=l+h*d;b[10]=f*g}else"YXZ"===a.order?(a=g*k,h=g*e,l=d*k,n=d*e,b[0]=a+n*c,b[4]=l*c-h,b[8]=f*d,b[1]=f*e,b[5]=f*k,b[9]=-c,b[2]=h*c-l,b[6]=n+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*k,h=g*e,l=d*k,n=d*e,b[0]=a-n*c,b[4]=-f*e,b[8]=l+h*c,b[1]=h+l*c,b[5]=f*k,b[9]=n-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*k,h=f*e,l=c*k,n=c*e,b[0]=g*k,b[4]=l*d-h,b[8]=a*d+n,b[1]=g*e,b[5]=n*d+a,b[9]=h*d-l,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===
a.order?(a=f*g,h=f*d,l=c*g,n=c*d,b[0]=g*k,b[4]=n-a*e,b[8]=l*e+h,b[1]=e,b[5]=f*k,b[9]=-c*k,b[2]=-d*k,b[6]=h*e+l,b[10]=a-n*e):"XZY"===a.order&&(a=f*g,h=f*d,l=c*g,n=c*d,b[0]=g*k,b[4]=-e,b[8]=d*k,b[1]=a*e+n,b[5]=f*k,b[9]=h*e-l,b[2]=l*e-h,b[6]=c*k,b[10]=n*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){C.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},
makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,k=d+d,h=e+e;a=c*g;var l=c*k;c*=h;var n=d*k;d*=h;e*=h;g*=f;k*=f;f*=h;b[0]=1-(n+e);b[4]=l-f;b[8]=c+k;b[1]=l+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-k;b[6]=d+g;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new C.Vector3,b=new C.Vector3,c=new C.Vector3;return function(d,e,f){var g=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);a.crossVectors(f,
c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(C.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=c[8],
g=c[12],k=c[1],h=c[5],l=c[9],n=c[13],p=c[2],r=c[6],q=c[10],w=c[14],x=c[3],t=c[7],A=c[11];c=c[15];var D=d[0],H=d[4],G=d[8],K=d[12],W=d[1],O=d[5],ea=d[9],ra=d[13],va=d[2],I=d[6],V=d[10],pa=d[14],T=d[3],P=d[7],ca=d[11];d=d[15];b[0]=a*D+e*W+f*va+g*T;b[4]=a*H+e*O+f*I+g*P;b[8]=a*G+e*ea+f*V+g*ca;b[12]=a*K+e*ra+f*pa+g*d;b[1]=k*D+h*W+l*va+n*T;b[5]=k*H+h*O+l*I+n*P;b[9]=k*G+h*ea+l*V+n*ca;b[13]=k*K+h*ra+l*pa+n*d;b[2]=p*D+r*W+q*va+w*T;b[6]=p*H+r*O+q*I+w*P;b[10]=p*G+r*ea+q*V+w*ca;b[14]=p*K+r*ra+q*pa+w*d;b[3]=x*
D+t*W+A*va+c*T;b[7]=x*H+t*O+A*I+c*P;b[11]=x*G+t*ea+A*V+c*ca;b[15]=x*K+t*ra+A*pa+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=
a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){C.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){C.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){C.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new C.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){C.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){C.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],k=a[9],h=a[13],l=a[2],n=a[6],p=a[10],r=a[14];return a[3]*(+e*k*n-d*h*n-e*g*p+c*h*p+d*g*r-c*k*r)+a[7]*(+b*k*r-b*h*p+e*f*p-d*f*r+d*h*l-e*k*l)+a[11]*(+b*h*n-b*g*r-e*f*n+c*f*r+e*g*l-c*h*l)+a[15]*(-d*g*l-b*k*n+b*g*p+d*f*n-c*f*p+c*k*l)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=
a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new C.Vector3;return function(){C.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var b=this.elements;
return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var e=d[4],f=d[8],g=d[12],k=d[1],h=d[5],l=d[9],n=d[13],p=d[2],r=d[6],q=d[10],w=d[14],x=d[3],t=d[7],A=d[11];d=d[15];c[0]=l*w*t-n*q*t+n*r*A-h*w*A-l*r*d+h*q*d;c[4]=g*q*t-f*w*t-g*r*A+e*w*A+f*r*d-e*q*d;c[8]=f*n*t-g*l*t+g*h*A-e*n*A-f*h*d+e*l*d;c[12]=g*l*r-f*n*r-g*h*q+e*n*q+f*h*w-e*l*w;c[1]=n*q*x-l*w*x-n*p*A+k*w*A+l*p*
d-k*q*d;c[5]=f*w*x-g*q*x+g*p*A-a*w*A-f*p*d+a*q*d;c[9]=g*l*x-f*n*x-g*k*A+a*n*A+f*k*d-a*l*d;c[13]=f*n*p-g*l*p+g*k*q-a*n*q-f*k*w+a*l*w;c[2]=h*w*x-n*r*x+n*p*t-k*w*t-h*p*d+k*r*d;c[6]=g*r*x-e*w*x-g*p*t+a*w*t+e*p*d-a*r*d;c[10]=e*n*x-g*h*x+g*k*t-a*n*t-e*k*d+a*h*d;c[14]=g*h*p-e*n*p-g*k*r+a*n*r+e*k*w-a*h*w;c[3]=l*r*x-h*q*x-l*p*t+k*q*t+h*p*A-k*r*A;c[7]=e*q*x-f*r*x+f*p*t-a*q*t-e*p*A+a*r*A;c[11]=f*h*x-e*l*x-f*k*t+a*l*t+e*k*A-a*h*A;c[15]=e*l*p-f*h*p+f*k*r-a*l*r-e*k*q+a*h*q;c=a*c[0]+k*c[4]+p*c[8]+x*c[12];if(0==
c){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");C.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(){C.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){C.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){C.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){C.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(){C.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,
0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,f=a.y;a=a.z;var g=d*e,k=d*f;this.set(g*e+c,g*f-b*a,g*a+b*f,0,g*
f+b*a,k*f+c,k*a-b*e,0,g*a-b*f,k*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new C.Vector3,b=new C.Matrix4;return function(c,d,e){var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),k=a.set(f[4],f[5],f[6]).length(),h=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=f[12];c.y=f[13];
c.z=f[14];b.elements.set(this.elements);c=1/g;f=1/k;var l=1/h;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=l;b.elements[9]*=l;b.elements[10]*=l;d.setFromRotationMatrix(b);e.x=g;e.y=k;e.z=h;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=0;g[11]=-1;g[15]=
0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(C.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,k=b-a,h=c-d,l=f-e;g[0]=2/k;g[4]=0;g[8]=0;g[12]=-((b+a)/k);g[1]=0;g[5]=2/h;g[9]=0;g[13]=-((c+d)/h);g[2]=0;g[6]=0;g[10]=-2/l;g[14]=-((f+e)/l);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],
a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new C.Matrix4).fromArray(this.elements)}};C.Triangle=function(a,b,c){this.a=void 0!==a?a:new C.Vector3;this.b=void 0!==b?b:new C.Vector3;this.c=void 0!==c?c:new C.Vector3};C.Triangle.normal=function(){var a=new C.Vector3;return function(b,c,d,e){e=e||new C.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();
C.Triangle.barycoordFromPoint=function(){var a=new C.Vector3,b=new C.Vector3,c=new C.Vector3;return function(d,e,f,g,k){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var h=b.dot(b);g=b.dot(c);var l=d*h-e*e;k=k||new C.Vector3;if(0==l)return k.set(-2,-1,-1);l=1/l;h=(h*f-e*g)*l;d=(d*g-e*f)*l;return k.set(1-h-d,d,h)}}();
C.Triangle.containsPoint=function(){var a=new C.Vector3;return function(b,c,d,e){b=C.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
C.Triangle.prototype={constructor:C.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new C.Vector3,b=new C.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new C.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return C.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new C.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return C.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return C.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},clone:function(){return(new C.Triangle).copy(this)}};
C.Ray=function(a,b){this.origin=void 0!==a?a:new C.Vector3;this.direction=void 0!==b?b:new C.Vector3};
C.Ray.prototype={constructor:C.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new C.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new C.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){b=b||new C.Vector3;b.subVectors(a,this.origin);a=b.dot(this.direction);
return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(){var a=new C.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(){var a=new C.Vector3,b=new C.Vector3,c=new C.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();
c.copy(this.origin).sub(a);var k=.5*d.distanceTo(e),h=-this.direction.dot(b),l=c.dot(this.direction),n=-c.dot(b),p=c.lengthSq(),r=Math.abs(1-h*h);if(0<r){d=h*n-l;e=h*l-n;var q=k*r;0<=d?e>=-q?e<=q?(k=1/r,d*=k,e*=k,h=d*(d+h*e+2*l)+e*(h*d+e+2*n)+p):(e=k,d=Math.max(0,-(h*e+l)),h=-d*d+e*(e+2*n)+p):(e=-k,d=Math.max(0,-(h*e+l)),h=-d*d+e*(e+2*n)+p):e<=-q?(d=Math.max(0,-(-h*k+l)),e=0<d?-k:Math.min(Math.max(-k,-n),k),h=-d*d+e*(e+2*n)+p):e<=q?(d=0,e=Math.min(Math.max(-k,-n),k),h=e*(e+2*n)+p):(d=Math.max(0,-(h*
k+l)),e=0<d?k:Math.min(Math.max(-k,-n),k),h=-d*d+e*(e+2*n)+p)}else e=0<h?-k:k,d=Math.max(0,-(h*e+l)),h=-d*d+e*(e+2*n)+p;f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return h}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new C.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d;b=b.radius*b.radius;if(e>b)return null;b=
Math.sqrt(b-e);e=d-b;d+=b;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,b)},isIntersectionBox:function(){var a=
new C.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,f=this.origin;if(0<=c){var g=(a.min.x-f.x)*c;c*=a.max.x-f.x}else g=(a.max.x-f.x)*c,c*=a.min.x-f.x;if(0<=d){var k=(a.min.y-f.y)*d;d*=a.max.y-f.y}else k=(a.max.y-f.y)*d,d*=a.min.y-f.y;if(g>d||k>c)return null;if(k>g||g!==g)g=k;if(d<c||c!==c)c=d;0<=e?(k=(a.min.z-f.z)*e,a=(a.max.z-f.z)*e):(k=(a.max.z-f.z)*e,a=(a.min.z-f.z)*e);if(g>
a||k>c)return null;if(k>g||g!==g)g=k;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=g?g:c,b)},intersectTriangle:function(){var a=new C.Vector3,b=new C.Vector3,c=new C.Vector3,d=new C.Vector3;return function(e,f,g,k,h){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(k)return null;k=1}else if(0>f)k=-1,f=-f;else return null;a.subVectors(this.origin,e);e=k*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=k*this.direction.dot(b.cross(a));if(0>g||e+g>
f)return null;e=-k*a.dot(d);return 0>e?null:this.at(e/f,h)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new C.Ray).copy(this)}};C.Sphere=function(a,b){this.center=void 0!==a?a:new C.Vector3;this.radius=void 0!==b?b:0};
C.Sphere.prototype={constructor:C.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new C.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=c=0,f=b.length;e<f;e++)c=Math.max(c,d.distanceToSquared(b[e]));this.radius=Math.sqrt(c);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);b=b||new C.Vector3;b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){a=a||new C.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new C.Sphere).copy(this)}};C.Plane=function(a,b){this.normal=void 0!==a?a:new C.Vector3(1,0,0);this.constant=void 0!==b?b:0};
C.Plane.prototype={constructor:C.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new C.Vector3,b=new C.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,c);return this}}(),
copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){a=this.distanceToPoint(a);return(b||new C.Vector3).copy(this.normal).multiplyScalar(a)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new C.Vector3;return function(b,c){c=c||new C.Vector3;var d=b.delta(a),e=this.normal.dot(d);if(0==e){if(0==this.distanceToPoint(b.start))return c.copy(b.start)}else if(e=-(b.start.dot(this.normal)+this.constant)/e,!(0>e||1<e))return c.copy(d).multiplyScalar(e).add(b.start)}}(),
coplanarPoint:function(a){return(a||new C.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new C.Vector3,b=new C.Vector3,c=new C.Matrix3;return function(d,e){e=e||c.getNormalMatrix(d);e=a.copy(this.normal).applyMatrix3(e);var f=this.coplanarPoint(b);f.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(e,f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant==
this.constant},clone:function(){return(new C.Plane).copy(this)}};
C.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?b[e]="-":14==e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19==e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;
if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return Math.floor(this.randFloat(a,b))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=
180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};C.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
C.Clock.prototype={constructor:C.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();a=
.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};C.EventDispatcher=function(){};
C.EventDispatcher.prototype={constructor:C.EventDispatcher,apply:function(a){a.addEventListener=C.EventDispatcher.prototype.addEventListener;a.hasEventListener=C.EventDispatcher.prototype.hasEventListener;a.removeEventListener=C.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=C.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,
b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};
C.Object3D=function(){Object.defineProperty(this,"id",{value:C.Object3DIdCount++});this.name="";this.parent=void 0;this.children=[];this.up=C.Object3D.DefaultUp.clone();var a=new C.Vector3,b=new C.Euler,c=new C.Quaternion,d=new C.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d}});
this.rotationAutoUpdate=!0;this.matrix=new C.Matrix4;this.matrixWorld=new C.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};C.Object3D.DefaultUp=new C.Vector3(0,1,0);
C.Object3D.prototype={constructor:C.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new C.Quaternion;
return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new C.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new C.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new C.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new C.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));
return this}}(),translate:function(a,b){C.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},translateX:function(){var a=new C.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new C.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new C.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},
worldToLocal:function(){var a=new C.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new C.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return C.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a instanceof C.Object3D?(void 0!==
a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):C.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getChildByName:function(a){C.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(a)},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new C.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=
new C.Vector3,b=new C.Vector3;return function(c){c=c||new C.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new C.Quaternion;return function(b){b=b||new C.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new C.Vector3,b=new C.Quaternion;return function(c){c=c||new C.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=
new C.Quaternion;return function(b){b=b||new C.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverseVisible(a)}},traverseAncestors:function(a){this.parent&&(a(this.parent),this.parent.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,
this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},clone:function(a,b){void 0===a&&(a=new C.Object3D);void 0===b&&(b=!0);a.name=
this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===
b)for(b=0;b<this.children.length;b++)a.add(this.children[b].clone());return a}};C.EventDispatcher.prototype.apply(C.Object3D.prototype);C.Object3DIdCount=0;C.Face3=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d instanceof C.Vector3?d:new C.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof C.Color?e:new C.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==f?f:0};
C.Face3.prototype={constructor:C.Face3,clone:function(){var a=new C.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;for(var b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
C.BufferAttribute=function(a,b){this.array=a;this.itemSize=b;this.needsUpdate=!1};
C.BufferAttribute.prototype={constructor:C.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},setX:function(a,b){this.array[a*this.itemSize]=b;return this},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},setXY:function(a,
b,c){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return new C.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
C.BufferGeometry=function(){Object.defineProperty(this,"id",{value:C.GeometryIdCount++});this.name="";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
C.BufferGeometry.prototype={constructor:C.BufferGeometry,addAttribute:function(a,b){this.attributes[a]=b;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new C.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),
b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.applyMatrix((new C.Matrix4).setPosition(a));return a},computeBoundingBox:function(){var a=new C.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new C.Box3);var b=this.attributes.position.array;if(b){var c=this.boundingBox;c.makeEmpty();for(var d=0,e=b.length;d<e;d+=
3)a.set(b[d],b[d+1],b[d+2]),c.expandByPoint(a)}if(void 0===b||0===b.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&C.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new C.Box3,b=new C.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=
new C.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),a.expandByPoint(b);a.center(d);var g=0;e=0;for(f=c.length;e<f;e+=3)b.set(c[e],c[e+1],c[e+2]),g=Math.max(g,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(g);isNaN(this.boundingSphere.radius)&&C.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),
computeVertexNormals:function(){var a=this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new C.BufferAttribute(new Float32Array(b.length),3));else for(var c=a.normal.array,d=0,e=c.length;d<e;d++)c[d]=0;c=a.normal.array;var f=new C.Vector3,g=new C.Vector3,k=new C.Vector3,h=new C.Vector3,l=new C.Vector3;if(a.index)for(var n=a.index.array,p=0<this.offsets.length?this.offsets:[{start:0,count:n.length,index:0}],r=0,q=p.length;r<q;++r){e=p[r].start;var w=
p[r].count;var x=p[r].index;d=e;for(e+=w;d<e;d+=3){w=3*(x+n[d]);var t=3*(x+n[d+1]);var A=3*(x+n[d+2]);f.fromArray(b,w);g.fromArray(b,t);k.fromArray(b,A);h.subVectors(k,g);l.subVectors(f,g);h.cross(l);c[w]+=h.x;c[w+1]+=h.y;c[w+2]+=h.z;c[t]+=h.x;c[t+1]+=h.y;c[t+2]+=h.z;c[A]+=h.x;c[A+1]+=h.y;c[A+2]+=h.z}}else for(d=0,e=b.length;d<e;d+=9)f.fromArray(b,d),g.fromArray(b,d+3),k.fromArray(b,d+6),h.subVectors(k,g),l.subVectors(f,g),h.cross(l),c[d]=h.x,c[d+1]=h.y,c[d+2]=h.z,c[d+3]=h.x,c[d+4]=h.y,c[d+5]=h.z,
c[d+6]=h.x,c[d+7]=h.y,c[d+8]=h.z;this.normalizeNormals();a.normal.needsUpdate=!0}},computeTangents:function(){function a(ja,ta,X){p.fromArray(d,3*ja);r.fromArray(d,3*ta);q.fromArray(d,3*X);w.fromArray(f,2*ja);x.fromArray(f,2*ta);t.fromArray(f,2*X);A=r.x-p.x;D=q.x-p.x;H=r.y-p.y;G=q.y-p.y;K=r.z-p.z;W=q.z-p.z;O=x.x-w.x;ea=t.x-w.x;ra=x.y-w.y;va=t.y-w.y;I=1/(O*va-ea*ra);V.set((va*A-ra*D)*I,(va*H-ra*G)*I,(va*K-ra*W)*I);pa.set((O*D-ea*A)*I,(O*G-ea*H)*I,(O*W-ea*K)*I);h[ja].add(V);h[ta].add(V);h[X].add(V);
l[ja].add(pa);l[ta].add(pa);l[X].add(pa)}function b(ja){Z.fromArray(e,3*ja);ka.copy(Z);M=h[ja];Q.copy(M);Q.sub(Z.multiplyScalar(Z.dot(M))).normalize();ia.crossVectors(ka,M);fa=ia.dot(l[ja]);ma=0>fa?-1:1;k[4*ja]=Q.x;k[4*ja+1]=Q.y;k[4*ja+2]=Q.z;k[4*ja+3]=ma}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)C.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");
else{var c=this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,f=this.attributes.uv.array,g=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new C.BufferAttribute(new Float32Array(4*g),4));for(var k=this.attributes.tangent.array,h=[],l=[],n=0;n<g;n++)h[n]=new C.Vector3,l[n]=new C.Vector3;var p=new C.Vector3,r=new C.Vector3,q=new C.Vector3,w=new C.Vector2,x=new C.Vector2,t=new C.Vector2,A,D,H,G,K,W,O,ea,ra,va,I,V=new C.Vector3,pa=new C.Vector3,
T;0===this.drawcalls.length&&this.addDrawCall(0,c.length,0);var P=this.drawcalls;n=0;for(T=P.length;n<T;++n){var ca=P[n].start;var J=P[n].count;var aa=P[n].index;g=ca;for(ca+=J;g<ca;g+=3){J=aa+c[g];var na=aa+c[g+1];var L=aa+c[g+2];a(J,na,L)}}var Q=new C.Vector3,ia=new C.Vector3,Z=new C.Vector3,ka=new C.Vector3,ma,M,fa;n=0;for(T=P.length;n<T;++n)for(ca=P[n].start,J=P[n].count,aa=P[n].index,g=ca,ca+=J;g<ca;g+=3)J=aa+c[g],na=aa+c[g+1],L=aa+c[g+2],b(J),b(na),b(L)}},normalizeNormals:function(){for(var a=
this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},clone:function(){var a=new C.BufferGeometry;for(b in this.attributes)a.addAttribute(b,this.attributes[b].clone());var b=0;for(var c=this.offsets.length;b<c;b++){var d=this.offsets[b];a.offsets.push({start:d.start,index:d.index,count:d.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};C.EventDispatcher.prototype.apply(C.BufferGeometry.prototype);
C.Camera=function(){C.Object3D.call(this);this.matrixWorldInverse=new C.Matrix4;this.projectionMatrix=new C.Matrix4};C.Camera.prototype=Object.create(C.Object3D.prototype);C.Camera.prototype.constructor=C.Camera;C.Camera.prototype.getWorldDirection=function(){var a=new C.Quaternion;return function(b){b=b||new C.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
C.Camera.prototype.lookAt=function(){var a=new C.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();C.Camera.prototype.clone=function(a){void 0===a&&(a=new C.Camera);C.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};
C.PerspectiveCamera=function(a,b,c,d){C.Camera.call(this);this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};C.PerspectiveCamera.prototype=Object.create(C.Camera.prototype);C.PerspectiveCamera.prototype.constructor=C.PerspectiveCamera;C.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*C.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
C.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=f;this.updateProjectionMatrix()};
C.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=C.Math.radToDeg(2*Math.atan(Math.tan(.5*C.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight;a=Math.tan(C.Math.degToRad(.5*a))*this.near;var c=-a,d=b*c;b=Math.abs(b*a-d);c=Math.abs(a-c);this.projectionMatrix.makeFrustum(d+this.x*b/this.fullWidth,d+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};C.PerspectiveCamera.prototype.clone=function(){var a=new C.PerspectiveCamera;C.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};C.OrthographicCamera=function(a,b,c,d,e,f){C.Camera.call(this);this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()};
C.OrthographicCamera.prototype=Object.create(C.Camera.prototype);C.OrthographicCamera.prototype.constructor=C.OrthographicCamera;C.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)};
C.OrthographicCamera.prototype.clone=function(){var a=new C.OrthographicCamera;C.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};C.Mesh=function(a,b){C.Object3D.call(this);this.geometry=void 0!==a?a:new C.Geometry;this.material=void 0!==b?b:new C.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};
C.Mesh.prototype=Object.create(C.Object3D.prototype);C.Mesh.prototype.constructor=C.Mesh;C.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
C.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];C.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};C.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new C.Mesh(this.geometry,this.material));C.Object3D.prototype.clone.call(this,a,b);return a};C.Scene=function(){C.Object3D.call(this);this.overrideMaterial=null;this.autoUpdate=!0};C.Scene.prototype=Object.create(C.Object3D.prototype);
C.Scene.prototype.constructor=C.Scene;C.Scene.prototype.clone=function(a){void 0===a&&(a=new C.Scene);C.Object3D.prototype.clone.call(this,a);null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};
C.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];b[c][d]=e&&void 0!==e.clone?e.clone():e instanceof Array?e.slice():e}}return b}};
C.BoxBufferGeometry=function(a,b,c,d,e,f){function g(r,q,w,x,t,A,D,H,G,K){var W=A/G,O=D/K,ea=A/2,ra=D/2,va=H/2;D=G+1;var I=K+1;A=0;var V,pa,T=new C.Vector3;for(pa=0;pa<I;pa++){var P=pa*O-ra;for(V=0;V<D;V++)T[r]=(V*W-ea)*x,T[q]=P*t,T[w]=va,h.push(T.x,T.y,T.z),T[r]=0,T[q]=0,T[w]=0<H?1:-1,l.push(T.x,T.y,T.z),n.push(V/G),n.push(1-pa/K),A+=1}for(pa=0;pa<K;pa++)for(V=0;V<G;V++)r=p+V+D*(pa+1),q=p+(V+1)+D*(pa+1),w=p+(V+1)+D*pa,k.push(p+V+D*pa,r,w),k.push(r,q,w);p+=A}C.BufferGeometry.call(this);this.parameters=
{width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var k=[],h=[],l=[],n=[],p=0;g("z","y","x",-1,-1,c,b,a,f,e);g("z","y","x",1,-1,c,b,-a,f,e);g("x","z","y",1,1,a,c,b,d,f);g("x","z","y",1,-1,a,c,-b,d,f);g("x","y","z",1,-1,a,b,c,d,e);g("x","y","z",-1,-1,a,b,-c,d,e);console.assert(65536>=h.length);this.addAttribute("index",new C.BufferAttribute(new Uint16Array(k),1));this.addAttribute("position",new C.BufferAttribute(new Float32Array(h),
3));this.addAttribute("normal",new C.BufferAttribute(new Float32Array(l),3));this.addAttribute("uv",new C.BufferAttribute(new Float32Array(n),2))};C.BoxBufferGeometry.prototype=Object.create(C.BufferGeometry.prototype);C.BoxBufferGeometry.prototype.constructor=C.BoxBufferGeometry;
C.SphereBufferGeometry=function(a,b,c,d,e,f,g){C.BufferGeometry.call(this);this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;var k=f+g,h,l,n=0,p=[],r=new C.Vector3,q=new C.Vector3,w=[],x=[],t=[],A=[];for(l=0;l<=c;l++){var D=[],H=l/c;for(h=0;h<=b;h++){var G=h/b;r.x=-a*Math.cos(d+G*e)*Math.sin(f+
H*g);r.y=a*Math.cos(f+H*g);r.z=a*Math.sin(d+G*e)*Math.sin(f+H*g);x.push(r.x,r.y,r.z);q.set(r.x,r.y,r.z).normalize();t.push(q.x,q.y,q.z);A.push(G,1-H);D.push(n++)}p.push(D)}for(l=0;l<c;l++)for(h=0;h<b;h++)a=p[l][h+1],d=p[l][h],e=p[l+1][h],g=p[l+1][h+1],(0!==l||0<f)&&w.push(a,d,g),(l!==c-1||k<Math.PI)&&w.push(d,e,g);console.assert(65536>=x.length);this.addAttribute("index",new C.BufferAttribute(new Uint16Array(w),1));this.addAttribute("position",new C.BufferAttribute(new Float32Array(x),3));this.addAttribute("normal",
new C.BufferAttribute(new Float32Array(t),3));this.addAttribute("uv",new C.BufferAttribute(new Float32Array(A),2))};C.SphereBufferGeometry.prototype=Object.create(C.BufferGeometry.prototype);C.SphereBufferGeometry.prototype.constructor=C.SphereBufferGeometry;
C.PlaneBufferGeometry=function(a,b,c,d){C.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=c||1;d=d||1;var g=c+1,k=d+1,h=a/c,l=b/d;b=new Float32Array(g*k*3);a=new Float32Array(g*k*3);for(var n=new Float32Array(g*k*2),p=0,r=0,q=0;q<k;q++)for(var w=q*l-f,x=0;x<g;x++)b[p]=x*h-e,b[p+1]=-w,a[p+2]=1,n[r]=x/c,n[r+1]=1-q/d,p+=3,r+=2;p=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(q=0;q<d;q++)for(x=
0;x<c;x++)f=x+g*(q+1),k=x+1+g*(q+1),h=x+1+g*q,e[p]=x+g*q,e[p+1]=f,e[p+2]=h,e[p+3]=f,e[p+4]=k,e[p+5]=h,p+=6;this.addAttribute("index",new C.BufferAttribute(e,1));this.addAttribute("position",new C.BufferAttribute(b,3));this.addAttribute("normal",new C.BufferAttribute(a,3));this.addAttribute("uv",new C.BufferAttribute(n,2))};C.PlaneBufferGeometry.prototype=Object.create(C.BufferGeometry.prototype);C.PlaneBufferGeometry.prototype.constructor=C.PlaneBufferGeometry;
C.CylinderBufferGeometry=function(a,b,c,d,e,f,g,k){function h(t){var A,D=new C.Vector2,H=new C.Vector3,G=!0===t?a:b,K=!0===t?1:-1;var W=q;for(A=1;A<=d;A++)n.push(0,x*K,0),p.push(0,K,0),r.push(.5,.5),q++;var O=q;for(A=0;A<=d;A++){var ea=A/d*k+g,ra=Math.cos(ea);ea=Math.sin(ea);H.x=G*ea;H.y=x*K;H.z=G*ra;n.push(H.x,H.y,H.z);p.push(0,K,0);D.x=.5*ra+.5;D.y=.5*ea*K+.5;r.push(D.x,D.y);q++}for(A=0;A<d;A++)D=W+A,H=O+A,!0===t?l.push(H,H+1,D):l.push(H+1,H,D)}C.BufferGeometry.call(this);this.parameters={radiusTop:a,
radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:k};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;k=void 0!==k?k:2*Math.PI;var l=[],n=[],p=[],r=[],q=0,w=[],x=c/2;(function(){var t,A,D=new C.Vector3,H=new C.Vector3,G=(b-a)/c;for(A=0;A<=e;A++){var K=[],W=A/e,O=W*(b-a)+a;for(t=0;t<=d;t++){var ea=t/d,ra=ea*k+g,va=Math.sin(ra);ra=Math.cos(ra);H.x=O*va;H.y=-W*c+x;H.z=O*ra;n.push(H.x,
H.y,H.z);D.set(va,G,ra).normalize();p.push(D.x,D.y,D.z);r.push(ea,1-W);K.push(q++)}w.push(K)}for(t=0;t<d;t++)for(A=0;A<e;A++)D=w[A+1][t],H=w[A+1][t+1],G=w[A][t+1],l.push(w[A][t],D,G),l.push(D,H,G)})();!1===f&&(0<a&&h(!0),0<b&&h(!1));console.assert(65536>=n.length);this.addAttribute("index",new C.BufferAttribute(new Uint16Array(l),1));this.addAttribute("position",new C.BufferAttribute(new Float32Array(n),3));this.addAttribute("normal",new C.BufferAttribute(new Float32Array(p),3));this.addAttribute("uv",
new C.BufferAttribute(new Float32Array(r),2))};C.CylinderBufferGeometry.prototype=Object.create(C.BufferGeometry.prototype);C.CylinderBufferGeometry.prototype.constructor=C.CylinderBufferGeometry;
C.TorusBufferGeometry=function(a,b,c,d,e){C.BufferGeometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=[],g=[],k=[],h=[],l=new C.Vector3,n=new C.Vector3,p=new C.Vector3,r,q;for(r=0;r<=c;r++)for(q=0;q<=d;q++){var w=q/d*e,x=r/c*Math.PI*2;n.x=(a+b*Math.cos(x))*Math.cos(w);n.y=(a+b*Math.cos(x))*Math.sin(w);n.z=b*Math.sin(x);g.push(n.x,n.y,n.z);l.x=a*Math.cos(w);l.y=a*Math.sin(w);p.subVectors(n,
l).normalize();k.push(p.x,p.y,p.z);h.push(q/d);h.push(r/c)}for(r=1;r<=c;r++)for(q=1;q<=d;q++)a=(d+1)*(r-1)+q-1,b=(d+1)*(r-1)+q,e=(d+1)*r+q,f.push((d+1)*r+q-1,a,e),f.push(a,b,e);console.assert(65536>=g.length);this.addAttribute("index",new C.BufferAttribute(new Uint16Array(f),1));this.addAttribute("position",new C.BufferAttribute(new Float32Array(g),3));this.addAttribute("normal",new C.BufferAttribute(new Float32Array(k),3));this.addAttribute("uv",new C.BufferAttribute(new Float32Array(h),2))};
C.TorusBufferGeometry.prototype=Object.create(C.BufferGeometry.prototype);C.TorusBufferGeometry.prototype.constructor=C.TorusBufferGeometry;/*
 Copyright (C) 2014-present Shapespark
*/
var xa=2*Math.PI;function Ha(a,b){if(0===a.length)return null;var c=0;b=b?b:function(g){return g};for(var d=b(a[0]),e=1;e<a.length;e+=1){var f=b(a[e]);f>d&&(c=e,d=f)}return c}function Ia(a,b){a=b.indexOf(a);console.assert(-1!==a);return b.splice(a,1)}function Ja(a,b,c){for(var d=a.indexOf(b),e=c>d?1:-1;d!==c;d+=e)a[d]=a[d+e];a[c]=b}function La(a,b,c){for(var d=0;d<b.length;d+=1){var e=b[d],f=a[e];void 0!==f&&(c[e]=f)}}function Oa(a){a%=xa;return a>Math.PI?-xa+a:a<-Math.PI?xa+a:a}
function Ra(a,b){return Math.atan2(-(b.x-a.x),b.y-a.y)}function Sa(a,b){void 0!==a.textContent?a.textContent=b:void 0!==a.innerText?a.innerText=b:console.warn("textContent and innerText properties are missing")}function Ua(a,b){void 0===b&&(b=3);return+(Math.round(a+"e+"+b)+"e-"+b)}function Ya(a){var b=new Image;b.src=a;return b}
function cb(a,b){function c(){a.readyState>=a.HAVE_CURRENT_DATA&&(a.removeEventListener("playing",c),a.removeEventListener("timeupdate",c),b(a))}a.readyState>=a.HAVE_CURRENT_DATA?b(a):(a.addEventListener("playing",c),a.addEventListener("timeupdate",c))}function ib(a){return JSON.parse(JSON.stringify(a))}function mb(a){return"object"===typeof a?Object.freeze(ib(a)):a}
function nb(a,b){if(a===b)return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b||Object.keys(a).length!==Object.keys(b).length)return!1;for(var c=m.makeIterator(Object.keys(a)),d=c.next();!d.done;d=c.next())if(d=d.value,!b.hasOwnProperty(d)||!nb(a[d],b[d]))return!1;return!0}
function ob(a){a:{var b=document.getElementsByTagName("script");b=m.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=c.value;var d=c.src.includes("main.js"),e=c.src.includes("walk.min.js");if(d||e){b=c.src.split("/").slice(0,-1).join("/")+"/";break a}}console.error("Cannot determine webwalk URL.");b="/webwalk/"}return b+a}var pb={FontAwesomeSolid:"\uf2b9",FontAwesomeRegular:"\uf2b9",FontAwesomeBrands:"\uf293"};
function qb(a,b,c){function d(k){k?++f:++g;f+g===a.length&&(0===g?b():c&&c())}if(0===a.length)b();else{var e={};a.forEach(function(k){console.assert(pb[k],"Font "+JSON.stringify(k)+" is not supported.");e[k]=pb[k]});var f=0,g=0;WebFont.load({custom:{families:a,testStrings:e},timeout:1E4,fontactive:function(){d(!0)},fontinactive:function(k){console.error("Cannot load font: "+k);d(!1)}})}}function tb(a){return a.startsWith("extra-assets/")?S.ASSETS_URL+a:S.ASSETS_URL+"extra-assets/"+a}
function vb(){}function zb(a){zb[" "](a);return a}zb[" "]=function(){return null};function Db(a){var b={};a&&a.substring(1).split("&").forEach(function(c){var d=c.indexOf("=");0<=d?b[c.substring(0,d)]=c.substring(d+1):b[c]=void 0});return b}function Eb(a){return a in Db(window.location.hash)}function Fb(a){var b=Db(window.location.hash);return a in b&&void 0!==b[a]?decodeURI(b[a]):null}
var S={ASSETS_URL:"./",EDIT_MODE:"editor"in Db(window.location.search),NO_SCREENSHOTS:Eb("noscreenshots"),DEBUG:Eb("debug")||Eb("benchmark"),DEBUG_WEBGL:Eb("debugwebgl"),DEBUG_WEBGL_ERROR:Eb("debugwebgl_error"),DEBUG_WEBGL_CALL:Eb("debugwebgl_call"),DEBUG_SPECTOR:Eb("debugspector"),BENCHMARK:Eb("benchmark"),BENCHMARK_OUTPUT:Fb("benchmark_output"),BENCHMARK_MEASUREMENTS:Fb("benchmark_measurements"),BENCHMARK_LIST_ALL:Eb("benchmark_list_all"),DEBUG_SHARED_BUFFERS:Eb("debugbuffers"),DEBUG_CAMERA_PATH:Eb("debugcamerapath"),
DEBUG_GEOMETRY_MERGING:Eb("debugmerge"),NO_PBR:Eb("nopbr"),ALWAYS_RENDER:Eb("alwaysrender"),LOG_INFO:Eb("log")||Eb("savelog"),LOG_TO_SERVER:Eb("savelog"),LOG_TIME:!1,PROGRESSIVE_LOADER_AFTER_SEC:30,CONTEXT_LOST_RESTORE_LIMIT:4,RETRIES_ON_LOAD_ERROR:3,DEFAULT_ANISOTROPY:4,NO_ANISOTROPY:1,FORCE_FXAA:Eb("fxaa"),FORCE_MOTION_BLUR:Eb("motionblur"),FORCE_WEBGL1:Eb("webgl1"),FONT_FAMILIES_TO_LOAD:[],MAX_TWO_POINTERS_IN_LINE_DIFF:40,CAMERA_WALK_NEAR:.01,CAMERA_ORBIT_NEAR_FROM_1M:.01,CAMERA_MIN_FAR:100,SKY_DISTANCE_TO_SCENE:100,
CAMERA_DEFAULT_FOV:70,FORCE_ORTHO:Eb("ortho"),CAMERA_ORTHO_FRUSTUM_SIZE:20,CAMERA_DEFAULT_MOVE_MAX_SPEED:1.11,CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:2,CAMERA_LOOK_SPEED:Math.PI/1500,CAMERA_LOOK_SMOOTHING:.1,CAMERA_ARROWS_TURN_SPEED:Math.PI/2,CAMERA_SCROLL_SPEED:.5,CAMERA_FULL_ACCELERATION_TIME:.5,CAMERA_FULL_DECELERATION_TIME:.166,CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE:1,CAMERA_FIXED_HEIGHT:null,MAX_GROUND_SEARCH_DEPTH:5.5,MATERIAL_PICKER_BALL_MAX_SIZE:.1,COVER_JSON_URL:"./cover.json",AUTO_TOUR_IN_VIEW_STILL_TIME_MS:3E3,
CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE:.7,CLICK_MOVE_SHOW_TARGET_INDICATOR:!Eb("nomovetarget"),KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE:.1,MIN_DISTANCE_TO_CEILING:.1,LIGHT_PROBE_MIRROR_SIZE:512,LIGHT_PROBE_MAX_MIP_SIZE:128,LIGHT_PROBE_MIN_MIP_SIZE:4,LIGHT_PROBE_GLOSS_FOR_MIP:[.99,.9,.85,.7,.4,.25],DEBUG_LIGHT_PROBE_MIPS:!1,ENABLE_AUTO_EXPOSURE_CONTROLS:!1,EDITOR_COVER_WIDTH:1920,EDITOR_COVER_HEIGHT:1080,MAX_PANORAMA_SIZE:8192,OBJECT_VISIBILITY_TARGET_SIZE:128,DEFAULT_SKY_NAME:"default",EDITOR_CONTROLLED_SKY_NAME:"sky0",
EDITOR_SELECTION_COLOR:(new C.Color(5021401)).convertGammaToLinear(),ALLOW_MOBILE_VR:!0,FALLBACK_CAMERA_HEIGHT:1.6,LOAD_PRIORITY:{CORE_RESOURCE:0,COLORMAP:1,UV0:1,DIFFUSE:2,LIGHTMAP:3,SKY:4,SPECULARITY:5,VIDEO:6},MERGE_TRANSPARENT_DISABLED:Eb("nomergetransparent"),urlHashContains:Eb,urlHashGetArgument:Fb,urlHashRemoveArgument:function(a){var b=Db(window.location.hash);return Object.keys(b).filter(function(c){return c!==a}).map(function(c){var d=b[c];return c+(void 0===d?"":"="+d)}).join("&")},TELEPORT_TO_VIEW_MAX_TIME:3,
TELEPORT_TO_POINT_MAX_TIME:4.5,TELEPORT_PATH_MAX_TIME:6,TELEPORT_TO_VIEW_ACCELERATION:4,TELEPORT_TO_POINT_ACCELERATION:2,TELEPORT_PATH_ACCELERATION:2,GAZE_POINTER_SHOW_LOADING_AFTER_S:2.5,GAZE_POINTER_ACTIVATE_AFTER_S:4.5,SPRITE_ANCHOR_FONT_SIZE:128,POINTER_PRIORITY:{TRANSFORM_CONTROLS:1,EDITOR_SELECTOR:2,INTERACTION_DISPATCHER:3},AVATAR_COLORS:"#f44336 #e81e63 #9c27b0 #673ab7 #3f51b5 #2196f3 #03a9f4 #00bcd4 #009688 #4caf50 #8bc34a #cddc39 #ffeb3b #ffc107 #ff9800 #ff5722 #795548 #9e9e9e #607d8b #ff5084".split(" "),
STRINGS:{},DEFAULT_LANGUAGE:"English",ENABLE_MINIMAP:!0,FLIP_MOUSE:Eb("flipmouse"),AUTO_PLAY:Eb("autoplay"),HIDE_PLAY:Eb("hideplay"),SHOW_HELP_ON_LOAD:Eb("help"),GAZE_IN_POINTER_LOCK:Eb("gazeinpointerlock"),NO_GAZE_TELEPORT:Eb("nogazeteleport"),VR_LO:Eb("vrlo"),VR_HI:Eb("vrhi"),MOBILE_HI:Eb("mobilehi"),NO_BASIS:Eb("nobasis"),NO_WEBP:Eb("nowebp"),ENABLE_REFLECTION_PROBES_BLENDING:!0,MAX_BLENDED_REFLECTION_PROBES:3,DEV_NEW_RENDER_ARCHITECTURE:Eb("devnewrenderer")};
S.LIGHT_PROBE_MIPS_COUNT=Math.log(S.LIGHT_PROBE_MAX_MIP_SIZE)/Math.log(2)-Math.log(S.LIGHT_PROBE_MIN_MIP_SIZE)/Math.log(2)+1;var Mb={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FUNC_ADD:32774,FUNC_SUBTRACT:32778,
FUNC_REVERSE_SUBTRACT:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,HALF_FLOAT_OES:36193,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,
COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4x4_KHR:37808};var Nb={cardboardConfig:{ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:null,CARDBOARD_UI_DISABLED:!1,K_FILTER:.98,ROTATE_INSTRUCTIONS_DISABLED:!1,PREDICTION_TIME_S:.04,YAW_ONLY:!1,BUFFER_SCALE:1,DIRTY_SUBMIT_FRAME_BINDINGS:!1}};var Ob={Chinese:{help:{basic:"\u57fa\u672c",advanced:"\u9ad8\u7ea7",mouse:"\u6ed1\u9f20",or:"\u6216",keyboard:"\u952e\u76d8",vrTeleport:"VR \u4f20\u9001",holdLeftButton:"\u6309\u4f4f\u5de6\u952e",clickLeftButton:"\u5355\u6309\u5de6\u952e",lookAround:"\u8c03\u6574\u89c6\u89d2",walkToClickedPlace:"\u8d70\u53bb\u6307\u5b9a\u5730\u70b9",selectMaterialLightObject:"\u9009\u62e9\u6750\u8d28\uff0c\u706f\u5149\uff0c\u7269\u4f53",scroll:"\u6ed1\u8f6e",walkStraight:"\u76f4\u8d70",walkStraightAndLookAround:"\u8c03\u6574\u89c6\u89d2",
walkStraightAndSideways:"\u79fb\u52a8",changeHeight:"\u8c03\u6574\u9ad8\u5ea6",switchView:"\u79fb\u52a8\u81f3\u6307\u5b9a\u89c6\u89d2",screenshot:"\u622a\u56fe",illuminationPreview:"\u7167\u660e\u9884\u89c8",hideShowMenu:"\u9690\u85cf/\u663e\u793a\u83dc\u5355",hideShowMousePointer:"\u9690\u85cf/\u663e\u793a\u9f20\u6807",vrMode:"VR \u6a21\u5f0f",gazeAtFixedPlace:"\u51dd\u89c6\u4e00\u4e2a\u56fa\u5b9a\u7684\u5730\u65b9",clickControllerButton:"\u5355\u51fb\u63a7\u5236\u5668\u6309\u94ae",teleport:"\u4f20\u9001",
touch:"\u89e6\u78b0"}},German:{help:{basic:"GRUNDLAGEN",advanced:"ERWEITERT",mouse:"Maus",or:"oder",keyboard:"Tastatur",vrTeleport:"VR-Teleport",holdLeftButton:"Linke Maustaste gedr\u00fcckt halten",clickLeftButton:"Klick auf die linke Maustaste",lookAround:"Umschauen",walkToClickedPlace:"Zum angeklickten Punkt bewegen",selectMaterialLightObject:"Material, Licht, Objekt ausw\u00e4hlen",scroll:"Mausrad",walkStraight:"Geradeaus gehen",walkStraightAndLookAround:"Geradeaus gehen und umsehen",walkStraightAndSideways:"Geradeaus und seitw\u00e4rts gehen",
changeHeight:"H\u00f6he \u00e4ndern",switchView:"Ansicht wechseln",screenshot:"Bildschirmfoto",illuminationPreview:"Beleuchtungsvorschau",hideShowMenu:"Men\u00fc aus- / einblenden",hideShowMousePointer:"Mauszeiger aus-/einblenden",vrMode:"VR-Modus",gazeAtFixedPlace:"Blick auf einem Punkt fixieren",clickControllerButton:"Controller Taste dr\u00fccken",teleport:"Teleportieren",touch:"Tippen"}},English:{help:{basic:"BASIC",advanced:"ADVANCED",mouse:"Mouse",or:"or",keyboard:"Keyboard",vrTeleport:"VR teleport",
holdLeftButton:"Hold the left button",clickLeftButton:"Click the left button",lookAround:"Look around",walkToClickedPlace:"Walk to the clicked place",selectMaterialLightObject:"Select material, light, object",scroll:"Scroll",walkStraight:"Walk straight",walkStraightAndLookAround:"Walk straight and look around",walkStraightAndSideways:"Walk straight and sideways",changeHeight:"Change height",switchView:"Switch view",screenshot:"Screenshot",illuminationPreview:"Illumination preview",hideShowMenu:"Hide/show menu",
hideShowMousePointer:"Hide/show mouse pointer",vrMode:"VR Mode",gazeAtFixedPlace:"Gaze at a fixed place",clickControllerButton:"Click a controller button",teleport:"Teleport",touch:"Touch",interactiveDesktop:"Click and drag to look around",interactiveMobile:"Drag to look around"}},Spanish:{help:{basic:"B\u00c1SICO",advanced:"AVANZADO",mouse:"Rat\u00f3n",or:"o",keyboard:"Teclado",vrTeleport:"Teletransporte VR",holdLeftButton:"Mant\u00e9n presionado el bot\u00f3n izquierdo",clickLeftButton:"Haz clic en el bot\u00f3n izquierdo",
lookAround:"Mira a tu alrededor",walkToClickedPlace:"Camina hasta el lugar donde hiciste clic",selectMaterialLightObject:"Selecciona material, luz, objeto",scroll:"Despl\u00e1zate",walkStraight:"Camina en l\u00ednea recta",walkStraightAndLookAround:"Camina en l\u00ednea recta y mira a tu alrededor",walkStraightAndSideways:"Camina recto y de lado",changeHeight:"Cambiar altura",switchView:"Cambiar vista",screenshot:"Captura de pantalla",illuminationPreview:"Vista previa de iluminaci\u00f3n",hideShowMenu:"Ocultar / mostrar men\u00fa",
hideShowMousePointer:"Ocultar / mostrar el puntero del rat\u00f3n",vrMode:"Modo VR",gazeAtFixedPlace:"Mira a un punto fijo",clickControllerButton:"Pulsa un bot\u00f3n del mando",teleport:"Teletransporte",touch:"Tocar"}},French:{help:{basic:"BASIQUES",advanced:"AVANC\u00c9S",mouse:"Souris",or:"ou",keyboard:"Clavier",vrTeleport:"T\u00e9l\u00e9portation VR",holdLeftButton:"Maintenez le bouton gauche",clickLeftButton:"Cliquez sur le bouton gauche",lookAround:"Regardez autour",walkToClickedPlace:"D\u00e9placez-vous jusqu\u2019\u00e0 l\u2019endroit cliqu\u00e9",
selectMaterialLightObject:"S\u00e9lectionnez le mat\u00e9riel, la lumi\u00e8re, l\u2019objet",scroll:"D\u00e9filement",walkStraight:"Allez tout droit",walkStraightAndLookAround:"Allez tout droit et regardez autour",walkStraightAndSideways:"Allez tout droit et de c\u00f4t\u00e9",changeHeight:"Changez la hauteur",switchView:"Changez de vue",screenshot:"Capture d\u2019\u00e9cran",illuminationPreview:"Aper\u00e7u de l\u2019\u00e9clairage",hideShowMenu:"Masquer / Afficher le menu",hideShowMousePointer:"Masquer / Afficher le pointeur de la souris",
vrMode:"Mode RV",gazeAtFixedPlace:"Fixez un endroit pr\u00e9cis",clickControllerButton:"Appuyez sur un bouton du contr\u00f4leur",teleport:"T\u00e9l\u00e9portation",touch:"Touchez"}},Japanese:{help:{basic:"\u57fa\u672c\u64cd\u4f5c",advanced:"\u8a73\u7d30\u64cd\u4f5c",mouse:"\u30de\u30a6\u30b9",or:"or",keyboard:"\u30ad\u30fc\u30dc\u30fc\u30c9",vrTeleport:"VR \u30c6\u30ec\u30dd\u30fc\u30c8",holdLeftButton:"\u5de6\u30dc\u30bf\u30f3\u3092\u9577\u62bc\u3057",lookAround:"\u898b\u56de\u3059",clickLeftButton:"\u5de6\u30dc\u30bf\u30f3",
walkToClickedPlace:"\u30af\u30ea\u30c3\u30af\u3057\u305f\u5834\u6240\u306b\u79fb\u52d5\u3059\u308b",selectMaterialLightObject:"\u30de\u30c6\u30ea\u30a2\u30eb\u3001\u30e9\u30a4\u30c8\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u9078\u629e",scroll:"\u30b9\u30af\u30ed\u30fc\u30eb",walkStraight:"\u524d\u5f8c\u79fb\u52d5",walkStraightAndLookAround:"\u524d\u5f8c\u79fb\u52d5\u3057\u3066\u898b\u56de\u3059",walkStraightAndSideways:"\u524d\u5f8c\u5de6\u53f3\u79fb\u52d5",changeHeight:"\u9ad8\u3055\u8abf\u6574",
switchView:"\u30d3\u30e5\u30fc\u5207\u308a\u66ff\u3048",screenshot:"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8",illuminationPreview:"\u30a4\u30eb\u30df\u30cd\u30fc\u30b7\u30e7\u30f3\u30d7\u30ec\u30d3\u30e5\u30fc",hideShowMenu:"\u30e1\u30cb\u30e5\u30fc \u8868\u793a/\u975e\u8868\u793a",hideShowMousePointer:"\u30de\u30a6\u30b9\u30ab\u30fc\u30bd\u30eb \u8868\u793a/\u975e\u8868\u793a",vrMode:"VR \u30e2\u30fc\u30c9",gazeAtFixedPlace:"\u7279\u5b9a\u306e\u5834\u6240\u3092\u898b\u308b",clickControllerButton:"\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b",
teleport:"\u30c6\u30ec\u30dd\u30fc\u30c8",touch:"\u89e6\u308b",interactiveDesktop:"\u30af\u30ea\u30c3\u30af\uff06\u30c9\u30e9\u30c3\u30b0\u3057\u3066\u898b\u56de\u3059",interactiveMobile:"\u30c9\u30e9\u30c3\u30b0\u3057\u3066\u898b\u56de\u3059"}},Korean:{help:{basic:"\uae30\ubcf8 \uc870\uc791\ubc95",advanced:"\uc0c1\uc138 \uc870\uc791\ubc95",mouse:"\ub9c8\uc6b0\uc2a4",or:"\ud639\uc740",keyboard:"\ud0a4\ubcf4\ub4dc",vrTeleport:"VR \uc774\ub3d9",holdLeftButton:"\uc88c\uce21 \ubc84\ud2bc \ub4dc\ub798\uadf8",
clickLeftButton:"\uc88c\uce21 \ubc84\ud2bc \ud074\ub9ad",lookAround:"\uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",walkToClickedPlace:"\ud074\ub9ad\ud55c \uacf3\uc73c\ub85c \uc774\ub3d9",selectMaterialLightObject:"\uc7ac\uc9c8, \uc870\uba85, \uc0ac\ubb3c \uc120\ud0dd",scroll:"\uc2a4\ud06c\ub864",walkStraight:"\uc9c1\uc9c4 \uc774\ub3d9",walkStraightAndLookAround:"\uc9c1\uc9c4 \uc774\ub3d9 / \uc8fc\ubcc0 \ub458\ub7ec\ubcf4\uae30",walkStraightAndSideways:"\uc9c1\uc9c4 \uc774\ub3d9 / \uc606\uc73c\ub85c \uc774\ub3d9",
changeHeight:"\ub192\uc774 \uc870\uc808",switchView:"\ubdf0 \uc120\ud0dd",screenshot:"\uc2a4\ud06c\ub9b0\uc0f7",illuminationPreview:"\uc77c\ub8e8\ubbf8\ub124\uc774\uc158 \ud504\ub9ac\ubdf0",hideShowMenu:"\uba54\ub274 On/Off",hideShowMousePointer:"\ub9c8\uc6b0\uc2a4 \ud3ec\uc778\ud130 On/Off",vrMode:"VR \ubaa8\ub4dc",gazeAtFixedPlace:"\ud2b9\uc815 \uc7a5\uc18c \ubc14\ub77c\ubcf4\uae30",clickControllerButton:"\ucee8\ud2b8\ub864\ub7ec \ubc84\ud2bc \ud074\ub9ad",teleport:"\ud154\ub808\ud3ec\ud2b8",touch:"\ud130\uce58"}},
Polish:{help:{basic:"PODSTAWOWE",advanced:"ZAAWANSOWANE",mouse:"Myszka",or:"lub",keyboard:"Klawiatura",vrTeleport:"Teleportacja VR",holdLeftButton:"Przytrzymaj lewy przycisk",clickLeftButton:"Naci\u015bnij lewy przycisk",lookAround:"Rozgl\u0105daj si\u0119",walkToClickedPlace:"Id\u017a do naci\u015bni\u0119tego miejsca",selectMaterialLightObject:"Wybierz materia\u0142, \u015bwiat\u0142o, obiekt",scroll:"Przewi\u0144",walkStraight:"Id\u017a prosto",walkStraightAndLookAround:"Id\u017a prosto i rozgl\u0105daj si\u0119",
walkStraightAndSideways:"Id\u017a prosto i na boki",changeHeight:"Zmie\u0144 wysoko\u015b\u0107",switchView:"Zmie\u0144 widok",screenshot:"Zrzut ekranu",illuminationPreview:"Podgl\u0105d o\u015bwietlenia",hideShowMenu:"Schowaj/poka\u017c menu",hideShowMousePointer:"Schowaj/poka\u017c kursor myszki",vrMode:"Tryb VR",gazeAtFixedPlace:"Patrz w ustalone miejsce",clickControllerButton:"Naci\u015bnij przycisk kontrolera",teleport:"Teleportacja",touch:"Dotyk",interactiveDesktop:"Klikaj i przeci\u0105gaj, aby si\u0119 rozgl\u0105da\u0107",
interactiveMobile:"Przeci\u0105gaj, aby si\u0119 rozgl\u0105da\u0107"}},Portuguese:{help:{basic:"B\u00c1SICO",advanced:"AVAN\u00c7ADO",mouse:"Mouse",or:"ou",keyboard:"Teclado",vrTeleport:"Teletransporte VR",holdLeftButton:"Mantenha pressionado o bot\u00e3o esquerdo",clickLeftButton:"Clique com o bot\u00e3o esquerdo",lookAround:"Olhe ao redor",walkToClickedPlace:"Ande at\u00e9 o lugar que foi clicado",selectMaterialLightObject:"Selecione material, luz, objeto",scroll:"Rolagem",walkStraight:"Ande em frente",
walkStraightAndLookAround:"Ande em frente e olhe ao redor",walkStraightAndSideways:"Ande em frente e para os lados",changeHeight:"Variar altura",switchView:"Alternar entre cenas",screenshot:"Captura de imagem",illuminationPreview:"Visualiza\u00e7\u00e3o de ilumina\u00e7\u00e3o",hideShowMenu:"Ocultar/mostrar menu",hideShowMousePointer:"Ocultar/mostrar a seta do mouse",vrMode:"Modo VR",gazeAtFixedPlace:"Olhe para um lugar fixo",clickControllerButton:"Clique num bot\u00e3o controlador",teleport:"Teletransporte",
touch:"Toque",interactiveDesktop:"Clique e arraste para olhar ao redor",interactiveMobile:"Arraste para olhar ao redor"}},Turkish:{help:{basic:"Basit",advanced:"\u0130leri D\u00fczey",mouse:"Fare",or:"veya",keyboard:"Klavye",vrTeleport:"VR I\u015f\u0131nlanma",holdLeftButton:"Sol tu\u015fa bas\u0131l\u0131 tut",clickLeftButton:"Sol tu\u015fa t\u0131kla",lookAround:"\u00c7evrene bak",walkToClickedPlace:"T\u0131klad\u0131\u011f\u0131n alana y\u00fcr\u00fc",selectMaterialLightObject:"Materyal, \u0131\u015f\u0131k veya obje se\u00e7",
scroll:"A\u015fa\u011f\u0131 kayd\u0131r",walkStraight:"D\u00fcz y\u00fcr\u00fc",walkStraightAndLookAround:"D\u00fcz y\u00fcr\u00fc ve \u00e7evrene bak\u0131n",walkStraightAndSideways:"D\u00fcz ve yanlana do\u011fru y\u00fcr\u00fc",changeHeight:"Y\u00fckseklik de\u011fi\u015ftir",switchView:"G\u00f6r\u00fcn\u00fcm de\u011fi\u015ftir",screenshot:"Ekran G\u00f6r\u00fcnt\u00fcs\u00fc",illuminationPreview:"Ayd\u0131nlatma \u00f6nizlemesi",hideShowMenu:"Men\u00fcy\u00fc g\u00f6ster/gizle",hideShowMousePointer:"\u0130mleci g\u00f6ster/gizle",
vrMode:"VR Modu",gazeAtFixedPlace:"Bir noktaya kitlenerek bak",clickControllerButton:"Kumanda butonuna t\u0131kla",teleport:"I\u015f\u0131nlan",touch:"Dokun"}}};var Tb=ib(Ob[S.DEFAULT_LANGUAGE]);function Ub(){for(var a=document.querySelectorAll("[data-strings]"),b=0;b<a.length;++b){var c=a.item(b);a:{var d=c.getAttribute("data-strings").split(".");for(var e=Tb,f=0;f<d.length;f++)if(e=e[d[f]],!e){d=null;break a}d="string"===typeof e?e:null}c.textContent=d}}
function Wb(a){function b(c,d,e){Object.keys(d).forEach(function(f){var g=""===e?f:e+"."+f;if(void 0===c[f])console.warn("Viewer string "+g+" doesn\u2019t exist");else if(typeof c[f]!==typeof d[f])console.error(g+" should be "+typeof c[f]);else switch(typeof d[f]){case "string":c[f]=d[f];break;case "object":b(c[f],d[f],g)}})}b(Tb,a,"");Ub()}Ub();var Xb={};function Yb(a,b,c){Xb[a]={name:a,value:b,fontFamily:c}}function ac(a,b){Yb(a,b,"FontAwesomeSolid")}function bc(a,b){Yb(a,b,"FontAwesomeRegular")}function dc(a,b){Yb(a,b,"FontAwesomeBrands")}ac("address-book","\uf2b9");ac("address-card","\uf2bb");ac("area-chart","\uf1fe");ac("arrows","\uf0b2");ac("arrow-up","\uf062");ac("arrow-down","\uf063");ac("assistive-listening-systems","\uf2a2");ac("asterisk","\uf069");ac("audio-description","\uf29e");ac("at","\uf1fa");ac("bars","\uf0c9");
ac("bell","\uf0f3");ac("book","\uf02d");ac("bookmark","\uf02e");ac("bullhorn","\uf0a1");ac("calculator","\uf1ec");ac("camera","\uf030");ac("chart-bar","\uf080");ac("chart-pie","\uf200");ac("chevron-up","\uf077");ac("chevron-down","\uf078");ac("cloud","\uf0c2");ac("cog","\uf013");ac("comment","\uf075");bc("compass","\uf14e");bc("credit-card","\uf09d");ac("crosshairs","\uf05b");ac("desktop","\uf108");ac("download","\uf019");ac("envelope","\uf0e0");ac("expand","\uf424");ac("external-link","\uf35d");
bc("eye","\uf06e");ac("eye-dropper","\uf1fb");ac("film","\uf008");ac("flag","\uf024");ac("folder","\uf07b");ac("gift","\uf06b");ac("headphones","\uf025");ac("highlighter","\uf591");ac("home","\uf015");bc("image","\uf03e");ac("sign-in","\uf2f6");ac("info","\uf129");bc("lightbulb","\uf0eb");ac("magic","\uf0d0");ac("magnet","\uf076");ac("map-marker","\uf3c5");ac("map-pin","\uf276");ac("map-signs","\uf277");ac("paint-brush","\uf1fc");ac("pencil","\uf303");ac("pen","\uf304");ac("phone","\uf095");
ac("question","\uf128");ac("search","\uf002");ac("share","\uf064");ac("share-alt","\uf1e0");ac("shopping-cart","\uf07a");ac("sliders","\uf1de");ac("star","\uf005");bc("sticky-note","\uf249");ac("sync","\uf2f1");bc("edit","\uf044");ac("tachometer","\uf3fd");ac("tag","\uf02b");ac("video","\uf03d");ac("wrench","\uf0ad");ac("palette","\uf53f");ac("paint-roller","\uf5aa");ac("play","\uf04b");ac("pause","\uf04c");ac("plus","\uf067");dc("youtube","\uf167");dc("vimeo","\uf40a");dc("facebook","\uf09a");
dc("twitter","\uf099");dc("instagram","\uf16d");dc("linkedin","\uf08c");dc("skype","\uf17e");dc("whatsapp","\uf232");dc("facebook-messenger","\uf39f");dc("telegram","\uf2c6");dc("slack","\uf198");var lc=[],mc=0,oc=void 0,pc=0;function qc(a,b){for(a=a.toString();a.length<b;)a="0"+a;return a}function rc(){0!==pc&&(lc[lc.length-1]+=" ["+(pc+1).toString()+" copies]",pc=0)}function tc(){rc();0<mc&&lc.push("[truncated, removed lines "+mc.toString()+"]");uc("./logs","application/json",JSON.stringify({logs:lc}));lc.length=0;oc=void 0;pc=mc=0}
function wc(a){var b=console[a].bind(console);console[a]=function(){for(var c="",d="",e=0;e<arguments.length;++e)d+=(0===e?"":" ")+arguments[e];S.LOG_TIME&&(c=new Date,c=qc(c.getHours(),2)+":"+qc(c.getMinutes(),2)+":"+qc(c.getSeconds(),2)+","+qc(c.getMilliseconds(),3)+" ");e=c;var f=d;oc===f?pc+=1:499<=lc.length?mc+=1:(rc(),oc=f,e=e+a.toUpperCase()+" "+f,lc.push(e),1==lc.length&&setTimeout(tc,5E3));b(c+d)}}
function xc(){window.onerror=function(a,b,c,d,e){console.error("Error occured: "+a+" ("+b+"#"+c.toString()+":"+d.toString()+"/"+e+")");return!1}}function yc(){this.log=vb}yc.prototype.logInfoMessages=function(){this.log=function(){var a=m.getRestArguments.apply(0,arguments);console.log.apply(console,m.arrayFromIterable(a))}};var zc=new yc;function Ac(a){a&&(wc("log"),wc("info"));wc("warn");wc("error");xc()}S.LOG_INFO&&zc.logInfoMessages();S.LOG_TO_SERVER&&Ac(!0);var Bc=new function(){function a(l){function n(q){var w=p[q];if(void 0!==w)return w;switch(q){case "EXT_texture_filter_anisotropic":w=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":w=l.getExtension("WEBGL_compressed_texture_s3tc")||l.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;
case "WEBGL_compressed_texture_pvrtc":w=l.getExtension("WEBGL_compressed_texture_pvrtc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":w=l.getExtension("WEBGL_compressed_texture_etc1");break;case "WEBGL_depth_texture":w=l.getExtension(q);break;default:w=l.getExtension(q)}return p[q]=w}var p={};this.extension=n;this.webgl2="undefined"!==typeof WebGL2RenderingContext&&l instanceof WebGL2RenderingContext;this.antialiasNative=l.getContextAttributes().antialias&&
1<l.getParameter(l.SAMPLES);this.antialiasSamples=l.getParameter(l.SAMPLES);this.antialiasPostprocess=!g.mobile;this.floatTextures=this.webgl2||n("OES_texture_float");this.standardDerivatives=this.webgl2||n("OES_standard_derivatives");this.useDepthExtension=!this.webgl2&&n("WEBGL_depth_texture");this.maxAnisotropy=function(){var q=n("EXT_texture_filter_anisotropic");return null!==q?l.getParameter(q.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}();this.indexUint=this.webgl2||n("OES_element_index_uint");this.instances=
this.webgl2||n("ANGLE_instanced_arrays");this.fragmentPrecision=void 0===l.getShaderPrecisionFormat||0<l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.HIGH_FLOAT).precision?"highp":0<l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.MEDIUM_FLOAT).precision?"mediump":"lowp";var r=4096>l.getParameter(l.MAX_TEXTURE_SIZE)?"Your graphics card does not have sufficient capabilities, texture sizes 4096x4096 need to be supported.":null;this.missingCapabilities=r;this.maxRenderBufferSize=l.getParameter(l.MAX_RENDERBUFFER_SIZE);
if(r=l.getExtension("WEBGL_debug_renderer_info"))this.vendor=l.getParameter(r.UNMASKED_VENDOR_WEBGL),this.renderer=l.getParameter(r.UNMASKED_RENDERER_WEBGL);this.dxtTextures=function(){try{if(S.urlHashContains("nodxt"))return!1;for(var q=n("WEBGL_compressed_texture_s3tc"),w=l.getParameter(l.COMPRESSED_TEXTURE_FORMATS),x=!1,t=!1,A=0;A<w.length;A+=1)x=x||w[A]===q.COMPRESSED_RGB_S3TC_DXT1_EXT,t=t||w[A]===q.COMPRESSED_RGBA_S3TC_DXT5_EXT;return x&&t}catch(D){}return!1}();r=S.urlHashContains("nopvr")?!1:
n("WEBGL_compressed_texture_pvrtc");this.pvrtcTextures=r;r=S.urlHashContains("noetc1")?!1:n("WEBGL_compressed_texture_etc1")&&g.mobile;this.etc1Textures=r;this.astcTextures=!1;this.textureLod=this.webgl2||n("EXT_shader_texture_lod")&&(!g.firefox||!g.android);this.mirrorCubeMaps=!g.mobile||S.MOBILE_HI;this.disableTextureSlotReuse=g.mac||83===g.chromeVersion;this.reportToConsole=function(){zc.log("WebGL"+(this.webgl2?"2":"")+"; "+this.fragmentPrecision+" fragment precision.");this.dxtTextures||zc.log("DXT textures not supported.");
this.textureLod||zc.log("Texture fetch level of detail not supported.");this.floatTextures||zc.log("Float textures not supported.");this.antialiasNative?zc.log("Native anti-aliasing supported with "+this.antialiasSamples+" samples."):zc.log("Native anti-aliasing not supported");this.disableTextureSlotReuse&&zc.log("WebGL texture slot reuse disabled.");this.indexUint||zc.log("Uint index not supported");this.instances||zc.log("Instanced geometry not supported")}}function b(l){var n=document.createElement("a");
n.href=l;return n.protocol+"//"+n.host}function c(l,n){l=l.toLowerCase();n=n.toLowerCase();return-1!==l.indexOf(n)}function d(l){return navigator&&navigator.userAgent?c(navigator.userAgent,l):!1}function e(l,n){console.assert(void 0===g[l]);g[l]=n;void 0!==g.webp&&(h.forEach(function(p){return p()}),h.length=0)}function f(){var l=new Image;l.onload=function(){e("webp",0<l.width&&0<l.height)};l.onerror=function(){e("webp",!1)};l.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="}
var g=this;this.https="https:"===window.location.protocol;this.localhost="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;this.canForceBrotliBuffers=!1;this.ipad=/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;this.mobile=/mobile|ip(hone|od)|android|silk/i.test(navigator.userAgent)||this.ipad||S.urlHashContains("mobile");this.ios=/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||this.ipad;this.android=/Android/.test(navigator.userAgent);
this.facebookApp=/FBAN|FBAV/.test(navigator.userAgent);this.whatsApp=/WhatsApp/.test(navigator.userAgent);this.inCrossOriginIframe=function(){var l=window.self!==window.top,n=b(document.referrer),p=b(window.location.href);return l&&n!==p}();this.firefox=d("firefox");this.opera=d("opera")||d("OPR/");var k;(k=d("msie"))||(k=navigator&&navigator.appVersion?c(navigator.appVersion,"trident/"):!1);this.ie=k;this.edge=d("edge/");this.safari=d("safari/")&&!(d("chrome/")||d("chromium/"));this.mac=d("macintosh")&&
!this.ipad;this.chromeVersion=function(){var l=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return l?parseInt(l[2],10):!1}();this.browserName=this.firefox?"firefox":this.opera?"opera":this.ie?"ie":"chrome";this.browserName=this.edge?"edge":this.safari?"safari":this.browserName;this.BASIS_DECODE_WORKERS=this.safari||this.ios?0:Math.min(4,navigator.hardwareConcurrency||4);this.gl=null;this.resetGlDetector=function(l){this.gl=new a(l)};this.webp=void 0;var h=[];(function(){navigator.gpu&&navigator.gpu.requestAdapter({powerPreference:"high-performance"}).then(function(l){return l&&
l.requestAdapterInfo()}).then(function(l){l&&e("gpuInfo",l)})})();S.NO_WEBP?this.webp=!1:f();this.onAsyncPropertiesDetected=function(l){void 0!==g.webp?l():h.push(l)};this.getPlatformInfo=function(){function l(p,r){p.length>r&&(p=p.substring(0,r));p=p.replace(/[^0-9a-zA-Z() .]/gi,"");return encodeURI(p)}var n={renderApi:this.gpuInfo?3:this.gl.webgl2?2:1,webglVendor:this.gl.vendor?l(this.gl.vendor,32):"",webglRenderer:this.gl.renderer?l(this.gl.renderer,128):"",webgpuVendor:this.gpuInfo?l(this.gpuInfo.vendor,
32):"",webgpuArch:this.gpuInfo?l(this.gpuInfo.architecture,64):"",width:10*Math.round(window.innerWidth/10),height:10*Math.round(window.innerHeight/10),dpr:window.devicePixelRatio,cpuCores:navigator.hardwareConcurrency,webp:this.webp?1:0,version:535,browser:this.browserName};this.chromeVersion&&(n.chromeVersion=this.chromeVersion);navigator.connection&&(n.downloadSpeed=navigator.connection.downlink,n.roundTripTime=navigator.connection.rtt);return n}};var Cc=new function(){this.hideInfo=function(){document.getElementById("info-message").style.display="none"};this.info=function(a,b){var c=document.getElementById("info-message");c.innerHTML=a;c.style.display="";setTimeout(this.hideInfo,b||15E3);console.info(a)};this.error=function(a){var b=document.getElementById("error-message");b.innerHTML=a;b.style.display="";console.error(a)}};var Gc=!1,Hc={NOT_NEEDED:0,TEST_NEEDED:1,NEEDED:2},Ic=function(){function a(e){c.add(e);var f=d.get(e);d.delete(e);f.forEach(function(g){try{(0,g.onSuccess)()}catch(k){console.log(k)}})}function b(e){var f=d.get(e);d.delete(e);console.error("Can't load script : "+e);f.forEach(function(g){if(void 0!==g.onError){g=g.onError.bind(null,e);try{g()}catch(k){console.log(k)}}})}var c=new Set,d=new Map;return function(e,f,g){if(c.has(e))f();else if(d.has(e))d.get(e).push({onSuccess:f,onError:g});else{d.set(e,
[{onSuccess:f,onError:g}]);f=a.bind(this,e);g=b.bind(this,e);var k=document.createElement("script");k.onload=f;k.onerror=g;k.src=e;k.type="text/javascript";k.crossOrigin="anonymous";document.body.appendChild(k)}}}(),Jc=new function(){function a(){for(d+=1;d<b.length;d+=1){var e=b[d];if(0<e.length){for(var f=0;f<e.length;f+=1)c[d]+=1,setTimeout(e[f],0);e.length=0;break}}}var b=[],c=[],d=Infinity;(function(){var e=0,f;for(f in S.LOAD_PRIORITY)S.LOAD_PRIORITY.hasOwnProperty(f)&&(e=Math.max(e,S.LOAD_PRIORITY[f]));
for(f=0;f<=e;f+=1)b[f]=[],c[f]=0})();this.add=function(e,f){e<=d?(c[e]+=1,d=e,setTimeout(f,0)):(b[e].push(f),0===c[d]&&a())};this.finished=function(e){--c[e];var f=c[e];console.assert(0<=f);e===d&&0===f&&a()}};
function Kc(a){for(var b=m.makeIterator(Object.entries({"https://cdn0.shapespark.com/":"https://cdn0-jsbr.shapespark.com/","https://cdn0.dev.shapespark.com/":"https://cdn0-jsbr.dev.shapespark.com/","https://cdn0-shapespark-cn-dev.oss-accelerate.aliyuncs.com/":"https://cdn0-jsbr-cn-dev.shapespark.com.cn/","https://cdn0-shapespark-cn.oss-accelerate.aliyuncs.com/":"https://cdn0-jsbr.shapespark.com.cn/","https://cdncn0-shapespark.oss-accelerate.aliyuncs.com/":"https://cdncn0-jsbr.shapespark.com.cn/"})),
c=b.next();!c.done;c=b.next()){var d=m.makeIterator(c.value);c=d.next().value;d=d.next().value;if(a.startsWith(c))return a.replace(c,d)}return a}
var Lc=new function(){function a(n){n=new Int8Array(n);return(new BrotliDecode(n)).buffer}function b(n){k=n;for(var p=0;p<f.length;p+=1)f[p](n);f=null}function c(n){h?n():(g.push(n),1===g.length&&Ic(ob("lib/brotli.min.js"),function(){h=!0;for(var p=0;p<g.length;p+=1)g[p]();g=null},function(){return Cc.error("Cannot load required library")}))}function d(){200<=l.status&&300>l.status||0===l.status?b("SSSSSS"===l.responseText):(console.error("br.buf response",l.status),b(!0))}function e(n){void 0!==
k?n(k):(f.push(n),1===f.length&&(l.addEventListener("load",d,!1),l.open("GET",ob("3dassets/br.buf"),!0),l.send()))}var f=[],g=[],k=void 0,h=!1,l=new XMLHttpRequest;this.decode=function(n,p,r){p?c(function(){r(a(n))}):e(function(q){q?r(n):c(function(){r(a(n))})})}};function Mc(a,b){return function(c){Jc.finished(a);b(c)}}
function Nc(a){this.method=a;this.binaryResult=!1;this.dataContentType=this.data=null;"GET"===a?(this.retriesLeft=S.RETRIES_ON_LOAD_ERROR,this.retryDelayMs=1E3+1E3*Math.random()):this.retryDelayMs=this.retriesLeft=0}Nc.prototype={constructor:Nc,retryScheduled:function(){console.assert(0<this.retriesLeft);--this.retriesLeft;this.retryDelayMs*=2}};function Oc(a,b,c,d,e,f){setTimeout(function(){Pc(a,b,c,d,e,f)},b.retryDelayMs);b.retryScheduled()}
function Pc(a,b,c,d,e,f){function g(n,p){var r=!0!==Bc.canForceBrotliBuffers?Hc.NOT_NEEDED:0<=l.getAllResponseHeaders().toLowerCase().indexOf("js-content-encoding:")?Hc.NEEDED:"br"===l.getResponseHeader("content-encoding")?Hc.TEST_NEEDED:Hc.NOT_NEEDED;r===Hc.NOT_NEEDED?p(n):Lc.decode(n,r===Hc.NEEDED,p)}function k(){var n=l.status||0;n="GET"===b.method&&(500<=n||0===n)?0!==b.retriesLeft:!1;console.warn("Failed to "+b.method+": "+a+" ("+l.status+")"+(n?", retrying in "+b.retryDelayMs/1E3+"s":""));if(n)f&&
!Gc&&(console.warn("Switch to jsbr hosts."),Gc=!0),Oc(a,b,c,d,e,f);else if(void 0!==d){try{var p=JSON.parse(l.responseText).message}catch(r){p=void 0}d(l.status,p)}b=l=null}function h(){if(void 0!==c)if(b.binaryResult)g(l.response,c);else{var n=l.getResponseHeader("content-type"),p=l.responseText;p&&-1!==n.indexOf("text/plain")?g(p,c):p?g(p,function(r){c(JSON.parse(r))}):c()}b=l=null}var l=new XMLHttpRequest;void 0!==e&&l.addEventListener("progress",e,!1);l.addEventListener("load",function(){200<=
l.status&&300>l.status||0===l.status?h():k()},!1);l.addEventListener("error",k,!1);l.addEventListener("abort",k,!1);f&&Gc&&(a=Kc(a));l.open(b.method,a,!0);b.binaryResult&&(l.responseType="arraybuffer");b.dataContentType&&l.setRequestHeader("Content-Type",b.dataContentType);"POST"===b.method&&l.setRequestHeader("X-Requested-By","Shapespark");l.send(b.data)}function Qc(a,b,c,d,e,f){var g=new Nc("GET");g.binaryResult=b;Pc(a,g,c,d,e,f)}
function Rc(a,b,c,d,e,f,g){g=void 0===g?!1:g;Jc.add(a,function(){Qc(b,c,Mc(a,d),Mc(a,e),f,g)})}function uc(a,b,c,d,e,f){var g=new Nc("POST");g.data=c;g.dataContentType=b;Pc(a,g,d,e,f)}function Sc(a,b,c,d,e){function f(){a(b,c,d,e)}return function(){console.warn("Failed to get: "+b+(f?", retrying in "+c.retryDelayMs/1E3+"s":""));0<c.retriesLeft?(setTimeout(f,c.retryDelayMs),c.retryScheduled()):e()}}
function Tc(a,b,c,d){var e=new Image;e.onload=function(){c(e);e=null};e.onerror=Sc(Tc,a,b,c,d);e.crossOrigin="anonymous";e.src=a}function Uc(a,b,c,d){Jc.add(a,function(){var e=new Nc("GET");Tc(b,e,Mc(a,c),Mc(a,d))})}
function Vc(a,b,c,d){var e=document.createElement("video");e.muted=!0;e.loop=!0;e.setAttribute("playsinline","");e.setAttribute("webkit-playsinline","");e.crossOrigin="anonymous";e.onerror=Sc(Vc,a,b,c,d);cb(e,function(){e.onerror=void 0;c(e);e=null});e.src=a;e.play().catch(function(f){console.error(f);d()})}function Wc(a,b,c,d){Jc.add(a,function(){var e=new Nc("GET");Vc(b,e,Mc(a,c),Mc(a,d))})}
function Xc(a,b,c){function d(e){return new Promise(function(f,g){Ic(e,f,g)})}a=a.map(function(e){return d(e)});Promise.all(a).then(b).catch(function(e){void 0!==c&&c(e)})};/*

 nosleep.js
 Copyright (c) 2017, Rich Tibbett

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 webxr-polyfill
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 cardboard-vr-display
 Copyright (c) 2015-2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 webvr-polyfill-dpdb 
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 wglu-preserve-state
 Copyright (c) 2016, Brandon Jones.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
function $c(){function a(u){u=void 0===u?{}:u;this.config=Object.freeze(Object.assign({},jl,u));this.global=this.config.global;this.nativeWebXR="xr"in this.global.navigator;this.injected=!1;this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)}function b(u,y){var E,F;return m.asyncExecutePromiseGeneratorProgram(function(da){return 1==da.nextAddress?y.webvr?da.yield(c(u),3):da.jumpTo(2):2!=da.nextAddress&&(E=da.yieldResult)?da.return(E):(F=r(u))&&y.cardboard||
!F&&y.allowCardboardOnDesktop?(u.VRFrameData||(u.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=new Float32Array(16);this.leftProjectionMatrix=new Float32Array(16);this.pose=null}),da.return(new f(u,y.cardboardConfig))):da.return(new d(u))})}function c(u){var y,E;return m.asyncExecutePromiseGeneratorProgram(function(F){switch(F.nextAddress){case 1:y=null;if(!("getVRDisplays"in u.navigator)){F.jumpTo(2);break}F.setCatchFinallyBlocks(3);
return F.yield(u.navigator.getVRDisplays(),5);case 5:(E=F.yieldResult)&&E.length&&(y=new g(u,E[0]));F.leaveTryBlock(2);break;case 3:F.enterCatchBlock();case 2:return F.return(y)}})}function d(u){u=p.call(this,u)||this;u.sessions=new Map;u.projectionMatrix=J();u.identityMatrix=J();return u}function e(u,y){this.mode=u;this.enabledFeatures=y;this.baseLayer=this.ended=null;this.id=++kl}function f(u,y){y=new ll(y||{});u=g.call(this,u,y)||this;u.display=y;u.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),
rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null};return u}function g(u,y){var E=y.capabilities.canPresent;var F=p.call(this,u)||this;F.display=y;F.frame=new u.VRFrameData;F.sessions=new Map;F.immersiveSession=null;F.canPresent=E;F.baseModelMatrix=J();F.gamepadInputSources={};F.tempVec3=new Float32Array(3);F.onVRDisplayPresentChange=F.onVRDisplayPresentChange.bind(F);u.window.addEventListener("vrdisplaypresentchange",F.onVRDisplayPresentChange);
F.CAN_USE_GAMEPAD=u.navigator&&"getGamepads"in u.navigator;F.HAS_BITMAP_SUPPORT=!(!u.ImageBitmapRenderingContext||!u.createImageBitmap);return F}function k(u,y,E){E=void 0===E?{}:E;this.mode=u;this.enabledFeatures=y;this.outputContext=null;this.immersive="immersive-vr"==u||"immersive-ar"==u;this.baseLayer=this.ended=null;this.id=++ml;this.modifiedCanvasLayer=!1;this.outputContext&&(this.renderContext=this.outputContext.canvas.getContext(E.renderContextType||"2d"))}function h(u,y,E,F){E=void 0===E?
0:E;F=void 0===F?-1:F;this.polyfill=u;this.display=y;this.gamepad=this.nativeGamepad=null;this.inputSource=new x(this);this.lastPosition=ma();this.emulatedPosition=!1;this.basePoseMatrix=J();this.outputMatrix=J();this.primaryButtonIndex=E;this.primaryActionPressed=!1;this.primarySqueezeButtonIndex=F;this.primarySqueezeActionPressed=!1;this.handedness="";this.targetRayMode="gaze";this.armModel=null}function l(u,y,E){E||(E={});if(E.userAgentOverrides)for(var F in E.userAgentOverrides)if(navigator.userAgent.includes(F)){F=
E.userAgentOverrides[F];for(var da in F)da in E?Object.assign(E[da],F[da]):E[da]=F[da];break}da=Array(E.axes&&E.axes.length?E.axes.length:u.axes.length);F=Array(E.buttons&&E.buttons.length?E.buttons.length:u.buttons.length);var sa=null;if(E.gripTransform){var wa=E.gripTransform.orientation||[0,0,0,1];sa=J();Q(sa,pa(wa,wa),E.gripTransform.position||[0,0,0])}wa=null;if(E.targetRayTransform){var Ma=E.targetRayTransform.orientation||[0,0,0,1];wa=J();Q(wa,pa(Ma,Ma),E.targetRayTransform.position||[0,0,
0])}Ma=E.profiles;E.displayProfiles&&y.displayName in E.displayProfiles&&(Ma=E.displayProfiles[y.displayName]);this[sc]={gamepad:u,map:E,profiles:Ma||[u.id],mapping:E.mapping||u.mapping,axes:da,buttons:F,gripTransform:sa,targetRayTransform:wa};this._update()}function n(){this.hand="right";this.headElbowOffset=Si;this.controllerQ=Ga();this.lastControllerQ=Ga();this.headQ=Ga();this.headPos=ma();this.elbowPos=ma();this.wristPos=ma();this.lastTime=this.time=null;this.rootQ=Ga();this.position=ma()}function p(u){var y=
ca.call(this)||this;y.global=u;y.onWindowResize=y.onWindowResize.bind(y);y.global.window.addEventListener("resize",y.onWindowResize);y.environmentBlendMode="opaque";return y}function r(u){var y=!1;u=u.navigator.userAgent||u.navigator.vendor||u.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(u)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(u.substr(0,
4)))y=!0;return y}function q(u){var y=u.prototype.getContext;u.prototype.getContext=function(E,F){if(E=y.call(this,E,F))E[Ti]=!0,F&&"xrCompatible"in F&&(E[Eh]=F.xrCompatible);return E}}function w(u){if("function"===typeof u.prototype.makeXRCompatible)return!1;u.prototype.makeXRCompatible=function(){this[Eh]=!0;return Promise.resolve()};return!0}function x(u){this[Nd]={impl:u,gripSpace:new I("grip",this),targetRaySpace:new I("target-ray",this)}}function t(u,y,E){var F=ca.call(this)||this;var da="inline"!=
y,sa=new H({inlineVerticalFieldOfView:da?null:.5*Math.PI});F[Ca]={device:u,mode:y,immersive:da,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:E,activeRenderState:sa,pendingRenderState:null,viewerSpace:new va("viewer"),viewSpaces:[],currentInputSources:[]};da?F[Ca].viewSpaces.push(new A("left"),new A("right")):F[Ca].viewSpaces.push(new A("none"));F[Ca].onDeviceFrame=function(){if(!F[Ca].ended&&!F[Ca].suspended){F[Ca].deviceFrameHandle=null;
F[Ca].startDeviceFrameLoop();if(null!==F[Ca].pendingRenderState&&(F[Ca].activeRenderState=new H(F[Ca].pendingRenderState),F[Ca].pendingRenderState=null,F[Ca].activeRenderState.baseLayer))F[Ca].device.onBaseLayerSet(F[Ca].id,F[Ca].activeRenderState.baseLayer);if(null!==F[Ca].activeRenderState.baseLayer){var wa=new G(u,F,F[Ca].id),Ma=F[Ca].currentFrameCallbacks=F[Ca].frameCallbacks;F[Ca].frameCallbacks=[];wa[ec].active=!0;wa[ec].animationFrame=!0;F[Ca].device.onFrameStart(F[Ca].id,F[Ca].activeRenderState);
F._checkInputSourcesChange();for(var db=xb(),fb=0;fb<Ma.length;fb++)try{Ma[fb].cancelled||"function"!==typeof Ma[fb].callback||Ma[fb].callback(db,wa)}catch(hb){console.error(hb)}F[Ca].currentFrameCallbacks=null;wa[ec].active=!1;F[Ca].device.onFrameEnd(F[Ca].id)}}};F[Ca].startDeviceFrameLoop=function(){null===F[Ca].deviceFrameHandle&&(F[Ca].deviceFrameHandle=F[Ca].device.requestAnimationFrame(F[Ca].onDeviceFrame))};F[Ca].stopDeviceFrameLoop=function(){var wa=F[Ca].deviceFrameHandle;null!==wa&&(F[Ca].device.cancelAnimationFrame(wa),
F[Ca].deviceFrameHandle=null)};F[Ca].onPresentationEnd=function(wa){wa!==F[Ca].id?(F[Ca].suspended=!1,F[Ca].startDeviceFrameLoop(),F.dispatchEvent("focus",{session:F})):(F[Ca].ended=!0,F[Ca].stopDeviceFrameLoop(),u.removeEventListener("@@webxr-polyfill/vr-present-end",F[Ca].onPresentationEnd),u.removeEventListener("@@webxr-polyfill/vr-present-start",F[Ca].onPresentationStart),u.removeEventListener("@@webxr-polyfill/input-select-start",F[Ca].onSelectStart),u.removeEventListener("@@webxr-polyfill/input-select-end",
F[Ca].onSelectEnd),F.dispatchEvent("end",Ib("end",{session:F})))};u.addEventListener("@@webxr-polyfill/vr-present-end",F[Ca].onPresentationEnd);F[Ca].onPresentationStart=function(wa){wa!==F[Ca].id&&(F[Ca].suspended=!0,F[Ca].stopDeviceFrameLoop(),F.dispatchEvent("blur",{session:F}))};u.addEventListener("@@webxr-polyfill/vr-present-start",F[Ca].onPresentationStart);F[Ca].onSelectStart=function(wa){wa.sessionId===F[Ca].id&&F[Ca].dispatchInputSourceEvent("selectstart",wa.inputSource)};u.addEventListener("@@webxr-polyfill/input-select-start",
F[Ca].onSelectStart);F[Ca].onSelectEnd=function(wa){wa.sessionId===F[Ca].id&&(F[Ca].dispatchInputSourceEvent("selectend",wa.inputSource),F[Ca].dispatchInputSourceEvent("select",wa.inputSource))};u.addEventListener("@@webxr-polyfill/input-select-end",F[Ca].onSelectEnd);F[Ca].onSqueezeStart=function(wa){wa.sessionId===F[Ca].id&&F[Ca].dispatchInputSourceEvent("squeezestart",wa.inputSource)};u.addEventListener("@@webxr-polyfill/input-squeeze-start",F[Ca].onSqueezeStart);F[Ca].onSqueezeEnd=function(wa){wa.sessionId===
F[Ca].id&&(F[Ca].dispatchInputSourceEvent("squeezeend",wa.inputSource),F[Ca].dispatchInputSourceEvent("squeeze",wa.inputSource))};u.addEventListener("@@webxr-polyfill/input-squeeze-end",F[Ca].onSqueezeEnd);F[Ca].dispatchInputSourceEvent=function(wa,Ma){var db=new G(u,F,F[Ca].id);Ma=hc(wa,{frame:db,inputSource:Ma});db[ec].active=!0;F.dispatchEvent(wa,Ma);db[ec].active=!1};F[Ca].startDeviceFrameLoop();F.onblur=void 0;F.onfocus=void 0;F.onresetpose=void 0;F.onend=void 0;F.onselect=void 0;F.onselectstart=
void 0;F.onselectend=void 0;return F}function A(u){return I.call(this,u)||this}function D(u,y,E){E=void 0===E?{}:E;E=Object.assign({},nl,E);if(!(u instanceof t))throw Error("session must be a XRSession");if(u.ended)throw Error("InvalidStateError");if(y[Ti]&&!0!==y[Eh])throw Error("InvalidStateError");var F=y.getParameter(y.FRAMEBUFFER_BINDING);this[$d]={context:y,config:E,framebuffer:F,session:u}}function H(u){u=void 0===u?{}:u;u=Object.assign({},ol,u);this[df]={config:u}}function G(u,y,E){this[ec]=
{id:++pl,active:!1,animationFrame:!1,device:u,session:y,sessionId:E}}function K(u,y,E,F){if(!nc.includes(E))throw Error("XREye must be one of: "+nc);var da=Object.create(null),sa=new W(da);this[Rb]={device:u,eye:E,viewport:sa,temp:da,sessionId:F,transform:y}}function W(u){this[Jb]={target:u}}function O(u,y,E){u=ea.call(this,u,void 0===E?!1:E)||this;u[Hb]={views:y};return u}function ea(u,y){this[Gb]={transform:u,emulatedPosition:y}}function ra(u){var y=ca.call(this)||this;y[ya]={device:null,devicePromise:u,
immersiveSession:null,inlineSessions:new Set};u.then(function(E){y[ya].device=E});return y}function va(u,y){y=void 0===y?null:y;if(!Aa.includes(u))throw Error("XRReferenceSpaceType must be one of "+Aa);var E=I.call(this,u)||this;if("bounded-floor"===u&&!y)throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");"bounded-floor"!==u&&"local-floor"!==u||y||(y=aa(new Float32Array(16)),y[13]=1.6);E._inverseBaseMatrix=y||aa(new Float32Array(16));E[la]=
{type:u,transform:y,originOffset:aa(new Float32Array(16))};return E}function I(u,y){this[N]={specialType:void 0===u?null:u,inputSource:void 0===y?null:y,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}function V(){this[bb]={matrix:null,position:null,orientation:null,inverse:null};if(0===arguments.length)this[bb].matrix=aa(new Float32Array(16));else if(1===arguments.length)arguments[0]instanceof Float32Array?this[bb].matrix=arguments[0]:(this[bb].position=this._getPoint(arguments[0]),this[bb].orientation=
DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(2===arguments.length)this[bb].position=this._getPoint(arguments[0]),this[bb].orientation=this._getPoint(arguments[1]);else throw Error("Too many arguments!");if(this[bb].matrix){var u=ma();ia(u,this[bb].matrix);this[bb].position=DOMPointReadOnly.fromPoint({x:u[0],y:u[1],z:u[2]});u=Ga();Z(u,this[bb].matrix);this[bb].orientation=DOMPointReadOnly.fromPoint({x:u[0],y:u[1],z:u[2],w:u[3]})}else{this[bb].matrix=aa(new Float32Array(16));u=this[bb].matrix;
var y=this[bb].orientation.x,E=this[bb].orientation.y,F=this[bb].orientation.z,da=this[bb].orientation.w,sa=new ab(4);sa[0]=y;sa[1]=E;sa[2]=F;sa[3]=da;Q(u,sa,fa(this[bb].position.x,this[bb].position.y,this[bb].position.z))}}function pa(u,y){var E=y[0],F=y[1],da=y[2];y=y[3];var sa=E*E+F*F+da*da+y*y;0<sa&&(sa=1/Math.sqrt(sa),u[0]=E*sa,u[1]=F*sa,u[2]=da*sa,u[3]=y*sa);return u}function T(u,y){u[0]=y[0];u[1]=y[1];u[2]=y[2];u[3]=y[3];return u}function P(u){var y=new ab(4);y[0]=u[0];y[1]=u[1];y[2]=u[2];
y[3]=u[3];return y}function ca(){this[eb]={listeners:new Map}}function J(){var u=new ab(16);ab!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0);u[0]=1;u[5]=1;u[10]=1;u[15]=1;return u}function aa(u){u[0]=1;u[1]=0;u[2]=0;u[3]=0;u[4]=0;u[5]=1;u[6]=0;u[7]=0;u[8]=0;u[9]=0;u[10]=1;u[11]=0;u[12]=0;u[13]=0;u[14]=0;u[15]=1;return u}function na(u,y){var E=y[0],F=y[1],da=y[2],sa=y[3],wa=y[4],Ma=y[5],db=y[6],fb=y[7],hb=y[8],Kb=y[9],Zb=y[10],cc=y[11],Lb=
y[12],$b=y[13],wb=y[14];y=y[15];var ic=E*Ma-F*wa,yb=E*db-da*wa,Ab=E*fb-sa*wa,gb=F*db-da*Ma,Bb=F*fb-sa*Ma,Yc=da*fb-sa*db,ae=hb*$b-Kb*Lb,Zc=hb*wb-Zb*Lb,Ec=hb*y-cc*Lb,Od=Kb*wb-Zb*$b,jc=Kb*y-cc*$b,Fc=Zb*y-cc*wb,ub=ic*Fc-yb*jc+Ab*Od+gb*Ec-Bb*Zc+Yc*ae;if(!ub)return null;ub=1/ub;u[0]=(Ma*Fc-db*jc+fb*Od)*ub;u[1]=(da*jc-F*Fc-sa*Od)*ub;u[2]=($b*Yc-wb*Bb+y*gb)*ub;u[3]=(Zb*Bb-Kb*Yc-cc*gb)*ub;u[4]=(db*Ec-wa*Fc-fb*Zc)*ub;u[5]=(E*Fc-da*Ec+sa*Zc)*ub;u[6]=(wb*Ab-Lb*Yc-y*yb)*ub;u[7]=(hb*Yc-Zb*Ab+cc*yb)*ub;u[8]=(wa*
jc-Ma*Ec+fb*ae)*ub;u[9]=(F*Ec-E*jc-sa*ae)*ub;u[10]=(Lb*Bb-$b*Ab+y*ic)*ub;u[11]=(Kb*Ab-hb*Bb-cc*ic)*ub;u[12]=(Ma*Zc-wa*Od-db*ae)*ub;u[13]=(E*Od-F*Zc+da*ae)*ub;u[14]=($b*yb-Lb*gb-wb*ic)*ub;u[15]=(hb*gb-Kb*yb+Zb*ic)*ub;return u}function L(u,y,E){var F=y[0],da=y[1],sa=y[2],wa=y[3],Ma=y[4],db=y[5],fb=y[6],hb=y[7],Kb=y[8],Zb=y[9],cc=y[10],Lb=y[11],$b=y[12],wb=y[13],ic=y[14];y=y[15];var yb=E[0],Ab=E[1],gb=E[2],Bb=E[3];u[0]=yb*F+Ab*Ma+gb*Kb+Bb*$b;u[1]=yb*da+Ab*db+gb*Zb+Bb*wb;u[2]=yb*sa+Ab*fb+gb*cc+Bb*ic;
u[3]=yb*wa+Ab*hb+gb*Lb+Bb*y;yb=E[4];Ab=E[5];gb=E[6];Bb=E[7];u[4]=yb*F+Ab*Ma+gb*Kb+Bb*$b;u[5]=yb*da+Ab*db+gb*Zb+Bb*wb;u[6]=yb*sa+Ab*fb+gb*cc+Bb*ic;u[7]=yb*wa+Ab*hb+gb*Lb+Bb*y;yb=E[8];Ab=E[9];gb=E[10];Bb=E[11];u[8]=yb*F+Ab*Ma+gb*Kb+Bb*$b;u[9]=yb*da+Ab*db+gb*Zb+Bb*wb;u[10]=yb*sa+Ab*fb+gb*cc+Bb*ic;u[11]=yb*wa+Ab*hb+gb*Lb+Bb*y;yb=E[12];Ab=E[13];gb=E[14];Bb=E[15];u[12]=yb*F+Ab*Ma+gb*Kb+Bb*$b;u[13]=yb*da+Ab*db+gb*Zb+Bb*wb;u[14]=yb*sa+Ab*fb+gb*cc+Bb*ic;u[15]=yb*wa+Ab*hb+gb*Lb+Bb*y;return u}function Q(u,y,
E){var F=y[0],da=y[1],sa=y[2],wa=y[3],Ma=F+F,db=da+da,fb=sa+sa;y=F*Ma;var hb=F*db;F*=fb;var Kb=da*db;da*=fb;sa*=fb;Ma*=wa;db*=wa;wa*=fb;u[0]=1-(Kb+sa);u[1]=hb+wa;u[2]=F-db;u[3]=0;u[4]=hb-wa;u[5]=1-(y+sa);u[6]=da+Ma;u[7]=0;u[8]=F+db;u[9]=da-Ma;u[10]=1-(y+Kb);u[11]=0;u[12]=E[0];u[13]=E[1];u[14]=E[2];u[15]=1;return u}function ia(u,y){u[0]=y[12];u[1]=y[13];u[2]=y[14];return u}function Z(u,y){var E=y[0]+y[5]+y[10];0<E?(E=2*Math.sqrt(E+1),u[3]=.25*E,u[0]=(y[6]-y[9])/E,u[1]=(y[8]-y[2])/E,u[2]=(y[1]-y[4])/
E):y[0]>y[5]&&y[0]>y[10]?(E=2*Math.sqrt(1+y[0]-y[5]-y[10]),u[3]=(y[6]-y[9])/E,u[0]=.25*E,u[1]=(y[1]+y[4])/E,u[2]=(y[8]+y[2])/E):y[5]>y[10]?(E=2*Math.sqrt(1+y[5]-y[0]-y[10]),u[3]=(y[8]-y[2])/E,u[0]=(y[1]+y[4])/E,u[1]=.25*E,u[2]=(y[6]+y[9])/E):(E=2*Math.sqrt(1+y[10]-y[0]-y[5]),u[3]=(y[1]-y[4])/E,u[0]=(y[8]+y[2])/E,u[1]=(y[6]+y[9])/E,u[2]=.25*E);return u}function ka(u,y,E,F,da){y=1/Math.tan(y/2);u[0]=y/E;u[1]=0;u[2]=0;u[3]=0;u[4]=0;u[5]=y;u[6]=0;u[7]=0;u[8]=0;u[9]=0;u[11]=-1;u[12]=0;u[13]=0;u[15]=0;
null!=da&&Infinity!==da?(E=1/(F-da),u[10]=(da+F)*E,u[14]=2*da*F*E):(u[10]=-1,u[14]=-2*F);return u}function ma(){var u=new ab(3);ab!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0);return u}function M(u){var y=new ab(3);y[0]=u[0];y[1]=u[1];y[2]=u[2];return y}function fa(u,y,E){var F=new ab(3);F[0]=u;F[1]=y;F[2]=E;return F}function ja(u,y){u[0]=y[0];u[1]=y[1];u[2]=y[2];return u}function ta(u,y,E){u[0]=y[0]+E[0];u[1]=y[1]+E[1];u[2]=y[2]+E[2];return u}function X(u,y,E){u[0]=y[0]*E;u[1]=y[1]*E;u[2]=y[2]*E;return u}
function Y(u,y){var E=y[0],F=y[1],da=y[2];E=E*E+F*F+da*da;0<E&&(E=1/Math.sqrt(E),u[0]=y[0]*E,u[1]=y[1]*E,u[2]=y[2]*E);return u}function qa(u,y){return u[0]*y[0]+u[1]*y[1]+u[2]*y[2]}function za(u,y,E){var F=y[0],da=y[1];y=y[2];var sa=E[0],wa=E[1];E=E[2];u[0]=da*E-y*wa;u[1]=y*sa-F*E;u[2]=F*wa-da*sa;return u}function Ka(u,y,E){var F=E[0],da=E[1],sa=E[2],wa=y[0],Ma=y[1];y=y[2];var db=da*y-sa*Ma,fb=sa*wa-F*y,hb=F*Ma-da*wa;E=2*E[3];u[0]=wa+db*E+2*(da*hb-sa*fb);u[1]=Ma+fb*E+2*(sa*db-F*hb);u[2]=y+hb*E+2*
(F*fb-da*db);return u}function Ba(){var u=new ab(9);ab!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0);u[0]=1;u[4]=1;u[8]=1;return u}function Ea(){var u=new ab(4);ab!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0);return u}function Ga(){var u=new ab(4);ab!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0);u[3]=1;return u}function Da(u,y,E){var F=y[0],da=y[1],sa=y[2];y=y[3];var wa=E[0],Ma=E[1],db=E[2];E=E[3];u[0]=F*E+y*wa+da*db-sa*Ma;u[1]=da*E+y*Ma+sa*wa-F*db;u[2]=sa*E+y*db+F*Ma-da*wa;u[3]=y*E-F*wa-da*
Ma-sa*db;return u}function Va(u,y,E,F){var da=y[0],sa=y[1],wa=y[2];y=y[3];var Ma=E[0],db=E[1],fb=E[2];E=E[3];var hb=da*Ma+sa*db+wa*fb+y*E;0>hb&&(hb=-hb,Ma=-Ma,db=-db,fb=-fb,E=-E);if(1E-6<1-hb){var Kb=Math.acos(hb);var Zb=Math.sin(Kb);hb=Math.sin((1-F)*Kb)/Zb;F=Math.sin(F*Kb)/Zb}else hb=1-F;u[0]=hb*da+F*Ma;u[1]=hb*sa+F*db;u[2]=hb*wa+F*fb;u[3]=hb*y+F*E;return u}function jb(u,y){var E=y[0],F=y[1],da=y[2];y=y[3];var sa=E*E+F*F+da*da+y*y;sa=sa?1/sa:0;u[0]=-E*sa;u[1]=-F*sa;u[2]=-da*sa;u[3]=y*sa;return u}
function hc(u,y){u=new Event(u,y);u[Fh]={frame:y.frame,inputSource:y.inputSource};Object.setPrototypeOf(u,hc.prototype);Object.defineProperty(u,"frame",{get:function(){return this[Fh].frame}});Object.defineProperty(u,"inputSource",{get:function(){return this[Fh].inputSource}});return u}function Ib(u,y){u=new Event(u,y);u[Ui]={session:y.session};Object.setPrototypeOf(u,Ib.prototype);Object.defineProperty(u,"session",{get:function(){return this[Ui].session}});return u}function Dc(u,y){u=new Event(u,
y);u[eg]={session:y.session,added:y.added,removed:y.removed};Object.setPrototypeOf(u,Dc.prototype);Object.defineProperty(u,"session",{get:function(){return this[eg].session}});Object.defineProperty(u,"added",{get:function(){return this[eg].added}});Object.defineProperty(u,"removed",{get:function(){return this[eg].removed}});return u}function U(u,y){u=new Event(u,y);u[Gh]={referenceSpace:y.referenceSpace,transform:y.transform||null};Object.setPrototypeOf(u,U.prototype);Object.defineProperty(u,"referenceSpace",
{get:function(){return this[Gh].referenceSpace}});Object.defineProperty(u,"transform",{get:function(){return this[Gh].transform}});return u}function ua(u,y,E){function F(db,fb,hb){return db<fb?fb:db>hb?hb:db}var da=y[0]*y[0],sa=y[1]*y[1],wa=y[2]*y[2],Ma=y[3]*y[3];"XYZ"===E?(u[0]=Math.atan2(2*(y[0]*y[3]-y[1]*y[2]),Ma-da-sa+wa),u[1]=Math.asin(F(2*(y[0]*y[2]+y[1]*y[3]),-1,1)),u[2]=Math.atan2(2*(y[2]*y[3]-y[0]*y[1]),Ma+da-sa-wa)):"YXZ"===E?(u[0]=Math.asin(F(2*(y[0]*y[3]-y[1]*y[2]),-1,1)),u[1]=Math.atan2(2*
(y[0]*y[2]+y[1]*y[3]),Ma-da-sa+wa),u[2]=Math.atan2(2*(y[0]*y[1]+y[2]*y[3]),Ma-da+sa-wa)):"ZXY"===E?(u[0]=Math.asin(F(2*(y[0]*y[3]+y[1]*y[2]),-1,1)),u[1]=Math.atan2(2*(y[1]*y[3]-y[2]*y[0]),Ma-da-sa+wa),u[2]=Math.atan2(2*(y[2]*y[3]-y[0]*y[1]),Ma-da+sa-wa)):"ZYX"===E?(u[0]=Math.atan2(2*(y[0]*y[3]+y[2]*y[1]),Ma-da-sa+wa),u[1]=Math.asin(F(2*(y[1]*y[3]-y[0]*y[2]),-1,1)),u[2]=Math.atan2(2*(y[0]*y[1]+y[2]*y[3]),Ma+da-sa-wa)):"YZX"===E?(u[0]=Math.atan2(2*(y[0]*y[3]-y[2]*y[1]),Ma-da+sa-wa),u[1]=Math.atan2(2*
(y[1]*y[3]-y[0]*y[2]),Ma+da-sa-wa),u[2]=Math.asin(F(2*(y[0]*y[1]+y[2]*y[3]),-1,1))):"XZY"===E?(u[0]=Math.atan2(2*(y[0]*y[3]+y[1]*y[2]),Ma-da+sa-wa),u[1]=Math.atan2(2*(y[0]*y[2]+y[1]*y[3]),Ma+da-sa-wa),u[2]=Math.asin(F(2*(y[2]*y[3]-y[0]*y[1]),-1,1))):console.log("No order given for quaternion to euler conversion.")}var Na="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{},eb=Symbol("@@webxr-polyfill/EventTarget");ca.prototype.addEventListener=function(u,
y){if("string"!==typeof u)throw Error("`type` must be a string");if("function"!==typeof y)throw Error("`listener` must be a function");var E=this[eb].listeners.get(u)||[];E.push(y);this[eb].listeners.set(u,E)};ca.prototype.removeEventListener=function(u,y){if("string"!==typeof u)throw Error("`type` must be a string");if("function"!==typeof y)throw Error("`listener` must be a function");u=this[eb].listeners.get(u)||[];for(var E=u.length;0<=E;E--)u[E]===y&&u.pop()};ca.prototype.dispatchEvent=function(u,
y){for(var E=this[eb].listeners.get(u)||[],F=[],da=0;da<E.length;da++)F[da]=E[da];E=m.makeIterator(F);for(F=E.next();!F.done;F=E.next())F=F.value,F(y);if("function"===typeof this["on"+u])this["on"+u](y)};var ab="undefined"!==typeof Float32Array?Float32Array:Array;(function(){var u=ma();return function(y,E,F,da,sa,wa){E||(E=3);F||(F=0);for(da=da?Math.min(da*E+F,y.length):y.length;F<da;F+=E)u[0]=y[F],u[1]=y[F+1],u[2]=y[F+2],sa(u,u,wa),y[F]=u[0],y[F+1]=u[1],y[F+2]=u[2];return y}})();(function(){var u=
Ea();return function(y,E,F,da,sa,wa){E||(E=4);F||(F=0);for(da=da?Math.min(da*E+F,y.length):y.length;F<da;F+=E)u[0]=y[F],u[1]=y[F+1],u[2]=y[F+2],u[3]=y[F+3],sa(u,u,wa),y[F]=u[0],y[F+1]=u[1],y[F+2]=u[2],y[F+3]=u[3];return y}})();(function(){var u=ma(),y=fa(1,0,0),E=fa(0,1,0);return function(F,da,sa){var wa=qa(da,sa);if(-.999999>wa){za(u,y,da);sa=u[0];wa=u[1];var Ma=u[2];1E-6>Math.sqrt(sa*sa+wa*wa+Ma*Ma)&&za(u,E,da);Y(u,u);da=Math.PI;da*=.5;sa=Math.sin(da);F[0]=sa*u[0];F[1]=sa*u[1];F[2]=sa*u[2];F[3]=
Math.cos(da);return F}if(.999999<wa)return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F;za(u,da,sa);F[0]=u[0];F[1]=u[1];F[2]=u[2];F[3]=1+wa;return pa(F,F)}})();(function(){var u=Ga(),y=Ga();return function(E,F,da,sa,wa,Ma){Va(u,F,wa,Ma);Va(y,da,sa,Ma);Va(E,u,y,2*Ma*(1-Ma));return E}})();(function(){var u=Ba();return function(y,E,F,da){u[0]=F[0];u[3]=F[1];u[6]=F[2];u[1]=da[0];u[4]=da[1];u[7]=da[2];u[2]=-E[0];u[5]=-E[1];u[8]=-E[2];E=u[0]+u[4]+u[8];if(0<E)E=Math.sqrt(E+1),y[3]=.5*E,E=.5/E,y[0]=(u[5]-u[7])*E,y[1]=(u[6]-
u[2])*E,y[2]=(u[1]-u[3])*E;else{F=0;u[4]>u[0]&&(F=1);u[8]>u[3*F+F]&&(F=2);da=(F+1)%3;var sa=(F+2)%3;E=Math.sqrt(u[3*F+F]-u[3*da+da]-u[3*sa+sa]+1);y[F]=.5*E;E=.5/E;y[3]=(u[3*da+sa]-u[3*sa+da])*E;y[da]=(u[3*da+F]+u[3*F+da])*E;y[sa]=(u[3*sa+F]+u[3*F+sa])*E}return pa(y,y)}})();if(!("DOMPointReadOnly"in window)){var kb=Symbol("@@webxr-polyfill/DOMPointReadOnly"),Sb=function(u,y,E,F){if(1===arguments.length)this[kb]={x:u.x,y:u.y,z:u.z,w:u.w};else if(4===arguments.length)this[kb]={x:u,y:y,z:E,w:F};else throw new TypeError("Must supply either 1 or 4 arguments");
};Sb.fromPoint=function(u){return new Sb(u.x,u.y,u.z,u.w)};m.global.Object.defineProperties(Sb.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[kb].x}},y:{configurable:!0,enumerable:!0,get:function(){return this[kb].y}},z:{configurable:!0,enumerable:!0,get:function(){return this[kb].z}},w:{configurable:!0,enumerable:!0,get:function(){return this[kb].w}}});window.DOMPointReadOnly=Sb}var bb=Symbol("@@webxr-polyfill/XRRigidTransform");V.prototype._getPoint=function(u){return u instanceof
DOMPointReadOnly?u:DOMPointReadOnly.fromPoint(u)};m.global.Object.defineProperties(V.prototype,{matrix:{configurable:!0,enumerable:!0,get:function(){return this[bb].matrix}},position:{configurable:!0,enumerable:!0,get:function(){return this[bb].position}},orientation:{configurable:!0,enumerable:!0,get:function(){return this[bb].orientation}},inverse:{configurable:!0,enumerable:!0,get:function(){if(null===this[bb].inverse){var u=aa(new Float32Array(16));na(u,this[bb].matrix);this[bb].inverse=new V(u);
this[bb].inverse[bb].inverse=this}return this[bb].inverse}}});var N=Symbol("@@webxr-polyfill/XRSpace");I.prototype._ensurePoseUpdated=function(u,y){y!=this[N].lastFrameId&&(this[N].lastFrameId=y,this._onPoseUpdate(u))};I.prototype._onPoseUpdate=function(u){"viewer"==this[N].specialType&&(this._baseMatrix=u.getBasePoseMatrix())};I.prototype._getSpaceRelativeTransform=function(u){if(!this._inverseBaseMatrix||!u._baseMatrix)return null;var y=new Float32Array(16);L(y,this._inverseBaseMatrix,u._baseMatrix);
return new V(y)};m.global.Object.defineProperties(I.prototype,{_specialType:{configurable:!0,enumerable:!0,get:function(){return this[N].specialType}},_inputSource:{configurable:!0,enumerable:!0,get:function(){return this[N].inputSource}},_baseMatrix:{configurable:!0,enumerable:!0,set:function(u){this[N].baseMatrix=u;this[N].inverseBaseMatrix=null},get:function(){!this[N].baseMatrix&&this[N].inverseBaseMatrix&&(this[N].baseMatrix=new Float32Array(16),na(this[N].baseMatrix,this[N].inverseBaseMatrix));
return this[N].baseMatrix}},_inverseBaseMatrix:{configurable:!0,enumerable:!0,set:function(u){this[N].inverseBaseMatrix=u;this[N].baseMatrix=null},get:function(){!this[N].inverseBaseMatrix&&this[N].baseMatrix&&(this[N].inverseBaseMatrix=new Float32Array(16),na(this[N].inverseBaseMatrix,this[N].baseMatrix));return this[N].inverseBaseMatrix}}});var la=Symbol("@@webxr-polyfill/XRReferenceSpace"),Aa=["viewer","local","local-floor","bounded-floor","unbounded"];m.inherits(va,I);va.prototype._transformBasePoseMatrix=
function(u,y){L(u,this._inverseBaseMatrix,y)};va.prototype._originOffsetMatrix=function(){return this[la].originOffset};va.prototype._adjustForOriginOffset=function(u){var y=new Float32Array(16);na(y,this[la].originOffset);L(u,y,u)};va.prototype._getSpaceRelativeTransform=function(u){u=I.prototype._getSpaceRelativeTransform.call(this,u);this._adjustForOriginOffset(u.matrix);return new XRRigidTransform(u.matrix)};va.prototype.getOffsetReferenceSpace=function(u){var y=new va(this[la].type,this[la].transform,
this[la].bounds);L(y[la].originOffset,this[la].originOffset,u.matrix);return y};var ya=Symbol("@@webxr-polyfill/XR"),Pa=["inline","immersive-vr","immersive-ar"],Wa={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}};m.inherits(ra,ca);ra.prototype.isSessionSupported=function(u){var y=this;return m.asyncExecutePromiseGeneratorProgram(function(E){return 1==
E.nextAddress?y[ya].device?E.jumpTo(2):E.yield(y[ya].devicePromise,2):"inline"!=u?E.return(Promise.resolve(y[ya].device.isSessionSupported(u))):E.return(Promise.resolve(!0))})};ra.prototype.requestSession=function(u,y){var E=this,F,da,sa,wa,Ma,db,fb,hb,Kb,Zb,cc,Lb,$b;return m.asyncExecutePromiseGeneratorProgram(function(wb){if(1==wb.nextAddress){if(E[ya].device)return wb.jumpTo(2);if("inline"!=u)throw Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");
return wb.yield(E[ya].devicePromise,2)}if(5!=wb.nextAddress){if(!Pa.includes(u))throw new TypeError("The provided value '"+u+"' is not a valid enum value of type XRSessionMode");F=Wa[u];da=F.requiredFeatures.concat(y&&y.requiredFeatures?y.requiredFeatures:[]);sa=F.optionalFeatures.concat(y&&y.optionalFeatures?y.optionalFeatures:[]);wa=new Set;Ma=!1;db=m.makeIterator(da);for(fb=db.next();!fb.done;fb=db.next())hb=fb.value,E[ya].device.isFeatureSupported(hb)?wa.add(hb):(console.error("The required feature '"+
hb+"' is not supported"),Ma=!0);if(Ma)throw new DOMException("Session does not support some required features","NotSupportedError");Kb=m.makeIterator(sa);for(fb=Kb.next();!fb.done;fb=Kb.next())Zb=fb.value,E[ya].device.isFeatureSupported(Zb)?wa.add(Zb):console.log("The optional feature '"+Zb+"' is not supported");return wb.yield(E[ya].device.requestSession(u,wa),5)}cc=wb.yieldResult;Lb=new XRSession(E[ya].device,u,cc);"inline"==u?E[ya].inlineSessions.add(Lb):E[ya].immersiveSession=Lb;$b=function(){"inline"==
u?E[ya].inlineSessions.delete(Lb):E[ya].immersiveSession=null;Lb.removeEventListener("end",$b)};Lb.addEventListener("end",$b);return wb.return(Lb)})};if(!1==="performance"in Na){var Za=Date.now();var lb=function(){return Date.now()-Za}}else lb=function(){return performance.now()};var xb=lb,Gb=Symbol("@@webxr-polyfill/XRPose");m.global.Object.defineProperties(ea.prototype,{transform:{configurable:!0,enumerable:!0,get:function(){return this[Gb].transform}},emulatedPosition:{configurable:!0,enumerable:!0,
get:function(){return this[Gb].emulatedPosition}}});var Hb=Symbol("@@webxr-polyfill/XRViewerPose");m.inherits(O,ea);m.global.Object.defineProperties(O.prototype,{views:{configurable:!0,enumerable:!0,get:function(){return this[Hb].views}}});var Jb=Symbol("@@webxr-polyfill/XRViewport");m.global.Object.defineProperties(W.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[Jb].target.x}},y:{configurable:!0,enumerable:!0,get:function(){return this[Jb].target.y}},width:{configurable:!0,
enumerable:!0,get:function(){return this[Jb].target.width}},height:{configurable:!0,enumerable:!0,get:function(){return this[Jb].target.height}}});var nc=["left","right","none"],Rb=Symbol("@@webxr-polyfill/XRView");K.prototype._getViewport=function(u){if(this[Rb].device.getViewport(this[Rb].sessionId,this.eye,u,this[Rb].temp))return this[Rb].viewport};m.global.Object.defineProperties(K.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this[Rb].eye}},projectionMatrix:{configurable:!0,
enumerable:!0,get:function(){return this[Rb].device.getProjectionMatrix(this.eye)}},transform:{configurable:!0,enumerable:!0,get:function(){return this[Rb].transform}}});var ec=Symbol("@@webxr-polyfill/XRFrame"),pl=0;G.prototype.getViewerPose=function(u){if(!this[ec].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[ec].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.",
"InvalidStateError");var y=this[ec].device,E=this[ec].session;E[Ca].viewerSpace._ensurePoseUpdated(y,this[ec].id);u._ensurePoseUpdated(y,this[ec].id);var F=u._getSpaceRelativeTransform(E[Ca].viewerSpace),da=[];E=m.makeIterator(E[Ca].viewSpaces);for(var sa=E.next();!sa.done;sa=E.next()){sa=sa.value;sa._ensurePoseUpdated(y,this[ec].id);var wa=u._getSpaceRelativeTransform(sa);sa=new K(y,wa,sa.eye,this[ec].sessionId);da.push(sa)}return new O(F,da,!1)};G.prototype.getPose=function(u,y){if(!this[ec].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.",
"InvalidStateError");var E=this[ec].device;if("target-ray"===u._specialType||"grip"===u._specialType)return E.getInputPose(u._inputSource,y,u._specialType);u._ensurePoseUpdated(E,this[ec].id);y._ensurePoseUpdated(E,this[ec].id);return(u=y._getSpaceRelativeTransform(u))?new XRPose(u,!1):null};m.global.Object.defineProperties(G.prototype,{session:{configurable:!0,enumerable:!0,get:function(){return this[ec].session}}});var df=Symbol("@@webxr-polyfill/XRRenderState"),ol=Object.freeze({depthNear:.1,depthFar:1E3,
inlineVerticalFieldOfView:null,baseLayer:null});m.global.Object.defineProperties(H.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this[df].config.depthNear}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this[df].config.depthFar}},inlineVerticalFieldOfView:{configurable:!0,enumerable:!0,get:function(){return this[df].config.inlineVerticalFieldOfView}},baseLayer:{configurable:!0,enumerable:!0,get:function(){return this[df].config.baseLayer}}});var Ti=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),
Eh=Symbol("@@webxr-polyfill/xr-compatible"),$d=Symbol("@@webxr-polyfill/XRWebGLLayer"),nl=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1});D.prototype.getViewport=function(u){return u._getViewport(this)};D.getNativeFramebufferScaleFactor=function(u){if(!u)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return u[Ca].ended?0:1};m.global.Object.defineProperties(D.prototype,{context:{configurable:!0,
enumerable:!0,get:function(){return this[$d].context}},antialias:{configurable:!0,enumerable:!0,get:function(){return this[$d].config.antialias}},ignoreDepthValues:{configurable:!0,enumerable:!0,get:function(){return!0}},framebuffer:{configurable:!0,enumerable:!0,get:function(){return this[$d].framebuffer}},framebufferWidth:{configurable:!0,enumerable:!0,get:function(){return this[$d].context.drawingBufferWidth}},framebufferHeight:{configurable:!0,enumerable:!0,get:function(){return this[$d].context.drawingBufferHeight}},
_session:{configurable:!0,enumerable:!0,get:function(){return this[$d].session}}});var Fh=Symbol("@@webxr-polyfill/XRInputSourceEvent"),Ui=Symbol("@@webxr-polyfill/XRSessionEvent"),eg=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent"),Ca=Symbol("@@webxr-polyfill/XRSession");m.inherits(A,I);A.prototype._onPoseUpdate=function(u){this._inverseBaseMatrix=u.getBaseViewMatrix(this._specialType)};m.global.Object.defineProperties(A.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this._specialType}}});
m.inherits(t,ca);t.prototype.requestReferenceSpace=function(u){var y=this,E,F;return m.asyncExecutePromiseGeneratorProgram(function(da){if(1==da.nextAddress){if(y[Ca].ended)return da.return();if(!Aa.includes(u))throw new TypeError("XRReferenceSpaceType must be one of "+Aa);if(!y[Ca].device.doesSessionSupportReferenceSpace(y[Ca].id,u))throw new DOMException("The "+u+" reference space is not supported by this session.","NotSupportedError");return"viewer"===u?da.return(y[Ca].viewerSpace):da.yield(y[Ca].device.requestFrameOfReferenceTransform(u),
2)}E=da.yieldResult;if("bounded-floor"===u){if(!E)throw new DOMException(u+" XRReferenceSpace not supported by this device.","NotSupportedError");F=y[Ca].device.requestStageBounds();if(!F)throw new DOMException(u+" XRReferenceSpace not supported by this device.","NotSupportedError");throw new DOMException("The WebXR polyfill does not support the "+u+" reference space yet.","NotSupportedError");}return da.return(new va(u,E))})};t.prototype.requestAnimationFrame=function(u){if(!this[Ca].ended){var y=
++this[Ca].frameHandle;this[Ca].frameCallbacks.push({handle:y,callback:u,cancelled:!1});return y}};t.prototype.cancelAnimationFrame=function(u){var y=this[Ca].frameCallbacks,E=y.findIndex(function(F){return F&&F.handle===u});-1<E&&(y[E].cancelled=!0,y.splice(E,1));if(y=this[Ca].currentFrameCallbacks)E=y.findIndex(function(F){return F&&F.handle===u}),-1<E&&(y[E].cancelled=!0)};t.prototype.end=function(){var u=this;return m.asyncExecutePromiseGeneratorProgram(function(y){if(u[Ca].ended)return y.return();
u[Ca].immersive&&(u[Ca].ended=!0,u[Ca].device.removeEventListener("@@webxr-polyfill/vr-present-start",u[Ca].onPresentationStart),u[Ca].device.removeEventListener("@@webxr-polyfill/vr-present-end",u[Ca].onPresentationEnd),u[Ca].device.removeEventListener("@@webxr-polyfill/input-select-start",u[Ca].onSelectStart),u[Ca].device.removeEventListener("@@webxr-polyfill/input-select-end",u[Ca].onSelectEnd),u.dispatchEvent("end",Ib("end",{session:u})));u[Ca].stopDeviceFrameLoop();return y.return(u[Ca].device.endSession(u[Ca].id))})};
t.prototype.updateRenderState=function(u){if(this[Ca].ended)throw Error("Can't call updateRenderState on an XRSession that has already ended.");if(u.baseLayer&&u.baseLayer._session!==this)throw Error("Called updateRenderState with a base layer that was created by a different session.");if(null!==u.inlineVerticalFieldOfView&&void 0!==u.inlineVerticalFieldOfView){if(this[Ca].immersive)throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");
u.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,u.inlineVerticalFieldOfView))}if(null===this[Ca].pendingRenderState){var y=this[Ca].activeRenderState;this[Ca].pendingRenderState={depthNear:y.depthNear,depthFar:y.depthFar,inlineVerticalFieldOfView:y.inlineVerticalFieldOfView,baseLayer:y.baseLayer}}Object.assign(this[Ca].pendingRenderState,u)};t.prototype._checkInputSourcesChange=function(){for(var u=[],y=[],E=this.inputSources,F=this[Ca].currentInputSources,da=m.makeIterator(E),sa=da.next();!sa.done;sa=
da.next())sa=sa.value,F.includes(sa)||u.push(sa);F=m.makeIterator(F);for(da=F.next();!da.done;da=F.next())da=da.value,E.includes(da)||y.push(da);(0<u.length||0<y.length)&&this.dispatchEvent("inputsourceschange",Dc("inputsourceschange",{session:this,added:u,removed:y}));this[Ca].currentInputSources.length=0;u=m.makeIterator(E);for(sa=u.next();!sa.done;sa=u.next())this[Ca].currentInputSources.push(sa.value)};m.global.Object.defineProperties(t.prototype,{renderState:{configurable:!0,enumerable:!0,get:function(){return this[Ca].activeRenderState}},
environmentBlendMode:{configurable:!0,enumerable:!0,get:function(){return this[Ca].device.environmentBlendMode||"opaque"}},inputSources:{configurable:!0,enumerable:!0,get:function(){return this[Ca].device.getInputSources()}}});var Nd=Symbol("@@webxr-polyfill/XRInputSource");m.global.Object.defineProperties(x.prototype,{handedness:{configurable:!0,enumerable:!0,get:function(){return this[Nd].impl.handedness}},targetRayMode:{configurable:!0,enumerable:!0,get:function(){return this[Nd].impl.targetRayMode}},
gripSpace:{configurable:!0,enumerable:!0,get:function(){var u=this[Nd].impl.targetRayMode;return"gaze"===u||"screen"===u?null:this[Nd].gripSpace}},targetRaySpace:{configurable:!0,enumerable:!0,get:function(){return this[Nd].targetRaySpace}},profiles:{configurable:!0,enumerable:!0,get:function(){return this[Nd].impl.profiles}},gamepad:{configurable:!0,enumerable:!0,get:function(){return this[Nd].impl.gamepad}}});var Gh=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Hh={XRSystem:ra,XRSession:t,XRSessionEvent:Ib,
XRFrame:G,XRView:K,XRViewport:W,XRViewerPose:O,XRWebGLLayer:D,XRSpace:I,XRReferenceSpace:va,XRReferenceSpaceEvent:U,XRInputSource:x,XRInputSourceEvent:hc,XRInputSourcesChangeEvent:Dc,XRRenderState:H,XRRigidTransform:V,XRPose:ea},Ih="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},ll=function(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u["default"]:u}(function(u,y){return y={exports:{}},u(y,y.exports),y.exports}(function(u){(function(y,
E){u.exports=E()})(Ih,function(){function y(v,z,B,R){this.x=v||0;this.y=z||0;this.z=B||0;this.w=void 0!==R?R:1}function E(v,z,B){this.x=v||0;this.y=z||0;this.z=B||0}function F(v,z,B){if(z){for(var R=[],oa=null,ba=0;ba<z.length;++ba){var ha=z[ba];switch(ha){case v.TEXTURE_BINDING_2D:case v.TEXTURE_BINDING_CUBE_MAP:var Fa=z[++ba];if(Fa<v.TEXTURE0||Fa>v.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");R.push(null,null);break}oa||(oa=
v.getParameter(v.ACTIVE_TEXTURE));v.activeTexture(Fa);R.push(v.getParameter(ha),null);break;case v.ACTIVE_TEXTURE:oa=v.getParameter(v.ACTIVE_TEXTURE);R.push(null);break;default:R.push(v.getParameter(ha))}}B(v);for(ba=0;ba<z.length;++ba){ha=z[ba];B=R[ba];switch(ha){case v.ACTIVE_TEXTURE:break;case v.ARRAY_BUFFER_BINDING:v.bindBuffer(v.ARRAY_BUFFER,B);break;case v.COLOR_CLEAR_VALUE:v.clearColor(B[0],B[1],B[2],B[3]);break;case v.COLOR_WRITEMASK:v.colorMask(B[0],B[1],B[2],B[3]);break;case v.CURRENT_PROGRAM:v.useProgram(B);
break;case v.ELEMENT_ARRAY_BUFFER_BINDING:v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,B);break;case v.FRAMEBUFFER_BINDING:v.bindFramebuffer(v.FRAMEBUFFER,B);break;case v.RENDERBUFFER_BINDING:v.bindRenderbuffer(v.RENDERBUFFER,B);break;case v.TEXTURE_BINDING_2D:Fa=z[++ba];if(Fa<v.TEXTURE0||Fa>v.TEXTURE31)break;v.activeTexture(Fa);v.bindTexture(v.TEXTURE_2D,B);break;case v.TEXTURE_BINDING_CUBE_MAP:Fa=z[++ba];if(Fa<v.TEXTURE0||Fa>v.TEXTURE31)break;v.activeTexture(Fa);v.bindTexture(v.TEXTURE_CUBE_MAP,B);break;
case v.VIEWPORT:v.viewport(B[0],B[1],B[2],B[3]);break;case v.BLEND:case v.CULL_FACE:case v.DEPTH_TEST:case v.SCISSOR_TEST:case v.STENCIL_TEST:B?v.enable(ha):v.disable(ha);break;default:console.log("No GL restore behavior for 0x"+ha.toString(16))}oa&&v.activeTexture(oa)}}else B(v)}function da(v,z){Jh(v,v+" has been deprecated. This may not work on native WebVR displays. "+(z?"Please use "+z+" instead.":""))}function sa(v){var z=v.indexOf("://");z=v.indexOf("/",-1!==z?z+3:0);-1===z&&(z=v.length);return v.substring(0,
z)}function wa(v){if(kc()){var z=v.style.width,B=v.style.height;v.style.width=parseInt(z)+1+"px";v.style.height=parseInt(B)+"px";setTimeout(function(){v.style.width=z;v.style.height=B},100)}window.canvas=v}function Ma(v,z){for(var B in z)z.hasOwnProperty(B)&&(v[B]=z[B]);return v}function db(){var v=!1,z=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(z)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(z.substr(0,
4)))v=!0;return v}function fb(v,z){for(var B={},R=v.getProgramParameter(z,v.ACTIVE_UNIFORMS),oa,ba=0;ba<R;ba++)oa=v.getActiveUniform(z,ba).name.replace("[0]",""),B[oa]=v.getUniformLocation(z,oa);return B}function hb(v,z,B,R){var oa=v.createShader(v.VERTEX_SHADER);v.shaderSource(oa,z);v.compileShader(oa);z=v.createShader(v.FRAGMENT_SHADER);v.shaderSource(z,B);v.compileShader(z);B=v.createProgram();v.attachShader(B,oa);v.attachShader(B,z);for(var ba in R)v.bindAttribLocation(B,R[ba],ba);v.linkProgram(B);
v.deleteShader(oa);v.deleteShader(z);return B}function Kb(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0}function Zb(v){if(Kh())return!1;if(v.requestFullscreen)v.requestFullscreen();else if(v.webkitRequestFullscreen)v.webkitRequestFullscreen();else if(v.mozRequestFullScreen)v.mozRequestFullScreen();
else if(v.msRequestFullscreen)v.msRequestFullscreen();else return!1;return!0}function cc(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio}function Lb(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio}function $b(){var v=90==window.orientation||-90==window.orientation;return Vi()?!v:v}function wb(v,z,B,R){this.gl=v;this.cardboardUI=z;this.bufferScale=B;this.dirtySubmitFrameBindings=R;this.ctxAttribs=v.getContextAttributes();this.instanceExt=
v.getExtension("ANGLE_instanced_arrays");this.meshHeight=this.meshWidth=20;this.bufferWidth=v.drawingBufferWidth;this.bufferHeight=v.drawingBufferHeight;this.realBindFramebuffer=v.bindFramebuffer;this.realEnable=v.enable;this.realDisable=v.disable;this.realColorMask=v.colorMask;this.realClearColor=v.clearColor;this.realViewport=v.viewport;kc()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(v.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(v.canvas.__proto__,
"height"));this.isPatched=!1;this.lastBoundFramebuffer=null;this.stencilTest=this.scissorTest=this.blend=this.depthTest=this.cullFace=!1;this.viewport=[0,0,0,0];this.colorMask=[!0,!0,!0,!0];this.clearColor=[0,0,0,0];this.attribs={position:0,texCoord:1};this.program=hb(v,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}",
"precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs);this.uniforms=fb(v,this.program);this.viewportOffsetScale=new Float32Array(8);this.setTextureBounds();this.vertexBuffer=v.createBuffer();this.indexBuffer=v.createBuffer();this.indexCount=0;this.renderTarget=v.createTexture();this.framebuffer=v.createFramebuffer();this.stencilBuffer=this.depthBuffer=this.depthStencilBuffer=null;this.ctxAttribs.depth&&
this.ctxAttribs.stencil?this.depthStencilBuffer=v.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=v.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=v.createRenderbuffer());this.patch();this.onResize()}function ic(v){this.gl=v;this.attribs={position:0};this.program=hb(v,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",
this.attribs);this.uniforms=fb(v,this.program);this.vertexBuffer=v.createBuffer();this.arrowVertexCount=this.arrowOffset=this.gearVertexCount=this.gearOffset=0;this.projMat=new Float32Array(16);this.listener=null;this.onResize()}function yb(v){this.coefficients=v}function Ab(v){this.width=v.width||Lb();this.height=v.height||cc();this.widthMeters=v.widthMeters;this.heightMeters=v.heightMeters;this.bevelMeters=v.bevelMeters}function gb(v,z){this.viewer=Lh.CardboardV2;this.updateDeviceParams(v);this.distortion=
new yb(this.viewer.distortionCoefficients);for(v=0;v<z.length;v++){var B=z[v];Lh[B.id]=new Bb(B)}}function Bb(v){this.id=v.id;this.label=v.label;this.fov=v.fov;this.interLensDistance=v.interLensDistance;this.baselineLensDistance=v.baselineLensDistance;this.screenLensDistance=v.screenLensDistance;this.distortionCoefficients=v.distortionCoefficients;this.inverseCoefficients=v.inverseCoefficients}function Yc(v,z){this.dpdb=ql;this.recalculateDeviceParams_();if(v){this.onDeviceParamsUpdated=z;var B=new XMLHttpRequest,
R=this;B.open("GET",v,!0);B.addEventListener("load",function(){R.loading=!1;200<=B.status&&299>=B.status?(R.dpdb=JSON.parse(B.response),R.recalculateDeviceParams_()):console.error("Error loading online DPDB!")});B.send()}}function ae(v){this.xdpi=v.xdpi;this.ydpi=v.ydpi;this.bevelMm=v.bevelMm}function Zc(v,z){this.set(v,z)}function Ec(v,z){this.kFilter=v;this.isDebug=z;this.currentAccelMeasurement=new Zc;this.currentGyroMeasurement=new Zc;this.previousGyroMeasurement=new Zc;kc()?this.filterQ=new y(-1,
0,0,1):this.filterQ=new y(1,0,0,1);this.previousFilterQ=new y;this.previousFilterQ.copy(this.filterQ);this.accelQ=new y;this.isOrientationInitialized=!1;this.estimatedGravity=new E;this.measuredGravity=new E;this.gyroIntegralQ=new y}function Od(v,z){this.predictionTimeS=v;this.isDebug=z;this.previousQ=new y;this.previousTimestampS=null;this.deltaQ=new y;this.outQ=new y}function jc(v,z,B,R){this.yawOnly=B;this.accelerometer=new E;this.gyroscope=new E;this.filter=new Ec(v,R);this.posePredictor=new Od(z,
R);this.isFirefoxAndroid=rl();this.isIOS=kc();v=Wi();this.isDeviceMotionInRadians=!this.isIOS&&v&&66>v;this.isWithoutDeviceMotion=sl()||tl();this.filterToWorldQ=new y;kc()?this.filterToWorldQ.setFromAxisAngle(new E(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new E(1,0,0),-Math.PI/2);this.inverseWorldToScreenQ=new y;this.worldToScreenQ=new y;this.originalPoseAdjustQ=new y;this.originalPoseAdjustQ.setFromAxisAngle(new E(0,0,1),-window.orientation*Math.PI/180);this.setScreenTransform_();$b()&&
this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);this.resetQ=new y;this.orientationOut_=new Float32Array(4);this.start()}function Fc(){this.loadIcon_();var v=document.createElement("div"),z=v.style;z.position="fixed";z.top=0;z.right=0;z.bottom=0;z.left=0;z.backgroundColor="gray";z.fontFamily="sans-serif";z.zIndex=1E6;var B=document.createElement("img");B.src=this.icon;z=B.style;z.marginLeft="25%";z.marginTop="25%";z.width="50%";v.appendChild(B);B=document.createElement("div");z=B.style;z.textAlign=
"center";z.fontSize="16px";z.lineHeight="24px";z.margin="24px 25%";z.width="50%";B.innerHTML="Place your phone into your Cardboard viewer.";v.appendChild(B);var R=document.createElement("div");z=R.style;z.backgroundColor="#CFD8DC";z.position="fixed";z.bottom=0;z.width="100%";z.height="48px";z.padding="14px 24px";z.boxSizing="border-box";z.color="#656A6B";v.appendChild(R);var oa=document.createElement("div");oa.style.float="left";oa.innerHTML="No Cardboard viewer?";var ba=document.createElement("a");
ba.href="https://www.google.com/get/cardboard/get-cardboard/";ba.innerHTML="get one";ba.target="_blank";z=ba.style;z.float="right";z.fontWeight=600;z.textTransform="uppercase";z.borderLeft="1px solid gray";z.paddingLeft="24px";z.textDecoration="none";z.color="#656A6B";R.appendChild(oa);R.appendChild(ba);this.overlay=v;this.text=B;this.hide()}function ub(v){try{this.selectedKey=localStorage.getItem("WEBVR_CARDBOARD_VIEWER")}catch(z){console.error("Failed to load viewer profile: %s",z)}this.selectedKey||
(this.selectedKey=v||"CardboardV1");this.dialog=this.createDialog_(gb.Viewers);this.root=null;this.onChangeCallbacks_=[]}function Xi(v){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:v.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:v.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:v.canPresent},maxLayers:{writable:!1,enumerable:!0,value:v.maxLayers},hasOrientation:{enumerable:!0,get:function(){da("VRDisplayCapabilities.prototype.hasOrientation",
"VRDisplay.prototype.getFrameData");return v.hasOrientation}}})}function Pb(v){v=v||{};v="wakelock"in v?v.wakelock:!0;this.isPolyfilled=!0;this.displayId=ul++;this.displayName="";this.depthNear=.01;this.depthFar=1E4;this.isPresenting=!1;Object.defineProperty(this,"isConnected",{get:function(){da("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay");return!1}});this.capabilities=new Xi({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1});
this.stageParameters=null;this.waitingForPresent_=!1;this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=this.fullscreenElementCachedStyle_=this.fullscreenWrapper_=this.fullscreenElement_=this.originalParent_=this.layer_=null;v&&db()&&(this.wakelock_=new vl)}function fc(v){var z=Ma({},wl);v=Ma(z,v||{});Pb.call(this,{wakelock:v.MOBILE_WAKE_LOCK});this.config=v;this.displayName="Cardboard VRDisplay";this.capabilities=new Xi({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,
canPresent:!0,maxLayers:1});this.stageParameters=null;this.bufferScale_=this.config.BUFFER_SCALE;this.poseSensor_=new xl(this.config);this.cardboardUI_=this.distorter_=null;this.dpdb_=new Yc(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));this.deviceInfo_=new gb(this.dpdb_.getDeviceParams(),v.ADDITIONAL_VIEWERS);this.viewerSelector_=new ub(v.DEFAULT_VIEWER);this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());
this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new Fc);kc()&&window.addEventListener("resize",this.onResize_.bind(this))}var yl=function(){function v(z,B){for(var R=0;R<B.length;R++){var oa=B[R];oa.enumerable=oa.enumerable||!1;oa.configurable=!0;"value"in oa&&(oa.writable=!0);Object.defineProperty(z,oa.key,oa)}}return function(z,B,R){B&&v(z.prototype,B);R&&v(z,R);return z}}(),zl=function(){return function(v,z){if(Array.isArray(v))return v;if(Symbol.iterator in Object(v)){var B=
[],R=!0,oa=!1,ba=void 0;try{for(var ha=v[Symbol.iterator](),Fa;!(R=(Fa=ha.next()).done)&&(B.push(Fa.value),!z||B.length!==z);R=!0);}catch(Ta){oa=!0,ba=Ta}finally{try{if(!R&&ha["return"])ha["return"]()}finally{if(oa)throw ba;}}return B}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),kc=function(){var v=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return v}}(),Kh=function(){var v=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&
-1!==navigator.userAgent.indexOf("Chrome");return function(){return v}}(),Al=function(){var v=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return v}}(),rl=function(){var v=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return v}}(),Wi=function(){var v=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),z=v?parseInt(v[1],10):null;return function(){return z}}(),tl=function(){var v=!1;v=kc()&&Al()&&-1!==navigator.userAgent.indexOf("13_4");
return function(){return v}}(),sl=function(){var v=!1;if(65===Wi()){var z=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(z){z=z[1].split(".");z=zl(z,4);var B=z[3];v=3325===parseInt(z[2],10)&&148>parseInt(B,10)}}return function(){return v}}(),Vi=function(){var v=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return v}}(),Bl=function(){function v(ba,ha,Fa,Ta,Qa,Xa){var $a=Ta||null;Ta=Xa.depthNear;Xa=Xa.depthFar;var rb=Math.tan($a?$a.upDegrees*z:B),Cb=Math.tan($a?$a.downDegrees*
z:B),Vb=Math.tan($a?$a.leftDegrees*z:B);$a=Math.tan($a?$a.rightDegrees*z:B);var sb=2/(Vb+$a),Qb=2/(rb+Cb);ba[0]=sb;ba[1]=0;ba[2]=0;ba[3]=0;ba[4]=0;ba[5]=Qb;ba[6]=0;ba[7]=0;ba[8]=-((Vb-$a)*sb*.5);ba[9]=(rb-Cb)*Qb*.5;ba[10]=Xa/(Ta-Xa);ba[11]=-1;ba[12]=0;ba[13]=0;ba[14]=Xa*Ta/(Ta-Xa);ba[15]=0;ba=Fa.orientation||R;Fa=Fa.position||oa;Cb=ba[0];sb=ba[1];Qb=ba[2];Xa=ba[3];var vc=Cb+Cb;$a=sb+sb;rb=Qb+Qb;ba=Cb*vc;Ta=Cb*$a;Cb*=rb;Vb=sb*$a;sb*=rb;Qb*=rb;vc*=Xa;$a*=Xa;Xa*=rb;ha[0]=1-(Vb+Qb);ha[1]=Ta+Xa;ha[2]=
Cb-$a;ha[3]=0;ha[4]=Ta-Xa;ha[5]=1-(ba+Qb);ha[6]=sb+vc;ha[7]=0;ha[8]=Cb+$a;ha[9]=sb-vc;ha[10]=1-(ba+Vb);ha[11]=0;ha[12]=Fa[0];ha[13]=Fa[1];ha[14]=Fa[2];ha[15]=1;if(Qa)if(Fa=Qa[0],ba=Qa[1],Qa=Qa[2],ha===ha)ha[12]=ha[0]*Fa+ha[4]*ba+ha[8]*Qa+ha[12],ha[13]=ha[1]*Fa+ha[5]*ba+ha[9]*Qa+ha[13],ha[14]=ha[2]*Fa+ha[6]*ba+ha[10]*Qa+ha[14],ha[15]=ha[3]*Fa+ha[7]*ba+ha[11]*Qa+ha[15];else{Ta=ha[0];Xa=ha[1];rb=ha[2];Cb=ha[3];Vb=ha[4];$a=ha[5];sb=ha[6];Qb=ha[7];vc=ha[8];var vd=ha[9];var wd=ha[10];var xd=ha[11];ha[0]=
Ta;ha[1]=Xa;ha[2]=rb;ha[3]=Cb;ha[4]=Vb;ha[5]=$a;ha[6]=sb;ha[7]=Qb;ha[8]=vc;ha[9]=vd;ha[10]=wd;ha[11]=xd;ha[12]=Ta*Fa+Vb*ba+vc*Qa+ha[12];ha[13]=Xa*Fa+$a*ba+vd*Qa+ha[13];ha[14]=rb*Fa+sb*ba+wd*Qa+ha[14];ha[15]=Cb*Fa+Qb*ba+xd*Qa+ha[15]}Qa=ha[0];Fa=ha[1];ba=ha[2];Ta=ha[3];Xa=ha[4];rb=ha[5];Cb=ha[6];Vb=ha[7];$a=ha[8];sb=ha[9];Qb=ha[10];vc=ha[11];vd=ha[12];wd=ha[13];xd=ha[14];var Ae=ha[15],ef=Qa*rb-Fa*Xa,ff=Qa*Cb-ba*Xa,gf=Qa*Vb-Ta*Xa,hf=Fa*Cb-ba*rb,jf=Fa*Vb-Ta*rb,kf=ba*Vb-Ta*Cb,lf=$a*wd-sb*vd,mf=$a*xd-Qb*
vd,nf=$a*Ae-vc*vd,of=sb*xd-Qb*wd,pf=sb*Ae-vc*wd,qf=Qb*Ae-vc*xd,gc=ef*qf-ff*pf+gf*of+hf*nf-jf*mf+kf*lf;gc&&(gc=1/gc,ha[0]=(rb*qf-Cb*pf+Vb*of)*gc,ha[1]=(ba*pf-Fa*qf-Ta*of)*gc,ha[2]=(wd*kf-xd*jf+Ae*hf)*gc,ha[3]=(Qb*jf-sb*kf-vc*hf)*gc,ha[4]=(Cb*nf-Xa*qf-Vb*mf)*gc,ha[5]=(Qa*qf-ba*nf+Ta*mf)*gc,ha[6]=(xd*gf-vd*kf-Ae*ff)*gc,ha[7]=($a*kf-Qb*gf+vc*ff)*gc,ha[8]=(Xa*pf-rb*nf+Vb*lf)*gc,ha[9]=(Fa*nf-Qa*pf-Ta*lf)*gc,ha[10]=(vd*jf-wd*gf+Ae*ef)*gc,ha[11]=(sb*gf-$a*jf-vc*ef)*gc,ha[12]=(rb*mf-Xa*of-Cb*lf)*gc,ha[13]=
(Qa*of-Fa*mf+ba*lf)*gc,ha[14]=(wd*ff-vd*hf-xd*ef)*gc,ha[15]=($a*hf-sb*ff+Qb*ef)*gc)}var z=Math.PI/180,B=.25*Math.PI,R=new Float32Array([0,0,0,1]),oa=new Float32Array([0,0,0]);return function(ba,ha,Fa){if(!ba||!ha)return!1;ba.pose=ha;ba.timestamp=ha.timestamp;v(ba.leftProjectionMatrix,ba.leftViewMatrix,ha,Fa._getFieldOfView("left"),Fa._getEyeOffset("left"),Fa);v(ba.rightProjectionMatrix,ba.rightViewMatrix,ha,Fa._getFieldOfView("right"),Fa._getEyeOffset("right"),Fa);return!0}}(),Jh=function(){var v=
{};return function(z,B){void 0===v[z]&&(console.warn("webvr-polyfill: "+B),v[z]=!0)}}();wb.prototype.destroy=function(){var v=this.gl;this.unpatch();v.deleteProgram(this.program);v.deleteBuffer(this.vertexBuffer);v.deleteBuffer(this.indexBuffer);v.deleteTexture(this.renderTarget);v.deleteFramebuffer(this.framebuffer);this.depthStencilBuffer&&v.deleteRenderbuffer(this.depthStencilBuffer);this.depthBuffer&&v.deleteRenderbuffer(this.depthBuffer);this.stencilBuffer&&v.deleteRenderbuffer(this.stencilBuffer);
this.cardboardUI&&this.cardboardUI.destroy()};wb.prototype.onResize=function(){var v=this.gl,z=this;F(v,[v.RENDERBUFFER_BINDING,v.TEXTURE_BINDING_2D,v.TEXTURE0],function(B){z.realBindFramebuffer.call(B,B.FRAMEBUFFER,null);z.scissorTest&&z.realDisable.call(B,B.SCISSOR_TEST);z.realColorMask.call(B,!0,!0,!0,!0);z.realViewport.call(B,0,0,B.drawingBufferWidth,B.drawingBufferHeight);z.realClearColor.call(B,0,0,0,1);B.clear(B.COLOR_BUFFER_BIT);z.realBindFramebuffer.call(B,B.FRAMEBUFFER,z.framebuffer);B.bindTexture(B.TEXTURE_2D,
z.renderTarget);B.texImage2D(B.TEXTURE_2D,0,z.ctxAttribs.alpha?B.RGBA:B.RGB,z.bufferWidth,z.bufferHeight,0,z.ctxAttribs.alpha?B.RGBA:B.RGB,B.UNSIGNED_BYTE,null);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE);B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE);B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,z.renderTarget,0);z.ctxAttribs.depth&&
z.ctxAttribs.stencil?(B.bindRenderbuffer(B.RENDERBUFFER,z.depthStencilBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_STENCIL,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_STENCIL_ATTACHMENT,B.RENDERBUFFER,z.depthStencilBuffer)):z.ctxAttribs.depth?(B.bindRenderbuffer(B.RENDERBUFFER,z.depthBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.DEPTH_COMPONENT16,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.DEPTH_ATTACHMENT,B.RENDERBUFFER,z.depthBuffer)):
z.ctxAttribs.stencil&&(B.bindRenderbuffer(B.RENDERBUFFER,z.stencilBuffer),B.renderbufferStorage(B.RENDERBUFFER,B.STENCIL_INDEX8,z.bufferWidth,z.bufferHeight),B.framebufferRenderbuffer(B.FRAMEBUFFER,B.STENCIL_ATTACHMENT,B.RENDERBUFFER,z.stencilBuffer));!B.checkFramebufferStatus(B.FRAMEBUFFER)===B.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!");z.realBindFramebuffer.call(B,B.FRAMEBUFFER,z.lastBoundFramebuffer);z.scissorTest&&z.realEnable.call(B,B.SCISSOR_TEST);z.realColorMask.apply(B,
z.colorMask);z.realViewport.apply(B,z.viewport);z.realClearColor.apply(B,z.clearColor)});if(this.cardboardUI)this.cardboardUI.onResize()};wb.prototype.patch=function(){if(!this.isPatched){var v=this,z=this.gl.canvas,B=this.gl;kc()||(z.width=Lb()*this.bufferScale,z.height=cc()*this.bufferScale,Object.defineProperty(z,"width",{configurable:!0,enumerable:!0,get:function(){return v.bufferWidth},set:function(R){v.bufferWidth=R;v.realCanvasWidth.set.call(z,R);v.onResize()}}),Object.defineProperty(z,"height",
{configurable:!0,enumerable:!0,get:function(){return v.bufferHeight},set:function(R){v.bufferHeight=R;v.realCanvasHeight.set.call(z,R);v.onResize()}}));this.lastBoundFramebuffer=B.getParameter(B.FRAMEBUFFER_BINDING);null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(B.FRAMEBUFFER,this.framebuffer));this.gl.bindFramebuffer=function(R,oa){v.lastBoundFramebuffer=oa?oa:v.framebuffer;v.realBindFramebuffer.call(B,R,v.lastBoundFramebuffer)};this.cullFace=
B.getParameter(B.CULL_FACE);this.depthTest=B.getParameter(B.DEPTH_TEST);this.blend=B.getParameter(B.BLEND);this.scissorTest=B.getParameter(B.SCISSOR_TEST);this.stencilTest=B.getParameter(B.STENCIL_TEST);B.enable=function(R){switch(R){case B.CULL_FACE:v.cullFace=!0;break;case B.DEPTH_TEST:v.depthTest=!0;break;case B.BLEND:v.blend=!0;break;case B.SCISSOR_TEST:v.scissorTest=!0;break;case B.STENCIL_TEST:v.stencilTest=!0}v.realEnable.call(B,R)};B.disable=function(R){switch(R){case B.CULL_FACE:v.cullFace=
!1;break;case B.DEPTH_TEST:v.depthTest=!1;break;case B.BLEND:v.blend=!1;break;case B.SCISSOR_TEST:v.scissorTest=!1;break;case B.STENCIL_TEST:v.stencilTest=!1}v.realDisable.call(B,R)};this.colorMask=B.getParameter(B.COLOR_WRITEMASK);B.colorMask=function(R,oa,ba,ha){v.colorMask[0]=R;v.colorMask[1]=oa;v.colorMask[2]=ba;v.colorMask[3]=ha;v.realColorMask.call(B,R,oa,ba,ha)};this.clearColor=B.getParameter(B.COLOR_CLEAR_VALUE);B.clearColor=function(R,oa,ba,ha){v.clearColor[0]=R;v.clearColor[1]=oa;v.clearColor[2]=
ba;v.clearColor[3]=ha;v.realClearColor.call(B,R,oa,ba,ha)};this.viewport=B.getParameter(B.VIEWPORT);B.viewport=function(R,oa,ba,ha){v.viewport[0]=R;v.viewport[1]=oa;v.viewport[2]=ba;v.viewport[3]=ha;v.realViewport.call(B,R,oa,ba,ha)};this.isPatched=!0;wa(z)}};wb.prototype.unpatch=function(){if(this.isPatched){var v=this.gl,z=this.gl.canvas;kc()||(Object.defineProperty(z,"width",this.realCanvasWidth),Object.defineProperty(z,"height",this.realCanvasHeight));z.width=this.bufferWidth;z.height=this.bufferHeight;
v.bindFramebuffer=this.realBindFramebuffer;v.enable=this.realEnable;v.disable=this.realDisable;v.colorMask=this.realColorMask;v.clearColor=this.realClearColor;v.viewport=this.realViewport;this.lastBoundFramebuffer==this.framebuffer&&v.bindFramebuffer(v.FRAMEBUFFER,null);this.isPatched=!1;setTimeout(function(){wa(z)},1)}};wb.prototype.setTextureBounds=function(v,z){v||(v=[0,0,.5,1]);z||(z=[.5,0,.5,1]);this.viewportOffsetScale[0]=v[0];this.viewportOffsetScale[1]=v[1];this.viewportOffsetScale[2]=v[2];
this.viewportOffsetScale[3]=v[3];this.viewportOffsetScale[4]=z[0];this.viewportOffsetScale[5]=z[1];this.viewportOffsetScale[6]=z[2];this.viewportOffsetScale[7]=z[3]};wb.prototype.submitFrame=function(){var v=this.gl,z=this,B=[];this.dirtySubmitFrameBindings||B.push(v.CURRENT_PROGRAM,v.ARRAY_BUFFER_BINDING,v.ELEMENT_ARRAY_BUFFER_BINDING,v.TEXTURE_BINDING_2D,v.TEXTURE0);F(v,B,function(R){z.realBindFramebuffer.call(R,R.FRAMEBUFFER,null);var oa=0,ba=0;z.instanceExt&&(oa=R.getVertexAttrib(z.attribs.position,
z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),ba=R.getVertexAttrib(z.attribs.texCoord,z.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE));z.cullFace&&z.realDisable.call(R,R.CULL_FACE);z.depthTest&&z.realDisable.call(R,R.DEPTH_TEST);z.blend&&z.realDisable.call(R,R.BLEND);z.scissorTest&&z.realDisable.call(R,R.SCISSOR_TEST);z.stencilTest&&z.realDisable.call(R,R.STENCIL_TEST);z.realColorMask.call(R,!0,!0,!0,!0);z.realViewport.call(R,0,0,R.drawingBufferWidth,R.drawingBufferHeight);if(z.ctxAttribs.alpha||
kc())z.realClearColor.call(R,0,0,0,1),R.clear(R.COLOR_BUFFER_BIT);R.useProgram(z.program);R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,z.indexBuffer);R.bindBuffer(R.ARRAY_BUFFER,z.vertexBuffer);R.enableVertexAttribArray(z.attribs.position);R.enableVertexAttribArray(z.attribs.texCoord);R.vertexAttribPointer(z.attribs.position,2,R.FLOAT,!1,20,0);R.vertexAttribPointer(z.attribs.texCoord,3,R.FLOAT,!1,20,8);z.instanceExt&&(0!=oa&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,0),0!=ba&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,
0));R.activeTexture(R.TEXTURE0);R.uniform1i(z.uniforms.diffuse,0);R.bindTexture(R.TEXTURE_2D,z.renderTarget);R.uniform4fv(z.uniforms.viewportOffsetScale,z.viewportOffsetScale);R.drawElements(R.TRIANGLES,z.indexCount,R.UNSIGNED_SHORT,0);z.cardboardUI&&z.cardboardUI.renderNoState();z.realBindFramebuffer.call(z.gl,R.FRAMEBUFFER,z.framebuffer);z.ctxAttribs.preserveDrawingBuffer||(z.realClearColor.call(R,0,0,0,0),R.clear(R.COLOR_BUFFER_BIT));z.dirtySubmitFrameBindings||z.realBindFramebuffer.call(R,R.FRAMEBUFFER,
z.lastBoundFramebuffer);z.cullFace&&z.realEnable.call(R,R.CULL_FACE);z.depthTest&&z.realEnable.call(R,R.DEPTH_TEST);z.blend&&z.realEnable.call(R,R.BLEND);z.scissorTest&&z.realEnable.call(R,R.SCISSOR_TEST);z.stencilTest&&z.realEnable.call(R,R.STENCIL_TEST);z.realColorMask.apply(R,z.colorMask);z.realViewport.apply(R,z.viewport);!z.ctxAttribs.alpha&&z.ctxAttribs.preserveDrawingBuffer||z.realClearColor.apply(R,z.clearColor);z.instanceExt&&(0!=oa&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.position,
oa),0!=ba&&z.instanceExt.vertexAttribDivisorANGLE(z.attribs.texCoord,ba))});kc()&&(v=v.canvas,v.width!=z.bufferWidth||v.height!=z.bufferHeight)&&(z.bufferWidth=v.width,z.bufferHeight=v.height,z.onResize())};wb.prototype.updateDeviceInfo=function(v){var z=this.gl,B=this;F(z,[z.ARRAY_BUFFER_BINDING,z.ELEMENT_ARRAY_BUFFER_BINDING],function(R){var oa=B.computeMeshVertices_(B.meshWidth,B.meshHeight,v);R.bindBuffer(R.ARRAY_BUFFER,B.vertexBuffer);R.bufferData(R.ARRAY_BUFFER,oa,R.STATIC_DRAW);B.indexCount||
(oa=B.computeMeshIndices_(B.meshWidth,B.meshHeight),R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,B.indexBuffer),R.bufferData(R.ELEMENT_ARRAY_BUFFER,oa,R.STATIC_DRAW),B.indexCount=oa.length)})};wb.prototype.computeMeshVertices_=function(v,z,B){for(var R=new Float32Array(2*v*z*5),oa=B.getLeftEyeVisibleTanAngles(),ba=B.getLeftEyeNoLensTanAngles(),ha=B.getLeftEyeVisibleScreenRect(ba),Fa=0,Ta=0;2>Ta;Ta++){for(var Qa=0;Qa<z;Qa++)for(var Xa=0;Xa<v;Xa++,Fa++){var $a=Xa/(v-1),rb=Qa/(z-1),Cb=$a,Vb=rb,sb=oa[0];$a=sb+
(oa[2]-sb)*$a;sb=oa[3];var Qb=sb+(oa[1]-sb)*rb;rb=Math.sqrt($a*$a+Qb*Qb);sb=B.distortion.distortInverse(rb);Qb=Qb*sb/rb;$a=($a*sb/rb-ba[0])/(ba[2]-ba[0]);rb=(Qb-ba[3])/(ba[1]-ba[3]);$a=2*(ha.x+$a*ha.width-.5);rb=2*(ha.y+rb*ha.height-.5);R[5*Fa]=$a;R[5*Fa+1]=rb;R[5*Fa+2]=Cb;R[5*Fa+3]=Vb;R[5*Fa+4]=Ta}Qa=oa[2]-oa[0];oa[0]=-(Qa+oa[0]);oa[2]=Qa-oa[2];Qa=ba[2]-ba[0];ba[0]=-(Qa+ba[0]);ba[2]=Qa-ba[2];ha.x=1-(ha.x+ha.width)}return R};wb.prototype.computeMeshIndices_=function(v,z){for(var B=new Uint16Array(2*
(v-1)*(z-1)*6),R=v/2,oa=z/2,ba=0,ha=0,Fa=0;2>Fa;Fa++)for(var Ta=0;Ta<z;Ta++)for(var Qa=0;Qa<v;Qa++,ba++)0!=Qa&&0!=Ta&&(Qa<=R==Ta<=oa?(B[ha++]=ba,B[ha++]=ba-v-1,B[ha++]=ba-v,B[ha++]=ba-v-1,B[ha++]=ba,B[ha++]=ba-1):(B[ha++]=ba-1,B[ha++]=ba-v,B[ha++]=ba,B[ha++]=ba-v,B[ha++]=ba-1,B[ha++]=ba-v-1));return B};wb.prototype.getOwnPropertyDescriptor_=function(v,z){v=Object.getOwnPropertyDescriptor(v,z);if(void 0===v.get||void 0===v.set)v.configurable=!0,v.enumerable=!0,v.get=function(){return this.getAttribute(z)},
v.set=function(B){this.setAttribute(z,B)};return v};var Yi=Math.PI/180;ic.prototype.destroy=function(){var v=this.gl;this.listener&&v.canvas.removeEventListener("click",this.listener,!1);v.deleteProgram(this.program);v.deleteBuffer(this.vertexBuffer)};ic.prototype.listen=function(v,z){var B=this.gl.canvas;this.listener=function(R){var oa=B.clientWidth/2,ba=R.touches?R.touches[0].clientX:R.clientX,ha=R.touches?R.touches[0].clientY:R.clientY;ba>oa-42&&ba<oa+42&&ha>B.clientHeight-42?v(R):42>ba&&42>ha&&
z(R)};B.addEventListener("click",this.listener,!1);B.addEventListener("touchstart",this.listener,!1)};ic.prototype.onResize=function(){var v=this.gl,z=this;F(v,[v.ARRAY_BUFFER_BINDING],function(B){function R(Cb,Vb){var sb=(90-Cb)*Yi;Cb=Math.cos(sb);sb=Math.sin(sb);ba.push(.3125*Cb*Xa+ha,.3125*sb*Xa+Xa);ba.push(Vb*Cb*Xa+ha,Vb*sb*Xa+Xa)}function oa(Cb,Vb){ba.push($a+Cb,B.drawingBufferHeight-$a-Vb)}var ba=[],ha=B.drawingBufferWidth/2,Fa=B.drawingBufferWidth/(Math.max(screen.width,screen.height)*window.devicePixelRatio)*
window.devicePixelRatio,Ta=4*Fa/2,Qa=42*Fa,Xa=28*Fa/2,$a=14*Fa;ba.push(ha-Ta,Qa);ba.push(ha-Ta,B.drawingBufferHeight);ba.push(ha+Ta,Qa);ba.push(ha+Ta,B.drawingBufferHeight);z.gearOffset=ba.length/2;for(Qa=0;6>=Qa;Qa++){var rb=60*Qa;R(rb,1);R(rb+12,1);R(rb+20,.75);R(rb+40,.75);R(rb+48,1)}z.gearVertexCount=ba.length/2-z.gearOffset;z.arrowOffset=ba.length/2;Qa=Ta/Math.sin(45*Yi);oa(0,Xa);oa(Xa,0);oa(Xa+Qa,Qa);oa(Qa,Xa+Qa);oa(Qa,Xa-Qa);oa(0,Xa);oa(Xa,2*Xa);oa(Xa+Qa,2*Xa-Qa);oa(Qa,Xa-Qa);oa(0,Xa);oa(Qa,
Xa-Ta);oa(28*Fa,Xa-Ta);oa(Qa,Xa+Ta);oa(28*Fa,Xa+Ta);z.arrowVertexCount=ba.length/2-z.arrowOffset;B.bindBuffer(B.ARRAY_BUFFER,z.vertexBuffer);B.bufferData(B.ARRAY_BUFFER,new Float32Array(ba),B.STATIC_DRAW)})};ic.prototype.render=function(){var v=this.gl,z=this;F(v,[v.CULL_FACE,v.DEPTH_TEST,v.BLEND,v.SCISSOR_TEST,v.STENCIL_TEST,v.COLOR_WRITEMASK,v.VIEWPORT,v.CURRENT_PROGRAM,v.ARRAY_BUFFER_BINDING],function(B){B.disable(B.CULL_FACE);B.disable(B.DEPTH_TEST);B.disable(B.BLEND);B.disable(B.SCISSOR_TEST);
B.disable(B.STENCIL_TEST);B.colorMask(!0,!0,!0,!0);B.viewport(0,0,B.drawingBufferWidth,B.drawingBufferHeight);z.renderNoState()})};ic.prototype.renderNoState=function(){var v=this.gl;v.useProgram(this.program);v.bindBuffer(v.ARRAY_BUFFER,this.vertexBuffer);v.enableVertexAttribArray(this.attribs.position);v.vertexAttribPointer(this.attribs.position,2,v.FLOAT,!1,8,0);v.uniform4f(this.uniforms.color,1,1,1,1);var z=this.projMat,B=v.drawingBufferWidth,R=v.drawingBufferHeight,oa=1/(0-B),ba=1/(0-R),ha=1/
-1023.9;z[0]=-2*oa;z[1]=0;z[2]=0;z[3]=0;z[4]=0;z[5]=-2*ba;z[6]=0;z[7]=0;z[8]=0;z[9]=0;z[10]=2*ha;z[11]=0;z[12]=(0+B)*oa;z[13]=(R+0)*ba;z[14]=1024.1*ha;z[15]=1;v.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat);v.drawArrays(v.TRIANGLE_STRIP,0,4);v.drawArrays(v.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount);v.drawArrays(v.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};yb.prototype.distortInverse=function(v){for(var z=0,B=1,R=v-this.distort(z);1E-4<Math.abs(B-z);){var oa=
v-this.distort(B);R=B-(B-z)/(oa-R)*oa;z=B;B=R;R=oa}return B};yb.prototype.distort=function(v){for(var z=v*v,B=0,R=0;R<this.coefficients.length;R++)B=z*(B+this.coefficients[R]);return(B+1)*v};var md=Math.PI/180,nd=180/Math.PI;E.prototype={constructor:E,set:function(v,z,B){this.x=v;this.y=z;this.z=B;return this},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var v=this.length();0!==v?
this.multiplyScalar(1/v):this.z=this.y=this.x=0;return this},multiplyScalar:function(v){this.x*=v;this.y*=v;this.z*=v},applyQuaternion:function(v){var z=this.x,B=this.y,R=this.z,oa=v.x,ba=v.y,ha=v.z;v=v.w;var Fa=v*z+ba*R-ha*B,Ta=v*B+ha*z-oa*R,Qa=v*R+oa*B-ba*z;z=-oa*z-ba*B-ha*R;this.x=Fa*v+z*-oa+Ta*-ha-Qa*-ba;this.y=Ta*v+z*-ba+Qa*-oa-Fa*-ha;this.z=Qa*v+z*-ha+Fa*-ba-Ta*-oa;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},crossVectors:function(v,z){var B=v.x,R=v.y;v=v.z;var oa=z.x,
ba=z.y;z=z.z;this.x=R*z-v*ba;this.y=v*oa-B*z;this.z=B*ba-R*oa;return this}};y.prototype={constructor:y,set:function(v,z,B,R){this.x=v;this.y=z;this.z=B;this.w=R;return this},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=v.w;return this},setFromEulerXYZ:function(v,z,B){var R=Math.cos(v/2),oa=Math.cos(z/2),ba=Math.cos(B/2);v=Math.sin(v/2);z=Math.sin(z/2);B=Math.sin(B/2);this.x=v*oa*ba+R*z*B;this.y=R*z*ba-v*oa*B;this.z=R*oa*B+v*z*ba;this.w=R*oa*ba-v*z*B;return this},setFromEulerYXZ:function(v,
z,B){var R=Math.cos(v/2),oa=Math.cos(z/2),ba=Math.cos(B/2);v=Math.sin(v/2);z=Math.sin(z/2);B=Math.sin(B/2);this.x=v*oa*ba+R*z*B;this.y=R*z*ba-v*oa*B;this.z=R*oa*B-v*z*ba;this.w=R*oa*ba+v*z*B;return this},setFromAxisAngle:function(v,z){z/=2;var B=Math.sin(z);this.x=v.x*B;this.y=v.y*B;this.z=v.z*B;this.w=Math.cos(z);return this},multiply:function(v){return this.multiplyQuaternions(this,v)},multiplyQuaternions:function(v,z){var B=v.x,R=v.y,oa=v.z;v=v.w;var ba=z.x,ha=z.y,Fa=z.z;z=z.w;this.x=B*z+v*ba+
R*Fa-oa*ha;this.y=R*z+v*ha+oa*ba-B*Fa;this.z=oa*z+v*Fa+B*ha-R*ba;this.w=v*z-B*ba-R*ha-oa*Fa;return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;this.normalize();return this},normalize:function(){var v=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===v?(this.z=this.y=this.x=0,this.w=1):(v=1/v,this.x*=v,this.y*=v,this.z*=v,this.w*=v);return this},slerp:function(v,z){if(0===z)return this;if(1===z)return this.copy(v);var B=this.x,R=this.y,oa=this.z,ba=this.w,ha=ba*v.w+
B*v.x+R*v.y+oa*v.z;0>ha?(this.w=-v.w,this.x=-v.x,this.y=-v.y,this.z=-v.z,ha=-ha):this.copy(v);if(1<=ha)return this.w=ba,this.x=B,this.y=R,this.z=oa,this;v=Math.acos(ha);var Fa=Math.sqrt(1-ha*ha);if(.001>Math.abs(Fa))return this.w=.5*(ba+this.w),this.x=.5*(B+this.x),this.y=.5*(R+this.y),this.z=.5*(oa+this.z),this;ha=Math.sin((1-z)*v)/Fa;z=Math.sin(z*v)/Fa;this.w=ba*ha+this.w*z;this.x=B*ha+this.x*z;this.y=R*ha+this.y*z;this.z=oa*ha+this.z*z;return this},setFromUnitVectors:function(){var v,z;return function(B,
R){void 0===v&&(v=new E);z=B.dot(R)+1;1E-6>z?(z=0,Math.abs(B.x)>Math.abs(B.z)?v.set(-B.y,B.x,0):v.set(0,-B.z,B.y)):v.crossVectors(B,R);this.x=v.x;this.y=v.y;this.z=v.z;this.w=z;this.normalize();return this}}()};var Cl=new Ab({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),Dl=new Ab({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Lh={CardboardV1:new Bb({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,
.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new Bb({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9.904169E-4,6.183535E-5,-1.6981803E-6]})};gb.prototype.updateDeviceParams=
function(v){this.device=this.determineDevice_(v)||this.device};gb.prototype.getDevice=function(){return this.device};gb.prototype.setViewer=function(v){this.viewer=v;this.distortion=new yb(this.viewer.distortionCoefficients)};gb.prototype.determineDevice_=function(v){if(!v){if(kc())return console.warn("Using fallback iOS device measurements."),Dl;console.warn("Using fallback Android device measurements.");return Cl}var z=.0254/v.xdpi,B=.0254/v.ydpi,R=Lb(),oa=cc();return new Ab({widthMeters:z*R,heightMeters:B*
oa,bevelMeters:.001*v.bevelMm})};gb.prototype.getDistortedFieldOfViewLeftEye=function(){var v=this.viewer,z=this.device,B=this.distortion,R=v.screenLensDistance,oa=v.interLensDistance/2,ba=v.baselineLensDistance-z.bevelMeters,ha=z.heightMeters-ba;z=nd*Math.atan(B.distort((z.widthMeters-v.interLensDistance)/2/R));oa=nd*Math.atan(B.distort(oa/R));ba=nd*Math.atan(B.distort(ba/R));B=nd*Math.atan(B.distort(ha/R));return{leftDegrees:Math.min(z,v.fov),rightDegrees:Math.min(oa,v.fov),downDegrees:Math.min(ba,
v.fov),upDegrees:Math.min(B,v.fov)}};gb.prototype.getLeftEyeVisibleTanAngles=function(){var v=this.viewer,z=this.device,B=this.distortion,R=Math.tan(-md*v.fov),oa=Math.tan(md*v.fov),ba=Math.tan(md*v.fov),ha=Math.tan(-md*v.fov),Fa=z.widthMeters/4,Ta=z.heightMeters/2,Qa=v.interLensDistance/2-Fa,Xa=-(v.baselineLensDistance-z.bevelMeters-Ta),$a=v.screenLensDistance;v=B.distort((Qa-Fa)/$a);z=B.distort((Xa+Ta)/$a);Fa=B.distort((Qa+Fa)/$a);B=B.distort((Xa-Ta)/$a);Ta=new Float32Array(4);Ta[0]=Math.max(R,
v);Ta[1]=Math.min(oa,z);Ta[2]=Math.min(ba,Fa);Ta[3]=Math.max(ha,B);return Ta};gb.prototype.getLeftEyeNoLensTanAngles=function(){var v=this.viewer,z=this.device,B=this.distortion,R=new Float32Array(4),oa=B.distortInverse(Math.tan(-md*v.fov)),ba=B.distortInverse(Math.tan(md*v.fov)),ha=B.distortInverse(Math.tan(md*v.fov));B=B.distortInverse(Math.tan(-md*v.fov));var Fa=z.widthMeters/4,Ta=z.heightMeters/2,Qa=v.interLensDistance/2-Fa;z=-(v.baselineLensDistance-z.bevelMeters-Ta);v=v.screenLensDistance;R[0]=
Math.max(oa,(Qa-Fa)/v);R[1]=Math.min(ba,(z+Ta)/v);R[2]=Math.min(ha,(Qa+Fa)/v);R[3]=Math.max(B,(z-Ta)/v);return R};gb.prototype.getLeftEyeVisibleScreenRect=function(v){var z=this.viewer,B=this.device,R=z.screenLensDistance,oa=(B.widthMeters-z.interLensDistance)/2;z=z.baselineLensDistance-B.bevelMeters;var ba=(v[0]*R+oa)/B.widthMeters,ha=(v[3]*R+z)/B.heightMeters;return{x:ba,y:ha,width:(v[2]*R+oa)/B.widthMeters-ba,height:(v[1]*R+z)/B.heightMeters-ha}};gb.prototype.getFieldOfViewLeftEye=function(v){return v?
this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};gb.prototype.getFieldOfViewRightEye=function(v){v=this.getFieldOfViewLeftEye(v);return{leftDegrees:v.rightDegrees,rightDegrees:v.leftDegrees,upDegrees:v.upDegrees,downDegrees:v.downDegrees}};gb.prototype.getUndistortedFieldOfViewLeftEye=function(){var v=this.getUndistortedParams_();return{leftDegrees:nd*Math.atan(v.outerDist),rightDegrees:nd*Math.atan(v.innerDist),downDegrees:nd*Math.atan(v.bottomDist),upDegrees:nd*Math.atan(v.topDist)}};
gb.prototype.getUndistortedViewportLeftEye=function(){var v=this.getUndistortedParams_(),z=this.device,B=this.viewer.screenLensDistance,R=z.width/(z.widthMeters/B);z=z.height/(z.heightMeters/B);B=Math.round((v.eyePosX-v.outerDist)*R);var oa=Math.round((v.eyePosY-v.bottomDist)*z);return{x:B,y:oa,width:Math.round((v.eyePosX+v.innerDist)*R)-B,height:Math.round((v.eyePosY+v.topDist)*z)-oa}};gb.prototype.getUndistortedParams_=function(){var v=this.viewer,z=this.device,B=v.screenLensDistance,R=v.interLensDistance/
2/B,oa=z.heightMeters/B,ba=z.widthMeters/B/2-R;z=(v.baselineLensDistance-z.bevelMeters)/B;v=this.distortion.distortInverse(Math.tan(md*v.fov));return{outerDist:Math.min(ba,v),innerDist:Math.min(R,v),topDist:Math.min(oa-z,v),bottomDist:Math.min(z,v),eyePosX:ba,eyePosY:z}};gb.Viewers=Lh;var ql={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],
dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,
ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},
{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,
bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},
{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},
{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],
dpi:[403.4,403],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,
327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,
ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},
{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},
{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},
{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],
dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],
dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],
dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,
518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],
dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,
520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},
{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",
rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1E3},
{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},
{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,
1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,
2688]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},
{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};Yc.prototype.getDeviceParams=function(){return this.deviceParams};Yc.prototype.recalculateDeviceParams_=function(){var v=this.calcDeviceParams_();if(v){if(this.deviceParams=v,this.onDeviceParamsUpdated)this.onDeviceParamsUpdated(this.deviceParams)}else console.error("Failed to recalculate device parameters.")};Yc.prototype.calcDeviceParams_=function(){var v=this.dpdb;if(!v)return console.error("DPDB not available."),null;if(1!=v.format)return console.error("DPDB has unexpected format version."),
null;if(!v.devices||!v.devices.length)return console.error("DPDB does not have a devices section."),null;var z=navigator.userAgent||navigator.vendor||window.opera,B=Lb(),R=cc();if(!v.devices)return console.error("DPDB has no devices section."),null;for(var oa=0;oa<v.devices.length;oa++){var ba=v.devices[oa];if(!ba.rules)console.warn("Device["+oa+"] has no rules section.");else if("ios"!=ba.type&&"android"!=ba.type)console.warn("Device["+oa+"] has invalid type.");else if(kc()==("ios"==ba.type)){for(var ha=
!1,Fa=0;Fa<ba.rules.length;Fa++)if(this.ruleMatches_(ba.rules[Fa],z,B,R)){ha=!0;break}if(ha)return new ae({xdpi:ba.dpi[0]||ba.dpi,ydpi:ba.dpi[1]||ba.dpi,bevelMm:ba.bw})}}console.warn("No DPDB device match.");return null};Yc.prototype.ruleMatches_=function(v,z,B,R){if(!v.ua&&!v.res)return!1;v.ua&&"SM"===v.ua.substring(0,2)&&(v.ua=v.ua.substring(0,7));if(v.ua&&0>z.indexOf(v.ua))return!1;if(v.res){if(!v.res[0]||!v.res[1])return!1;z=v.res[0];v=v.res[1];if(Math.min(B,R)!=Math.min(z,v)||Math.max(B,R)!=
Math.max(z,v))return!1}return!0};Zc.prototype.set=function(v,z){this.sample=v;this.timestampS=z};Zc.prototype.copy=function(v){this.set(v.sample,v.timestampS)};Ec.prototype.addAccelMeasurement=function(v,z){this.currentAccelMeasurement.set(v,z)};Ec.prototype.addGyroMeasurement=function(v,z){this.currentGyroMeasurement.set(v,z);v=z-this.previousGyroMeasurement.timestampS;isNaN(v)||.001>=v||1<v||this.run_();this.previousGyroMeasurement.copy(this.currentGyroMeasurement)};Ec.prototype.run_=function(){if(this.isOrientationInitialized){var v=
this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);this.gyroIntegralQ.multiply(v);this.filterQ.copy(this.previousFilterQ);this.filterQ.multiply(v);v=new y;v.copy(this.filterQ);v.inverse();this.estimatedGravity.set(0,0,-1);this.estimatedGravity.applyQuaternion(v);this.estimatedGravity.normalize();this.measuredGravity.copy(this.currentAccelMeasurement.sample);this.measuredGravity.normalize();v=new y;v.setFromUnitVectors(this.estimatedGravity,
this.measuredGravity);v.inverse();if(this.isDebug){var z=console,B=z.log;if(1<v.w){console.warn("getQuaternionAngle: w > 1");var R=0}else R=2*Math.acos(v.w);B.call(z,"Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",nd*R,this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1))}z=new y;z.copy(this.filterQ);z.multiply(v);this.filterQ.slerp(z,
1-this.kFilter);this.previousFilterQ.copy(this.filterQ)}else this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0};Ec.prototype.getOrientation=function(){return this.filterQ};Ec.prototype.accelToQuaternion_=function(v){var z=new E;z.copy(v);z.normalize();v=new y;v.setFromUnitVectors(new E(0,0,-1),z);v.inverse();return v};Ec.prototype.gyroToQuaternionDelta_=function(v,z){var B=new y,R=new E;R.copy(v);R.normalize();
B.setFromAxisAngle(R,v.length()*z);return B};Od.prototype.getPrediction=function(v,z,B){if(!this.previousTimestampS)return this.previousQ.copy(v),this.previousTimestampS=B,v;var R=new E;R.copy(z);R.normalize();z=z.length();if(z<20*md)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(nd*z).toFixed(1)),this.outQ.copy(v),this.previousQ.copy(v),this.outQ;this.deltaQ.setFromAxisAngle(R,z*this.predictionTimeS);this.outQ.copy(this.previousQ);this.outQ.multiply(this.deltaQ);this.previousQ.copy(v);
this.previousTimestampS=B;return this.outQ};jc.prototype.getPosition=function(){return null};jc.prototype.getOrientation=function(){var v=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var B=(new y).setFromAxisAngle(new E(0,0,-1),0),R=new y;-90===window.orientation?R.setFromAxisAngle(new E(0,1,0),Math.PI/-2):R.setFromAxisAngle(new E(0,1,0),Math.PI/2);return B.multiply(R)}();this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||
function(){var B=new y;B.setFromAxisAngle(new E(1,0,0),-Math.PI/2);return B}();v=this._deviceOrientationQ;var z=new y;z.copy(v);z.multiply(this.deviceOrientationFilterToWorldQ);z.multiply(this.resetQ);z.multiply(this.worldToScreenQ);z.multiplyQuaternions(this.deviceOrientationFixQ,z);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_}v=this.filter.getOrientation();v=this.posePredictor.getPrediction(v,
this.gyroscope,this.previousTimestampS);z=new y;z.copy(this.filterToWorldQ);z.multiply(this.resetQ);z.multiply(v);z.multiply(this.worldToScreenQ);this.yawOnly&&(z.x=0,z.z=0,z.normalize());this.orientationOut_[0]=z.x;this.orientationOut_[1]=z.y;this.orientationOut_[2]=z.z;this.orientationOut_[3]=z.w;return this.orientationOut_};jc.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation());this.resetQ.x=0;this.resetQ.y=0;this.resetQ.z*=-1;this.resetQ.normalize();$b()&&this.resetQ.multiply(this.inverseWorldToScreenQ);
this.resetQ.multiply(this.originalPoseAdjustQ)};jc.prototype.onDeviceOrientation_=function(v){this._deviceOrientationQ=this._deviceOrientationQ||new y;var z=v.alpha,B=v.beta;v=v.gamma;z=(z||0)*Math.PI/180;B=(B||0)*Math.PI/180;v=(v||0)*Math.PI/180;this._deviceOrientationQ.setFromEulerYXZ(B,z,-v)};jc.prototype.onDeviceMotion_=function(v){this.updateDeviceMotion_(v)};jc.prototype.updateDeviceMotion_=function(v){var z=v.accelerationIncludingGravity,B=v.rotationRate;v=v.timeStamp/1E3;var R=v-this.previousTimestampS;
0>R?Jh("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"):.001>=R||1<R?Jh("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-z.x,-z.y,-z.z),B&&(Vi()?this.gyroscope.set(-B.beta,B.alpha,B.gamma):this.gyroscope.set(B.alpha,B.beta,B.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,
v)),this.filter.addAccelMeasurement(this.accelerometer,v));this.previousTimestampS=v};jc.prototype.onOrientationChange_=function(){this.setScreenTransform_()};jc.prototype.onMessage_=function(v){(v=v.data)&&v.type&&"devicemotion"===v.type.toLowerCase()&&this.updateDeviceMotion_(v.deviceMotionEvent)};jc.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);switch(window.orientation){case 90:this.worldToScreenQ.setFromAxisAngle(new E(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new E(0,
0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ);this.inverseWorldToScreenQ.inverse()};jc.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this);this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this);this.onMessageCallback_=this.onMessage_.bind(this);this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this);var v;if(v=kc()){v=window.self!==window.top;var z=sa(document.referrer),B=sa(window.location.href);v=v&&z!==B}v&&
window.addEventListener("message",this.onMessageCallback_);window.addEventListener("orientationchange",this.onOrientationChangeCallback_);this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)};jc.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_);window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_);window.removeEventListener("orientationchange",
this.onOrientationChangeCallback_);window.removeEventListener("message",this.onMessageCallback_)};var El=new E(1,0,0),Fl=new E(0,0,1),Mh=new y;Mh.setFromAxisAngle(El,-Math.PI/2);Mh.multiply((new y).setFromAxisAngle(Fl,Math.PI/2));var xl=function(){function v(z){if(!(this instanceof v))throw new TypeError("Cannot call a class as a function");this.config=z;this.fusionSensor=this.sensor=null;this._out=new Float32Array(4);this.api=null;this.errors=[];this._sensorQ=new y;this._outQ=new y;this._onSensorRead=
this._onSensorRead.bind(this);this._onSensorError=this._onSensorError.bind(this);this.init()}yl(v,[{key:"init",value:function(){var z=null;try{z=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"}),z.addEventListener("error",this._onSensorError)}catch(B){this.errors.push(B),"SecurityError"===B.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),
this.useDeviceMotion()):"ReferenceError"===B.name?this.useDeviceMotion():console.error(B)}z&&(this.api="sensor",this.sensor=z,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion";this.fusionSensor=new jc(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG);this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",
this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var z=this.sensor.quaternion;this._sensorQ.set(z[0],z[1],z[2],z[3]);z=this._outQ;z.copy(Mh);z.multiply(this._sensorQ);this.config.YAW_ONLY&&(z.x=z.z=0,z.normalize());this._out[0]=z.x;this._out[1]=z.y;this._out[2]=z.z;this._out[3]=z.w;return this._out}},
{key:"_onSensorError",value:function(z){this.errors.push(z.error);"NotAllowedError"===z.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===z.error.name?console.error("Sensor could not be read"):console.error(z.error);this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]);return v}();Fc.prototype.show=function(v){v||this.overlay.parentElement?v&&(this.overlay.parentElement&&this.overlay.parentElement!=v&&this.overlay.parentElement.removeChild(this.overlay),
v.appendChild(this.overlay)):document.body.appendChild(this.overlay);this.overlay.style.display="block";v=this.overlay.querySelector("img").style;$b()?(v.width="20%",v.marginLeft="40%",v.marginTop="3%"):(v.width="50%",v.marginLeft="25%",v.marginTop="25%")};Fc.prototype.hide=function(){this.overlay.style.display="none"};Fc.prototype.showTemporarily=function(v,z){this.show(z);this.timer=setTimeout(this.hide.bind(this),v)};Fc.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)};Fc.prototype.update=
function(){this.disableShowTemporarily();!$b()&&db()?this.show():this.hide()};Fc.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};
ub.prototype.show=function(v){this.root=v;v.appendChild(this.dialog);this.dialog.querySelector("#"+this.selectedKey).checked=!0;this.dialog.style.display="block"};ub.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog);this.dialog.style.display="none"};ub.prototype.getCurrentViewer=function(){return gb.Viewers[this.selectedKey]};ub.prototype.getSelectedKey_=function(){var v=this.dialog.querySelector("input[name=field]:checked");return v?v.id:null};
ub.prototype.onChange=function(v){this.onChangeCallbacks_.push(v)};ub.prototype.fireOnChange_=function(v){for(var z=0;z<this.onChangeCallbacks_.length;z++)this.onChangeCallbacks_[z](v)};ub.prototype.onSave_=function(){if((this.selectedKey=this.getSelectedKey_())&&gb.Viewers[this.selectedKey]){this.fireOnChange_(gb.Viewers[this.selectedKey]);try{localStorage.setItem("WEBVR_CARDBOARD_VIEWER",this.selectedKey)}catch(v){console.error("Failed to save viewer profile: %s",v)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")};
ub.prototype.createDialog_=function(v){var z=document.createElement("div");z.classList.add("webvr-polyfill-viewer-selector");z.style.display="none";var B=document.createElement("div"),R=B.style;R.position="fixed";R.left=0;R.top=0;R.width="100%";R.height="100%";R.background="rgba(0, 0, 0, 0.3)";B.addEventListener("click",this.hide.bind(this));var oa=document.createElement("div");R=oa.style;R.boxSizing="border-box";R.position="fixed";R.top="24px";R.left="50%";R.marginLeft="-140px";R.width="280px";R.padding=
"24px";R.overflow="hidden";R.background="#fafafa";R.fontFamily="'Roboto', sans-serif";R.boxShadow="0px 5px 20px #666";oa.appendChild(this.createH1_("Select your viewer"));for(var ba in v)oa.appendChild(this.createChoice_(ba,v[ba].label));oa.appendChild(this.createButton_("Save",this.onSave_.bind(this)));z.appendChild(B);z.appendChild(oa);return z};ub.prototype.createH1_=function(v){var z=document.createElement("h1"),B=z.style;B.color="black";B.fontSize="20px";B.fontWeight="bold";B.marginTop=0;B.marginBottom=
"24px";z.innerHTML=v;return z};ub.prototype.createChoice_=function(v,z){var B=document.createElement("div");B.style.marginTop="8px";B.style.color="black";var R=document.createElement("input");R.style.fontSize="30px";R.setAttribute("id",v);R.setAttribute("type","radio");R.setAttribute("value",v);R.setAttribute("name","field");var oa=document.createElement("label");oa.style.marginLeft="4px";oa.setAttribute("for",v);oa.innerHTML=z;B.appendChild(R);B.appendChild(oa);return B};ub.prototype.createButton_=
function(v,z){var B=document.createElement("button");B.innerHTML=v;v=B.style;v.float="right";v.textTransform="uppercase";v.color="#1094f7";v.fontSize="14px";v.letterSpacing=0;v.border=0;v.background="none";v.marginTop="16px";B.addEventListener("click",z);return B};var Gl="undefined"!==typeof window?window:"undefined"!==typeof Ih?Ih:"undefined"!==typeof self?self:{},vl=function(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v["default"]:v}(function(v,z){return z={exports:{}},
v(z,z.exports),z.exports}(function(v){(function(z,B){v.exports=B()})(Gl,function(){return function(z){function B(oa){if(R[oa])return R[oa].exports;var ba=R[oa]={i:oa,l:!1,exports:{}};z[oa].call(ba.exports,ba,ba.exports,B);ba.l=!0;return ba.exports}var R={};B.m=z;B.c=R;B.d=function(oa,ba,ha){B.o(oa,ba)||Object.defineProperty(oa,ba,{configurable:!1,enumerable:!0,get:ha})};B.n=function(oa){var ba=oa&&oa.__esModule?function(){return oa["default"]}:function(){return oa};B.d(ba,"a",ba);return ba};B.o=function(oa,
ba){return Object.prototype.hasOwnProperty.call(oa,ba)};B.p="";return B(B.s=0)}([function(z,B,R){var oa=function(){function Fa(Ta,Qa){for(var Xa=0;Xa<Qa.length;Xa++){var $a=Qa[Xa];$a.enumerable=$a.enumerable||!1;$a.configurable=!0;"value"in $a&&($a.writable=!0);Object.defineProperty(Ta,$a.key,$a)}}return function(Ta,Qa,Xa){Qa&&Fa(Ta.prototype,Qa);Xa&&Fa(Ta,Xa);return Ta}}(),ba=R(1),ha="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||
[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream;B=function(){function Fa(){if(!(this instanceof Fa))throw new TypeError("Cannot call a class as a function");ha?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",ba),this.noSleepVideo.addEventListener("timeupdate",function(){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}
oa(Fa,[{key:"enable",value:function(){ha?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){ha?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return Fa}();z.exports=B},function(z){z.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),
ul=1E3,Hl=[0,0,.5,1],Il=[.5,0,.5,1],Jl=window.requestAnimationFrame,Kl=window.cancelAnimationFrame;Pb.prototype.getFrameData=function(v){return Bl(v,this._getPose(),this)};Pb.prototype.getPose=function(){da("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData");return this._getPose()};Pb.prototype.resetPose=function(){da("VRDisplay.prototype.resetPose");return this._resetPose()};Pb.prototype.getImmediatePose=function(){da("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData");
return this._getPose()};Pb.prototype.requestAnimationFrame=function(v){return Jl(v)};Pb.prototype.cancelAnimationFrame=function(v){return Kl(v)};Pb.prototype.wrapForFullscreen=function(v){if(kc())return v;this.fullscreenWrapper_||(this.fullscreenWrapper_=document.createElement("div"),this.fullscreenWrapper_.setAttribute("style",["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important; left: 0 !important; right: 0 !important; border: 0; margin: 0; padding: 0; z-index: 999999 !important; position: fixed"].join("; ")+
";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper"));if(this.fullscreenElement_==v)return this.fullscreenWrapper_;this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_));this.fullscreenElement_=v;(this.originalParent_=v.parentElement)||document.body.appendChild(v);this.fullscreenWrapper_.parentElement||(v=this.fullscreenElement_.parentElement,v.insertBefore(this.fullscreenWrapper_,
this.fullscreenElement_),v.removeChild(this.fullscreenElement_));this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild);this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");this.fullscreenElement_&&this.fullscreenElement_.setAttribute("style",["position: absolute; top: 0; left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0; margin: 0; padding: 0"].join("; ")+
";");return this.fullscreenWrapper_};Pb.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var v=this.fullscreenElement_;this.fullscreenElementCachedStyle_?v.setAttribute("style",this.fullscreenElementCachedStyle_):v.removeAttribute("style");this.fullscreenElementCachedStyle_=this.fullscreenElement_=null;var z=this.fullscreenWrapper_.parentElement;this.fullscreenWrapper_.removeChild(v);this.originalParent_===z?z.insertBefore(v,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(v);
z.removeChild(this.fullscreenWrapper_);return v}};Pb.prototype.requestPresent=function(v){var z=this.isPresenting,B=this;v instanceof Array||(da("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),v=[v]);return new Promise(function(R,oa){if(B.capabilities.canPresent)if(0==v.length||v.length>B.capabilities.maxLayers)oa(Error("Invalid number of layers."));else{var ba=v[0];if(ba.source){var ha=ba.leftBounds||Hl,Fa=ba.rightBounds||Il;if(z){var Ta=
B.layer_;Ta.source!==ba.source&&(Ta.source=ba.source);for(ba=0;4>ba;ba++)Ta.leftBounds[ba]=ha[ba],Ta.rightBounds[ba]=Fa[ba];B.wrapForFullscreen(B.layer_.source);B.updatePresent_();R()}else{B.layer_={predistorted:ba.predistorted,source:ba.source,leftBounds:ha.slice(0),rightBounds:Fa.slice(0)};B.waitingForPresent_=!1;if(B.layer_&&B.layer_.source){var Qa=B.wrapForFullscreen(B.layer_.source);B.addFullscreenListeners_(Qa,function(){B.isPresenting=Qa===(document.fullscreenElement||document.webkitFullscreenElement||
document.mozFullScreenElement||document.msFullscreenElement);B.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(Xa){console.error("screen.orientation.lock() failed due to",Xa.message)}),B.waitingForPresent_=!1,B.beginPresent_(),R()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),B.removeFullscreenWrapper(),B.disableWakeLock(),B.endPresent_(),B.removeFullscreenListeners_());B.fireVRDisplayPresentChange_()},
function(){B.waitingForPresent_&&(B.removeFullscreenWrapper(),B.removeFullscreenListeners_(),B.disableWakeLock(),B.waitingForPresent_=!1,B.isPresenting=!1,oa(Error("Unable to present.")))});if(Zb(Qa))B.enableWakeLock(),B.waitingForPresent_=!0;else if(kc()||Kh())B.enableWakeLock(),B.isPresenting=!0,B.beginPresent_(),B.fireVRDisplayPresentChange_(),R()}B.waitingForPresent_||kc()||(Kb(),oa(Error("Unable to present.")))}}else R()}else oa(Error("VRDisplay is not capable of presenting."))})};Pb.prototype.exitPresent=
function(){var v=this.isPresenting,z=this;this.isPresenting=!1;this.layer_=null;this.disableWakeLock();return new Promise(function(B,R){v?(!Kb()&&kc()&&(z.endPresent_(),z.fireVRDisplayPresentChange_()),Kh()&&(z.removeFullscreenWrapper(),z.removeFullscreenListeners_(),z.endPresent_(),z.fireVRDisplayPresentChange_()),B()):R(Error("Was not presenting to VRDisplay."))})};Pb.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]};Pb.prototype.fireVRDisplayPresentChange_=function(){var v=new CustomEvent("vrdisplaypresentchange",
{detail:{display:this}});window.dispatchEvent(v)};Pb.prototype.fireVRDisplayConnect_=function(){var v=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(v)};Pb.prototype.addFullscreenListeners_=function(v,z,B){this.removeFullscreenListeners_();this.fullscreenEventTarget_=v;this.fullscreenChangeHandler_=z;this.fullscreenErrorHandler_=B;z&&(document.fullscreenEnabled?v.addEventListener("fullscreenchange",z,!1):document.webkitFullscreenEnabled?v.addEventListener("webkitfullscreenchange",
z,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",z,!1):document.msFullscreenEnabled&&v.addEventListener("msfullscreenchange",z,!1));B&&(document.fullscreenEnabled?v.addEventListener("fullscreenerror",B,!1):document.webkitFullscreenEnabled?v.addEventListener("webkitfullscreenerror",B,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",B,!1):document.msFullscreenEnabled&&v.addEventListener("msfullscreenerror",B,!1))};Pb.prototype.removeFullscreenListeners_=
function(){if(this.fullscreenEventTarget_){var v=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var z=this.fullscreenChangeHandler_;v.removeEventListener("fullscreenchange",z,!1);v.removeEventListener("webkitfullscreenchange",z,!1);document.removeEventListener("mozfullscreenchange",z,!1);v.removeEventListener("msfullscreenchange",z,!1)}this.fullscreenErrorHandler_&&(z=this.fullscreenErrorHandler_,v.removeEventListener("fullscreenerror",z,!1),v.removeEventListener("webkitfullscreenerror",
z,!1),document.removeEventListener("mozfullscreenerror",z,!1),v.removeEventListener("msfullscreenerror",z,!1));this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=null}};Pb.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()};Pb.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()};Pb.prototype.beginPresent_=function(){};Pb.prototype.endPresent_=function(){};Pb.prototype.submitFrame=function(){};Pb.prototype.getEyeParameters=
function(){return null};var wl={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};fc.prototype=Object.create(Pb.prototype);fc.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,
angularAcceleration:null}};fc.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()};fc.prototype._getFieldOfView=function(v){if("left"==v)v=this.deviceInfo_.getFieldOfViewLeftEye();else if("right"==v)v=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",v),null;return v};fc.prototype._getEyeOffset=function(v){if("left"==v)v=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else if("right"==v)v=[.5*this.deviceInfo_.viewer.interLensDistance,
0,0];else return console.error("Invalid eye provided: %s",v),null;return v};fc.prototype.getEyeParameters=function(v){var z=this._getEyeOffset(v),B=this._getFieldOfView(v);v={offset:z,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};Object.defineProperty(v,"fieldOfView",{enumerable:!0,get:function(){da("VRFieldOfView","VRFrameData's projection matrices");return B}});return v};fc.prototype.onDeviceParamsUpdated_=function(v){this.config.DEBUG&&
console.log("DPDB reported that device params were updated.");this.deviceInfo_.updateDeviceParams(v);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)};fc.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)};fc.prototype.beginPresent_=function(){var v=this.layer_.source.getContext("webgl");v||(v=this.layer_.source.getContext("experimental-webgl"));
v||(v=this.layer_.source.getContext("webgl2"));v&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(v.canvas.width=Lb()*this.bufferScale_,v.canvas.height=cc()*this.bufferScale_,this.cardboardUI_=new ic(v)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new ic(v)),this.distorter_=new wb(v,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(z){this.viewerSelector_.show(this.layer_.source.parentElement);
z.stopPropagation();z.preventDefault()}.bind(this),function(z){this.exitPresent();z.stopPropagation();z.preventDefault()}.bind(this)),this.rotateInstructions_&&($b()&&db()?this.rotateInstructions_.showTemporarily(3E3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",
this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())};fc.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null);this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null);this.rotateInstructions_&&this.rotateInstructions_.hide();this.viewerSelector_.hide();window.removeEventListener("orientationchange",this.orientationHandler);window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)};fc.prototype.updatePresent_=
function(){this.endPresent_();this.beginPresent_()};fc.prototype.submitFrame=function(){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var v=this.layer_.source.getContext("webgl");v||(v=this.layer_.source.getContext("experimental-webgl"));v||(v=this.layer_.source.getContext("webgl2"));v=v.canvas;if(v.width!=this.lastWidth||v.height!=this.lastHeight)this.cardboardUI_.onResize();this.lastWidth=v.width;this.lastHeight=v.height;this.cardboardUI_.render()}};
fc.prototype.onOrientationChange_=function(){this.viewerSelector_.hide();this.rotateInstructions_&&this.rotateInstructions_.update();this.onResize_()};fc.prototype.onResize_=function(){if(this.layer_){var v=this.layer_.source.getContext("webgl");v||(v=this.layer_.source.getContext("experimental-webgl"));v||(v=this.layer_.source.getContext("webgl2"));v.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;");
wa(v.canvas)}};fc.prototype.onViewerChanged_=function(v){this.deviceInfo_.setViewer(v);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_);this.fireVRDisplayDeviceParamsChange_()};fc.prototype.fireVRDisplayDeviceParamsChange_=function(){var v=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(v)};fc.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=
new Float32Array(16);this.rightViewMatrix=new Float32Array(16);this.pose=null};fc.VRDisplay=Pb;return fc})}));m.inherits(p,ca);p.prototype.onBaseLayerSet=function(){throw Error("Not implemented");};p.prototype.isSessionSupported=function(){throw Error("Not implemented");};p.prototype.isFeatureSupported=function(){throw Error("Not implemented");};p.prototype.requestSession=function(){return m.asyncExecutePromiseGeneratorProgram(function(){throw Error("Not implemented");})};p.prototype.requestAnimationFrame=
function(){throw Error("Not implemented");};p.prototype.onFrameStart=function(){throw Error("Not implemented");};p.prototype.onFrameEnd=function(){throw Error("Not implemented");};p.prototype.doesSessionSupportReferenceSpace=function(){throw Error("Not implemented");};p.prototype.requestStageBounds=function(){throw Error("Not implemented");};p.prototype.requestFrameOfReferenceTransform=function(){return m.asyncExecutePromiseGeneratorProgram(function(u){return u.return(void 0)})};p.prototype.cancelAnimationFrame=
function(){throw Error("Not implemented");};p.prototype.endSession=function(){throw Error("Not implemented");};p.prototype.getViewport=function(){throw Error("Not implemented");};p.prototype.getProjectionMatrix=function(){throw Error("Not implemented");};p.prototype.getBasePoseMatrix=function(){throw Error("Not implemented");};p.prototype.getBaseViewMatrix=function(){throw Error("Not implemented");};p.prototype.getInputSources=function(){throw Error("Not implemented");};p.prototype.getInputPose=function(){throw Error("Not implemented");
};p.prototype.onWindowResize=function(){this.onWindowResize()};var Zi={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},Nh={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],
buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},Ll={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},"Gear VR Controller":{mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],
buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":{mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"Oculus Touch (Right)":Zi,"Oculus Touch (Left)":Zi,"OpenVR Gamepad":{mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],
"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},"Spatial Controller (Spatial Interaction Source) 045E-065A":Nh,"Spatial Controller (Spatial Interaction Source) 045E-065D":{mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,
0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},"Windows Mixed Reality (Right)":Nh,"Windows Mixed Reality (Left)":Nh},Si=fa(.155,-.465,-.15),Ml=fa(-.155,-.465,-.15),Nl=fa(0,0,-.25),Ol=fa(0,0,.05),$i=fa(-.08,.14,.08),aj=180/Math.PI;n.prototype.setHandedness=function(u){this.hand!=u&&(this.hand=u,this.headElbowOffset="left"==this.hand?Ml:Si)};n.prototype.update=function(u,y){this.time=xb();u&&(T(this.lastControllerQ,this.controllerQ),T(this.controllerQ,u));
y&&(ia(this.headPos,y),Z(this.headQ,y));u=this.getHeadYawOrientation_();y=this.quatAngle_(this.lastControllerQ,this.controllerQ);.61<y/((this.time-this.lastTime)/1E3)?Va(this.rootQ,this.rootQ,u,Math.min(y/.175,1)):T(this.rootQ,u);u=fa(0,0,-1);Ka(u,u,this.controllerQ);u=qa(u,[0,1,0]);u=this.clamp_((u-.12)/.87,0,1);var E=P(this.rootQ);jb(E,E);Da(E,E,this.controllerQ);y=this.elbowPos;ja(y,this.headPos);ta(y,y,this.headElbowOffset);var F=M($i);X(F,F,u);ta(y,y,F);F=this.quatAngle_(E,Ga())*aj;var da=(1-
Math.pow(F/180,4))*(.4+.24*u);F=Ga();Va(F,F,E,da);da=jb(Ga(),F);E=P(E);Da(E,E,da);da=this.wristPos;ja(da,Ol);Ka(da,da,F);ta(da,da,Nl);Ka(da,da,E);ta(da,da,y);y=M($i);X(y,y,u);ta(this.position,this.wristPos,y);Ka(this.position,this.position,this.rootQ);this.lastTime=this.time};n.prototype.getPosition=function(){return this.position};n.prototype.getHeadYawOrientation_=function(){var u=ma();ua(u,this.headQ,"YXZ");var y=Ga(),E=u[1]*aj;u=.5*Math.PI/180;var F=0*u;E*=u;var da=0*u;u=Math.sin(F);F=Math.cos(F);
var sa=Math.sin(E);E=Math.cos(E);var wa=Math.sin(da);da=Math.cos(da);y[0]=u*E*da-F*sa*wa;y[1]=F*sa*da+u*E*wa;y[2]=F*E*wa-u*sa*da;y[3]=F*E*da+u*sa*wa;return y};n.prototype.clamp_=function(u,y,E){return Math.min(Math.max(u,y),E)};n.prototype.quatAngle_=function(u,y){var E=[0,0,-1],F=[0,0,-1];Ka(E,E,u);Ka(F,F,y);u=fa(E[0],E[1],E[2]);F=fa(F[0],F[1],F[2]);Y(u,u);Y(F,F);F=qa(u,F);F=1<F?0:-1>F?Math.PI:Math.acos(F);return F};var sc=Symbol("@@webxr-polyfill/XRRemappedGamepad"),bj={pressed:!1,touched:!1,value:0};
Object.freeze(bj);l.prototype._update=function(){for(var u=this[sc].gamepad,y=this[sc].map,E=this[sc].axes,F=0;F<E.length;++F)E[F]=y.axes&&F in y.axes?null===y.axes[F]?0:u.axes[y.axes[F]]:u.axes[F];if(y.axes&&y.axes.invert){F=m.makeIterator(y.axes.invert);for(var da=F.next();!da.done;da=F.next())da=da.value,da<E.length&&(E[da]*=-1)}E=this[sc].buttons;for(F=0;F<E.length;++F)E[F]=y.buttons&&F in y.buttons?null===y.buttons[F]?bj:u.buttons[y.buttons[F]]:u.buttons[F]};m.global.Object.defineProperties(l.prototype,
{id:{configurable:!0,enumerable:!0,get:function(){return""}},_profiles:{configurable:!0,enumerable:!0,get:function(){return this[sc].profiles}},index:{configurable:!0,enumerable:!0,get:function(){return-1}},connected:{configurable:!0,enumerable:!0,get:function(){return this[sc].gamepad.connected}},timestamp:{configurable:!0,enumerable:!0,get:function(){return this[sc].gamepad.timestamp}},mapping:{configurable:!0,enumerable:!0,get:function(){return this[sc].mapping}},axes:{configurable:!0,enumerable:!0,
get:function(){return this[sc].axes}},buttons:{configurable:!0,enumerable:!0,get:function(){return this[sc].buttons}},hapticActuators:{configurable:!0,enumerable:!0,get:function(){return this[sc].gamepad.hapticActuators}}});h.prototype.updateFromGamepad=function(u){this.nativeGamepad!==u&&(this.gamepad=(this.nativeGamepad=u)?new l(u,this.display,Ll[u.id]):null);this.handedness=""===u.hand?"none":u.hand;this.gamepad&&this.gamepad._update();u.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=
!u.pose.hasPosition):""===u.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)};h.prototype.updateBasePoseMatrix=function(){if(this.nativeGamepad&&this.nativeGamepad.pose){var u=this.nativeGamepad.pose,y=u.position,E=u.orientation;if(!y&&!E)return;y?(this.lastPosition[0]=y[0],this.lastPosition[1]=y[1],this.lastPosition[2]=y[2]):u.hasPosition?y=this.lastPosition:(this.armModel||(this.armModel=new n),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(E,this.polyfill.getBasePoseMatrix()),
y=this.armModel.getPosition());Q(this.basePoseMatrix,E,y)}else u=this.basePoseMatrix,y=this.polyfill.getBasePoseMatrix(),u[0]=y[0],u[1]=y[1],u[2]=y[2],u[3]=y[3],u[4]=y[4],u[5]=y[5],u[6]=y[6],u[7]=y[7],u[8]=y[8],u[9]=y[9],u[10]=y[10],u[11]=y[11],u[12]=y[12],u[13]=y[13],u[14]=y[14],u[15]=y[15];return this.basePoseMatrix};h.prototype.getXRPose=function(u,y){this.updateBasePoseMatrix();switch(y){case "target-ray":u._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[sc].targetRayTransform&&
L(this.outputMatrix,this.outputMatrix,this.gamepad[sc].targetRayTransform);break;case "grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;u._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[sc].gripTransform&&L(this.outputMatrix,this.outputMatrix,this.gamepad[sc].gripTransform);break;default:return null}u._adjustForOriginOffset(this.outputMatrix);return new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)};m.global.Object.defineProperties(h.prototype,
{profiles:{configurable:!0,enumerable:!0,get:function(){return this.gamepad?this.gamepad._profiles:[]}}});var cj={highRefreshRate:!0},dj={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},ml=0;m.inherits(g,p);g.prototype.onBaseLayerSet=function(u,y){var E=this,F=this.sessions.get(u),da=y.context.canvas;if(F.immersive){u=this.display.getEyeParameters("left");var sa=this.display.getEyeParameters("right");da.width=2*Math.max(u.renderWidth,sa.renderWidth);da.height=Math.max(u.renderHeight,
sa.renderHeight);this.display.requestPresent([{source:da,attributes:cj}]).then(function(){E.global.document.body.contains(da)||(F.modifiedCanvasLayer=!0,E.global.document.body.appendChild(da),da.style.display="block",da.style.position="absolute",da.style.width=da.style.height="1px",da.style.top=da.style.left="0px");F.baseLayer=y})}else F.baseLayer=y};g.prototype.isSessionSupported=function(u){return"immersive-ar"==u||"immersive-vr"==u&&!1===this.canPresent?!1:!0};g.prototype.isFeatureSupported=function(u){switch(u){case "viewer":return!0;
case "local":return!0;case "local-floor":return!0;case "bounded":return!1;case "unbounded":return!1;default:return!1}};g.prototype.requestSession=function(u,y){var E=this,F,da,sa;return m.asyncExecutePromiseGeneratorProgram(function(wa){if(1==wa.nextAddress){if(!E.isSessionSupported(u))return wa.return(Promise.reject());F="immersive-vr"==u;if(!F)return wa.jumpTo(2);da=E.global.document.createElement("canvas");da.getContext("webgl");return wa.yield(E.display.requestPresent([{source:da,attributes:cj}]),
2)}sa=new k(u,y,{renderContextType:E.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});E.sessions.set(sa.id,sa);F&&(E.immersiveSession=sa,E.dispatchEvent("@@webxr-polyfill/vr-present-start",sa.id));return wa.return(Promise.resolve(sa.id))})};g.prototype.requestAnimationFrame=function(u){return this.display.requestAnimationFrame(u)};g.prototype.getPrimaryButtonIndex=function(u){var y=0,E=u.id.toLowerCase(),F;for(F in dj)if(E.includes(F)){y=dj[F];break}return Math.min(y,u.buttons.length-1)};g.prototype.onFrameStart=
function(u,y){this.display.depthNear=y.depthNear;this.display.depthFar=y.depthFar;this.display.getFrameData(this.frame);u=this.sessions.get(u);if(u.immersive&&this.CAN_USE_GAMEPAD){var E=this.gamepadInputSources;this.gamepadInputSources={};for(var F=this.global.navigator.getGamepads(),da=0;da<F.length;++da){var sa=F[da];if(sa&&0<sa.displayId){var wa=E[da];wa||(wa=new h(this,this.display,this.getPrimaryButtonIndex(sa)));wa.updateFromGamepad(sa);this.gamepadInputSources[da]=wa;if(-1!=wa.primaryButtonIndex){var Ma=
sa.buttons[wa.primaryButtonIndex].pressed;Ma&&!wa.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:u.id,inputSource:wa.inputSource}):!Ma&&wa.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:u.id,inputSource:wa.inputSource});wa.primaryActionPressed=Ma}-1!=wa.primarySqueezeButtonIndex&&((sa=sa.buttons[wa.primarySqueezeButtonIndex].pressed)&&!wa.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",
{sessionId:u.id,inputSource:wa.inputSource}):!sa&&wa.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:u.id,inputSource:wa.inputSource}),wa.primarySqueezeActionPressed=sa)}}}!u.immersive&&u.baseLayer&&(u=u.baseLayer.context.canvas,ka(this.frame.leftProjectionMatrix,y.inlineVerticalFieldOfView,u.width/u.height,y.depthNear,y.depthFar))};g.prototype.onFrameEnd=function(u){u=this.sessions.get(u);if(!u.ended&&u.baseLayer){if(u.outputContext&&(!u.immersive||
this.display.capabilities.hasExternalDisplay)){var y=u.baseLayer.context.canvas,E=u.immersive&&this.display.capabilities.hasExternalDisplay?y.width/2:y.width,F=y.height,da=u.outputContext.canvas,sa=da.width;da=da.height;var wa=u.renderContext;this.HAS_BITMAP_SUPPORT?y.transferToImageBitmap?wa.transferFromImageBitmap(y.transferToImageBitmap()):this.global.createImageBitmap(y,0,0,E,F,{resizeWidth:sa,resizeHeight:da}).then(function(Ma){return wa.transferFromImageBitmap(Ma)}):wa.drawImage(y,0,0,E,F,0,
0,sa,da)}u.immersive&&u.baseLayer&&this.display.submitFrame()}};g.prototype.cancelAnimationFrame=function(u){this.display.cancelAnimationFrame(u)};g.prototype.endSession=function(u){var y=this,E;return m.asyncExecutePromiseGeneratorProgram(function(F){E=y.sessions.get(u);if(E.ended)return F.return();if(E.immersive)return F.return(y.display.exitPresent());E.ended=!0;F.jumpToEnd()})};g.prototype.doesSessionSupportReferenceSpace=function(u,y){u=this.sessions.get(u);return u.ended?!1:u.enabledFeatures.has(y)};
g.prototype.requestStageBounds=function(){if(this.display.stageParameters){var u=this.display.stageParameters.sizeX,y=this.display.stageParameters.sizeZ,E=[];E.push(-u/2);E.push(-y/2);E.push(u/2);E.push(-y/2);E.push(u/2);E.push(y/2);E.push(-u/2);E.push(y/2);return E}return null};g.prototype.requestFrameOfReferenceTransform=function(u){var y=this;return m.asyncExecutePromiseGeneratorProgram(function(E){return("local-floor"===u||"bounded-floor"===u)&&y.display.stageParameters&&y.display.stageParameters.sittingToStandingTransform?
E.return(y.display.stageParameters.sittingToStandingTransform):E.return(null)})};g.prototype.getProjectionMatrix=function(u){if("left"===u)return this.frame.leftProjectionMatrix;if("right"===u)return this.frame.rightProjectionMatrix;if("none"===u)return this.frame.leftProjectionMatrix;throw Error("eye must be of type 'left' or 'right'");};g.prototype.getViewport=function(u,y,E,F){u=this.sessions.get(u);var da=E.context.canvas;E=da.width;da=da.height;if(!u.immersive)return F.x=F.y=0,F.width=E,F.height=
da,!0;if("left"===y||"none"===y)F.x=0;else if("right"===y)F.x=E/2;else return!1;F.y=0;F.width=E/2;F.height=da;return!0};g.prototype.getBasePoseMatrix=function(){var u=this.frame.pose,y=u.position;u=u.orientation;if(!y&&!u)return this.baseModelMatrix;y||(y=this.tempVec3,y[0]=y[1]=y[2]=0);Q(this.baseModelMatrix,u,y);return this.baseModelMatrix};g.prototype.getBaseViewMatrix=function(u){if("left"===u||"none"===u)return this.frame.leftViewMatrix;if("right"===u)return this.frame.rightViewMatrix;throw Error("eye must be of type 'left' or 'right'");
};g.prototype.getInputSources=function(){var u=[],y;for(y in this.gamepadInputSources)u.push(this.gamepadInputSources[y].inputSource);return u};g.prototype.getInputPose=function(u,y,E){if(!y)return null;for(var F in this.gamepadInputSources){var da=this.gamepadInputSources[F];if(da.inputSource===u)return da.getXRPose(y,E)}return null};g.prototype.onWindowResize=function(){};g.prototype.onVRDisplayPresentChange=function(){var u=this;this.display.isPresenting||this.sessions.forEach(function(y){if(y.immersive&&
!y.ended){if(y.modifiedCanvasLayer){var E=y.baseLayer.context.canvas;document.body.removeChild(E);E.setAttribute("style","")}u.immersiveSession===y&&(u.immersiveSession=null);u.dispatchEvent("@@webxr-polyfill/vr-present-end",y.id)}})};m.global.Object.defineProperties(g.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this.display.depthNear},set:function(u){this.display.depthNear=u}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this.display.depthFar},set:function(u){this.display.depthFar=
u}}});m.inherits(f,g);var kl=0;m.inherits(d,p);d.prototype.onBaseLayerSet=function(u,y){this.sessions.get(u).baseLayer=y};d.prototype.isSessionSupported=function(u){return"inline"==u};d.prototype.isFeatureSupported=function(u){switch(u){case "viewer":return!0;default:return!1}};d.prototype.requestSession=function(u,y){var E=this,F;return m.asyncExecutePromiseGeneratorProgram(function(da){if(!E.isSessionSupported(u))return da.return(Promise.reject());F=new e(u,y);E.sessions.set(F.id,F);return da.return(Promise.resolve(F.id))})};
d.prototype.requestAnimationFrame=function(u){return window.requestAnimationFrame(u)};d.prototype.cancelAnimationFrame=function(u){window.cancelAnimationFrame(u)};d.prototype.onFrameStart=function(u,y){u=this.sessions.get(u);u.baseLayer&&(u=u.baseLayer.context.canvas,ka(this.projectionMatrix,y.inlineVerticalFieldOfView,u.width/u.height,y.depthNear,y.depthFar))};d.prototype.onFrameEnd=function(){};d.prototype.endSession=function(u){var y=this,E;return m.asyncExecutePromiseGeneratorProgram(function(F){E=
y.sessions.get(u);E.ended=!0;F.jumpToEnd()})};d.prototype.doesSessionSupportReferenceSpace=function(u,y){u=this.sessions.get(u);return u.ended?!1:u.enabledFeatures.has(y)};d.prototype.requestStageBounds=function(){return null};d.prototype.requestFrameOfReferenceTransform=function(){return m.asyncExecutePromiseGeneratorProgram(function(u){return u.return(null)})};d.prototype.getProjectionMatrix=function(){return this.projectionMatrix};d.prototype.getViewport=function(u,y,E,F){this.sessions.get(u);
y=E.context.canvas;u=y.width;y=y.height;F.x=F.y=0;F.width=u;F.height=y;return!0};d.prototype.getBasePoseMatrix=function(){return this.identityMatrix};d.prototype.getBaseViewMatrix=function(){return this.identityMatrix};d.prototype.getInputSources=function(){return[]};d.prototype.getInputPose=function(){return null};d.prototype.onWindowResize=function(){};var jl={global:Na,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},fg=["navigator","HTMLCanvasElement","WebGLRenderingContext"];
a.prototype._injectPolyfill=function(u){if(!fg.every(function(F){return!!u[F]}))throw Error("Global must have the following attributes : "+fg);for(var y=m.makeIterator(Object.keys(Hh)),E=y.next();!E.done;E=y.next())E=E.value,void 0!==u[E]?console.warn(E+" already defined on global."):u[E]=Hh[E];w(u.WebGLRenderingContext)&&(q(u.HTMLCanvasElement),u.OffscreenCanvas&&q(u.OffscreenCanvas),u.WebGL2RenderingContext&&w(u.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));
this.injected=!0;this._patchNavigatorXR()};a.prototype._patchNavigatorXR=function(){var u=b(this.global,this.config);this.xr=new Hh.XRSystem(u);Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})};a.prototype._injectCompatibilityShims=function(u){if(!fg.every(function(E){return!!u[E]}))throw Error("Global must have the following attributes : "+fg);if(u.navigator.xr&&"supportsSession"in u.navigator.xr&&!("isSessionSupported"in u.navigator.xr)){var y=u.navigator.xr.supportsSession;
u.navigator.xr.isSessionSupported=function(E){return y.call(this,E).then(function(){return!0}).catch(function(){return!1})};u.navigator.xr.supportsSession=function(E){console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves.");return y.call(this,E)}}};return a}
"object"===typeof exports&&"undefined"!==typeof module?module.exports=$c():"function"===typeof define&&define.amd?define($c):this.WebXRPolyfill=$c();var ad=function(){function a(w){for(var x=new Uint8Array(w.length),t=0;t<w.length;++t){var A=w.charCodeAt(t);x[t]=96<A?A-97:64<A?A-39:A+4}for(t=A=0;t<w.length;++t)x[A++]=60>x[t]?g[x[t]]:64*(x[t]-60)+x[++t];return x.buffer.slice(0,A)}function b(w,x,t,A,D,H){var G=h.exports.sbrk,K=t+3&-4,W=G(K*A),O=G(D.length),ea=new Uint8Array(h.exports.memory.buffer);ea.set(D,O);w=w(W,t,A,O,D.length);0==w&&H&&H(W,K,A);x.set(ea.subarray(W,W+t*A));G(W-G(0));if(0!=w)throw Error("Malformed buffer data: "+w);}function c(w){var x=
{object:new Worker(w),pending:0,requests:{}};x.object.onmessage=function(t){t=t.data;x.pending-=t.count;x.requests[t.id][t.action](t.value);delete x.requests[t.id]};return x}function d(w,x,t,A,D){for(var H=r[0],G=1;G<r.length;++G)r[G].pending<H.pending&&(H=r[G]);return new Promise(function(K,W){var O=new Uint8Array(t),ea=q++;H.pending+=w;H.requests[ea]={resolve:K,reject:W};H.object.postMessage({id:ea,count:w,size:x,source:O,mode:A,filter:D},[O.buffer])})}function e(w){l.then(function(){var x=w.data;
try{var t=new Uint8Array(x.count*x.size);b(h.exports[x.mode],t,x.count,x.size,x.source,h.exports[x.filter]);self.postMessage({id:x.id,count:x.count,action:"resolve",value:t},[t.buffer])}catch(A){self.postMessage({id:x.id,count:x.count,action:"reject",value:A})}})}var f=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),g=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,
16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!==typeof WebAssembly)return{supported:!1};var k=WebAssembly.validate(f)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;a9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;d8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgAclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;tzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhrcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgDc;Ve0mbavc;abfalaDcu7gPcl4fcsGcitfgsydlhzasydbhHdnaDcsGgDak9pmbavaiaPfcsGcdtfydbaxaDEhsaDThDdndnadcd9hmbabarcetfgPaH87ebaPcdfaz87ebaPclfas87ebxekabarcdtfgPaHBdbaPclfazBdbaPcwfasBdbkaxaDfhxavc;abfalcitfgPasBdbaPazBdlavaicdtfasBdbavc;abfalcefcsGglcitfgPaHBdbaPasBdlaiaDfhialcefhlxdkdndnaDcsSmbamaDfaDc987fcefhmxekaocefhDao8SbbgscFeGhPdndnascu9mmbaDhoxekaocvfhoaPcFbGhPcrhsdninaD8SbbgOcFbGastaPVhPaOcu9kmeaDcefhDascrfgsc8J9hmbxdkkaDcefhokaPce4cbaPceG9R7amfhmkdndnadcd9hmbabarcetfgDaH87ebaDcdfaz87ebaDclfam87ebxekabarcdtfgDaHBdbaDclfazBdbaDcwfamBdbkavc;abfalcitfgDamBdbaDazBdlavaicdtfamBdbavc;abfalcefcsGglcitfgDaHBdbaDamBdlaicefhialcefhlxekdnaDcpe0mbaxcefgOavaiaqaDcsGfRbbgscl49RcsGcdtfydbascz6gPEhDavaias9RcsGcdtfydbaOaPfgzascsGgOEhsaOThOdndnadcd9hmbabarcetfgHax87ebaHcdfaD87ebaHclfas87ebxekabarcdtfgHaxBdbaHclfaDBdbaHcwfasBdbkavaicdtfaxBdbavc;abfalcitfgHaDBdbaHaxBdlavaicefgicsGcdtfaDBdbavc;abfalcefcsGcitfgHasBdbaHaDBdlavaiaPfcsGgicdtfasBdbavc;abfalcdfcsGglcitfgDaxBdbaDasBdlalcefhlaiaOfhiazaOfhxxekaxcbaoRbbgHEgAaDc;:eSgDfhzaHcsGhCaHcl4hXdndnaHcs0mbazcefhOxekazhOavaiaX9RcsGcdtfydbhzkdndnaCmbaOcefhxxekaOhxavaiaH9RcsGcdtfydbhOkdndnaDTmbaocefhDxekaocdfhDao8SbegPcFeGhsdnaPcu9kmbaocofhAascFbGhscrhodninaD8SbbgPcFbGaotasVhsaPcu9kmeaDcefhDaocrfgoc8J9hmbkaAhDxekaDcefhDkasce4cbasceG9R7amfgmhAkdndnaXcsSmbaDhsxekaDcefhsaD8SbbgocFeGhPdnaocu9kmbaDcvfhzaPcFbGhPcrhodninas8SbbgDcFbGaotaPVhPaDcu9kmeascefhsaocrfgoc8J9hmbkazhsxekascefhskaPce4cbaPceG9R7amfgmhzkdndnaCcsSmbashoxekascefhoas8SbbgDcFeGhPdnaDcu9kmbascvfhOaPcFbGhPcrhDdninao8SbbgscFbGaDtaPVhPascu9kmeaocefhoaDcrfgDc8J9hmbkaOhoxekaocefhokaPce4cbaPceG9R7amfgmhOkdndnadcd9hmbabarcetfgDaA87ebaDcdfaz87ebaDclfaO87ebxekabarcdtfgDaABdbaDclfazBdbaDcwfaOBdbkavc;abfalcitfgDazBdbaDaABdlavaicdtfaABdbavc;abfalcefcsGcitfgDaOBdbaDazBdlavaicefgicsGcdtfazBdbavc;abfalcdfcsGcitfgDaABdbaDaOBdlavaiaHcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiarcifgrae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:flevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:wPliuo97eue978Jjjjjbca9Rhiaec98Ghldndnadcl9hmbdnalTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaipxbbbbbbbbbbbbbbbbgqpklbaiabalcdtfgdaeciGglcdtgv;8qbbdnalTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDaqp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkadaiav;8qbbskdnalTmbcbhvabhdinadczfgxaxpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgval6mbkkalae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabalcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbheabhdinadadpbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbadczfhdaeclfgeav6mbkkdnaval9pmbaialciGgecdtgdVcbc;abad9R;8kbaiabavcdtfgvad;8qbbdnaeTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiad;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":
"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:78Yqdbk:qzezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhlaicefhodnadTmbalc;WFbGglcjdalcjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfglcl4cifcd4hxdndndndnalc9WGgmTmbcbhPcehsawcjdfhzaohHinaraH9Rax6midnaraHaxfgo9RcK6mbczhlinalgic9Wfglawcj;cbffhOdndndndndnaHalco4fRbbalci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOaoRblaoRbbgAco4glalciSgCE86bbawcj;cbfaifglcGfaoclfaCfgORbbaAcl4ciGgCaCciSgCE86bbalcVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbalc7faOaCfgORbbaAciGgAaAciSgAE86bbalctfaOaAfgARbbaoRbegOco4gCaCciSgCE86bbalc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbalc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc93faAaCfgARbbaOciGgOaOciSgOE86bbalc94faAaOfgARbbaoRbdgOco4gCaCciSgCE86bbalc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbalc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbalc97faAaCfgARbbaOciGgOaOciSgOE86bbalc98faAaOfgORbbaoRbigoco4gAaAciSgAE86bbalc99faOaAfgORbbaocl4ciGgAaAciSgAE86bbalc9:faOaAfgORbbaocd4ciGgAaAciSgAE86bbalcufaOaAfglRbbaociGgoaociSgoE86bbalaofhoxdkaOaoRbwaoRbbgAcl4glalcsSgCE86bbawcj;cbfaifglcGfaocwfaCfgORbbaAcsGgAaAcsSgAE86bbalcVfaOaAfgORbbaoRbegAcl4gCaCcsSgCE86bbalc7faOaCfgORbbaAcsGgAaAcsSgAE86bbalctfaOaAfgORbbaoRbdgAcl4gCaCcsSgCE86bbalc91faOaCfgORbbaAcsGgAaAcsSgAE86bbalc4faOaAfgORbbaoRbigAcl4gCaCcsSgCE86bbalc93faOaCfgORbbaAcsGgAaAcsSgAE86bbalc94faOaAfgORbbaoRblgAcl4gCaCcsSgCE86bbalc95faOaCfgORbbaAcsGgAaAcsSgAE86bbalc96faOaAfgORbbaoRbvgAcl4gCaCcsSgCE86bbalc97faOaCfgORbbaAcsGgAaAcsSgAE86bbalc98faOaAfgORbbaoRbogAcl4gCaCcsSgCE86bbalc99faOaCfgORbbaAcsGgAaAcsSgAE86bbalc9:faOaAfgORbbaoRbrgocl4gAaAcsSgAE86bbalcufaOaAfglRbbaocsGgoaocsSgoE86bbalaofhoxekaOao8Pbb83bbaOcwfaocwf8Pbb83bbaoczfhokdnaiam9pmbaiczfhlarao9RcL0mekkaiam6miaoTmidnakTmbawaPfRbbhOawcj;cbfhlazhiakhHinaialRbbgAce4cbaAceG9R7aOfgO86bbaiadfhialcefhlaHcufgHmbkkazcefhzaPcefgPad6hsaohHaPad9hmexvkkcbhoasceGmdxikaoaxad2fhPdnakTmbcbhmcehsawcjdfhCinarao9Rax6miaoTmdaoaxfhoawamfRbbhOawcj;cbfhlaChiakhHinaialRbbgAce4cbaAceG9R7aOfgO86bbaiadfhialcefhlaHcufgHmbkaCcefhCamcefgmad6hsamad9hmbkaPhoxikcbhlcehsinarao9Rax6mdaoTmeaoaxfhoalcefglad6hsadal9hmbkaPhoxdkcbhoasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqaombkc9:hoxekcbc99arao9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;xzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhrcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgDc;Ve0mbavc;abfalaDcu7gPcl4fcsGcitfgsydlhzasydbhHdnaDcsGgDak9pmbavaiaPfcsGcdtfydbaxaDEhsaDThDdndnadcd9hmbabarcetfgPaH87ebaPcdfaz87ebaPclfas87ebxekabarcdtfgPaHBdbaPclfazBdbaPcwfasBdbkaxaDfhxavc;abfalcitfgPasBdbaPazBdlavaicdtfasBdbavc;abfalcefcsGglcitfgPaHBdbaPasBdlaiaDfhialcefhlxdkdndnaDcsSmbamaDfaDc987fcefhmxekaocefhDao8SbbgscFeGhPdndnascu9mmbaDhoxekaocvfhoaPcFbGhPcrhsdninaD8SbbgOcFbGastaPVhPaOcu9kmeaDcefhDascrfgsc8J9hmbxdkkaDcefhokaPce4cbaPceG9R7amfhmkdndnadcd9hmbabarcetfgDaH87ebaDcdfaz87ebaDclfam87ebxekabarcdtfgDaHBdbaDclfazBdbaDcwfamBdbkavc;abfalcitfgDamBdbaDazBdlavaicdtfamBdbavc;abfalcefcsGglcitfgDaHBdbaDamBdlaicefhialcefhlxekdnaDcpe0mbaxcefgOavaiaqaDcsGfRbbgscl49RcsGcdtfydbascz6gPEhDavaias9RcsGcdtfydbaOaPfgzascsGgOEhsaOThOdndnadcd9hmbabarcetfgHax87ebaHcdfaD87ebaHclfas87ebxekabarcdtfgHaxBdbaHclfaDBdbaHcwfasBdbkavaicdtfaxBdbavc;abfalcitfgHaDBdbaHaxBdlavaicefgicsGcdtfaDBdbavc;abfalcefcsGcitfgHasBdbaHaDBdlavaiaPfcsGgicdtfasBdbavc;abfalcdfcsGglcitfgDaxBdbaDasBdlalcefhlaiaOfhiazaOfhxxekaxcbaoRbbgHEgAaDc;:eSgDfhzaHcsGhCaHcl4hXdndnaHcs0mbazcefhOxekazhOavaiaX9RcsGcdtfydbhzkdndnaCmbaOcefhxxekaOhxavaiaH9RcsGcdtfydbhOkdndnaDTmbaocefhDxekaocdfhDao8SbegPcFeGhsdnaPcu9kmbaocofhAascFbGhscrhodninaD8SbbgPcFbGaotasVhsaPcu9kmeaDcefhDaocrfgoc8J9hmbkaAhDxekaDcefhDkasce4cbasceG9R7amfgmhAkdndnaXcsSmbaDhsxekaDcefhsaD8SbbgocFeGhPdnaocu9kmbaDcvfhzaPcFbGhPcrhodninas8SbbgDcFbGaotaPVhPaDcu9kmeascefhsaocrfgoc8J9hmbkazhsxekascefhskaPce4cbaPceG9R7amfgmhzkdndnaCcsSmbashoxekascefhoas8SbbgDcFeGhPdnaDcu9kmbascvfhOaPcFbGhPcrhDdninao8SbbgscFbGaDtaPVhPascu9kmeaocefhoaDcrfgDc8J9hmbkaOhoxekaocefhokaPce4cbaPceG9R7amfgmhOkdndnadcd9hmbabarcetfgDaA87ebaDcdfaz87ebaDclfaO87ebxekabarcdtfgDaABdbaDclfazBdbaDcwfaOBdbkavc;abfalcitfgDazBdbaDaABdlavaicdtfaABdbavc;abfalcefcsGcitfgDaOBdbaDazBdlavaicefgicsGcdtfazBdbavc;abfalcdfcsGcitfgDaABdbaDaOBdlavaiaHcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiarcifgrae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:flevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaic8Etc8F91aicd47avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2gdTmbinababydbgecwtcw91:Yaece91cjjj;8ifcjjj98G::NUdbabclfhbadcufgdmbkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaeczfheaiczfhiadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",
h,l=WebAssembly.instantiate(a(k),{}).then(function(w){h=w.instance;h.exports.__wasm_call_ctors()}),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},p={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},r=[],q=0;return{ready:l,supported:!0,useWorkers:function(w){var x="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(k))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+
b.toString()+e.toString();x=new Blob([x],{type:"text/javascript"});x=URL.createObjectURL(x);for(var t=0;t<w;++t)r[t]=c(x);URL.revokeObjectURL(x)},decodeVertexBuffer:function(w,x,t,A,D){b(h.exports.meshopt_decodeVertexBuffer,w,x,t,A,h.exports[n[D]])},decodeIndexBuffer:function(w,x,t,A){b(h.exports.meshopt_decodeIndexBuffer,w,x,t,A)},decodeIndexSequence:function(w,x,t,A){b(h.exports.meshopt_decodeIndexSequence,w,x,t,A)},decodeGltfBuffer:function(w,x,t,A,D,H){b(h.exports[p[D]],w,x,t,A,h.exports[n[H]])},
decodeGltfBufferAsync:function(w,x,t,A,D){return 0<r.length?d(w,x,t,p[A],n[D]):l.then(function(){var H=new Uint8Array(w*x);b(h.exports[p[A]],H,w,x,t,h.exports[n[D]]);return H})}}}();"object"===typeof exports&&"object"===typeof module?module.exports=ad:"function"===typeof define&&define.amd?define([],function(){return ad}):"object"===typeof exports?exports.MeshoptDecoder=ad:("undefined"!==typeof self?self:this).MeshoptDecoder=ad;function bd(a,b,c,d,e,f,g,k){this.id=a;this.name=b;this.parentTexture=c;this.textureCropper=d;this.extractedTexture=this.stdExt=this.rawExt=null;this.uvOffsetScale=new C.Vector4(e,f,g,k);this.isCutout=!1;this.importAutoScale=this.importGpuCompress=!0}
bd.prototype={addLoadedListener:function(a){this.parentTexture.addLoadedListener(a)},extractTexture:function(){console.assert(null!==this.textureCropper);console.assert(null===this.extractedTexture);this.extractedTexture=this.textureCropper.cropTextureToPoTTarget(this.parentTexture,this.uvOffsetScale)},get hasAlpha(){return this.parentTexture.hasAlpha},serialize:function(){return{id:this.id,name:this.name,atlasId:this.parentTexture.id,atlasOffset:[this.uvOffsetScale.x,this.uvOffsetScale.y],atlasScale:[this.uvOffsetScale.z,
this.uvOffsetScale.w],rawExt:this.rawExt,stdExt:this.stdExt,webFormats:[],alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale}}};
function cd(a,b,c,d,e,f,g,k){this.webFormats=this.stdExt=this.rawExt=this.name=this.id=null;this.isCube=!1;this.image=a;this.height=this.width=null;this.mipmaps=[];this.wrapS=void 0!==b?b:Mb.CLAMP_TO_EDGE;this.wrapT=void 0!==c?c:Mb.CLAMP_TO_EDGE;this.magFilter=void 0!==d?d:Mb.LINEAR;this.minFilter=void 0!==e?e:Mb.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==k?k:1;this.isCutout=this.hasAlpha=this.isAnimated=!1;this.encoding=null;this.ycocgmThreshold=0;this.format=void 0!==f?f:Mb.RGBA;this.type=void 0!==
g?g:Mb.UNSIGNED_BYTE;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._textureCropper=this._atlasEntries=null;this._needsUpdate=!1;this.releaseOnLoadedToGpu=!0;this.loaded=!1;this._loadedListeners=[];this.__webglSlot=this.__webglTexture=null;this.importAutoScale=this.importGpuCompress=!0;this.passphrase=null}
cd.prototype={constructor:cd,sleepAnimation:function(){console.assert(!1)},wakeAnimation:function(){console.assert(!1)},get needsUpdate(){return this._needsUpdate},set needsUpdate(a){this._needsUpdate=a},isAtlas:function(){return null!==this._atlasEntries},enableAtlas:function(a){console.assert(!this.isAtlas());this._atlasEntries={};this._textureCropper=a},getAtlasEntry:function(a,b,c,d,e,f){var g=this._atlasEntries[b];if(g)return g;console.assert(!this.loaded);g=new bd(a,b,this,this._textureCropper,
c,d,e,f);return this._atlasEntries[b]=g},forEachAtlasEntry:function(a){for(var b in this._atlasEntries)this._atlasEntries.hasOwnProperty(b)&&a(this._atlasEntries[b])},clone:function(a){void 0===a&&(a=new cd);a.isCube=a.isCube;a.image=this.image;a.mipmaps=this.mipmaps.slice(0);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.isCutout=this.isCutout;a.isAnimated=this.isAnimated;a.hasAlpha=this.hasAlpha;a.format=this.format;a.type=
this.type;a.generateMipmaps=this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;a.unpackAlignment=this.unpackAlignment;a.passphrase=this.passphrase;return a},serialize:function(){var a={id:this.id,name:this.name,stdExt:this.stdExt,webFormats:this.webFormats,alpha:this.hasAlpha,importGpuCompress:this.importGpuCompress,importAutoScale:this.importAutoScale};this.passphrase&&(a.passphrase=this.passphrase);this.rawExt&&(a.rawExt=this.rawExt);this.encoding&&(a.encoding=this.encoding);
return a},dispose:function(){this._loadedListeners=[];this.dispatchEvent({type:"dispose"})},addLoadedListener:function(a){this.loaded?a():this._loadedListeners.push(a)},notifyLoaded:function(){this.loaded=!0;for(var a=this._loadedListeners,b=0;b<a.length;b+=1)a[b]();a.length=0}};C.EventDispatcher.prototype.apply(cd.prototype);function dd(a,b,c,d,e,f,g,k,h,l){cd.call(this,null,f,g,k,h,d,e,l);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}dd.prototype=Object.create(cd.prototype);dd.prototype.constructor=dd;dd.prototype.clone=function(){var a=new dd;cd.prototype.clone.call(this,a);return a};function ed(a,b,c,d,e,f,g,k,h,l){cd.call(this,null,f,g,k,h,d,e,l);this.image={data:a,width:b,height:c}}ed.prototype=Object.create(cd.prototype);ed.prototype.constructor=ed;ed.prototype.clone=function(){var a=new ed;cd.prototype.clone.call(this,a);return a};function fd(a,b,c,d,e,f,g,k,h){var l=this;cd.call(this,a,b,c,d,e,f,g,k,h);this.generateMipmaps=!1;this.isAnimated=!0;this.releaseOnLoadedToGpu=!1;this._isPlaying=!0;this._pauseRequested=this._isSleeping=!1;this._videoSrc=null;this._pausedTime=0;this._interruptible=!0;this._resizedListeners=[];this._handlePaused=function(){l._pauseRequested?l._pauseRequested=!1:l._isSleeping=!0;!l._isPlaying&&l._interruptible&&(l.video.src="")};this._handleEnded=function(){l._isPlaying=!1;l._isSleeping=!1};this._notifyResized=
function(){l.width=l.video.videoWidth;l.height=l.video.videoHeight;for(var n=0;n<l._resizedListeners.length;n+=1)l._resizedListeners[n]()}}fd.prototype=Object.create(cd.prototype);fd.prototype.constructor=fd;fd.prototype._srcAtPausedPosition=function(){return this._videoSrc+"#t="+this._pausedTime};fd.prototype._pauseVideo=function(){this._pausedTime=this.video.currentTime;this.video.pause()};fd.prototype.rewind=function(){this._pausedTime=0;this.video.currentTime=0};
Object.defineProperty(fd.prototype,"video",{get:function(){return this.image},set:function(a){console.assert(void 0===this.image,"Video already attached to texture.");this.image=a;this._videoSrc=a.src;this._isPlaying=!a.paused&&!a.ended;a.addEventListener("pause",this._handlePaused);a.addEventListener("ended",this._handleEnded);a.addEventListener("resize",this._notifyResized);this._isSleeping&&this._isPlaying&&this._pauseVideo()}});
Object.defineProperty(fd.prototype,"muted",{get:function(){return this.video.muted},set:function(a){this.video.muted=a}});Object.defineProperty(fd.prototype,"loop",{get:function(){return this.video.loop},set:function(a){this.video.loop=a}});Object.defineProperty(fd.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying}});
fd.prototype.play=function(){var a=this;if(!this._isPlaying)if(this._isSleeping)this._isPlaying=!0;else{var b=this.video;this._interruptible&&(b.src=this._srcAtPausedPosition());var c=b.play();c?(this._isPlaying=!0,c.catch(function(d){console.log("Can't play video texture: "+d);a._isPlaying=!1})):this._isPlaying=!b.paused&&!b.ended}};fd.prototype.pause=function(){this._isPlaying&&this.video&&(this._isPlaying=!1,this._isSleeping||(this._pauseRequested=!0,this._pauseVideo()))};
fd.prototype.sleepAnimation=function(){this._isSleeping||(this._isPlaying&&this.video&&this._pauseVideo(),this._isSleeping=!0)};fd.prototype.wakeAnimation=function(){this._isSleeping&&(this._isPlaying&&this.video&&(this._interruptible&&(this.video.src=this._srcAtPausedPosition()),this.video.play()),this._isSleeping=!1)};
fd.prototype.dispose=function(){cd.prototype.dispose.call(this);this._isPlaying&&this.pause();var a=this.video;this.image=null;this._videoSrc="";this._isPlaying=!1;a.src="";a.removeEventListener("pause",this._handlePaused);a.removeEventListener("ended",this._handleEnded);a.removeEventListener("resize",this._notifyResized);this._resizedListeners.length=0};fd.prototype.addResizedListener=function(a){this._resizedListeners.push(a)};
fd.prototype.serialize=function(){var a=cd.prototype.serialize.call(this);a.video=!0;return a};Object.defineProperty(fd.prototype,"needsUpdate",{get:function(){return this._needsUpdate||this.isPlaying&&this.video&&!0!==this.video.seeking&&this.video.readyState>=this.video.HAVE_CURRENT_DATA},set:function(a){this._needsUpdate=a}});function gd(a,b,c){this.y=this.x=0;this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:Mb.CLAMP_TO_EDGE;this.wrapT=void 0!==c.wrapT?c.wrapT:Mb.CLAMP_TO_EDGE;this.magFilter=void 0!==c.magFilter?c.magFilter:Mb.LINEAR;this.minFilter=void 0!==c.minFilter?c.minFilter:Mb.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new C.Vector2(0,0);this.repeat=new C.Vector2(1,1);this.format=void 0!==c.format?c.format:Mb.RGBA;this.type=void 0!==c.type?c.type:
Mb.UNSIGNED_BYTE;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=c.generateMipmaps||!1;this.shareDepthFrom=void 0!==c.shareDepthFrom?c.shareDepthFrom:null;this.isCube=!1;this.loaded=!0;this.useDepthTexture=void 0!==c.useDepthTexture?c.useDepthTexture:!1;this.__webglSlot=this.__webglTexture=this.__webglRenderbuffer=this.__webglFramebuffer=this.depthTexture=null}gd.prototype={constructor:gd,dispose:function(){this.dispatchEvent({type:"dispose"})}};
C.EventDispatcher.prototype.apply(gd.prototype);function hd(a){this.__webglFramebuffer=a;this.height=this.width=this.y=this.x=null;this.isCube=!1}hd.prototype={constructor:hd,dispose:function(){this.__webglFramebuffer=null;this.dispatchEvent({type:"dispose"})}};C.EventDispatcher.prototype.apply(hd.prototype);function id(a,b,c){gd.call(this,a,b,c);this.activeCubeFace=0;this.isCube=!0;this.__webglFramebuffer=[];this.__webglRenderbuffer=[]}id.prototype=Object.create(gd.prototype);id.prototype.constructor=id;var jd={HABLE:1,UNREAL:2,UCHIMURA:3};
function kd(){C.Camera.call(this);var a=this;this._aspect=1;this._defaultFov=S.CAMERA_DEFAULT_FOV;this._orthoFrustumSize=S.CAMERA_ORTHO_FRUSTUM_SIZE;this.perspectiveCamera=new C.PerspectiveCamera(this._defaultFov,this._aspect,S.CAMERA_WALK_NEAR,S.CAMERA_MIN_FAR);this.orthographicCamera=new C.OrthographicCamera(-1,1,1,-1,S.CAMERA_WALK_NEAR,S.CAMERA_MIN_FAR);this.adjustProjectionProperties();this.add(this.perspectiveCamera);this.add(this.orthographicCamera);this.current=S.FORCE_ORTHO?this.orthographicCamera:
this.perspectiveCamera;this._exposure=this._defaultExposure=0;this._gamma=this._defaultGamma=1;this._autoExposure=!1;this._autoExposureDarkness=.3;this._moveMaxSpeed=S.CAMERA_DEFAULT_MOVE_MAX_SPEED;this._autoClimb=this._autoPath=!1;this._toneMapping=this._colorMap=this._fixedHeight=null;this._motionBlurEnabled=S.FORCE_MOTION_BLUR;this._motionBlurIntensity=.5;this._colorMapIntensity=1;this._exposureUpdatedEvent={type:"exposureUpdated",target:null};this._gammaUpdatedEvent={type:"gammaUpdated",target:null};
this._colorMapUpdated={type:"colorMapUpdated",target:null};this._toneMappingUpdated={type:"toneMappingUpdated",target:null};this._motionBlurUpdated={type:"motionBlurUpdated",target:null};var b={type:"updated",target:this};this._updated=function(){return a.dispatchEvent(b)}}m.inherits(kd,C.Camera);
kd.prototype.adjustProjectionProperties=function(){this.perspectiveCamera.aspect=this._aspect;this.orthographicCamera.left=this._orthoFrustumSize*this._aspect/-2;this.orthographicCamera.right=this._orthoFrustumSize*this._aspect/2;this.orthographicCamera.top=this._orthoFrustumSize/2;this.orthographicCamera.bottom=this._orthoFrustumSize/-2};
kd.prototype.updateProjectionMatrix=function(){this.perspectiveCamera.updateProjectionMatrix();this.orthographicCamera.updateProjectionMatrix();this.projectionMatrix=this.current.projectionMatrix;this._updated()};kd.prototype.isPerspective=function(){return this.current===this.perspectiveCamera};kd.prototype.isOrthographic=function(){return this.current===this.orthographicCamera};kd.prototype.colorMapReady=function(){return this._colorMap&&this._colorMap.loaded};
kd.prototype.setGamma=function(a){this.gamma=a};
kd.prototype.serialize=function(){return{fov:this.defaultFov,exposure:this.defaultExposure,gamma:this.defaultGamma,lutTexture:this.colorMap?this.colorMap.serialize():null,lutIntensity:this.colorMapIntensity,toneMapping:this.toneMapping,autoPath:this.autoPath,autoClimb:this.autoClimb,moveMaxSpeed:this.moveMaxSpeed,fixedHeight:this._fixedHeight,motionBlurEnabled:this.motionBlurEnabled||null,motionBlurIntensity:this.motionBlurEnabled?this.motionBlurIntensity:null}};
m.global.Object.defineProperties(kd.prototype,{aspect:{configurable:!0,enumerable:!0,get:function(){return this.perspectiveCamera.aspect},set:function(a){this._aspect=a;this.adjustProjectionProperties();this._updated()}},orthoFrustumSize:{configurable:!0,enumerable:!0,get:function(){return this._orthoFrustumSize},set:function(a){this._orthoFrustumSize=a;this.adjustProjectionProperties();this._updated()}},near:{configurable:!0,enumerable:!0,get:function(){return this.current.near},set:function(a){this.perspectiveCamera.near=
a;this.orthographicCamera.near=a;this.updateProjectionMatrix();this._updated()}},far:{configurable:!0,enumerable:!0,get:function(){return this.current.far},set:function(a){this.perspectiveCamera.far=a;this.orthographicCamera.far=a;this.updateProjectionMatrix();this._updated()}},fov:{configurable:!0,enumerable:!0,get:function(){return this.perspectiveCamera.fov},set:function(a){this.perspectiveCamera.fov=a;this._updated()}},left:{configurable:!0,enumerable:!0,get:function(){return this.current.left}},
right:{configurable:!0,enumerable:!0,get:function(){return this.current.right}},top:{configurable:!0,enumerable:!0,get:function(){return this.current.top}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.current.bottom}},defaultFov:{configurable:!0,enumerable:!0,get:function(){return this._defaultFov},set:function(a){this._defaultFov=a;this.perspectiveCamera.fov=a;this._updated()}},colorMap:{configurable:!0,enumerable:!0,get:function(){return this._colorMap},set:function(a){var b=
this;this._colorMap&&this._colorMap.dispose();(this._colorMap=a)&&!a.loaded&&a.addLoadedListener(function(){return b.dispatchEvent(b._colorMapUpdated)});this.dispatchEvent(this._colorMapUpdated)}},colorMapIntensity:{configurable:!0,enumerable:!0,get:function(){return this._colorMapIntensity},set:function(a){this._colorMapIntensity=a;this.dispatchEvent(this._colorMapUpdated)}},toneMapping:{configurable:!0,enumerable:!0,get:function(){return this._toneMapping},set:function(a){this._toneMapping!==a&&
(this._toneMapping=a,this.dispatchEvent(this._toneMappingUpdated))}},toneMappingModes:{configurable:!0,enumerable:!0,get:function(){return jd}},motionBlurEnabled:{configurable:!0,enumerable:!0,get:function(){return this._motionBlurEnabled},set:function(a){this._motionBlurEnabled!==a&&(this._motionBlurEnabled=a,this.dispatchEvent(this._motionBlurUpdated))}},motionBlurIntensity:{configurable:!0,enumerable:!0,get:function(){return this._motionBlurIntensity},set:function(a){this._motionBlurIntensity!==
a&&(this._motionBlurIntensity=a,this.dispatchEvent(this._motionBlurUpdated))}},defaultExposure:{configurable:!0,enumerable:!0,get:function(){return this._defaultExposure},set:function(a){this._defaultExposure=a;this._updated()}},exposure:{configurable:!0,enumerable:!0,get:function(){return this._exposure},set:function(a){this._exposure!==a&&(this._exposure=a,this.dispatchEvent(this._exposureUpdatedEvent))}},defaultGamma:{configurable:!0,enumerable:!0,get:function(){return this._defaultGamma},set:function(a){this._defaultGamma=
a;this._updated()}},gamma:{configurable:!0,enumerable:!0,get:function(){return this._gamma},set:function(a){this._gamma!==a&&(this._gamma=a,this.dispatchEvent(this._gammaUpdatedEvent))}},autoExposure:{configurable:!0,enumerable:!0,get:function(){return this._autoExposure},set:function(a){this._autoExposure!==a&&(this._autoExposure=a,this._exposure=this._defaultExposure,this._updated())}},moveMaxSpeed:{configurable:!0,enumerable:!0,get:function(){return this._moveMaxSpeed},set:function(a){this._moveMaxSpeed=
a;this._updated()}},autoPath:{configurable:!0,enumerable:!0,get:function(){return this._autoPath},set:function(a){this._autoPath=a;this._updated()}},autoClimb:{configurable:!0,enumerable:!0,get:function(){return this._autoClimb},set:function(a){this._autoClimb=a;this._updated()}},autoExposureDarkness:{configurable:!0,enumerable:!0,get:function(){return this._autoExposureDarkness},set:function(a){this._autoExposureDarkness=a;this._updated()}},fixedHeight:{configurable:!0,enumerable:!0,get:function(){return this._fixedHeight||
S.CAMERA_FIXED_HEIGHT},set:function(a){this._fixedHeight=a;this._updated()}}});var ld={"aabb_query_fragment.glsl":"//AUTO GENERATED\nvarIn vec3 vPositionW;\nuniform int axis;\nvec4 encodeFloat(in float x) {\nfloat xabs = abs(x);\nfloat r = floor(xabs);\nfloat g = fract(xabs);\nreturn vec4(r / 255.0, g, 0.0, 0.0);\n}\nvoid main() {\nvec3 viewW = cameraPosition - vPositionW;\nif (axis == 0) {\nfragColor = encodeFloat(viewW.x);\n} else if (axis == 1) {\nfragColor = encodeFloat(viewW.y);\n} else if (axis == 2) {\nfragColor = encodeFloat(viewW.z);\n}\n}\n","aabb_query_vertex.glsl":"//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(t0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w, 1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n",
"accumulate_fragment.glsl":"//AUTO GENERATED\nuniform float weight;\nuniform sampler2D inputBuffer;\nvarIn vec2 vUv;\nvoid main() {\nvec3 inputColor = texture2D(inputBuffer, vUv).rgb;\nfragColor = vec4(inputColor, weight);\n}\n","accumulate_vertex.glsl":"//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","alpha_stats_combine_fragment.glsl":"//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec2 mapUvScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvScale - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nvec4 p0 = texture2D(map, uv);\nvec4 p1 = texture2D(map, uv + vec2(0.0, mapUvStep.y));\nvec4 p2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0));\nvec4 p3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y));\nfragColor = vec4((p0.r + p1.r + p2.r + p3.r) / 4.0, (p0.g + p1.g + p2.g + p3.g) / 4.0, 0.0, 1.0);\nreturn;\n}\n",
"alpha_stats_fragment.glsl":"//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec4 mapUvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvOffsetScale.zw + mapUvOffsetScale.xy - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nconst float bias = -1.0;\nfloat a0 = texture2D(map, uv, bias).a;\nfloat a1 = texture2D(map, uv + vec2(0.0, mapUvStep.y), bias).a;\nfloat a2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0), bias).a;\nfloat a3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y), bias).a;\nfloat fully_transparent_count = step(0.0, -a0) + step(0.0, -a1) + step(0.0, -a2) + step(0.0, -a3);\nfloat partialy_transparent_count =\nstep(0.0, -abs(clamp(a0, 0.05, 0.95) - a0)) + step(0.0, -abs(clamp(a1, 0.05, 0.95) - a1)) +\nstep(0.0, -abs(clamp(a2, 0.05, 0.95) - a2)) + step(0.0, -abs(clamp(a3, 0.05, 0.95) - a3));\nfragColor = vec4(step(4.0, partialy_transparent_count), fully_transparent_count / 4.0, 0.0, 1.0);\nreturn;\n}\n",
"alpha_stats_vertex.glsl":"//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","anchor_vertex.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || \\\ndefined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarOut vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvarOut vec3 vPositionV;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarOut vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvarOut vec3 vPositionW;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || \\\ndefined(USE_METALLIC_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvec3 normal = sphericalDecode(sphericalNormal);\nvec3 normalW = mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz) * normal;\nnormalW = normalize(normalW);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || \\\ndefined(USE_METALLIC_TEXTURE)\nvec3 anchorCenterW = vec3(modelMatrix[3].xyz);\nvec3 cameraUpW = vec3(modelViewMatrix[0].y, modelViewMatrix[1].y, modelViewMatrix[2].y);\nvec3 forwardW = normalize(anchorCenterW - cameraPosition);\nvec3 rightW = cross(forwardW, cameraUpW);\nrightW.z = 0.0;\nrightW = normalize(rightW);\nvec3 upW = cross(rightW, forwardW);\nvUv = vec2(dot(normalW, rightW) * 0.5 + 0.5, dot(normalW, upW) * 0.5 + 0.5);\n#endif\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvPositionV = -mvPosition.xyz;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvPositionW = positionW;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = normalW;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n",
"copy_opaque_fragment.glsl":"//AUTO GENERATED\nuniform sampler2D tDiffuse;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = vec4(texture2D(tDiffuse, vUv).rgb, 1.0);\n}\n","copy_opaque_vertex.glsl":"//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","crop_texture_fragment.glsl":"//AUTO GENERATED\nuniform sampler2D srcTexture;\nuniform vec4 uvOffsetScale;\nvarIn vec2 vUv;\nvoid main() {\nfragColor = texture2D(srcTexture, uvOffsetScale.xy + vUv * uvOffsetScale.zw);\n}\n",
"crop_texture_vertex.glsl":"//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","cubemap_filter_fragment.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) {  // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\nfloat distributionGGX(vec3 N, vec3 H, float roughness) {\nconst float PI = 3.14159265359;\nfloat a = roughness * roughness;\nfloat a2 = a * a;\nfloat NdotH = max(dot(N, H), 0.0);\nfloat NdotH2 = NdotH * NdotH;\nfloat nom = a2;\nfloat denom = (NdotH2 * (a2 - 1.0) + 1.0);\ndenom = PI * denom * denom;\nreturn nom / denom;\n}\nfloat radicalInverseVDC(int n) {\nfloat base = 2.0;\nfloat invBase = 1.0 / base;\nfloat result = 0.0;\nfloat denom;\nfor (int i = 0; i < 32; i++) {\nif (n > 0) {\ndenom = mod(float(n), base);\nresult += denom * invBase;\ninvBase = invBase / base;\nn = int(float(n) / base);\n}\n}\nreturn result;\n}\nvec2 hammersley(int i, int N) {\nreturn vec2(float(i) / float(N), radicalInverseVDC(i));\n}\nvec3 importanceSampleGGX(vec2 Xi, vec3 N, float roughness) {\nfloat a = roughness * roughness;\nfloat phi = 2.0 * PI * Xi.x;\nfloat cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a * a - 1.0) * Xi.y));\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 H;\nH.x = cos(phi) * sinTheta;\nH.y = sin(phi) * sinTheta;\nH.z = cosTheta;\nvec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\nvec3 tangent = normalize(cross(up, N));\nvec3 bitangent = cross(N, tangent);\nvec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\nreturn normalize(sampleVec);\n}\nvec4 cubic(in float v) {\nvec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\nvec4 s = n * n * n;\nfloat x = s.x;\nfloat y = s.y - 4.0 * s.x;\nfloat z = s.z - 4.0 * s.y + 6.0 * s.x;\nfloat w = 6.0 - x - y - z;\nreturn vec4(x, y, z, w) * (1.0 / 6.0);\n}\nvec3 hdrDecodeRgbm(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nfloat m = 1.0 - rgbm.a;\nvec3 r = rgbm.rgb * (rgbmScale * m);\nreturn r * r;\n}\nvec3 hdrDecodeYcocgm(in vec4 ycocgm, in vec2 threshold) {\nconst float ycocgmLumaRange = 16.0;\nfloat m = ycocgm.w * (16.0 * 255.0 / 256.0) - 1.0;\nfloat chroma_scale_factor = fract(m);\nfloat y_factor = m - chroma_scale_factor;\nchroma_scale_factor = 1.0 - chroma_scale_factor;\nfloat factor = y_factor == ycocgmLumaRange - 2.0 ? 0.0 : 1.0;\nfloat y = mix(ycocgm.x * threshold.x, (y_factor + ycocgm.x) * threshold.y + threshold.x, factor);\nfloat co = (ycocgm.y - 0.5) * chroma_scale_factor;\nfloat cg = (ycocgm.z - 0.5) * chroma_scale_factor;\nreturn vec3(y, co, cg);\n}\nvec3 ycocgToRgb(in vec3 ycocg) {\nfloat y = ycocg.x, co = ycocg.y, cg = ycocg.z;\ny = y * y;\nfloat r = saturate(y + co - cg);\nfloat g = saturate(y + cg);\nfloat b = saturate(y - co - cg);\nreturn vec3(r, g, b) * 8.0;\n}\n/*vec3 hdrDecodeYcocgmBicubic(in sampler2D ycocgmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 threshold, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x), ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = (c + vec4 (xcubic.yw, ycubic.yw) / s) * invTexSize.xxyy;\nvec3 sample0 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xz), threshold);\nvec3 sample1 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yz), threshold);\nvec3 sample2 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xw), threshold);\nvec3 sample3 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yw), threshold);\nfloat sx = s.x / (s.x + s.y), sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}*/\nvec3 hdrDecodeYcocgmBilinear(in sampler2D ycocgmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 threshold, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +0.5).xyxy;\nvec4 offset = c + vec4(1.0);\nfloat sx = 1.0 - fxy.x;\nfloat sy = 1.0 - fxy.y;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xz), threshold);\nvec3 sample1 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yz), threshold);\nvec3 sample2 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xw), threshold);\nvec3 sample3 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yw), threshold);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n/*vec3 hdrDecodeRgbmBicubic(in sampler2D rgbmSampler, in vec2 texSize,\nin vec2 invTexSize, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x), ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = (c + vec4 (xcubic.yw, ycubic.yw) / s) * invTexSize.xxyy;\nvec3 sample0 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xz));\nvec3 sample1 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yz));\nvec3 sample2 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xw));\nvec3 sample3 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yw));\nfloat sx = s.x / (s.x + s.y), sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}*/\nvec3 hdrDecodeRgbmBilinear(in sampler2D rgbmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +0.5).xyxy;\nvec4 offset = c + vec4(1.0);\nfloat sx = 1.0 - fxy.x;\nfloat sy = 1.0 - fxy.y;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xz));\nvec3 sample1 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yz));\nvec3 sample2 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xw));\nvec3 sample3 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yw));\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nuniform samplerCube envMap;\nuniform samplerCube envMapFiltered;\nuniform float mipSize;\nuniform float face;\nuniform float gloss;\nuniform float roughness;\nuniform float topMipResolution;  // topMipResolution of source cubemap (per face)\nvoid main(void) {\nvec2 st = 2.0 * floor(gl_FragCoord.xy) / (mipSize - 1.0) - 1.0;\nvec3 vec;\nif (face == 0.0) {\nvec = vec3(1, -st.y, -st.x);\n} else if (face == 1.0) {\nvec = vec3(-1, -st.y, st.x);\n} else if (face == 2.0) {\nvec = vec3(st.x, 1, st.y);\n} else if (face == 3.0) {\nvec = vec3(st.x, -1, -st.y);\n} else if (face == 4.0) {\nvec = vec3(st.x, -st.y, 1);\n} else {\nvec = vec3(-st.x, -st.y, -1);\n}\nmat3 vecSpace = matrixFromVector(normalize(vec));\nvec3 color = vec3(0.0);\n#ifdef USE_PBR\nconst int samples = 1024;\nfloat totalWeight = 0.0;\nvec3 N = normalize(vec);\nvec3 R = N;\nvec3 V = R;\nfor (int i = 0; i < samples; i++) {\nvec2 xi = hammersley(i, samples);\nvec3 H = importanceSampleGGX(xi, N, roughness);\nvec3 L = normalize(2.0 * dot(V, H) * H - V);\nfloat NdotL = max(dot(N, L), 0.0);\nif (NdotL > 0.0) {\n#ifdef HAVE_TEXTURE_LOD\nfloat D = distributionGGX(N, H, roughness);\nfloat NdotH = max(dot(N, H), 0.0);\nfloat HdotV = max(dot(H, V), 0.0);\nfloat pdf = D * NdotH / (4.0 * HdotV) + 0.0001;\nfloat saTexel = 4.0 * PI / (6.0 * topMipResolution * topMipResolution);\nfloat saSample = 1.0 / (float(samples) * pdf + 0.0001);\nfloat mipLevel = roughness == 0.0 ? 0.0 : 0.5 * log2(saSample / saTexel);\ncolor += hdrDecodeRgbm(textureCubeLodEXT(envMapFiltered, L, mipLevel)) * NdotL;\n#else\ncolor += hdrDecodeRgbm(textureCube(envMap, L)) * NdotL;\n#endif\ntotalWeight += NdotL;\n}\n}\ncolor /= totalWeight;\n#else\nconst int samples = 200;\nvec3 vect;\nfor (int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nvect = hemisphereSample_cos(vec2(float(i) / float(samples), rand), vecSpace, vec, gloss);\ncolor += hdrDecodeRgbm(textureCube(envMap, vect));\n}\ncolor /= float(samples);\n#endif\nfragColor = hdrEncode(color);\n}\n",
"cubemap_filter_vertex.glsl":"//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","cube_to_equirect_fragment.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform samplerCube panoramaCube;\nvarIn vec2 vUv;\nvoid main() {\nvec2 uv = vUv;\nfloat longitude = uv.x * 2. * PI;\nfloat latitude = uv.y * PI;\nvec3 dir = vec3(sin(longitude) * sin(latitude), cos(longitude) * sin(latitude), cos(latitude));\nfragColor = textureCube(panoramaCube, normalize(dir));\n}\n",
"cube_to_equirect_vertex.glsl":"//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = vec2(uv.x, uv.y - 1.0);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","editor_light_fragment.glsl":"//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) - E / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l, in float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\nuniform vec3 color;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vNormal;\nvarIn vec3 vViewPosition;\nvoid main() {\nvec3 lVector = normalize(vViewPosition.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormal), lVector), 0.0);\nvec3 lightColor = color * pointDiffuse;\nlightColor = mix(lightColor, highlight, highlightMix);\nfragColor = vec4(min(linearToGamma(lightColor), 1.0), 1.0);\n}\n",
"editor_light_vertex.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvarOut vec3 vNormal;\nvarOut vec3 vViewPosition;\nvoid main() {\nvec3 normal = sphericalDecode(sphericalNormal);\nvNormal = normalize(normalMatrix * normal);\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvViewPosition = -mvPosition.xyz;\ngl_Position = projectionMatrix * mvPosition;\n}\n",
"equirect_sky_fragment.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) - E / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l, in float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\nvec4 cubic(in float v) {\nvec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\nvec4 s = n * n * n;\nfloat x = s.x;\nfloat y = s.y - 4.0 * s.x;\nfloat z = s.z - 4.0 * s.y + 6.0 * s.x;\nfloat w = 6.0 - x - y - z;\nreturn vec4(x, y, z, w) * (1.0 / 6.0);\n}\nvec3 hdrDecodeRgbm(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nfloat m = 1.0 - rgbm.a;\nvec3 r = rgbm.rgb * (rgbmScale * m);\nreturn r * r;\n}\nvec3 hdrDecodeYcocgm(in vec4 ycocgm, in vec2 threshold) {\nconst float ycocgmLumaRange = 16.0;\nfloat m = ycocgm.w * (16.0 * 255.0 / 256.0) - 1.0;\nfloat chroma_scale_factor = fract(m);\nfloat y_factor = m - chroma_scale_factor;\nchroma_scale_factor = 1.0 - chroma_scale_factor;\nfloat factor = y_factor == ycocgmLumaRange - 2.0 ? 0.0 : 1.0;\nfloat y = mix(ycocgm.x * threshold.x, (y_factor + ycocgm.x) * threshold.y + threshold.x, factor);\nfloat co = (ycocgm.y - 0.5) * chroma_scale_factor;\nfloat cg = (ycocgm.z - 0.5) * chroma_scale_factor;\nreturn vec3(y, co, cg);\n}\nvec3 ycocgToRgb(in vec3 ycocg) {\nfloat y = ycocg.x, co = ycocg.y, cg = ycocg.z;\ny = y * y;\nfloat r = saturate(y + co - cg);\nfloat g = saturate(y + cg);\nfloat b = saturate(y - co - cg);\nreturn vec3(r, g, b) * 8.0;\n}\n/*vec3 hdrDecodeYcocgmBicubic(in sampler2D ycocgmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 threshold, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x), ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = (c + vec4 (xcubic.yw, ycubic.yw) / s) * invTexSize.xxyy;\nvec3 sample0 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xz), threshold);\nvec3 sample1 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yz), threshold);\nvec3 sample2 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xw), threshold);\nvec3 sample3 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yw), threshold);\nfloat sx = s.x / (s.x + s.y), sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}*/\nvec3 hdrDecodeYcocgmBilinear(in sampler2D ycocgmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 threshold, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +0.5).xyxy;\nvec4 offset = c + vec4(1.0);\nfloat sx = 1.0 - fxy.x;\nfloat sy = 1.0 - fxy.y;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xz), threshold);\nvec3 sample1 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yz), threshold);\nvec3 sample2 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xw), threshold);\nvec3 sample3 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yw), threshold);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n/*vec3 hdrDecodeRgbmBicubic(in sampler2D rgbmSampler, in vec2 texSize,\nin vec2 invTexSize, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x), ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = (c + vec4 (xcubic.yw, ycubic.yw) / s) * invTexSize.xxyy;\nvec3 sample0 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xz));\nvec3 sample1 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yz));\nvec3 sample2 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xw));\nvec3 sample3 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yw));\nfloat sx = s.x / (s.x + s.y), sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}*/\nvec3 hdrDecodeRgbmBilinear(in sampler2D rgbmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +0.5).xyxy;\nvec4 offset = c + vec4(1.0);\nfloat sx = 1.0 - fxy.x;\nfloat sy = 1.0 - fxy.y;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xz));\nvec3 sample1 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yz));\nvec3 sample2 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xw));\nvec3 sample3 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yw));\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#ifdef USE_FOG\nuniform float distanceDensity;\nuniform float distanceStart;\nuniform float heightDensity;\nuniform float heightStart;\nuniform vec3 color;\nconst float LOG2 = 1.442695;\nvec3 addFog(in vec3 colorIn, in float distance, in vec3 positionW) {\nfloat distanceValue = max(0.0, distance - distanceStart);\nfloat distanceFogExp =\n1.0 - exp2(-distanceDensity * distanceDensity * distanceValue * distanceValue * LOG2);\nfloat heightValue = max(0.0, -positionW.z + heightStart);\nfloat heightFogExp =\n1.0 - exp2(-heightDensity * heightDensity * heightValue * heightValue * LOG2);\nfloat fogAmount = min(1.0, distanceFogExp + heightFogExp);\nreturn mix(colorIn, color, fogAmount);\n}\n#endif\nuniform sampler2D map;\nuniform float exposure;\nuniform float cameraGamma;\nvarIn vec2 vUv;\n#ifdef USE_FOG\nvarIn vec3 vPositionW;\nvarIn vec3 vPositionV;\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color, in float intensity) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color, mix(color0, color1, bOffset), intensity);\n}\nuniform sampler2D colorMap;\nuniform float colorMapIntensity;\n#endif\nvoid main() {\n#ifdef USE_RGBM_MAP\nvec4 colorRgbm = texture2D(map, vUv);\nvec3 colorLinear = hdrDecodeRgbm(colorRgbm);\n#else\nvec3 colorLinear = gammaToLinear(texture2D(map, vUv).xyz);\n#endif\n#ifdef USE_FOG\nfloat distance = length(vPositionV);\ncolorLinear = addFog(colorLinear, distance, vPositionW);\n#endif\n#ifdef HDR_OUTPUT\n#ifdef USE_RGBM_MAP\nfragColor = colorRgbm;\n#else\nfragColor = hdrEncode(10.0 * colorLinear);\n#endif\n#else\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\nvec3 colorGamma = linearToGammaToneMapped(colorExposed);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma, colorMapIntensity), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n",
"equirect_sky_vertex.glsl":"//AUTO GENERATED\nvarOut vec2 vUv;\n#ifdef USE_FOG\nvarOut vec3 vPositionW;\nvarOut vec3 vPositionV;\n#endif\nvoid main() {\nvUv = uv;\n#ifdef USE_FOG\nvPositionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvPositionV = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n#endif\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","fxaa_fragment.glsl":"//AUTO GENERATED\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN (1.0 / 128.0)\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#define FXAA_SPAN_MAX 8.0\nvoid main() {\nvec3 rgbNW = texture2D(tDiffuse, (gl_FragCoord.xy + vec2(-1.0, -1.0)) * resolution).xyz;\nvec3 rgbNE = texture2D(tDiffuse, (gl_FragCoord.xy + vec2(1.0, -1.0)) * resolution).xyz;\nvec3 rgbSW = texture2D(tDiffuse, (gl_FragCoord.xy + vec2(-1.0, 1.0)) * resolution).xyz;\nvec3 rgbSE = texture2D(tDiffuse, (gl_FragCoord.xy + vec2(1.0, 1.0)) * resolution).xyz;\nvec4 rgbaM = texture2D(tDiffuse, gl_FragCoord.xy * resolution);\nvec3 rgbM = rgbaM.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM = dot(rgbM, luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce =\nmax((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) *\nresolution;\nvec4 rgbA =\n(1.0 / 2.0) * (texture2D(tDiffuse, gl_FragCoord.xy * resolution + dir * (1.0 / 3.0 - 0.5)) +\ntexture2D(tDiffuse, gl_FragCoord.xy * resolution + dir * (2.0 / 3.0 - 0.5)));\nvec4 rgbB =\nrgbA * (1.0 / 2.0) +\n(1.0 / 4.0) * (texture2D(tDiffuse, gl_FragCoord.xy * resolution + dir * (0.0 / 3.0 - 0.5)) +\ntexture2D(tDiffuse, gl_FragCoord.xy * resolution + dir * (3.0 / 3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ((lumaB < lumaMin) || (lumaB > lumaMax)) {\nfragColor = rgbA;\n} else {\nfragColor = rgbB;\n}\n}\n",
"fxaa_vertex.glsl":"//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","gaze_pointer_fragment.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nconst float pointRadius = 0.01;\nconst float pointBorder = 0.005;\nconst float timerRadius = 0.04;\nconst float timerBorder = 0.02;\nconst vec3 timerColor = vec3(0.298, 0.619, 0.851);\nvarIn vec2 coords;\nuniform float circleSpan;\nvoid main() {\nfloat dist = sqrt(dot(coords, coords));\nif (dist < pointRadius) {\nfloat a = 1.0 - smoothstep(pointRadius - pointBorder, pointRadius, dist);\nfragColor = vec4(1.0, 1.0, 1.0, a);\n} else if (-atan(coords.x, -coords.y) < circleSpan) {\nfloat a2 = smoothstep(timerRadius - timerBorder, timerRadius, dist) -\nsmoothstep(timerRadius, timerRadius + timerBorder, dist);\nfragColor = vec4(timerColor, a2);\n} else {\ndiscard;\n}\n}\n",
"gaze_pointer_vertex.glsl":"//AUTO GENERATED\nvarOut vec2 coords;\nvoid main() {\ncoords = vec2(position.x, position.y);\nvec4 outPosition = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\noutPosition.z = -0.1;\ngl_Position = outPosition;\n}\n","grass_fragment.glsl":"//AUTO GENERATED\n#ifdef USE_HEIGHT_TEXTURE\nuniform sampler2D heightTexture;\n#endif\nuniform float currentStep;\nuniform float renderSteps;\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity, inout float opacity) {\nreturn baseColor * totalIntensity;\n}\nfloat easeOutCubic(in float x) {\nreturn 1.0 - pow(1.0 - x, 3.0);\n}\nvec3 getBaseColorHook(out float alpha) {\nfloat alphaDiscard = 0.5;\n#ifdef USE_HEIGHT_TEXTURE\nfloat heightAmount = texture2D(heightTexture, vUv).r;\nalpha = currentStep > 0.0 ? easeOutCubic(heightAmount) : 1.0;\nalphaDiscard = (1.0 / renderSteps) * currentStep;\nif (alpha < alphaDiscard) {\ndiscard;\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nvec2 uv = vUv;\n#ifdef USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT\nvec2 uvScaled = uv * baseColorAtlasUvMod.zw;\nvec2 dfdx = dFdx(uvScaled);\nvec2 dfdy = dFdy(uvScaled);\nuv = fract(uv) * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\nvec4 baseColorGamma = texture2DGradEXT(baseColorTexture, uv, dfdx, dfdy);\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, uv);\n#endif\nvec3 baseColor = applyColorCorrection(gammaToLinear(baseColorGamma.rgb), baseColorCorrection);\n#endif\nfloat offset = min(0.35, 0.35 * (renderSteps - 1.0));\nfloat baseColorMultiplier = mix(1.0 - offset, 1.0 + offset, alphaDiscard);\nreturn baseColor * baseColorMultiplier;\n}\n",
"grass_vertex.glsl":"//AUTO GENERATED\nuniform float grassOffsetScaled;\nuniform float grassDirectionality;\nvoid modifyMvPositionHook(inout vec4 mvPosition, in vec3 normal) {\nvec3 vector = mix(vec3(0, 1, 0), normalize(normalMatrix * normal), grassDirectionality);\nmvPosition.xyz += vector * grassOffsetScaled;\n}\n","luma_fragment.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec4 cubic(in float v) {\nvec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\nvec4 s = n * n * n;\nfloat x = s.x;\nfloat y = s.y - 4.0 * s.x;\nfloat z = s.z - 4.0 * s.y + 6.0 * s.x;\nfloat w = 6.0 - x - y - z;\nreturn vec4(x, y, z, w) * (1.0 / 6.0);\n}\nvec3 hdrDecodeRgbm(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nfloat m = 1.0 - rgbm.a;\nvec3 r = rgbm.rgb * (rgbmScale * m);\nreturn r * r;\n}\nvec3 hdrDecodeYcocgm(in vec4 ycocgm, in vec2 threshold) {\nconst float ycocgmLumaRange = 16.0;\nfloat m = ycocgm.w * (16.0 * 255.0 / 256.0) - 1.0;\nfloat chroma_scale_factor = fract(m);\nfloat y_factor = m - chroma_scale_factor;\nchroma_scale_factor = 1.0 - chroma_scale_factor;\nfloat factor = y_factor == ycocgmLumaRange - 2.0 ? 0.0 : 1.0;\nfloat y = mix(ycocgm.x * threshold.x, (y_factor + ycocgm.x) * threshold.y + threshold.x, factor);\nfloat co = (ycocgm.y - 0.5) * chroma_scale_factor;\nfloat cg = (ycocgm.z - 0.5) * chroma_scale_factor;\nreturn vec3(y, co, cg);\n}\nvec3 ycocgToRgb(in vec3 ycocg) {\nfloat y = ycocg.x, co = ycocg.y, cg = ycocg.z;\ny = y * y;\nfloat r = saturate(y + co - cg);\nfloat g = saturate(y + cg);\nfloat b = saturate(y - co - cg);\nreturn vec3(r, g, b) * 8.0;\n}\n/*vec3 hdrDecodeYcocgmBicubic(in sampler2D ycocgmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 threshold, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x), ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = (c + vec4 (xcubic.yw, ycubic.yw) / s) * invTexSize.xxyy;\nvec3 sample0 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xz), threshold);\nvec3 sample1 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yz), threshold);\nvec3 sample2 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xw), threshold);\nvec3 sample3 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yw), threshold);\nfloat sx = s.x / (s.x + s.y), sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}*/\nvec3 hdrDecodeYcocgmBilinear(in sampler2D ycocgmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 threshold, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +0.5).xyxy;\nvec4 offset = c + vec4(1.0);\nfloat sx = 1.0 - fxy.x;\nfloat sy = 1.0 - fxy.y;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xz), threshold);\nvec3 sample1 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yz), threshold);\nvec3 sample2 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xw), threshold);\nvec3 sample3 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yw), threshold);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n/*vec3 hdrDecodeRgbmBicubic(in sampler2D rgbmSampler, in vec2 texSize,\nin vec2 invTexSize, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x), ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = (c + vec4 (xcubic.yw, ycubic.yw) / s) * invTexSize.xxyy;\nvec3 sample0 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xz));\nvec3 sample1 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yz));\nvec3 sample2 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xw));\nvec3 sample3 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yw));\nfloat sx = s.x / (s.x + s.y), sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}*/\nvec3 hdrDecodeRgbmBilinear(in sampler2D rgbmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +0.5).xyxy;\nvec4 offset = c + vec4(1.0);\nfloat sx = 1.0 - fxy.x;\nfloat sy = 1.0 - fxy.y;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xz));\nvec3 sample1 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yz));\nvec3 sample2 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xw));\nvec3 sample3 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yw));\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nuniform vec4 lightMapSize;\nuniform vec2 lightMapThreshold;\nvec3 getLightIntensity() {\nvec2 uv = vec2(vUv2.x, vUv2.y);\n#ifdef LIGHTMAP_YCOCGM\nreturn ycocgToRgb(\nhdrDecodeYcocgmBilinear(lightMap, lightMapSize.xy, lightMapSize.zw, lightMapThreshold, uv));\n#else  // LIGHTMAP_RGBM\nreturn hdrDecodeRgbmBilinear(lightMap, lightMapSize.xy, lightMapSize.zw, uv);\n#endif\n}\n#else  // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\nuniform vec3 color;\nvoid main() {\nvec3 receivedLight = getLightIntensity();\nvec3 diffuseLight = receivedLight * color;\nfloat luma = 0.299 * diffuseLight.r + 0.587 * diffuseLight.g + 0.114 * diffuseLight.b;\nfragColor.r = fract(luma);\nfragColor.g = floor(luma) / 255.0;\n}\n",
"minimap_add_alpha_fragment.glsl":"//AUTO GENERATED\nuniform sampler2D tColor;\n#ifdef USE_ALPHA_FROM_COLOR\nuniform vec3 colorFill;\n#else\nuniform sampler2D tAlpha;\n#endif\nvarIn vec2 vUv;\nvoid main() {\nvec4 color = texture2D(tColor, vUv);\n#ifdef USE_ALPHA_FROM_COLOR\nfloat alphaFromColor = (color.r + color.g + color.b) / 3.0;\nfragColor = vec4(colorFill, alphaFromColor);\n#else\nfloat alpha = vec4(texture2D(tAlpha, vUv)).a;\nfragColor = vec4(color.rgb, alpha);\n#endif\n}\n","minimap_add_alpha_vertex.glsl":"//AUTO GENERATED\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",
"mirror_fragment.glsl":"//AUTO GENERATED\nuniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarIn vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g),\nblendOverlay(mirrorColor.b, color.b), 1.0);\nfragColor = color;\n}\n","mirror_vertex.glsl":"//AUTO GENERATED\nuniform mat4 textureMatrix;\nvarOut vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvec4 worldPosition = modelMatrix * vec4(position, 1.0);\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n",
"motion_blur_fragment.glsl":"//AUTO GENERATED\nuniform sampler2D tDepth;\nuniform sampler2D tDiffuse;\nuniform float velocityFactor;\nuniform float delta;\nuniform vec2 resolution;\nuniform vec3 cameraMove;\nuniform mat4 clipToWorldMatrix;\nuniform mat4 previousWorldToClipMatrix;\nvoid main() {\nvec2 coord = gl_FragCoord.xy * resolution;\nfloat zOverW = texture2D(tDepth, coord).r;\nvec4 H = vec4(coord.x * 2.0 - 1.0, (1.0 - coord.y) * 2.0 - 1.0, zOverW, 1.0);\nvec4 D = H * clipToWorldMatrix;\nvec4 worldPos = D / D.w;\nvec4 currentPos = H;\nvec4 previousPos = worldPos * previousWorldToClipMatrix;\npreviousPos /= previousPos.w;\nvec2 velocity =\nvelocityFactor * clamp((currentPos.xy - previousPos.xy) / 2.0, vec2(-0.01), vec2(0.01));\nvec4 color = texture2D(tDiffuse, coord);\nconst int samples = 20;\nvec2 offset = vec2(0.0);\nfor (int i = 1; i < samples; i++) {\noffset = velocity * (float(i) / (float(samples) - 1.0) - 0.5);\nvec4 currentColor = texture2D(tDiffuse, coord + offset);\ncolor += currentColor;\n}\nvec4 finalColor = color / float(samples);\nfragColor = vec4(finalColor.rgb, 1.0);\n}\n",
"motion_blur_vertex.glsl":"//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","object_distance_vertex.glsl":"//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(t0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w, 1.0);\n}\nvarOut vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n",
"object_id_distance_fragment.glsl":"//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nfloat cameraDistance = min(distance(cameraPosition, vPositionW), 255.0);\nint x = objectId / 256;\nint y = objectId - 256 * x;\nfloat z = floor(cameraDistance);\nfloat a = fract(cameraDistance);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0, z / 255.0, a);\n}\n","object_id_fragment.glsl":"//AUTO GENERATED\nuniform int objectId;\nvarIn vec3 vPositionW;\nvoid main(void) {\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\nfragColor = vec4(float(x) / 255.0, float(y) / 255.0, float(z) / 255.0, 0);\n}\n",
"outline_fragment.glsl":"//AUTO GENERATED\nuniform vec3 color;\nvoid main() {\nfragColor = vec4(color, 1.0);\n}\n","outline_vertex.glsl":"//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(t0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w, 1.0);\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nuniform float thickness;\nvoid main() {\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(t0.x * n.x + t0.y * n.y + t0.z * n.z, t1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\nvec4 transformedPosition = transformPosition();\nfloat distToCamera = cameraPosition.z - transformedPosition.z;\nvec4 movedPosition = vec4(transformedPosition.x - distToCamera * thickness * normal.x,\ntransformedPosition.y - distToCamera * thickness * normal.y,\ntransformedPosition.z, transformedPosition.w);\ngl_Position = projectionMatrix * modelViewMatrix * movedPosition;\n}\n",
"procedural_sky_fragment.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) - E / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l, in float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\n#ifdef USE_FOG\nuniform float distanceDensity;\nuniform float distanceStart;\nuniform float heightDensity;\nuniform float heightStart;\nuniform vec3 color;\nconst float LOG2 = 1.442695;\nvec3 addFog(in vec3 colorIn, in float distance, in vec3 positionW) {\nfloat distanceValue = max(0.0, distance - distanceStart);\nfloat distanceFogExp =\n1.0 - exp2(-distanceDensity * distanceDensity * distanceValue * distanceValue * LOG2);\nfloat heightValue = max(0.0, -positionW.z + heightStart);\nfloat heightFogExp =\n1.0 - exp2(-heightDensity * heightDensity * heightValue * heightValue * LOG2);\nfloat fogAmount = min(1.0, distanceFogExp + heightFogExp);\nreturn mix(colorIn, color, fogAmount);\n}\n#endif\nuniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float sinBottomAngle;\nuniform float exponent;\nuniform float exposure;\nuniform float cameraGamma;\nvarIn vec3 vWorldDirection;\n#ifdef USE_FOG\nvarIn vec3 vPositionW;\nvarIn vec3 vPositionV;\n#endif\n#ifdef HDR_OUTPUT\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color, in float intensity) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color, mix(color0, color1, bOffset), intensity);\n}\nuniform sampler2D colorMap;\nuniform float colorMapIntensity;\n#endif\nvoid main() {\nfloat sinDirection = normalize(vWorldDirection).z;\nfloat w = max(0.0, (sinDirection - sinBottomAngle) / (1.0 - sinBottomAngle));\nvec3 colorGamma = mix(bottomColor, topColor, pow(w, exponent));\nvec3 colorLinear = gammaToLinear(colorGamma);\n#ifdef USE_FOG\nfloat distance = length(vPositionV);\ncolorLinear = addFog(colorLinear, distance, vPositionW);\n#endif\n#ifdef HDR_OUTPUT\nfragColor = hdrEncode(10.0 * colorLinear);\n#else\n#ifdef USE_FOG\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\ncolorGamma = linearToGammaToneMapped(colorExposed);\n#endif\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, colorGamma, colorMapIntensity), 1.0);\n#else\nfragColor = vec4(colorGamma, 1.0);\n#endif\n#endif\n}\n",
"procedural_sky_vertex.glsl":"//AUTO GENERATED\n#ifdef USE_FOG\nvarOut vec3 vPositionW;\nvarOut vec3 vPositionV;\n#endif\nvarOut vec3 vWorldDirection;\nvoid main() {\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvWorldDirection = positionW - cameraPosition;\n#ifdef USE_FOG\nvPositionW = positionW;\nvPositionV = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n#endif\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n","rotate_gizmo_material_fragment.glsl":"//AUTO GENERATED\nuniform vec3 color;\nuniform float opacity;\nuniform vec3 gizmoPosition;\nuniform float sphereRadius;\nvarIn vec4 mPosition;\nvoid discardIfRayIntersectsSphere(vec3 r0, vec3 rd, vec3 s0, float sr) {\nfloat a = dot(rd, rd);\nvec3 s0_r0 = r0 - s0;\nfloat b = 2.0 * dot(rd, s0_r0);\nfloat c = dot(s0_r0, s0_r0) - (sr * sr);\nfloat delta = b * b - 4.0 * a * c;\nif (delta >= 0.0 && -b - sqrt(delta) > 0.0) {\ndiscard;\n}\n}\nvoid main() {\nvec4 outColor;\noutColor.rgb = color;\noutColor.a = opacity;\nvec3 toCamera = normalize(cameraPosition - gizmoPosition);\ndiscardIfRayIntersectsSphere(mPosition.xyz, toCamera, gizmoPosition, sphereRadius);\nfragColor = outColor;\n}\n",
"rotate_gizmo_material_vertex.glsl":"//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(t0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w, 1.0);\n}\nvarOut vec4 mPosition;\nvoid main() {\nvec4 p = vec4(position, 1.0);\nmPosition = modelMatrix * p;\nvec4 mvPosition = modelViewMatrix * p;\ngl_Position = projectionMatrix * mvPosition;\n}\n","sprite_vertex.glsl":"//AUTO GENERATED\nuniform vec3 offset;\n#ifdef USE_FOG\nvarOut vec3 vPositionW;\nvarOut vec3 vPositionV;\n#endif\nvarOut vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = modelViewMatrix * vec4(offset, 1.0);\nvec2 scale;\n#ifdef USE_FOG\nvPositionW = (modelMatrix * vec4(offset, 1.0)).xyz;\nvPositionV = -mvPosition.xyz;\n#endif\nscale.x = length(modelMatrix[0].xyz);\nscale.y = length(modelMatrix[1].xyz);\nvec2 alignedPosition = position.xy * scale;\nmvPosition.xy += alignedPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n",
"standard_material_fragment.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) - E / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l, in float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\nvec4 cubic(in float v) {\nvec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\nvec4 s = n * n * n;\nfloat x = s.x;\nfloat y = s.y - 4.0 * s.x;\nfloat z = s.z - 4.0 * s.y + 6.0 * s.x;\nfloat w = 6.0 - x - y - z;\nreturn vec4(x, y, z, w) * (1.0 / 6.0);\n}\nvec3 hdrDecodeRgbm(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nfloat m = 1.0 - rgbm.a;\nvec3 r = rgbm.rgb * (rgbmScale * m);\nreturn r * r;\n}\nvec3 hdrDecodeYcocgm(in vec4 ycocgm, in vec2 threshold) {\nconst float ycocgmLumaRange = 16.0;\nfloat m = ycocgm.w * (16.0 * 255.0 / 256.0) - 1.0;\nfloat chroma_scale_factor = fract(m);\nfloat y_factor = m - chroma_scale_factor;\nchroma_scale_factor = 1.0 - chroma_scale_factor;\nfloat factor = y_factor == ycocgmLumaRange - 2.0 ? 0.0 : 1.0;\nfloat y = mix(ycocgm.x * threshold.x, (y_factor + ycocgm.x) * threshold.y + threshold.x, factor);\nfloat co = (ycocgm.y - 0.5) * chroma_scale_factor;\nfloat cg = (ycocgm.z - 0.5) * chroma_scale_factor;\nreturn vec3(y, co, cg);\n}\nvec3 ycocgToRgb(in vec3 ycocg) {\nfloat y = ycocg.x, co = ycocg.y, cg = ycocg.z;\ny = y * y;\nfloat r = saturate(y + co - cg);\nfloat g = saturate(y + cg);\nfloat b = saturate(y - co - cg);\nreturn vec3(r, g, b) * 8.0;\n}\n/*vec3 hdrDecodeYcocgmBicubic(in sampler2D ycocgmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 threshold, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x), ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = (c + vec4 (xcubic.yw, ycubic.yw) / s) * invTexSize.xxyy;\nvec3 sample0 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xz), threshold);\nvec3 sample1 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yz), threshold);\nvec3 sample2 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xw), threshold);\nvec3 sample3 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yw), threshold);\nfloat sx = s.x / (s.x + s.y), sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}*/\nvec3 hdrDecodeYcocgmBilinear(in sampler2D ycocgmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 threshold, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +0.5).xyxy;\nvec4 offset = c + vec4(1.0);\nfloat sx = 1.0 - fxy.x;\nfloat sy = 1.0 - fxy.y;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xz), threshold);\nvec3 sample1 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yz), threshold);\nvec3 sample2 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.xw), threshold);\nvec3 sample3 = hdrDecodeYcocgm(texture2D(ycocgmSampler, offset.yw), threshold);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n/*vec3 hdrDecodeRgbmBicubic(in sampler2D rgbmSampler, in vec2 texSize,\nin vec2 invTexSize, in vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 xcubic = cubic(fxy.x), ycubic = cubic(fxy.y);\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +1.5).xyxy;\nvec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\nvec4 offset = (c + vec4 (xcubic.yw, ycubic.yw) / s) * invTexSize.xxyy;\nvec3 sample0 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xz));\nvec3 sample1 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yz));\nvec3 sample2 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xw));\nvec3 sample3 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yw));\nfloat sx = s.x / (s.x + s.y), sy = s.z / (s.z + s.w);\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}*/\nvec3 hdrDecodeRgbmBilinear(in sampler2D rgbmSampler, in vec2 texSize, in vec2 invTexSize,\nin vec2 texCoords) {\nvec2 texCoordsScaled = texCoords * texSize - 0.5;\nvec2 fxy = fract(texCoordsScaled);\ntexCoordsScaled -= fxy;\nvec4 c = texCoordsScaled.xxyy + vec2(-0.5, +0.5).xyxy;\nvec4 offset = c + vec4(1.0);\nfloat sx = 1.0 - fxy.x;\nfloat sy = 1.0 - fxy.y;\noffset *= invTexSize.xxyy;\nvec3 sample0 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xz));\nvec3 sample1 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yz));\nvec3 sample2 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.xw));\nvec3 sample3 = hdrDecodeRgbm(texture2D(rgbmSampler, offset.yw));\nreturn mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx), sy);\n}\n#ifdef USE_FOG\nuniform float distanceDensity;\nuniform float distanceStart;\nuniform float heightDensity;\nuniform float heightStart;\nuniform vec3 color;\nconst float LOG2 = 1.442695;\nvec3 addFog(in vec3 colorIn, in float distance, in vec3 positionW) {\nfloat distanceValue = max(0.0, distance - distanceStart);\nfloat distanceFogExp =\n1.0 - exp2(-distanceDensity * distanceDensity * distanceValue * distanceValue * LOG2);\nfloat heightValue = max(0.0, -positionW.z + heightStart);\nfloat heightFogExp =\n1.0 - exp2(-heightDensity * heightDensity * heightValue * heightValue * LOG2);\nfloat fogAmount = min(1.0, distanceFogExp + heightFogExp);\nreturn mix(colorIn, color, fogAmount);\n}\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvarIn vec3 vPositionW;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarIn vec3 vNormalW;\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || \\\ndefined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE) || defined(USE_HEIGHT_TEXTURE)\nvarIn vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvarIn vec3 vPositionV;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarIn vec3 vNormalV;\nuniform float bumpScale;\nuniform sampler2D bumpTexture;\nvec2 dBumpdxy() {\nvec2 texdx = dFdx(vUv);\nvec2 texdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpTexture, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpTexture, vUv + texdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpTexture, vUv + texdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormal(in vec3 surfPos, in vec3 surfNorm) {\nvec2 dBdxy = dBumpdxy();\nvec3 vSigmaX = dFdx(surfPos);\nvec3 vSigmaY = dFdy(surfPos);\nvec3 R1 = cross(vSigmaY, surfNorm);\nvec3 R2 = cross(surfNorm, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nvec3 vGrad = sign(fDet) * (dBdxy.x * R1 + dBdxy.y * R2);\nreturn normalize(abs(fDet) * surfNorm - vGrad);\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nuniform sampler2D baseColorTexture;\nuniform vec4 baseColorAtlasUvMod;\nuniform float alphaDiscardThreshold;\n#ifdef USE_PARALLAX_CORRECTION\n#endif\n#else\nuniform vec3 baseColor;\n#endif\nuniform float opacity;\n#ifdef USE_CUTOUT_MASK\nuniform float cutoutMaskThreshold;\n#endif\nuniform vec4 baseColorCorrection;\nvec3 rgbToHsl(vec3 rgb) {\nvec3 hsl = vec3(0.0);\nfloat fMin = min(min(rgb.r, rgb.g), rgb.b);\nfloat fMax = max(max(rgb.r, rgb.g), rgb.b);\nfloat delta = fMax - fMin;\nhsl.z = (fMax + fMin) / 2.0;  // Luminance\nif (delta == 0.0) {\nreturn hsl;\n}\nhsl.y = delta / ((hsl.z <= 0.5) ? (fMax + fMin) : (2.0 - fMax - fMin));\nfloat denom = 6.0 * delta;\nif (rgb.r == fMax) {\nhsl.x = (rgb.g - rgb.b) / denom;\n} else if (rgb.g == fMax) {\nhsl.x = (rgb.b - rgb.r) / denom + (1.0 / 3.0);\n} else if (rgb.b == fMax) {\nhsl.x = (rgb.r - rgb.g) / denom + (2.0 / 3.0);\n}\nif (hsl.x < 0.0) {\nhsl.x += 1.0;\n}\nif (hsl.x > 1.0) {\nhsl.x -= 1.0;\n}\nreturn hsl;\n}\nfloat hueToRgb(float p, float q, float hue) {\nif (hue < 0.0) {\nhue += 1.0;\n}\nif (hue > 1.0) {\nhue -= 1.0;\n}\nfloat res;\nif (6.0 * hue < 1.0) {\nres = p + (q - p) * 6.0 * hue;\n} else if (2.0 * hue < 1.0) {\nres = q;\n} else if (3.0 * hue < 2.0) {\nres = p + (q - p) * ((2.0 / 3.0) - hue) * 6.0;\n} else {\nres = p;\n}\nreturn res;\n}\nvec3 hslToRgb(vec3 hsl) {\nvec3 rgb;\nif (hsl.y == 0.0) {\nreturn vec3(hsl.z);\n}\nfloat q = hsl.z < 0.5 ? hsl.z * (1.0 + hsl.y) : (hsl.z + hsl.y) - (hsl.y * hsl.z);\nfloat p = 2.0 * hsl.z - q;\nrgb.r = hueToRgb(p, q, hsl.x + (1.0 / 3.0));\nrgb.g = hueToRgb(p, q, hsl.x);\nrgb.b = hueToRgb(p, q, hsl.x - (1.0 / 3.0));\nreturn rgb;\n}\nvec3 adjustContrast(vec3 col, float contrast) {\nfloat factor = (1.0 + contrast);\nreturn clamp(vec3(factor * (col.r - 0.5) + 0.5, factor * (col.g - 0.5) + 0.5,\nfactor * (col.b - 0.5) + 0.5),\nvec3(0.0), vec3(1.0));\n}\nfloat modOne(float x) {\nif (x < 0.0) {\nreturn 1.0 - (float(int(x)) - x);\n}\nreturn x - float(int(x));\n}\nfloat adjustComponent(float component, float adjustment) {\nreturn clamp(component * (1.0 + adjustment), 0.0, 1.0);\n}\nvec3 applyColorCorrection(vec3 color, vec4 colorCorrection) {\nif (colorCorrection.x != 0.0 || colorCorrection.y != 0.0 || colorCorrection.z != 0.0) {\nvec3 colorInHSL = rgbToHsl(color);\ncolorInHSL = vec3(modOne(colorInHSL.x + colorCorrection.x),\nadjustComponent(colorInHSL.y, colorCorrection.y),\nadjustComponent(colorInHSL.z, colorCorrection.z));\ncolor = hslToRgb(colorInHSL);\n}\nif (colorCorrection.a == 0.0)\nreturn color;\nreturn adjustContrast(color, colorCorrection.a);\n}\nvec3 getBaseColorHook(out float alpha);\nvec3 getBaseColor(out float alpha) {\n#ifdef USE_BASE_COLOR_TEXTURE\n#ifdef USE_PARALLAX_CORRECTION\n#else\nvec2 uv = vUv;\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT\nvec2 uvScaled = uv * baseColorAtlasUvMod.zw;\nvec2 dfdx = dFdx(uvScaled);\nvec2 dfdy = dFdy(uvScaled);\nuv = fract(uv) * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\nvec4 baseColorGamma = texture2DGradEXT(baseColorTexture, uv, dfdx, dfdy);\nfloat textureAlpha = baseColorGamma.a;\n#else\nuv = uv * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\n#ifdef USE_ALPHA_IN_LOWER_HALF\nvec4 baseColorGamma = texture2D(baseColorTexture, vec2(uv.x, .5 + .5 * uv.y));\nfloat textureAlpha = texture2D(baseColorTexture, vec2(uv.x, .5 * uv.y)).r;\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, uv);\nfloat textureAlpha = baseColorGamma.a;\n#endif\n#endif\nvec3 baseColor = gammaToLinear(baseColorGamma.rgb);\n#ifdef USE_CUTOUT_MASK\nalpha = step(cutoutMaskThreshold, textureAlpha);\nif (alpha == 0.0)\ndiscard;\n#else\nalpha = opacity * textureAlpha;\n#endif\n#else  // NOT USE_BASE_COLOR_TEXTURE\nalpha = opacity;\n#endif\nreturn applyColorCorrection(baseColor, baseColorCorrection);\n}\n#ifdef USE_LIGHTMAP\nwebgl2centroid varIn vec2 vUv2;\nuniform sampler2D lightMap;\nuniform vec4 lightMapSize;\nuniform vec2 lightMapThreshold;\nvec3 getLightIntensity() {\nvec2 uv = vec2(vUv2.x, vUv2.y);\n#ifdef LIGHTMAP_YCOCGM\nreturn ycocgToRgb(\nhdrDecodeYcocgmBilinear(lightMap, lightMapSize.xy, lightMapSize.zw, lightMapThreshold, uv));\n#else  // LIGHTMAP_RGBM\nreturn hdrDecodeRgbmBilinear(lightMap, lightMapSize.xy, lightMapSize.zw, uv);\n#endif\n}\n#else  // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\n#ifdef USE_ROUGHNESS_TEXTURE\nuniform sampler2D roughnessTexture;\n#else\nuniform float roughness;\n#endif\n#ifdef USE_METALLIC_TEXTURE\nuniform sampler2D metallicTexture;\n#else\nuniform float metallic;\n#endif\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity, inout float opacity);\n#if defined(USE_ENVMAP)\nconst float DLT = 0.001;\nuniform sampler2D brdfLUT;\n#if defined(USE_REFLECTION_PROBE_BLENDING)\nuniform samplerCube envMap[MAX_BLENDED_REFLECTION_PROBES];\n#else\nuniform samplerCube envMap;\n#endif\nuniform float envMipsCount;\n#ifdef HAVE_TEXTURE_LOD\n#else\n#if defined(USE_REFLECTION_PROBE_BLENDING)\nuniform samplerCube envMap2[MAX_BLENDED_REFLECTION_PROBES];\n#else\nuniform samplerCube envMap2;\n#endif\n#endif\nstruct Roughness {\nfloat envFresnel;  // (1.0 - roughness)^2, used for Fresnel with env map\nfloat envMipLevel0;\nfloat envMipLevel1;\nfloat envMipMixFactor;\nfloat value;\n};\nRoughness getRoughnessFactors() {\nRoughness r;\n#ifdef USE_ROUGHNESS_TEXTURE\nfloat roughness = texture2D(roughnessTexture, vUv).x;\n#endif  // else roughness is a uniform\nfloat roughness2 = roughness * roughness;\nfloat maxMipLevel = envMipsCount - 1.0;\nfloat mipSelector = roughness * maxMipLevel;\nr.envMipLevel0 = floor(mipSelector);\nr.envMipLevel1 = min(r.envMipLevel0 + 1.0, maxMipLevel);\nr.envMipMixFactor = fract(mipSelector);\nr.envFresnel = (roughness2 - 2.0 * roughness + 1.0);\nr.value = roughness;\nreturn r;\n}\n#ifdef USE_ENVMAP_PROJECT\nstruct ReflectionProbe {\nvec3 boxMin;\nvec3 boxMax;\nvec3 posW;\n};\n#if defined(USE_REFLECTION_PROBE_BLENDING)\nuniform ReflectionProbe reflectionProbe[MAX_BLENDED_REFLECTION_PROBES];\n#else\nuniform ReflectionProbe reflectionProbe;\n#endif  // USE_REFLECTION_PROBE_BLENDING\nconst vec3 infBox = vec3(1000.0);\nvec3 cubeMapProject(vec3 reflectionW, in ReflectionProbe reflectionProbe) {\nvec3 firstPlaneIntersect = (reflectionProbe.boxMax - vPositionW) / reflectionW;\nvec3 secondPlaneIntersect = (reflectionProbe.boxMin - vPositionW) / reflectionW;\nvec3 furthestPlane = max(firstPlaneIntersect, secondPlaneIntersect);\nvec3 furthestPlaneNonNeg = step(0.0, -furthestPlane) * infBox + abs(furthestPlane);\nfloat distance = min(min(furthestPlaneNonNeg.x, furthestPlaneNonNeg.y), furthestPlaneNonNeg.z);\n/*if (furthestPlane.x > 0.0){\ndistance = furthestPlane.x;\n}\nif (furthestPlane.y > 0.0) {\ndistance = min(distance, furthestPlane.y);\n}\nif (furthestPlane.z > 0.0) {\ndistance = min(distance, furthestPlane.z);\n}*/\nvec3 intersectionPosW = vPositionW + reflectionW * distance;\nreturn intersectionPosW - reflectionProbe.posW;\n}\nfloat signedDistanceBox(vec3 p, vec3 b, float offset) {\nvec3 q = abs(p) - b;\nreturn length(max(q, 0.0)) + min(max(q.x, max(q.y, q.z)), 0.0) - offset;\n}\nfloat getSignedDistanceField(in ReflectionProbe probe) {\nvec3 halfBox = (probe.boxMax - probe.boxMin) * vec3(0.5);\nvec3 boxPos = (probe.boxMax + probe.boxMin) * vec3(0.5);\nvec3 localPos = boxPos - vPositionW;\nconst float offset = 0.1;\nreturn signedDistanceBox(localPos, halfBox, offset);\n}\n#endif  // USE_ENVMAP_PROJECT\nvec3 fixSeams(vec3 vec, float mipLevel) {\nfloat scale = 1.0 - exp2(mipLevel) / 128.0;\nfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\nif (abs(vec.x) != M)\nvec.x *= scale;\nif (abs(vec.y) != M)\nvec.y *= scale;\nif (abs(vec.z) != M)\nvec.z *= scale;\nreturn vec;\n}\nvec3 getEnvColor(in Roughness roughness, in vec3 reflectionW, in samplerCube envMap\n#ifdef HAVE_TEXTURE_LOD\n#else\n,\nin samplerCube envMap2\n#endif\n#ifdef USE_ENVMAP_PROJECT\n,\nin ReflectionProbe reflectionProbe\n#endif\n) {\nvec3 reflectionNormW = normalize(reflectionW);\n#ifdef USE_ENVMAP_PROJECT\nif (reflectionProbe.boxMin.x != reflectionProbe.boxMax.x) {\nreflectionNormW = cubeMapProject(reflectionNormW, reflectionProbe);\n}\n#endif\nvec3 reflectionNormFixedW = fixSeams(reflectionNormW, roughness.envMipLevel0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw0 = textureCubeLodEXT(envMap, reflectionNormFixedW, roughness.envMipLevel0);\n#else\nvec4 cubeColorRaw0 = textureCube(envMap, reflectionNormFixedW);\n#endif\nvec3 cubeColor0 = hdrDecodeRgbm(cubeColorRaw0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw1 = textureCubeLodEXT(envMap, reflectionNormFixedW, roughness.envMipLevel1);\n#else\nvec4 cubeColorRaw1 = textureCube(envMap2, reflectionNormFixedW);\n#endif\nvec3 cubeColor1 = hdrDecodeRgbm(cubeColorRaw1);\nreturn mix(cubeColor0, cubeColor1, roughness.envMipMixFactor);\n}\nvec3 fresnelSchlickEnv(in vec3 specularColor, in Roughness roughness, in float clampCosnv,\ninout float opacity) {\nfloat fresnel = 1.0 - clampCosnv;\nfloat fresnel2 = fresnel * fresnel;\nfresnel *= fresnel2 * fresnel2;\nfresnel *= roughness.envFresnel;\nopacity = opacity + (1.0 - opacity) * fresnel;\nreturn specularColor + (1.0 - specularColor) * fresnel;\n}\nvec3 getSpecularColor(in vec3 baseColor, float metalic) {\nconst float dielectricF0 = 0.04;\nreturn mix(vec3(dielectricF0), baseColor, metalic);\n}\nfloat getLuminance(in vec3 color) {\nreturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\nvec3 getNormalW() {\n#ifdef USE_BUMP_TEXTURE\nvec3 normalPerturbedV = perturbNormal(-vPositionV, normalize(vNormalV));\nreturn normalize(inverseTransformDirection(normalPerturbedV, viewMatrix));\n#else\nreturn normalize(vNormalW);\n#endif\n}\nvec3 envBRDFApprox(vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nreturn specular * AB.x + AB.y;\n}\nvec3 addSpecular(in vec3 baseColor, in vec3 totalIntensity, inout float opacity) {\nvec3 totalSpec = vec3(0.0, 0.0, 0.0);\n#ifdef USE_METALLIC_TEXTURE\nfloat metallic = texture2D(metallicTexture, vUv).x;\n#endif  // else metallic is a uniform\nvec3 diffuseIntensity = totalIntensity * (1.0 - mix(0.04, 1.0, metallic));\nvec3 viewW = normalize(cameraPosition - vPositionW);\nvec3 normalW = getNormalW();\nfloat clampCosnv = saturate(dot(normalW, viewW));\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 specularColor = getSpecularColor(baseColor, metallic);\nRoughness roughness = getRoughnessFactors();\n#ifdef USE_REFLECTION_PROBE_BLENDING\nfloat weight[MAX_BLENDED_REFLECTION_PROBES];\n#ifdef USE_ENVMAP_PROJECT\nfor (int i = 0; i < MAX_BLENDED_REFLECTION_PROBES; i++) {\nweight[i] = max(-getSignedDistanceField(reflectionProbe[i]), 0.0);\nweight[i] = smoothstep(0.0, 1.0, weight[i]);\n}\nfloat weightSum = weight[0] + weight[1] + weight[2];\nif (weightSum == 0.0) {\nweight[0] = 1.0;\n} else {\nfor (int i = 0; i < MAX_BLENDED_REFLECTION_PROBES; i++) weight[i] /= weightSum;\n}\n#else\nfor (int i = 0; i < MAX_BLENDED_REFLECTION_PROBES; i++) weight[i] = 1.0;\n#endif\nvec3 envColor = vec3(0.0, 0.0, 0.0);\nenvColor += getEnvColor(roughness, reflectionW, envMap[0]\n#ifdef HAVE_TEXTURE_LOD\n#else\n,\nin samplerCube envMap2[0]\n#endif\n#ifdef USE_ENVMAP_PROJECT\n,\nreflectionProbe[0]\n#endif\n) *\nweight[0];\nenvColor += getEnvColor(roughness, reflectionW, envMap[1]\n#ifdef HAVE_TEXTURE_LOD\n#else\n,\nin samplerCube envMap2[1]\n#endif\n#ifdef USE_ENVMAP_PROJECT\n,\nreflectionProbe[1]\n#endif\n) *\nweight[1];\n#if (MAX_BLENDED_REFLECTION_PROBES >= 3)\nenvColor += getEnvColor(roughness, reflectionW, envMap[2]\n#ifdef HAVE_TEXTURE_LOD\n#else\n,\nin samplerCube envMap2[2]\n#endif\n#ifdef USE_ENVMAP_PROJECT\n,\nreflectionProbe[2]\n#endif\n) *\nweight[2];\n#endif\n#else  // USE_REFLECTION_PROBE_BLENDING\nvec3 envColor = getEnvColor(roughness, reflectionW, envMap\n#ifdef HAVE_TEXTURE_LOD\n#else\n,\nin samplerCube envMap2\n#endif\n#ifdef USE_ENVMAP_PROJECT\n,\nreflectionProbe\n#endif\n);\n#endif  // USE_REFLECTION_PROBE_BLENDING\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness, clampCosnv, opacity);\nfloat luminance = getLuminance(totalIntensity);\n#ifdef USE_PBR\n#ifdef USE_BRDF_TEXTURE\nvec4 brdf = texture2D(brdfLUT, vec2(clampCosnv, roughness.value));\nfloat brdfX = brdf.x + (brdf.y / 255.0);\nfloat brdfY = brdf.z + (brdf.w / 255.0);\ntotalSpec = envColor * (fresnel * brdfX + brdfY);\n#else\nvec3 brdf = envBRDFApprox(specularColor, roughness.value, clampCosnv);\ntotalSpec = envColor * brdf;\n#endif\n#else\ntotalSpec = envColor * fresnel;\n#endif\nreturn (baseColor * diffuseIntensity + totalSpec * mix(0.4, 1.0, luminance));\n}\n#else  // NOT USE_ENVMAP\nvec3 addSpecular(vec3 baseColor, in vec3 lightIntensity, in float opacity) {\nreturn baseColor * lightIntensity;\n}\n#endif\n#ifdef USE_HIGHLIGHT\nuniform vec3 highlight;\nuniform float highlightMix;\n#endif\n#if defined(HDR_OUTPUT)\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D lut, in vec3 color, in float intensity) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(lut, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(lut, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color, mix(color0, color1, bOffset), intensity);\n}\nuniform sampler2D colorMap;\nuniform float colorMapIntensity;\n#endif\n#ifdef USE_CHROMA_KEY\nuniform vec3 chromaKeyColor;\nuniform vec3 chromaKeyDeltaCoeff;\nconst float k32 = sqrt(3.0) / 2.0;\nvec3 rgb2abi(vec3 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\nreturn vec3(r - 0.5 * g - 0.5 * b, k32 * (g - b), 0.3333 * (r + g + b));\n}\nconst float IPI2 = 0.5 / 3.1415926538;\nvec3 rgb2hci(vec3 color) {\nvec3 abi = rgb2abi(color);\nreturn vec3(atan(abi.y, abi.x) * IPI2, length(abi.xy), abi.z);\n}\nfloat chromaKeyShapeFn(vec3 delta, vec3 color, vec3 key) {\nvec3 diff = color - key;\nvec3 v = delta * vec3(\n0.5 - abs(abs(diff.x) - 0.5), abs(diff.y), abs(diff.z));\nfloat x = max(v.r, max(v.g, v.b));\nreturn x * x;\n}\nfloat chromaKeyEdgeFn(float a) {\nreturn clamp(.2 / .5 * (a - 1.0), 0.0, 1.0);\n}\n#endif\nuniform float emissionStrength;\n#ifdef USE_EXPOSURE_AND_GAMMA\nuniform float exposure;\nuniform float cameraGamma;\n#else\nconst float exposure = 1.0f;\nconst float cameraGamma = 1.0f;\n#endif\nvoid main() {\nfloat alpha;\nvec3 baseColor = getBaseColorHook(alpha);\n#ifdef USE_CHROMA_KEY\nfloat dist = chromaKeyShapeFn(chromaKeyDeltaCoeff, rgb2hci(baseColor), rgb2hci(chromaKeyColor));\nalpha *= chromaKeyEdgeFn(dist);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE)\nif (alpha < alphaDiscardThreshold) {\ndiscard;\n}\n#endif\nvec3 lightIntensity = getLightIntensity();\n#ifdef USE_HIGHLIGHT\nbaseColor = mix(baseColor, highlight, highlightMix);\nalpha = mix(alpha, 1.0, highlightMix);\n#endif\nvec3 diffuseSpecular = addSpecularHook(baseColor, lightIntensity, alpha);\n#ifdef USE_HEADLIGHT\nvec3 lightW = normalize(cameraPosition - vPositionW.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormalW), lightW), 0.0);\ndiffuseSpecular *= pointDiffuse;\n#endif\nvec3 diffuseSpecularEmissive = diffuseSpecular + baseColor * emissionStrength;\n#ifdef USE_FOG\nfloat distance = length(vPositionV);\ndiffuseSpecularEmissive = addFog(diffuseSpecularEmissive, distance, vPositionW);\n#endif\n#ifdef HDR_OUTPUT\nif (alpha < 0.5) {\ndiscard;\n}\nfragColor = hdrEncode(diffuseSpecularEmissive);\n#else  // no HDR_OUTPUT\nvec3 exposedColor = pow(exposure * diffuseSpecularEmissive.xyz, vec3(cameraGamma));\nvec3 gammaColor = linearToGammaToneMapped(exposedColor);\n#ifdef USE_COLORMAP\nfragColor = vec4(colormap(colorMap, min(gammaColor, 1.0), colorMapIntensity), alpha);\n#else\nfragColor = vec4(gammaColor, alpha);\n#endif\n#endif  // no HDR_OUTPUT\n}\n",
"standard_material_vertex.glsl":"//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvec4 transformPosition() {\nreturn vec4(t0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w, 1.0);\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || \\\ndefined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE) || defined(USE_HEIGHT_TEXTURE)\nvarOut vec2 vUv;\nuniform vec4 uvMod;\n#endif\n#ifdef USE_LIGHTMAP\nwebgl2centroid varOut vec2 vUv2;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvarOut vec3 vPositionV;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarOut vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvarOut vec3 vPositionW;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarOut vec3 vNormalW;\n#endif\nvoid modifyMvPositionHook(inout vec4 mvPosition, in vec3 normal);\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || \\\ndefined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE) || defined(USE_HEIGHT_TEXTURE)\nvUv = uv * uvMod.zw + uvMod.xy;\n#endif\nvec4 transformedPosition = transformPosition();\nvec4 mvPosition = modelViewMatrix * transformedPosition;\n#ifdef USE_LIGHTMAP\nfloat zeroOrOne = min(uv2.x + uv2.y, 1.0);\nvUv2 = uv2 * uv2Mod.zw + uv2Mod.xy * zeroOrOne;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_HEIGHT_TEXTURE) || defined(USE_ENVMAP) || \\\ndefined(USE_HEADLIGHT)\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(t0.x * n.x + t0.y * n.y + t0.z * n.z, t1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\nmodifyMvPositionHook(mvPosition, normal);\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_FOG)\nvPositionV = -mvPosition.xyz;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_FOG)\nvPositionW = (modelMatrix * transformedPosition).xyz;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n",
"static_render_fragment.glsl":"//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 hable(in vec3 rgb) {\nfloat A = 0.15;  // shoulderStrength\nfloat B = 0.50;  // linearStrength\nfloat C = 0.10;  // linearAngle\nfloat D = 0.20;  // toeStrength\nfloat E = 0.02;  // toeNumerator\nfloat F = 0.30;  // toeDenominator\nreturn ((rgb * (A * rgb + C * B) + D * E) / (rgb * (A * rgb + B) + D * F)) - E / F;\n}\nvec3 toneMappingHable(in vec3 rgb) {\nfloat exposure = 11.2;\nfloat exposureBias = 2.0;\nvec3 current = hable(exposureBias * rgb);\nvec3 whiteScale = 1.0 / hable(vec3(exposure));\nreturn pow(current * whiteScale, vec3(1.0 / 2.2));\n}\nvec3 uchimura(in vec3 x, in float P, in float a, in float m, in float l, in float c, in float b) {\nfloat l0 = ((P - m) * l) / a;\nfloat L0 = m - m / a;\nfloat L1 = m + (1.0 - m) / a;\nfloat S0 = m + l0;\nfloat S1 = m + a * l0;\nfloat C2 = (a * P) / (P - S1);\nfloat CP = -C2 / P;\nvec3 w0 = vec3(1.0 - smoothstep(0.0, m, x));\nvec3 w2 = vec3(step(m + l0, x));\nvec3 w1 = vec3(1.0 - w0 - w2);\nvec3 T = vec3(m * pow(x / m, vec3(c)) + b);\nvec3 S = vec3(P - (P - S1) * exp(CP * (x - S0)));\nvec3 L = vec3(m + a * (x - m));\nreturn T * w0 + L * w1 + S * w2;\n}\nvec3 toneMappingUchimura(in vec3 rgb) {\nfloat P = 1.0;   // max display brightness\nfloat a = 1.0;   // contrast\nfloat m = 0.22;  // linear section start\nfloat l = 0.4;   // linear section length\nfloat c = 1.45;  // black\nfloat b = 0.0;   // pedestal\nreturn pow(uchimura(rgb, P, a, m, l, c, b), vec3(1.0 / 2.2));\n}\nvec3 toneMappingUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 linearToGammaToneMapped(in vec3 rgb) {\n#ifdef TONE_MAPPING_UNREAL\nreturn toneMappingUnreal(rgb);\n#endif\n#ifdef TONE_MAPPING_HABLE\nreturn toneMappingHable(rgb);\n#endif\n#ifdef TONE_MAPPING_UCHIMURA\nreturn toneMappingUchimura(rgb);\n#endif\nreturn toneMappingUnreal(rgb);\n}\nuniform sampler2D staticRender;\nuniform vec2 sizeInv;\nvoid main() {\nvec3 colorLinear = texture2D(staticRender, gl_FragCoord.xy * sizeInv).rgb;\nfragColor = vec4(linearToGammaToneMapped(colorLinear), 1.0);\n}\n",
"static_render_vertex.glsl":"//AUTO GENERATED\nvoid main() {\ngl_Position = modelViewMatrix * vec4(position, 1.0);\n}\n","water.glsl":"//AUTO GENERATED\n#ifdef USE_NORMAL_TEXTURE\nuniform float time;\nuniform float wavesScale;\nuniform float refractionFactor;\nuniform sampler2D normalTexture;\nvec4 getNoise(in vec2 uv) {\nvec2 uv0 = (uv / 103.0) + vec2(time / 17.0, time / 29.0);\nvec2 uv1 = uv / 107.0 - vec2(time / -19.0, time / 31.0);\nvec2 uv2 = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\nvec2 uv3 = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\nvec4 noise = texture2D(normalTexture, uv0) + texture2D(normalTexture, uv1) +\ntexture2D(normalTexture, uv2) + texture2D(normalTexture, uv3);\nreturn noise * 0.5 - 1.0;\n}\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity, inout float opacity) {\nvec3 toEyeW = cameraPosition - vPositionW;\nvec3 viewW = normalize(toEyeW);\nvec4 noise = getNoise(vPositionW.xy * wavesScale);\nvec3 normalW = normalize(noise.xyz);\nfloat clampCosnv = saturate(dot(normalW, viewW));\nRoughness roughness;\nroughness.envMipLevel0 = 0.0;\nroughness.envMipLevel1 = 0.0;\nroughness.envMipMixFactor = 0.0;\nroughness.envFresnel = 1.0;\nconst float waterF0 = 0.02;\nvec3 specularColor = vec3(waterF0);\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 refractionW = refract(-viewW, normalW, 0.75);\nvec3 reflectedEnv = getEnvColor(roughness, normalize(reflectionW),\n#if defined(USE_REFLECTION_PROBE_BLENDING)\nenvMap[0]\n#ifdef USE_ENVMAP_PROJECT\n,\nreflectionProbe[0]\n#endif\n#else\nenvMap\n#ifdef USE_ENVMAP_PROJECT\n,\nreflectionProbe\n#endif\n#endif\n);\nvec3 refractedEnv = refractionFactor * getEnvColor(roughness, normalize(refractionW),\n#if defined(USE_REFLECTION_PROBE_BLENDING)\nenvMap[0]\n#ifdef USE_ENVMAP_PROJECT\n,\nreflectionProbe[0]\n#endif\n#else\nenvMap\n#ifdef USE_ENVMAP_PROJECT\n,\nreflectionProbe\n#endif\n#endif\n);\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness, clampCosnv, opacity);\nvec3 totalSpec = reflectedEnv * fresnel + refractedEnv * (1.0 - fresnel);\nvec3 diffuseIntensity = totalIntensity * 0.98;\nfloat luminance = getLuminance(totalIntensity);\nreturn totalSpec * mix(0.4, 1.0, luminance) + baseColor * diffuseIntensity;\n}\n#else  // NOT USE_NORMAL_TEXTURE\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity, inout float opacity) {\nreturn baseColor * totalIntensity;\n}\n#endif\nvec3 getBaseColorHook(out float alpha) {\nreturn getBaseColor(alpha);\n}\n",
"wireframe_fragment.glsl":"//AUTO GENERATED\nuniform vec3 lineColor;\nuniform float lineMaxAlpha;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarIn vec3 vBaryCentric;\nfloat edgeFactor() {\nvec3 d = fwidth(vBaryCentric);\nvec3 r = smoothstep(vec3(0.0), d * 1.5, vBaryCentric);\nreturn min(min(r.x, r.y), r.z);\n}\nvoid main(void) {\nfloat edge = edgeFactor();\nif (edge < 1.0) {\nfragColor = vec4(lineColor, (1.0 - edge) * lineMaxAlpha);\n} else {\nfragColor = vec4(highlight, highlightMix);\n}\n}\n",
"wireframe_vertex.glsl":"//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(t0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w, 1.0);\n}\nattr float order;\nvarOut vec3 vBaryCentric;\nvoid main() {\nif (order == 0.0) {\nvBaryCentric = vec3(1.0, 0.0, 0.0);\n} else if (order == 1.0) {\nvBaryCentric = vec3(0.0, 1.0, 0.0);\n} else {\nvBaryCentric = vec3(0.0, 0.0, 1.0);\n}\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n"};function od(a,b){this.id=a;this.code=b;this.codeHash=function(){var c=0,d;if(0===this.code.length)return c;for(d=0;d<this.code.length;d++){var e=this.code.charCodeAt(d);c=(c<<5)-c+e;c|=0}return c}}var pd=0;function qd(a){od.call(this,"inline:"+pd,a);pd+=1}m.inherits(qd,od);function rd(a){return new od(a,ld[a])};var sd=0,td=[0,0],ud=Object.freeze({uv:td,uv2:td,uv2Mod:[0,0,1/65535,1/65535],t0:[1,0,0,0],t1:[0,1,0,0],t2:[0,0,1,0]}),yd=Object.freeze("position sphericalNormal uv uv2 uv2Mod t0 t1 t2".split(" ")),zd=new qd(""),Ad=new qd(""),Bd=Object.keys(jd).map(function(a){return"TONE_MAPPING_"+a});function Cd(a){return"TONE_MAPPING_"+Object.keys(jd).find(function(b){return jd[b]===a})}
function Dd(a,b,c,d){var e=this;c=void 0===c?zd:c;d=void 0===d?Ad:d;sd+=1;Object.defineProperty(this,"id",{value:sd});this.name="";this.side=C.FrontSide;this.doNotOverrideSide=!1;this.opacity=1;this.transparent=!1;this.transparentRenderOrder=0;this.blending=C.NoBlending;this.blendSrc=Mb.SRC_ALPHA;this.blendDst=Mb.ONE_MINUS_SRC_ALPHA;this.blendEquation=Mb.FUNC_ADD;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this._hideFromLightProbes=
!1;this._defines=new Set;this._definesString=null;this._textureLodExtension=this._standardDerivativesExtension=!1;this._lightMapSize=new C.Vector4;this._lightMapThreshold=new C.Vector2;this.uniforms={};this.attributes=yd;this.vertexShaderName=a;this._vertexShaderBody=rd(a);this._vertexShaderHooks=c;this.fragmentShaderName=b;this._fragmentShaderBody=rd(b);this._fragmentShaderHooks=d;this.defaultAttributeValues=ud;this.index0AttributeName=void 0;this._programNeedsUpdate=this.visible=!0;this._sharedMaterialState=
this.program=null;this.usePbr=this.toneMappingSupported=this.exposureAndGammaSupported=this.colorMapSupported=this.hdrOutputSupported=this.fogSupported=this.lightMapSupported=!1;this.renderSteps=1;var f={type:"updated",target:this};this._updated=function(){return e.dispatchEvent(f)}}
Dd.prototype={constructor:Dd,get isAnimated(){return!1},get isPlaying(){return!1},update:function(){},rewind:function(){console.assert(!1)},play:function(){console.assert(!1)},pause:function(){console.assert(!1)},get hideFromLightProbes(){return this._hideFromLightProbes},set hideFromLightProbes(a){this._hideFromLightProbes=a},get programNeedsUpdate(){return this._programNeedsUpdate},set programNeedsUpdate(a){this._definesString=null;this._programNeedsUpdate=a},get lightMapEnabled(){return this.lightMapSupported&&
null!==this.sharedMaterialState&&this.sharedMaterialState.lightMapEnabled},get sharedMaterialState(){return this._sharedMaterialState},set sharedMaterialState(a){this._sharedMaterialState=a;this._setSharedStateUpdate();this._applySharedState()},hasDefine:function(a){return this._defines.has(a)},addDefine:function(a){this.hasDefine(a)||(this._defines.add(a),this.programNeedsUpdate=!0)},removeDefine:function(a){this.hasDefine(a)&&(this._defines.delete(a),this.programNeedsUpdate=!0)},condDefine:function(a,
b){a?this.addDefine(b):this.removeDefine(b);return a},_getDefinesString:function(){if(null===this._definesString){for(var a=[],b=m.makeIterator(this._defines),c=b.next();!c.done;c=b.next())a.push("#define "+c.value);a.sort();this._definesString=a.join("\n")}return this._definesString},generateProgramId:function(){return[this._fragmentShaderBody.id,this._fragmentShaderHooks.id,this._getDefinesString(),this._vertexShaderBody.id,this._vertexShaderHooks.id,this._standardDerivativesExtension?"+":"",this._textureLodExtension?
"+":""].join("$")},tryToRefreshShaderCode:function(){var a=0,b=0,c=!1;this._vertexShaderBody&&(a=this._vertexShaderBody.codeHash());this._fragmentShaderBody&&(b=this._fragmentShaderBody.codeHash());this._vertexShaderBody.code=rd(this.vertexShaderName).code;this._vertexShaderBody.codeHash()!=a&&(c=!0);this._fragmentShaderBody.code=rd(this.fragmentShaderName).code;this._fragmentShaderBody.codeHash()!=b&&(c=!0);return c},enableStandardDerivativesExtension:function(){Bc.gl.webgl2||this._standardDerivativesExtension||
(this.programNeedsUpdate=this._standardDerivativesExtension=!0)},enableTextureLodExtension:function(){Bc.gl.webgl2||this._textureLodExtension||(this.programNeedsUpdate=this._textureLodExtension=!0)},_getShaderHeader:function(){return Bc.gl.webgl2?"#version 300 es\n#define texture2D texture\n#define textureCube texture\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define attr in\n#define varOut out\n#define varIn in\n#define webgl2centroid centroid\n":"\n#define attr attribute\n#define varOut varying\n#define varIn varying\n#define webgl2centroid\n"},
generateVertexShader:function(){return[this._getShaderHeader(),"precision highp float;\nprecision highp int;",this._getDefinesString(),"uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattr vec3 position;\nattr vec2 sphericalNormal;\nattr vec2 uv;\nattr vec2 uv2;\nattr vec4 uv2Mod;\nattr vec4 t0;\nattr vec4 t1;\nattr vec4 t2;",this._vertexShaderBody.code,this._vertexShaderHooks.code].join("\n")},
generateFragmentShader:function(){return[this._getShaderHeader(),this._standardDerivativesExtension?"#extension GL_OES_standard_derivatives : enable":"",this._textureLodExtension?"#extension GL_EXT_shader_texture_lod : require":"","precision "+Bc.gl.fragmentPrecision+" float;","precision "+Bc.gl.fragmentPrecision+" int;",this._getDefinesString(),"uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;",Bc.gl.webgl2?"out vec4 fragColor;":"#define fragColor gl_FragColor",this._fragmentShaderBody.code,
this._fragmentShaderHooks.code].join("\n")},dispose:function(){this.dispatchEvent({type:"dispose"})},setUniform:function(a,b,c){this.uniforms[a]={type:b,value:c}},propertyFromUniform:function(a){Object.defineProperty(this,a,{get:function(){return this.uniforms[a].value},set:function(b){this.uniforms[a].value=b}})},hash:function(){console.assert(!1,"hash not implemented")},canMerge:function(){console.assert(!1,"canMerge not implemented")},updateRenderStep:function(){},_setSharedStateUpdate:function(){var a=
this;this._sharedMaterialState.addEventListener("updated",function(){a._applySharedState()&&a._updated()})},_applySharedState:function(){var a=this,b=!1;if(this.fogSupported){b=this.sharedMaterialState.fog;if(this.condDefine(null!==b&&b.enabled(),"USE_FOG")){var c=b.heightEnabled?b.heightDensity:0;this.setUniform("distanceDensity","f",b.distanceEnabled?b.distanceDensity:0);this.setUniform("distanceStart","f",b.distanceStart);this.setUniform("heightDensity","f",c);this.setUniform("heightStart","f",
b.heightStart);this.setUniform("color","c",b.color)}b=!0}this.hdrOutputSupported&&(this.condDefine(this.sharedMaterialState.hdrOutput,"HDR_OUTPUT"),b=!0);this.colorMapSupported&&(b=this.sharedMaterialState.colorMap,c=this.sharedMaterialState.colorMapIntensity,this.condDefine(null!==b&&0<c,"USE_COLORMAP")&&(this.setUniform("colorMap","t",b),this.setUniform("colorMapIntensity","f",c)),b=!0);this.exposureAndGammaSupported&&(this.addDefine("USE_EXPOSURE_AND_GAMMA"),this.setUniform("exposure","f",Math.pow(2,
this.sharedMaterialState.cameraExposure)),this.setUniform("cameraGamma","f",this.sharedMaterialState.cameraGamma),b=!0);this.toneMappingSupported&&(Bd.forEach(function(d){a.removeDefine(d)}),this.addDefine(Cd(this.sharedMaterialState.toneMapping)),b=!0);this.usePbr&&(this.addDefine("USE_PBR"),b=this.sharedMaterialState.brdfLUT,this.condDefine(null!==b,"USE_BRDF_TEXTURE")&&this.setUniform("brdfLUT","t",b),b=!0);this.condDefine(this.lightMapEnabled,"USE_LIGHTMAP")&&(this.addDefine("LIGHTMAP_"+this.sharedMaterialState.lightMapEncoding.toUpperCase()),
this.setUniform("lightMap","t",null),this.setUniform("lightMapSize","v4",this._lightMapSize),this.setUniform("lightMapThreshold","v2",this._lightMapThreshold),b=!0);return b},refreshPerObjectUniforms:function(a){var b=this.uniforms;a=a.lightMap;return this.lightMapEnabled&&b.lightMap.value!==a?(console.assert(void 0!==a),b.lightMap.value=a,b.lightMapSize.value.x=a.width,b.lightMapSize.value.y=a.height,b.lightMapSize.value.z=1/a.width,b.lightMapSize.value.w=1/a.height,b.lightMapThreshold.value.x=a.ycocgmThreshold,
b.lightMapThreshold.value.y=(1-a.ycocgmThreshold)/13,!0):!1}};C.EventDispatcher.prototype.apply(Dd.prototype);function Ed(a,b,c){this.textureID=void 0!==b?b:"tDiffuse";this.depthID=void 0!==c?c:"tDepth";this.material=new Dd(a.vertexShaderName,a.fragmentShaderName);this.material.uniforms=C.UniformsUtils.clone(a.uniforms);this.uniforms=this.material.uniforms;this.renderToScreen=!1;this.needsSwap=this.enabled=!0;this.clear=!1;this.camera=new C.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new C.Scene;this.quad=new C.Mesh(new C.PlaneBufferGeometry(2,2),this.material);this.scene.add(this.quad)}
Ed.prototype={render:function(a,b,c){var d=this.material.uniforms[this.textureID];d&&(d.value=c);if(d=this.material.uniforms[this.depthID])d.value=c.depthTexture;this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},dispose:function(){this.material.dispose();this.quad.geometry.dispose()}};function Fd(){this.clock=performance||Date;this.reset()}Fd.prototype.reset=function(){this.startMS=this.clock.now()};Fd.prototype.elapsedMSec=function(){return this.clock.now()-this.startMS};Fd.prototype.elapsedSec=function(){return.001*this.elapsedMSec()};function Gd(a,b){this.nativeTimeoutId=null;this.durationMSec=a;this.callback=b}Gd.prototype.isRunning=function(){return null!==this.nativeTimeoutId};
Gd.prototype.start=function(){null!==this.nativeTimeoutId&&clearTimeout(this.nativeTimeoutId);this.nativeTimeoutId=setTimeout(function(){this.nativeTimeoutId=null;this.callback&&this.callback()},this.durationMSec)};
function Hd(a,b){var c=this,d=new Fd,e=new Uint8Array(4),f=S.BENCHMARK_MEASUREMENTS?parseInt(S.BENCHMARK_MEASUREMENTS):960;this.benchmarking=b;var g=a.getSupportedExtensions().includes("EXT_disjoint_timer_query_webgl2")?a.getExtension("EXT_disjoint_timer_query_webgl2"):null;g||alert("EXT_disjoint_timer_query_webgl2 support isn't enabled in this browser. Using gl.readPixels() as a means of synchronisation.");var k=null,h=!1,l=!1,n=[];this.lastFPS=this.lastMS=0;this.benchmarking&&document.addEventListener("keydown",
function(p){"KeyB"==p.code&&(p.shiftKey?c.extensiveLogging():n=[])});this.tearDownQuery=function(){l=h=!1;k&&(a&&a.deleteQuery(k),k=null)};this.extensiveLogging=function(){var p=Array.from(n).sort(function(t,A){return t-A});this.max=p[p.length-1];var r=Math.floor(.9*p.length),q=Math.floor(p.length/2),w=Math.floor(.1*p.length),x=p.reduce(function(t,A){return t+A},0)/p.length;p=S.BENCHMARK_LIST_ALL?p.reduce(function(t,A){return t+A.toFixed(3)+";"},""):"high median average low \n"+p[r].toFixed(3)+" "+
p[q].toFixed(3)+" "+x.toFixed(3)+" "+p[w].toFixed(3)+" \n";"console"===S.BENCHMARK_OUTPUT?console.log(p):prompt(p+"\nYou can copy the result of the performance measurement by CTRL-C",p);n=[]};this.addNewMeasurement=function(p){this.lastMS=p;this.lastFPS=1E3/this.lastMS;this.benchmarking&&(n.push(this.lastMS),n.length==f&&this.extensiveLogging())};this.glQueryEnd=function(){l||(a.endQuery(g.TIME_ELAPSED_EXT),l=!0);if(a.getParameter(g.GPU_DISJOINT_EXT))this.tearDownQuery();else if(a.getQueryParameter(k,
a.QUERY_RESULT_AVAILABLE)){var p=a.getQueryParameter(k,a.QUERY_RESULT);this.addNewMeasurement(p/Math.pow(10,6));this.tearDownQuery()}};this.begin=function(){d.reset();g&&!h&&(k=a.createQuery(),a.beginQuery(g.TIME_ELAPSED_EXT,k),h=!0)};this.end=function(){g?h&&this.glQueryEnd():(a.readPixels(0,0,1,1,a.RGBA,a.UNSIGNED_BYTE,e),this.addNewMeasurement(1E3*d.elapsedSec()))}}function Id(a,b){function c(){d=null;a()}var d=null;this.deferRun=function(){null!==d&&clearTimeout(d);d=setTimeout(c,b)}}
function Jd(a,b){function c(){a()}var d=null;this.deferRun=function(){null!==d&&clearInterval(d);d=setInterval(c,b)}};var Kd=S.DEBUG;
function Ld(a){var b={format:Mb.RGBA,magFilter:Mb.NEAREST,minFilter:Mb.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1},c=[a.createRenderTarget(1024,1024,b),a.createRenderTarget(512,512,b)],d=new Ed({uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvOffsetScale:{type:"v4",value:null}},vertexShaderName:"alpha_stats_vertex.glsl",fragmentShaderName:"alpha_stats_fragment.glsl"},"map");d.material.depthTest=!1;d.material.depthWrite=!1;var e=new C.Vector2,f=new C.Vector4;
d.uniforms.mapUvStep.value=e;d.uniforms.mapUvOffsetScale.value=f;var g=new Ed({uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvScale:{type:"v2",value:null}},vertexShaderName:"alpha_stats_vertex.glsl",fragmentShaderName:"alpha_stats_combine_fragment.glsl"},"map");g.material.depthTest=!1;g.material.depthWrite=!1;var k=new C.Vector2;g.uniforms.mapUvScale.value=k;g.uniforms.mapUvStep.value=e;var h=new Uint8Array(4096),l=null;Kd&&(l=new Fd);this.isCutoutTexture=function(n){var p=
void 0!==n.parentTexture;if(p){var r=n.parentTexture;var q=n.uvOffsetScale.x;var w=n.uvOffsetScale.y;var x=n.uvOffsetScale.z;var t=n.uvOffsetScale.w}else r=n,q=w=0,x=t=1;if(!r.hasAlpha||r.video)n.isCutout=!1;else{Kd&&l.reset();a.enableScissorTest(!0);var A=r.width*x,D=r.height*t;e.set(1/A,1/D);f.set(q,w,x,t);A=Math.max(Math.floor(A/2),1);D=Math.max(Math.floor(D/2),1);a.setRenderTarget(c[0]);a.setViewport(0,0,A,D);a.setScissor(0,0,A,D);d.render(a,c[0],r);for(var H=1,G=c[0];1!==A&&1!==D;){e.set(1/G.width,
1/G.height);k.set(A/G.width,D/G.height);A=Math.floor(A/2);D=Math.floor(D/2);var K=c[H];a.setRenderTarget(K);a.setViewport(0,0,A,D);a.setScissor(0,0,A,D);g.render(a,K,G);G=K;H=(H+1)%2}a.readPixels(A,D,h);G=H=0;A=Math.max(A,D);for(D=0;D<A;++D)H+=h[4*D],G+=h[4*D+1];H=100*H/(255*A);G=100*G/(255*A);n.isCutout=20>H||50<G;Kd&&(A="",p&&(A+="From atlas: "+r.name+" ["+q+", "+w+", "+x+", "+t+"]\n"),console.log(n.name+" "+r.width+"x"+r.height+"\n "+A+"Is cutout: "+n.isCutout+"\n Partialy transparent regions: "+
H+"%\n Fully transparent pixels: "+G+"%\n Time: "+l.elapsedSec()));a.enableScissorTest(!1)}};this.dispose=function(){c[0].dispose();c[1].dispose();d.dispose();g.dispose()}};function Md(a){var b=new Ed({uniforms:{srcTexture:{type:"t",value:null},uvOffsetScale:{type:"v4",value:null}},vertexShaderName:"crop_texture_vertex.glsl",fragmentShaderName:"crop_texture_fragment.glsl"},"srcTexture");b.material.depthTest=!1;b.material.depthWrite=!1;this.cropTextureToPoTTarget=function(c,d){var e=C.Math.nextPowerOfTwo(d.z*c.width),f=C.Math.nextPowerOfTwo(d.w*c.height);e=a.createRenderTarget(e,f,{wrapS:Mb.REPEAT,wrapT:Mb.REPEAT,magFilter:Mb.LINEAR,minFilter:Mb.LINEAR_MIPMAP_LINEAR,
format:Mb.RGBA,type:Mb.UNSIGNED_BYTE,depthBuffer:!1,stencilBuffer:!1,generateMipmaps:!0});b.uniforms.uvOffsetScale.value=d;b.render(a,e,c);a.deallocateRenderTargetRenderingBuffers(e);return e}};function Pd(a,b,c){this.scene=a;this.camera=b;this.overrideMaterial=c;this.needsSwap=this.clear=this.enabled=!0}Pd.prototype={render:function(a,b){var c=this.scene.overrideMaterial;this.overrideMaterial&&(this.scene.overrideMaterial=this.overrideMaterial);a.render(this.scene,this.camera,b,this.clear);this.scene.overrideMaterial=c}};function Qd(a){Dd.call(this,"wireframe_vertex.glsl","wireframe_fragment.glsl");this.lineColor=a;this.setUniform("lineColor","c",a);this.setUniform("lineMaxAlpha","f",.65);this.setUniform("highlight","c",S.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0);this.customLightmapResolutionLineColor=new C.Color(170);this.autoLightmapResolutionLineColor=new C.Color(43690);this.meshSelectedLineColor=new C.Color(47872);this.meshSelectedSecondaryLineColor=new C.Color(13404160);this.transparent=!0;
this.blending=C.NormalBlending;this.depthWrite=this.depthTest=!1;this.attributes=this.attributes.concat(["order"]);this.enableStandardDerivativesExtension()}Qd.prototype=Object.create(Dd.prototype);Qd.prototype.constructor=Qd;Qd.prototype.propertyFromUniform("lineMaxAlpha");Qd.prototype.propertyFromUniform("highlight");Qd.prototype.propertyFromUniform("highlightMix");
Qd.prototype.refreshPerObjectUniforms=function(a){var b=this.uniforms,c=!1;null!==a.highlightMix&&void 0!==a.highlightMix&&a.highlightMix!==b.highlightMix.value&&(b.highlightMix.value=a.highlightMix,c=!0);return null!==a.selected&&void 0!==a.selected&&(a=!0===a.selected?this.meshSelectedLineColor:!0===a.selectedSecondary?this.meshSelectedSecondaryLineColor:null!==a.node.lightmapResolution?this.customLightmapResolutionLineColor:0<=a.autoLightmapResolution?this.autoLightmapResolutionLineColor:this.lineColor,
b.lineColor.value!==a)?(b.lineColor.value=a,!0):c};function Rd(a){return!isNaN(a)&&isFinite(a)}function Sd(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}
function Td(a){a=a||{};this.nodeCount=0;this.INDEX_INSIDE_CROSS=-1;this.INDEX_OUTSIDE_OFFSET=2;this.INDEX_OUTSIDE_POS_X=Rd(a.INDEX_OUTSIDE_POS_X)?a.INDEX_OUTSIDE_POS_X:0;this.INDEX_OUTSIDE_NEG_X=Rd(a.INDEX_OUTSIDE_NEG_X)?a.INDEX_OUTSIDE_NEG_X:1;this.INDEX_OUTSIDE_POS_Y=Rd(a.INDEX_OUTSIDE_POS_Y)?a.INDEX_OUTSIDE_POS_Y:2;this.INDEX_OUTSIDE_NEG_Y=Rd(a.INDEX_OUTSIDE_NEG_Y)?a.INDEX_OUTSIDE_NEG_Y:3;this.INDEX_OUTSIDE_POS_Z=Rd(a.INDEX_OUTSIDE_POS_Z)?a.INDEX_OUTSIDE_POS_Z:4;this.INDEX_OUTSIDE_NEG_Z=Rd(a.INDEX_OUTSIDE_NEG_Z)?
a.INDEX_OUTSIDE_NEG_Z:5;this.INDEX_OUTSIDE_MAP=[];this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]=
{index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1};this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1;this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1;this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1;this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1;this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1;this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1;this.utilVec31Search=new C.Vector3;this.utilVec32Search=new C.Vector3;
if(this.scene=a.scene)this.visualGeometry=new C.BoxBufferGeometry(1,1,1),this.visualGeometry.addTriangleOrderAttribute(),this.visualMaterial=new Qd(new C.Color(65280));this.depthMax=Rd(a.depthMax)?a.depthMax:Infinity;this.objectsThreshold=Rd(a.objectsThreshold)?a.objectsThreshold:8;this.overlapPct=Rd(a.overlapPct)?a.overlapPct:.15;this.root=new Ud({tree:this,parent:null,position:new C.Vector3})}
Td.prototype={add:function(a,b,c){b||(b=a.geometry.boundingSphere.center,c=a.geometry.boundingSphere.radius);0!==c&&this.root.addObject(new Vd(a,b,c))},search:function(a,b,c){var d,e=[];this.root.appendObjectsFromNode(e);0<b||(b=Number.MAX_VALUE);if(c instanceof C.Vector3){c=this.utilVec31Search.copy(c).normalize();var f=this.utilVec32Search.set(1,1,1).divide(c)}var g=0;for(d=this.root.nodesIndices.length;g<d;g++){var k=this.root.nodesByIndex[this.root.nodesIndices[g]];k.search(a,b,c,f,e)}return e},
setRoot:function(a){a instanceof Ud&&(this.root=a,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};function Vd(a,b,c){this.object=a;this.radius=c;this.position=b}var Wd=new C.Vector3,Xd=new C.Vector3;new C.Vector3;
function Ud(a){this.tree=a.tree;this.id=this.tree.nodeCount++;this.position=a.position;this.radius=0<a.radius?a.radius:1;this.indexOctant=a.indexOctant;this.depth=0;this.reset();this.setParent(a.parent);this.overlap=this.radius*this.tree.overlapPct;this.radiusOverlap=this.radius+this.overlap;this.left=this.position.x-this.radiusOverlap;this.right=this.position.x+this.radiusOverlap;this.bottom=this.position.y-this.radiusOverlap;this.top=this.position.y+this.radiusOverlap;this.back=this.position.z-
this.radiusOverlap;this.front=this.position.z+this.radiusOverlap;this.tree.scene&&(this.visual=new C.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual),this.tree.scene.updateMatrixWorld())}
Ud.prototype={setParent:function(a){a!==this&&this.parent!==a&&(this.parent=a,this.updateProperties())},updateProperties:function(){var a;this.parent instanceof Ud?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;var b=0;for(a=this.nodesIndices.length;b<a;b++)this.nodesByIndex[this.nodesIndices[b]].updateProperties()},reset:function(a,b){var c,d=this.nodesIndices||[],e=this.nodesByIndex;this.objects=[];this.nodesIndices=[];this.nodesByIndex={};var f=0;for(c=d.length;f<c;f++){var g=
e[d[f]];g.setParent(void 0);!0===a&&g.reset(a,b)}!0===b&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)},addNode:function(a,b){a.indexOctant=b;-1===Sd(this.nodesIndices,b)&&this.nodesIndices.push(b);this.nodesByIndex[b]=a;a.parent!==this&&a.setParent(this)},removeNode:function(a){var b=Sd(this.nodesIndices,a);this.nodesIndices.splice(b,1);var c=c||this.nodesByIndex[a];delete this.nodesByIndex[a];c.parent===this&&c.setParent(void 0)},addObject:function(a){var b=this.getOctantIndex(a);
-1<b&&0<this.nodesIndices.length?(b=this.branch(b),b.addObject(a)):-1>b&&this.parent instanceof Ud?this.parent.addObject(a):(b=Sd(this.objects,a),-1===b&&this.objects.push(a),a.node=this,this.checkGrow())},addObjectWithoutCheck:function(a){var b;var c=0;for(b=a.length;c<b;c++){var d=a[c];this.objects.push(d);d.node=this}},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&0<this.tree.objectsThreshold&&this.grow()},grow:function(){var a=[],b=[],c=[],d=[],e=[],f;var g=0;for(f=this.objects.length;g<
f;g++){var k=this.objects[g];var h=this.getOctantIndex(k);-1<h?(c.push(k),d.push(h)):-1>h?(a.push(k),b.push(h)):e.push(k)}0<c.length&&(e=e.concat(this.split(c,d)));0<a.length&&(e=e.concat(this.expand(a,b)));this.objects=e;this.checkMerge()},split:function(a,b){var c;if(this.depth<this.tree.depthMax){a=a||this.objects;b=b||[];var d=[];var e=0;for(c=a.length;e<c;e++){var f=a[e];var g=b[e];-1<g?(g=this.branch(g),g.addObject(f)):d.push(f)}a===this.objects&&(this.objects=d)}else d=this.objects;return d},
branch:function(a){if(this.nodesByIndex[a]instanceof Ud)var b=this.nodesByIndex[a];else{b=.5*this.radiusOverlap;var c=b*this.tree.overlapPct;c=b-c;c=Wd.set(a&1?c:-c,a&2?c:-c,a&4?c:-c);c=(new C.Vector3).addVectors(this.position,c);b=new Ud({tree:this.tree,parent:this,position:c,radius:b,indexOctant:a});this.addNode(b,a)}return b},expand:function(a,b){var c,d=this.tree.INDEX_OUTSIDE_MAP;if(this.tree.root.getDepthEnd()<this.tree.depthMax){a=a||this.objects;b=b||[];var e=[];var f=[];var g=0;for(c=d.length;g<
c;g++)d[g].count=0;g=0;for(c=a.length;g<c;g++){var k=a[g];var h=b[g];-1>h?(h=-h-this.tree.INDEX_OUTSIDE_OFFSET,h&this.tree.FLAG_POS_X?d[this.tree.INDEX_OUTSIDE_POS_X].count++:h&this.tree.FLAG_NEG_X&&d[this.tree.INDEX_OUTSIDE_NEG_X].count++,h&this.tree.FLAG_POS_Y?d[this.tree.INDEX_OUTSIDE_POS_Y].count++:h&this.tree.FLAG_NEG_Y&&d[this.tree.INDEX_OUTSIDE_NEG_Y].count++,h&this.tree.FLAG_POS_Z?d[this.tree.INDEX_OUTSIDE_POS_Z].count++:h&this.tree.FLAG_NEG_Z&&d[this.tree.INDEX_OUTSIDE_NEG_Z].count++,f.push(k)):
e.push(k)}if(0<f.length){var l=d.slice(0);l.sort(function(r,q){return q.count-r.count});h=l[0];g=h.index|1;k=l[1];d=l[2];b=(k.index|1)!==g?k:d;c=b.index|1;k=l[2];d=l[3];l=l[4];var n=k.index|1;var p=d.index|1;k=n!==g&&n!==c?k:p!==g&&p!==c?d:l;g=h.x+b.x+k.x;c=h.y+b.y+k.y;b=h.z+b.z+k.z;h=this.getOctantIndexFromPosition(g,c,b);b=this.getOctantIndexFromPosition(-g,-c,-b);c=this.overlap;k=this.radius;g=0<this.tree.overlapPct?c/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*k;d=g*this.tree.overlapPct;
c=g+d-(k+c);Xd.set(h&1?c:-c,h&2?c:-c,h&4?c:-c);h=(new C.Vector3).addVectors(this.position,Xd);h=new Ud({tree:this.tree,position:h,radius:g});h.addNode(this,b);this.tree.setRoot(h);g=0;for(c=f.length;g<c;g++)this.tree.root.addObject(f[g])}a===this.objects&&(this.objects=e)}else e=a;return e},shrink:function(){this.checkMerge();this.tree.root.checkContract()},checkMerge:function(){for(var a=this,b;a.parent instanceof Ud&&a.getObjectCountEnd()<this.tree.objectsThreshold;)b=a,a=a.parent;a!==this&&a.merge(b)},
merge:function(a){var b;a=a?"[object Array]"===Object.prototype.toString.call(a)!==!0?[a]:a:[];var c=0;for(b=a.length;c<b;c++){var d=a[c];this.addObjectWithoutCheck(d.getObjectsEnd());d.reset(!0,!0);this.removeNode(d.indexOctant,d)}this.checkMerge()},checkContract:function(){var a;if(0<this.nodesIndices.length){var b=0;var c=this.objects.length;var d=0;for(a=this.nodesIndices.length;d<a;d++){var e=this.nodesByIndex[this.nodesIndices[d]];var f=e.getObjectCountEnd();c+=f;if(!1===g instanceof Ud||f>
b){var g=e;b=f}}c-b<this.tree.objectsThreshold&&g instanceof Ud&&this.contract(g)}},contract:function(a){var b;var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];d!==a&&(a.addObjectWithoutCheck(d.getObjectsEnd()),d.reset(!0,!0))}a.addObjectWithoutCheck(this.objects);this.reset(!1,!0);this.tree.setRoot(a);a.checkContract()},getOctantIndex:function(a){var b=this.position,c=this.radiusOverlap,d=this.overlap,e=0;if(a instanceof Vd){var f=a.radius;var g=a.position}else a instanceof
Ud&&(g=a.position,f=0);var k=g.x-b.x;var h=g.y-b.y;g=g.z-b.z;b=Math.abs(k);var l=Math.abs(h);var n=Math.abs(g);if(Math.max(b,l,n)+f>c)return b+f>c&&(e^=0<k?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),l+f>c&&(e^=0<h?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),n+f>c&&(e^=0<g?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),a.indexOctant=-e-this.tree.INDEX_OUTSIDE_OFFSET,a.indexOctant;if(k-f>-d)e|=1;else if(!(k+f<d))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;if(h-f>-d)e|=2;else if(!(h+f<
d))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;if(g-f>-d)e|=4;else if(!(g+f<d))return a.indexOctant=this.tree.INDEX_INSIDE_CROSS,a.indexOctant;a.indexOctant=e;return a.indexOctant},getOctantIndexFromPosition:function(a,b,c){var d=0;0<a&&(d|=1);0<b&&(d|=2);0<c&&(d|=4);return d},appendObjectsFromNode:function(a){var b,c=this.objects;var d=0;for(b=c.length;d<b;d+=1)a.push(c[d].object)},search:function(a,b,c,d,e){var f;if(!0===this.intersectRay(a,c,b,d)){this.appendObjectsFromNode(e);
var g=0;for(f=this.nodesIndices.length;g<f;g++){var k=this.nodesByIndex[this.nodesIndices[g]];k.search(a,b,c,d,e)}}},intersectRay:function(a,b,c,d){b=(this.left-a.x)*d.x;var e=(this.right-a.x)*d.x,f=(this.bottom-a.y)*d.y,g=(this.top-a.y)*d.y,k=(this.back-a.z)*d.z;d=(this.front-a.z)*d.z;a=Math.min(Math.min(Math.max(b,e),Math.max(f,g)),Math.max(k,d));if(0>a)return!1;b=Math.max(Math.max(Math.min(b,e),Math.min(f,g)),Math.min(k,d));return b>a||b>c?!1:!0},getDepthEnd:function(a){var b;if(0<this.nodesIndices.length){var c=
0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];a=d.getDepthEnd(a)}}else a=!a||this.depth>a?this.depth:a;return a},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var a,b=this.nodesIndices.length;var c=0;for(a=this.nodesIndices.length;c<a;c++)b+=this.nodesByIndex[this.nodesIndices[c]].getNodeCountRecursive();return b},getObjectsEnd:function(a){var b;a=(a||[]).concat(this.objects);var c=0;for(b=this.nodesIndices.length;c<
b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];a=d.getObjectsEnd(a)}return a},getObjectCountEnd:function(){var a,b=this.objects.length;var c=0;for(a=this.nodesIndices.length;c<a;c++)b+=this.nodesByIndex[this.nodesIndices[c]].getObjectCountEnd();return b},getObjectCountStart:function(){for(var a=this.objects.length,b=this.parent;b instanceof Ud;)a+=b.objects.length,b=b.parent;return a},toConsole:function(a){var b;a="string"===typeof a?a:"   ";console.log(this.parent?a+" octree NODE > ":" octree ROOT > ",
this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth);console.log(this.parent?a+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects);console.log(this.parent?a+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];d.toConsole(a+"   ")}}};function Yd(a,b,c,d){function e(l){k.push(l.x,l.y,l.z)}function f(l,n){l*=3;n.x=a[l+0];n.y=a[l+1];n.z=a[l+2]}function g(l,n,p,r){0>r&&1===l.x&&(h[n]=l.x-1);0===p.x&&0===p.z&&(h[n]=r/2/Math.PI+.5)}C.BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var k=[],h=[];(function(l){for(var n=new C.Vector3,p=new C.Vector3,r=new C.Vector3,q=0;q<b.length;q+=3){f(b[q+0],n);f(b[q+1],p);f(b[q+2],r);var w,x,t=n,A=p,D=r,H=Math.pow(2,
l),G=[];for(x=0;x<=H;x++){G[x]=[];var K=t.clone().lerp(D,x/H),W=A.clone().lerp(D,x/H),O=H-x;for(w=0;w<=O;w++)G[x][w]=0===w&&x===H?K:K.clone().lerp(W,w/O)}for(x=0;x<H;x++)for(w=0;w<2*(H-x)-1;w++)t=Math.floor(w/2),0===w%2?(e(G[x][t+1]),e(G[x+1][t]),e(G[x][t])):(e(G[x][t+1]),e(G[x+1][t+1]),e(G[x+1][t]))}})(d);(function(l){for(var n=new C.Vector3,p=0;p<k.length;p+=3)n.x=k[p+0],n.y=k[p+1],n.z=k[p+2],n.normalize().multiplyScalar(l),k[p+0]=n.x,k[p+1]=n.y,k[p+2]=n.z})(c);(function(){for(var l=new C.Vector3,
n=0;n<k.length;n+=3)l.x=k[n+0],l.y=k[n+1],l.z=k[n+2],h.push(Math.atan2(l.z,-l.x)/2/Math.PI+.5,1-(Math.atan2(-l.y,Math.sqrt(l.x*l.x+l.z*l.z))/Math.PI+.5));l=new C.Vector3;n=new C.Vector3;for(var p=new C.Vector3,r=new C.Vector3,q=new C.Vector2,w=new C.Vector2,x=new C.Vector2,t=0,A=0;t<k.length;t+=9,A+=6){l.set(k[t+0],k[t+1],k[t+2]);n.set(k[t+3],k[t+4],k[t+5]);p.set(k[t+6],k[t+7],k[t+8]);q.set(h[A+0],h[A+1]);w.set(h[A+2],h[A+3]);x.set(h[A+4],h[A+5]);r.copy(l).add(n).add(p).divideScalar(3);var D=Math.atan2(r.z,
-r.x);g(q,A+0,l,D);g(w,A+2,n,D);g(x,A+4,p,D)}for(l=0;l<h.length;l+=6)n=h[l+0],p=h[l+2],r=h[l+4],q=Math.min(n,p,r),.9<Math.max(n,p,r)&&.1>q&&(.2>n&&(h[l+0]+=1),.2>p&&(h[l+2]+=1),.2>r&&(h[l+4]+=1))})();this.addAttribute("position",new C.BufferAttribute(new Float32Array(k),3));this.addAttribute("normal",new C.BufferAttribute(new Float32Array(k.slice()),3));this.addAttribute("uv",new C.BufferAttribute(new Float32Array(h),2));0===d?this.computeVertexNormals():this.normalizeNormals()}Yd.prototype=Object.create(C.BufferGeometry.prototype);
Yd.prototype.constructor=Yd;function Zd(a,b){var c=(1+Math.sqrt(5))/2;Yd.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}}Zd.prototype=Object.create(Yd.prototype);Zd.prototype.constructor=Zd;var be=Math,ce=be.abs,de=be.cos,ee=be.sin,fe=be.acos,ge=be.atan2,he=be.sqrt,ie=be.pow;function je(a){return 0>a?-ie(-a,1/3):ie(a,1/3)}
var ke=Math.PI,le=2*ke,me=ke/2,ne=Number.MAX_SAFE_INTEGER||9007199254740991,oe=Number.MIN_SAFE_INTEGER||-9007199254740991,pe={x:0,y:0,z:0},qe={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,
.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,
.0123412297999872,.0123412297999872],arcfn:function(a,b){a=b(a);b=a.x*a.x+a.y*a.y;"undefined"!==typeof a.z&&(b+=a.z*a.z);return he(b)},compute:function(a,b,c){if(0===a)return b[0].t=0,b[0];var d=b.length-1;if(1===a)return b[d].t=1,b[d];var e=1-a,f=b;if(0===d)return b[0].t=a,b[0];if(1===d){var g={x:e*f[0].x+a*f[1].x,y:e*f[0].y+a*f[1].y,t:a};c&&(g.z=e*f[0].z+a*f[1].z);return g}if(4>d){var k=e*e,h=a*a;b=0;if(2===d){f=[f[0],f[1],f[2],pe];g=k;var l=e*a*2;var n=h}else 3===d&&(g=k*e,l=k*a*3,n=e*h*3,b=a*
h);a={x:g*f[0].x+l*f[1].x+n*f[2].x+b*f[3].x,y:g*f[0].y+l*f[1].y+n*f[2].y+b*f[3].y,t:a};c&&(a.z=g*f[0].z+l*f[1].z+n*f[2].z+b*f[3].z);return a}for(c=JSON.parse(JSON.stringify(b));1<c.length;){for(f=0;f<c.length-1;f++)c[f]={x:c[f].x+(c[f+1].x-c[f].x)*a,y:c[f].y+(c[f+1].y-c[f].y)*a},"undefined"!==typeof c[f].z&&(c[f]=c[f].z+(c[f+1].z-c[f].z)*a);c.splice(c.length-1,1)}c[0].t=a;return c[0]},computeWithRatios:function(a,b,c,d){var e=1-a,f=c[0],g=c[1],k=c[2];c=c[3];f*=e;g*=a;if(2===b.length)return e=f+g,
{x:(f*b[0].x+g*b[1].x)/e,y:(f*b[0].y+g*b[1].y)/e,z:d?(f*b[0].z+g*b[1].z)/e:!1,t:a};f*=e;g*=2*e;k*=a*a;if(3===b.length)return e=f+g+k,{x:(f*b[0].x+g*b[1].x+k*b[2].x)/e,y:(f*b[0].y+g*b[1].y+k*b[2].y)/e,z:d?(f*b[0].z+g*b[1].z+k*b[2].z)/e:!1,t:a};f*=e;g*=1.5*e;k*=3*e;c*=a*a*a;if(4===b.length)return e=f+g+k+c,{x:(f*b[0].x+g*b[1].x+k*b[2].x+c*b[3].x)/e,y:(f*b[0].y+g*b[1].y+k*b[2].y+c*b[3].y)/e,z:d?(f*b[0].z+g*b[1].z+k*b[2].z+c*b[3].z)/e:!1,t:a}},derive:function(a,b){for(var c=[],d=a.length,e=d-1;1<d;d--,
e--){for(var f=[],g=0,k;g<e;g++)k={x:e*(a[g+1].x-a[g].x),y:e*(a[g+1].y-a[g].y)},b&&(k.z=e*(a[g+1].z-a[g].z)),f.push(k);c.push(f);a=f}return c},between:function(a,b,c){return b<=a&&a<=c||qe.approximately(a,b)||qe.approximately(a,c)},approximately:function(a,b,c){return ce(a-b)<=(c||1E-6)},length:function(a){for(var b=qe.Tvalues.length,c=0,d=0,e;d<b;d++)e=.5*qe.Tvalues[d]+.5,c+=qe.Cvalues[d]*qe.arcfn(e,a);return.5*c},map:function(a,b,c,d,e){return d+(a-b)/(c-b)*(e-d)},lerp:function(a,b,c){var d={x:b.x+
a*(c.x-b.x),y:b.y+a*(c.y-b.y)};void 0!==b.z&&void 0!==c.z&&(d.z=b.z+a*(c.z-b.z));return d},pointToString:function(a){var b=a.x+"/"+a.y;"undefined"!==typeof a.z&&(b+="/"+a.z);return b},pointsToString:function(a){return"["+a.map(qe.pointToString).join(", ")+"]"},copy:function(a){return JSON.parse(JSON.stringify(a))},angle:function(a,b,c){var d=b.x-a.x;b=b.y-a.y;var e=c.x-a.x;a=c.y-a.y;return ge(d*a-b*e,d*e+b*a)},round:function(a,b){a=""+a;var c=a.indexOf(".");return parseFloat(a.substring(0,c+1+b))},
dist:function(a,b){var c=a.x-b.x;a=a.y-b.y;return he(c*c+a*a)},closest:function(a,b){var c=ie(2,63),d,e;a.forEach(function(f,g){e=qe.dist(b,f);e<c&&(c=e,d=g)});return{mdist:c,mpos:d}},abcratio:function(a,b){if(2!==b&&3!==b)return!1;if("undefined"===typeof a)a=.5;else if(0===a||1===a)return a;a=ie(a,b)+ie(1-a,b);return ce((a-1)/a)},projectionratio:function(a,b){if(2!==b&&3!==b)return!1;if("undefined"===typeof a)a=.5;else if(0===a||1===a)return a;var c=ie(1-a,b);a=ie(a,b)+c;return c/a},lli8:function(a,
b,c,d,e,f,g,k){var h=(a-c)*(f-k)-(b-d)*(e-g);return 0==h?!1:{x:((a*d-b*c)*(e-g)-(a-c)*(e*k-f*g))/h,y:((a*d-b*c)*(f-k)-(b-d)*(e*k-f*g))/h}},lli4:function(a,b,c,d){return qe.lli8(a.x,a.y,b.x,b.y,c.x,c.y,d.x,d.y)},lli:function(a,b){return qe.lli4(a,a.c,b,b.c)},makeline:function(a,b){return new re(a.x,a.y,(a.x+b.x)/2,(a.y+b.y)/2,b.x,b.y)},findbbox:function(a){var b=ne,c=ne,d=oe,e=oe;a.forEach(function(f){f=f.bbox();b>f.x.min&&(b=f.x.min);c>f.y.min&&(c=f.y.min);d<f.x.max&&(d=f.x.max);e<f.y.max&&(e=f.y.max)});
return{x:{min:b,mid:(b+d)/2,max:d,size:d-b},y:{min:c,mid:(c+e)/2,max:e,size:e-c}}},shapeintersections:function(a,b,c,d,e){if(!qe.bboxoverlap(b,d))return[];var f=[],g=[c.startcap,c.forward,c.back,c.endcap];[a.startcap,a.forward,a.back,a.endcap].forEach(function(k){k.virtual||g.forEach(function(h){if(!h.virtual){var l=k.intersects(h,e);0<l.length&&(l.c1=k,l.c2=h,l.s1=a,l.s2=c,f.push(l))}})});return f},makeshape:function(a,b,c){var d=a.points.length,e=qe.makeline(b.points[b.points.length-1],a.points[0]);
d=qe.makeline(a.points[d-1],b.points[0]);var f={startcap:e,forward:a,back:b,endcap:d,bbox:qe.findbbox([e,a,b,d]),intersections:function(g){return qe.shapeintersections(f,f.bbox,g,g.bbox,c)}};return f},getminmax:function(a,b,c){if(!c)return{min:0,max:0};var d=ne,e=oe;-1===c.indexOf(0)&&(c=[0].concat(c));-1===c.indexOf(1)&&c.push(1);for(var f=0,g=c.length;f<g;f++){var k=c[f];k=a.get(k);k[b]<d&&(d=k[b]);k[b]>e&&(e=k[b])}return{min:d,mid:(d+e)/2,max:e,size:e-d}},align:function(a,b){var c=b.p1.x,d=b.p1.y,
e=-ge(b.p2.y-d,b.p2.x-c);return a.map(function(f){return{x:(f.x-c)*de(e)-(f.y-d)*ee(e),y:(f.x-c)*ee(e)+(f.y-d)*de(e)}})},roots:function(a,b){function c(k){return 0<=k&&1>=k}b=b||{p1:{x:0,y:0},p2:{x:1,y:0}};var d=a.length-1;a=qe.align(a,b);if(2===d){d=a[0].y;b=a[1].y;var e=a[2].y;a=d-2*b+e;return 0!==a?(e=-he(b*b-d*e),d=-d+b,[-(e+d)/a,-(-e+d)/a].filter(c)):b!==e&&0===a?[(2*b-e)/(2*b-2*e)].filter(c):[]}d=a[0].y;b=a[1].y;var f=a[2].y;e=-d+3*b-3*f+a[3].y;a=3*d-6*b+3*f;f=-3*d+3*b;if(qe.approximately(e,
0)){if(qe.approximately(a,0))return qe.approximately(f,0)?[]:[-d/f].filter(c);d=he(f*f-4*a*d);a*=2;return[(d-f)/a,(-f-d)/a].filter(c)}a/=e;f/=e;b=(3*f-a*a)/3;var g=b/3;d=(2*a*a*a-9*a*f+d/e*27)/27;e=d/2;f=e*e+g*g*g;if(0>f)return b=-b/3,b=he(b*b*b),d=-d/(2*b),e=fe(-1>d?-1:1<d?1:d),f=2*je(b),d=f*de(e/3)-a/3,b=f*de((e+le)/3)-a/3,a=f*de((e+2*le)/3)-a/3,[d,b,a].filter(c);if(0===f)return d=0>e?je(-e):-je(e),[2*d-a/3,-d-a/3].filter(c);b=he(f);d=je(-e+b);b=je(e+b);return[d-b-a/3].filter(c)},droots:function(a){if(3===
a.length){var b=a[0],c=a[1],d=a[2];a=b-2*c+d;return 0!==a?(d=-he(c*c-b*d),b=-b+c,[-(d+b)/a,-(-d+b)/a]):c!==d&&0===a?[(2*c-d)/(2*(c-d))]:[]}return 2===a.length&&(b=a[0],c=a[1],b!==c)?[b/(b-c)]:[]},curvature:function(a,b,c,d,e){var f=qe.compute(a,b);var g=qe.compute(a,c);var k=f.x*f.x+f.y*f.y;d?(g=he(ie(f.y*g.z-g.y*f.z,2)+ie(f.z*g.x-g.z*f.x,2)+ie(f.x*g.y-g.x*f.y,2)),k=ie(k+f.z*f.z,1.5)):(g=f.x*g.y-f.y*g.x,k=ie(k,1.5));if(0===g||0===k)return{k:0,r:0};f=g/k;g=k/g;if(!e){e=qe.curvature(a-.001,b,c,d,!0).k;
a=qe.curvature(a+.001,b,c,d,!0).k;var h=(a-f+(f-e))/2;var l=(ce(a-f)+ce(f-e))/2}return{k:f,r:g,dk:h,adk:l}},inflections:function(a){if(4>a.length)return[];a=qe.align(a,{p1:a[0],p2:a.slice(-1)[0]});var b=a[2].x*a[1].y,c=a[3].x*a[1].y,d=a[1].x*a[2].y;a=18*(-3*b+2*c+3*d-a[3].x*a[2].y);c=18*(3*b-c-3*d);b=18*(d-b);if(qe.approximately(a,0))return!qe.approximately(c,0)&&(a=-b/c,0<=a&&1>=a)?[a]:[];b=Math.sqrt(c*c-4*a*b);a*=2;return qe.approximately(a,0)?[]:[(b-c)/a,-(c+b)/a].filter(function(e){return 0<=
e&&1>=e})},bboxoverlap:function(a,b){for(var c=["x","y"],d=c.length,e=0,f,g,k;e<d;e++)if(f=c[e],g=a[f].mid,k=b[f].mid,f=(a[f].size+b[f].size)/2,ce(g-k)>=f)return!1;return!0},expandbox:function(a,b){b.x.min<a.x.min&&(a.x.min=b.x.min);b.y.min<a.y.min&&(a.y.min=b.y.min);b.z&&b.z.min<a.z.min&&(a.z.min=b.z.min);b.x.max>a.x.max&&(a.x.max=b.x.max);b.y.max>a.y.max&&(a.y.max=b.y.max);b.z&&b.z.max>a.z.max&&(a.z.max=b.z.max);a.x.mid=(a.x.min+a.x.max)/2;a.y.mid=(a.y.min+a.y.max)/2;a.z&&(a.z.mid=(a.z.min+a.z.max)/
2);a.x.size=a.x.max-a.x.min;a.y.size=a.y.max-a.y.min;a.z&&(a.z.size=a.z.max-a.z.min)},pairiteration:function(a,b,c){var d=a.bbox(),e=b.bbox(),f=c||.5;if(d.x.size+d.y.size<f&&e.x.size+e.y.size<f)return[(1E5*(a._t1+a._t2)/2|0)/1E5+"/"+(1E5*(b._t1+b._t2)/2|0)/1E5];a=a.split(.5);b=b.split(.5);b=[{left:a.left,right:b.left},{left:a.left,right:b.right},{left:a.right,right:b.right},{left:a.right,right:b.left}];b=b.filter(function(k){return qe.bboxoverlap(k.left.bbox(),k.right.bbox())});var g=[];if(0===b.length)return g;
b.forEach(function(k){g=g.concat(qe.pairiteration(k.left,k.right,f))});return g=g.filter(function(k,h){return g.indexOf(k)===h})},getccenter:function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=c.x-b.x,g=c.y-b.y,k=d*de(me)-e*ee(me);d=d*ee(me)+e*de(me);e=f*de(me)-g*ee(me);f=f*ee(me)+g*de(me);g=(a.x+b.x)/2;var h=(a.y+b.y)/2,l=(b.x+c.x)/2,n=(b.y+c.y)/2;k=qe.lli8(g,h,g+k,h+d,l,n,l+e,n+f);d=qe.dist(k,a);a=ge(a.y-k.y,a.x-k.x);b=ge(b.y-k.y,b.x-k.x);c=ge(c.y-k.y,c.x-k.x);if(a<c){if(a>b||b>c)a+=le;a>c&&(b=c,c=a,a=b)}else c<
b&&b<a?(b=c,c=a,a=b):c+=le;k.s=a;k.e=c;k.r=d;return k},numberSort:function(a,b){return a-b}};function se(a){this.curves=[];this._3d=!1;a&&(this.curves=a,this._3d=this.curves[0]._3d)}se.prototype.valueOf=function(){return this.toString()};se.prototype.toString=function(){return"["+this.curves.map(function(a){return qe.pointsToString(a.points)}).join(", ")+"]"};se.prototype.addCurve=function(a){this.curves.push(a);this._3d=this._3d||a._3d};
se.prototype.length=function(){return this.curves.map(function(a){return a.length()}).reduce(function(a,b){return a+b})};se.prototype.curve=function(a){return this.curves[a]};se.prototype.bbox=function(){for(var a=this.curves,b=a[0].bbox(),c=1;c<a.length;c++)qe.expandbox(b,a[c].bbox());return b};se.prototype.offset=function(a){var b=[];this.curves.forEach(function(c){b.push.apply(b,m.arrayFromIterable(c.offset(a)))});return new se(b)};
var te=Math,ue=te.abs,ve=te.min,we=te.max,xe=te.cos,ye=te.sin,ze=te.acos,Be=te.sqrt,Ce=Math.PI;
function re(a){var b=a&&a.forEach?a:Array.from(arguments).slice(),c=!1;if("object"===typeof b[0]){c=b.length;var d=[];b.forEach(function(l){["x","y","z"].forEach(function(n){"undefined"!==typeof l[n]&&d.push(l[n])})});b=d}var e=!1,f=b.length;if(c){if(4<c){if(1!==arguments.length)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");e=!0}}else if(6!==f&&8!==f&&9!==f&&12!==f&&1!==arguments.length)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");
e=this._3d=!e&&(9===f||12===f)||a&&a[0]&&"undefined"!==typeof a[0].z;c=this.points=[];for(var g=0,k=e?3:2;g<f;g+=k){var h={x:b[g],y:b[g+1]};e&&(h.z=b[g+2]);c.push(h)}b=this.order=c.length-1;f=this.dims=["x","y"];e&&f.push("z");this.dimlen=f.length;f=qe.align(c,{p1:c[0],p2:c[b]});c=qe.dist(c[0],c[b]);this._linear=f.reduce(function(l,n){return l+ue(n.y)},0)<c/50;this._lut=[];this._t1=0;this._t2=1;this.update()}
re.quadraticFromPoints=function(a,b,c,d){"undefined"===typeof d&&(d=.5);if(0===d)return new re(b,b,c);if(1===d)return new re(a,b,b);b=re.getABC(2,a,b,c,d);return new re(a,b.A,c)};
re.cubicFromPoints=function(a,b,c,d,e){"undefined"===typeof d&&(d=.5);var f=re.getABC(3,a,b,c,d);"undefined"===typeof e&&(e=qe.dist(b,f.C));var g=e*(1-d)/d,k=qe.dist(a,c),h=(c.x-a.x)/k;k=(c.y-a.y)/k;f=f.A;return new re(a,{x:a.x+(f.x+(b.x-e*h-f.x)/(1-d)-a.x)/d,y:a.y+(f.y+(b.y-e*k-f.y)/(1-d)-a.y)/d},{x:c.x+(f.x+(b.x+g*h-f.x)/d-c.x)/(1-d),y:c.y+(f.y+(b.y+g*k-f.y)/d-c.y)/(1-d)},c)};re.getUtils=function(){return qe};re.prototype.getUtils=function(){return re.getUtils()};re.prototype.valueOf=function(){return this.toString()};
re.prototype.toString=function(){return qe.pointsToString(this.points)};re.prototype.toSVG=function(){if(this._3d)return!1;for(var a=this.points,b=["M",a[0].x,a[0].y,2===this.order?"Q":"C"],c=1,d=a.length;c<d;c++)b.push(a[c].x),b.push(a[c].y);return b.join(" ")};re.prototype.setRatios=function(a){if(a.length!==this.points.length)throw Error("incorrect number of ratio values");this.ratios=a;this._lut=[]};re.prototype.verify=function(){var a=this.coordDigest();a!==this._print&&(this._print=a,this.update())};
re.prototype.coordDigest=function(){return this.points.map(function(a,b){return""+b+a.x+a.y+(a.z?a.z:0)}).join("")};re.prototype.update=function(){this._lut=[];this.dpoints=qe.derive(this.points,this._3d);this.computedirection()};re.prototype.computedirection=function(){var a=this.points;this.clockwise=0<qe.angle(a[0],a[this.order],a[1])};re.prototype.length=function(){return qe.length(this.derivative.bind(this))};
re.getABC=function(a,b,c,d,e){a=void 0===a?2:a;e=void 0===e?.5:e;var f=qe.projectionratio(e,a),g=1-f;f={x:f*b.x+g*d.x,y:f*b.y+g*d.y};a=qe.abcratio(e,a);return{A:{x:c.x+(c.x-f.x)/a,y:c.y+(c.y-f.y)/a},B:c,C:f,S:b,E:d}};re.prototype.getABC=function(a,b){b=b||this.get(a);return re.getABC(this.order,this.points[0],b,this.points[this.order],a)};
re.prototype.getLUT=function(a){this.verify();a=a||100;if(this._lut.length===a)return this._lut;a++;this._lut=[];for(var b=0,c,d;b<a;b++)d=b/(a-1),c=this.compute(d),c.t=d,this._lut.push(c);return this._lut};re.prototype.on=function(a,b){b=b||5;for(var c=this.getLUT(),d=[],e=0,f;e<c.length;e++)f=c[e],qe.dist(f,a)<b&&d.push(f);return d.length?NaN/d.length:!1};
re.prototype.project=function(a){var b=this.getLUT(),c=b.length-1,d=qe.closest(b,a),e=d.mpos;b=(e+1)/c;var f=.1/c;d=d.mdist;e=c=(e-1)/c;for(d+=1;c<b+f;c+=f){var g=this.compute(c);g=qe.dist(a,g);g<d&&(d=g,e=c)}e=0>e?0:1<e?1:e;g=this.compute(e);g.t=e;g.d=d;return g};re.prototype.get=function(a){return this.compute(a)};re.prototype.point=function(a){return this.points[a]};
re.prototype.compute=function(a){return this.ratios?qe.computeWithRatios(a,this.points,this.ratios,this._3d):qe.compute(a,this.points,this._3d,this.ratios)};re.prototype.raise=function(){for(var a=this.points,b=[a[0]],c=a.length,d=1,e,f;d<c;d++)e=a[d],f=a[d-1],b[d]={x:(c-d)/c*e.x+d/c*f.x,y:(c-d)/c*e.y+d/c*f.y};b[c]=a[c-1];return new re(b)};re.prototype.derivative=function(a){return qe.compute(a,this.dpoints[0],this._3d)};re.prototype.dderivative=function(a){return qe.compute(a,this.dpoints[1],this._3d)};
re.prototype.align=function(){var a=this.points;return new re(qe.align(a,{p1:a[0],p2:a[a.length-1]}))};re.prototype.curvature=function(a){return qe.curvature(a,this.dpoints[0],this.dpoints[1],this._3d)};re.prototype.inflections=function(){return qe.inflections(this.points)};re.prototype.normal=function(a){return this._3d?this.__normal3(a):this.__normal2(a)};re.prototype.__normal2=function(a){a=this.derivative(a);var b=Be(a.x*a.x+a.y*a.y);return{x:-a.y/b,y:a.x/b}};
re.prototype.__normal3=function(a){var b=this.derivative(a);a=this.derivative(a+.01);var c=Be(b.x*b.x+b.y*b.y+b.z*b.z),d=Be(a.x*a.x+a.y*a.y+a.z*a.z);b.x/=c;b.y/=c;b.z/=c;a.x/=d;a.y/=d;a.z/=d;c=a.y*b.z-a.z*b.y;d=a.z*b.x-a.x*b.z;a=a.x*b.y-a.y*b.x;var e=Be(c*c+d*d+a*a);c/=e;d/=e;a/=e;a=[c*c,c*d-a,c*a+d,c*d+a,d*d,d*a-c,c*a-d,d*a+c,a*a];return{x:a[0]*b.x+a[1]*b.y+a[2]*b.z,y:a[3]*b.x+a[4]*b.y+a[5]*b.z,z:a[6]*b.x+a[7]*b.y+a[8]*b.z}};
re.prototype.hull=function(a){var b=this.points,c=[],d=0;c[d++]=b[0];c[d++]=b[1];c[d++]=b[2];for(3===this.order&&(c[d++]=b[3]);1<b.length;){var e=[];for(var f=0,g,k=b.length-1;f<k;f++)g=qe.lerp(a,b[f],b[f+1]),c[d++]=g,e.push(g);b=e}return c};
re.prototype.split=function(a,b){if(0===a&&b)return this.split(b).left;if(1===b)return this.split(a).right;var c=this.hull(a);c={left:2===this.order?new re([c[0],c[3],c[5]]):new re([c[0],c[4],c[7],c[9]]),right:2===this.order?new re([c[5],c[4],c[2]]):new re([c[9],c[8],c[6],c[3]]),span:c};c.left._t1=qe.map(0,0,1,this._t1,this._t2);c.left._t2=qe.map(a,0,1,this._t1,this._t2);c.right._t1=qe.map(a,0,1,this._t1,this._t2);c.right._t2=qe.map(1,0,1,this._t1,this._t2);if(!b)return c;b=qe.map(b,a,1,0,1);return c.right.split(b).left};
re.prototype.extrema=function(){var a={},b=[];this.dims.forEach(function(c){function d(f){return f[c]}var e=this.dpoints[0].map(d);a[c]=qe.droots(e);3===this.order&&(e=this.dpoints[1].map(d),a[c]=a[c].concat(qe.droots(e)));a[c]=a[c].filter(function(f){return 0<=f&&1>=f});b=b.concat(a[c].sort(qe.numberSort))}.bind(this));a.values=b.sort(qe.numberSort).filter(function(c,d){return b.indexOf(c)===d});return a};
re.prototype.bbox=function(){var a=this.extrema(),b={};this.dims.forEach(function(c){b[c]=qe.getminmax(this,c,a[c])}.bind(this));return b};re.prototype.overlaps=function(a){var b=this.bbox();a=a.bbox();return qe.bboxoverlap(b,a)};
re.prototype.offset=function(a,b){if("undefined"!==typeof b){var c=this.get(a),d=this.normal(a),e={c:c,n:d,x:c.x+d.x*b,y:c.y+d.y*b};this._3d&&(e.z=c.z+d.z*b);return e}if(this._linear){var f=this.normal(0);b=this.points.map(function(g){var k={x:g.x+a*f.x,y:g.y+a*f.y};g.z&&f.z&&(k.z=g.z+a*f.z);return k});return[new re(b)]}return this.reduce().map(function(g){return g._linear?g.offset(a)[0]:g.scale(a)})};
re.prototype.simple=function(){if(3===this.order){var a=qe.angle(this.points[0],this.points[3],this.points[1]),b=qe.angle(this.points[0],this.points[3],this.points[2]);if(0<a&&0>b||0>a&&0<b)return!1}a=this.normal(0);b=this.normal(1);var c=a.x*b.x+a.y*b.y;this._3d&&(c+=a.z*b.z);return ue(ze(c))<Ce/3};
re.prototype.reduce=function(){var a,b=0,c=0,d=[],e=[],f=this.extrema().values;-1===f.indexOf(0)&&(f=[0].concat(f));-1===f.indexOf(1)&&f.push(1);b=f[0];for(a=1;a<f.length;a++){c=f[a];var g=this.split(b,c);g._t1=b;g._t2=c;d.push(g);b=c}d.forEach(function(k){for(c=b=0;1>=c;)for(c=b+.01;1.01>=c;c+=.01)if(g=k.split(b,c),!g.simple()){c-=.01;if(.01>ue(b-c))return[];g=k.split(b,c);g._t1=qe.map(b,0,1,k._t1,k._t2);g._t2=qe.map(c,0,1,k._t1,k._t2);e.push(g);b=c;break}1>b&&(g=k.split(b,1),g._t1=qe.map(b,0,1,
k._t1,k._t2),g._t2=k._t2,e.push(g))});return e};re.prototype.translate=function(a,b,c){c="number"===typeof c?c:b;var d=this.order,e=this.points.map(function(f,g){return(1-g/d)*b+g/d*c});return new re(this.points.map(function(f,g){return{x:f.x+a.x*e[g],y:f.y+a.y*e[g]}}))};
re.prototype.scale=function(a){var b=this,c=this.order,d=!1;"function"===typeof a&&(d=a);if(d&&2===c)return this.raise().scale(d);var e=this.clockwise,f=this.points;if(this._linear)return this.translate(this.normal(0),d?d(0):a,d?d(1):a);var g=d?d(0):a,k=d?d(1):a,h=[this.offset(0,10),this.offset(1,10)],l=[],n=qe.lli4(h[0],h[0].c,h[1],h[1].c);if(!n)throw Error("cannot scale this curve. Try reducing it first.");[0,1].forEach(function(p){var r=l[p*c]=qe.copy(f[p*c]);r.x+=(p?k:g)*h[p].n.x;r.y+=(p?k:g)*
h[p].n.y});if(!d)return[0,1].forEach(function(p){if(2!==c||!p){var r=l[p*c],q=b.derivative(p);l[p+1]=qe.lli4(r,{x:r.x+q.x,y:r.y+q.y},n,f[p+1])}}),new re(l);[0,1].forEach(function(p){if(2!==c||!p){var r=f[p+1],q=r.x-n.x,w=r.y-n.y,x=d?d((p+1)/c):a;d&&!e&&(x=-x);var t=Be(q*q+w*w);l[p+1]={x:r.x+q/t*x,y:r.y+w/t*x}}});return new re(l)};
re.prototype.outline=function(a,b,c,d){function e(D,H,G,K,W){return function(O){var ea=H-D;return qe.map(O,0,1,D+K/G*ea,D+(K+W)/G*ea)}}b=void 0===b?a:b;if(this._linear){var f=this.normal(0),g=this.points[0],k=this.points[this.points.length-1];void 0===c&&(c=a,d=b);var h={x:g.x+f.x*a,y:g.y+f.y*a};var l={x:k.x+f.x*c,y:k.y+f.y*c};var n={x:(h.x+l.x)/2,y:(h.y+l.y)/2};var p=[h,n,l];h={x:g.x-f.x*b,y:g.y-f.y*b};l={x:k.x-f.x*d,y:k.y-f.y*d};n={x:(h.x+l.x)/2,y:(h.y+l.y)/2};f=[l,n,h];g=qe.makeline(f[2],p[0]);
k=qe.makeline(p[2],f[0]);p=[g,new re(p),k,new re(f)];return new se(p)}f=this.reduce();p=f.length;var r=[],q=[],w,x=0,t=this.length(),A="undefined"!==typeof c&&"undefined"!==typeof d;f.forEach(function(D){var H=D.length();A?(r.push(D.scale(e(a,c,t,x,H))),q.push(D.scale(e(-b,-d,t,x,H)))):(r.push(D.scale(a)),q.push(D.scale(-b)));x+=H});q=q.map(function(D){w=D.points;D.points=w[3]?[w[3],w[2],w[1],w[0]]:[w[2],w[1],w[0]];return D}).reverse();f=r[p-1].points[r[p-1].points.length-1];g=q[0].points[0];p=qe.makeline(q[p-
1].points[q[p-1].points.length-1],r[0].points[0]);f=qe.makeline(f,g);p=[p].concat(r).concat([f]).concat(q);return new se(p)};re.prototype.outlineshapes=function(a,b,c){a=this.outline(a,b||a).curves;b=[];for(var d=1,e=a.length;d<e/2;d++){var f=qe.makeshape(a[d],a[e-d],c);f.startcap.virtual=1<d;f.endcap.virtual=d<e/2-1;b.push(f)}return b};
re.prototype.intersects=function(a,b){if(!a)return this.selfintersects(b);if(a.p1&&a.p2)return this.lineIntersects(a);a instanceof re&&(a=a.reduce());return this.curveintersects(this.reduce(),a,b)};re.prototype.lineIntersects=function(a){var b=this,c=ve(a.p1.x,a.p2.x),d=ve(a.p1.y,a.p2.y),e=we(a.p1.x,a.p2.x),f=we(a.p1.y,a.p2.y);return qe.roots(this.points,a).filter(function(g){g=b.get(g);return qe.between(g.x,c,e)&&qe.between(g.y,d,f)})};
re.prototype.selfintersects=function(a){for(var b=this.reduce(),c=b.length-2,d=[],e=0,f,g;e<c;e++)f=b.slice(e,e+1),g=b.slice(e+2),f=this.curveintersects(f,g,a),d.push.apply(d,m.arrayFromIterable(f));return d};re.prototype.curveintersects=function(a,b,c){var d=[];a.forEach(function(f){b.forEach(function(g){f.overlaps(g)&&d.push({left:f,right:g})})});var e=[];d.forEach(function(f){f=qe.pairiteration(f.left,f.right,c);0<f.length&&(e=e.concat(f))});return e};
re.prototype.arcs=function(a){return this._iterate(a||.5,[])};re.prototype._error=function(a,b,c,d){var e=(d-c)/4;c=this.get(c+e);d=this.get(d-e);b=qe.dist(a,b);c=qe.dist(a,c);a=qe.dist(a,d);return ue(c-b)+ue(a-b)};
re.prototype._iterate=function(a,b){var c=0;do{var d=0;var e=1;var f=this.get(c);var g=void 0;var k=!1;var h=1;do{var l=k;var n=g;var p=(c+e)/2;g=this.get(p);k=this.get(e);g=qe.getccenter(f,g,k);g.interval={start:c,end:e};k=this._error(g,f,c,e)<=a;(l=l&&!k)||(h=e);if(k){if(1<=e){g.interval.end=h=1;n=g;1<e&&(c={x:g.x+g.r*xe(g.e),y:g.y+g.r*ye(g.e)},g.e+=qe.angle({x:g.x,y:g.y},c,this.get(1)));break}e+=(e-c)/2}else e=p}while(!l&&100>d++);if(100<=d)break;n=n?n:g;b.push(n);c=h}while(1>e);return b};
m.global.Object.defineProperties(re,{PolyBezier:{configurable:!0,enumerable:!0,get:function(){return se}}});var De={linearToGamma:function(a){return.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055},gammaToLinear:function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},rgbmEncode:function(a,b){var c=Math.sqrt(a.r)/2.82842712,d=Math.sqrt(a.g)/2.82842712;a=Math.sqrt(a.b)/2.82842712;var e=Math.max(Math.max(c,d),a);e=C.Math.clamp(e,1/255,1);e=Math.ceil(255*e)/255;b.set(c/e,d/e,a/e,1-e)},ycocgmEncode:function(a,b,c){var d=.25*a.r+.5*a.g+.25*a.b,e=.5*a.r-.5*a.b;a=-.25*a.r+.5*a.g-.25*a.b;e*=.125;a*=.125;
var f=Math.max(Math.abs(e),Math.abs(a));f=.03125>f?16:.0625>f?8:.125>f?4:.25>f?2:1;d=Math.sqrt(.125*d);d<c?(d*=1/c,c=15):(d=1/(1-c)*(d-c)*13,c=d|0,d-=c,c++);b.set(d,e*f+.5,a*f+.5,1/255*((16-16/f|0)+16*c))}};C.Color.prototype.copyGammaToLinear=void 0;C.Color.prototype.copyLinearToGamma=void 0;C.Color.prototype.convertLinearToGamma=void 0;C.Color.prototype.convertGammaToLinear=function(){this.r=De.gammaToLinear(this.r);this.g=De.gammaToLinear(this.g);this.b=De.gammaToLinear(this.b)};
C.Color.prototype.roundChannels=function(){this.r=Ua(this.r,3);this.g=Ua(this.g,3);this.b=Ua(this.b,3);return this};function Ee(a,b,c){C.Euler.call(this,b,c,a,"ZXY")}Ee.prototype=Object.create(C.Euler.prototype);Ee.prototype.constructor=Ee;Object.defineProperty(Ee.prototype,"yaw",{get:function(){return this.z},set:function(a){this.z=a}});Object.defineProperty(Ee.prototype,"pitch",{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(Ee.prototype,"roll",{get:function(){return this.y},set:function(a){this.y=a}});
Object.defineProperty(Ee.prototype,"yawDeg",{get:function(){return C.Math.radToDeg(this.yaw)},set:function(a){this.yaw=C.Math.degToRad(a)}});Object.defineProperty(Ee.prototype,"pitchDeg",{get:function(){return C.Math.radToDeg(this.pitch)},set:function(a){this.pitch=C.Math.degToRad(a)}});Object.defineProperty(Ee.prototype,"rollDeg",{get:function(){return C.Math.radToDeg(this.roll)},set:function(a){this.roll=C.Math.degToRad(a)}});
Ee.prototype.setFromDegTriple=function(a){var b=C.Math.degToRad(a[0]),c=C.Math.degToRad(a[1]);a=C.Math.degToRad(a[2]);this.set(c,a,b);return this};Ee.prototype.toDegTriple=function(){return[this.yawDeg,this.pitchDeg,this.rollDeg]};Ee.prototype.setFromDirection=function(a){this.set(Math.asin(a.z),0,Math.atan2(-a.x,a.y));return this};Ee.prototype.toQuaternion=function(){var a=new C.Quaternion;a.setFromEuler(this);return a};
Ee.prototype.toRotationMatrix=function(){var a=new C.Matrix4;a.makeRotationFromEuler(this);return a};var Fe=new C.Sphere;function Ge(){this.planes=[new C.Plane,new C.Plane,new C.Plane,new C.Plane,new C.Plane,new C.Plane]}
Ge.prototype={constructor:Ge,setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],k=c[5],h=c[6],l=c[7],n=c[8],p=c[9],r=c[10],q=c[11],w=c[12],x=c[13],t=c[14];c=c[15];b[0].setComponents(f-a,l-g,q-n,c-w).normalize();b[1].setComponents(f+a,l+g,q+n,c+w).normalize();b[2].setComponents(f+d,l+k,q+p,c+x).normalize();b[3].setComponents(f-d,l-k,q-p,c-x).normalize();b[4].setComponents(f-e,l-h,q-r,c-t).normalize();b[5].setComponents(f+e,l+h,q+r,c+t).normalize();return this},
intersectsObject:function(a){var b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere();a.matrixWorld?(Fe.copy(b.boundingSphere),Fe.applyMatrix4(a.matrixWorld),a=Fe):a=b.boundingSphere;return this.intersectsSphere(a)},nearPlaneDistanceToCenter:function(a){var b=a.geometry,c=this.planes[5];a.matrixWorld?(Fe.copy(b.boundingSphere),Fe.applyMatrix4(a.matrixWorld),a=Fe):a=b.boundingSphere;return c.distanceToPoint(a.center)},intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;
for(var d=0;6>d;d+=1)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new C.Vector3,b=new C.Vector3;return function(c){for(var d=this.planes,e=0;6>e;e+=1){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?c.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a);f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=
this.planes,c=0;6>c;c+=1)if(0>b[c].distanceToPoint(a))return!1;return!0}};var He=new C.Vector3;function Ie(a){return Math.round(127*C.Math.clamp(a,-1,1))}function Je(a){return 127>=a?1:32767>=a?2:4}function Ke(a,b){if(b.empty())b.copy(a);else{var c=b.center.distanceTo(a.center);if(a.radius>b.radius){var d=a;a=b}else d=b;var e=(d.radius+a.radius+c)/2;e<=d.radius?b.copy(d):(c=(e-d.radius)/c,console.assert(0<c),He.copy(a.center).sub(d.center).multiplyScalar(c),b.center.copy(d.center).add(He),b.radius=e)}}function Le(a,b,c){return a+c*(b-a)};function Me(a){Dd.call(this,"object_distance_vertex.glsl",a?"object_id_fragment.glsl":"object_id_distance_fragment.glsl");this.doNotOverrideSide=!0;this.uniforms={objectId:{type:"i",value:null}}}Me.prototype=Object.create(Dd.prototype);Me.prototype.constructor=Me;Me.prototype.refreshPerObjectUniforms=function(a){this.uniforms.objectId.value=a.visibilityId;return!0};function Ne(a){var b,c,d,e;this.set=function(f,g,k){console.assert(void 0===b&&void 0===c&&void 0===d&&void 0===e);b=a.autoClear;c=a.autoClearColor;d=a.autoClearDepth;e=a.autoClearStencil;a.autoClear=f||g||k;a.autoClearColor=f;a.autoClearDepth=g;a.autoClearStencil=k};this.restore=function(){console.assert(void 0!==b&&void 0!==c&&void 0!==d&&void 0!==e);a.autoClear=b;a.autoClearColor=c;a.autoClearDepth=d;a.autoClearStencil=e;e=d=c=b=void 0}};function Oe(a){var b=new C.Color,c=null,d=!1;this.set=function(e,f){console.assert(!d);d=!0;b.copy(a.getClearColor());c=a.getClearAlpha();a.setClearColor(e,f)};this.restore=function(){console.assert(d);d=!1;a.setClearColor(b,c)}};function Pe(a,b,c){this.ray=new C.Ray(a,b);this.far=c||Infinity;this.ignoreVisibility=this.onlyGroundCollisions=this.respectColliderSettings=!1}function Qe(){this.distance=Infinity;this.point=new C.Vector3;this.object=null}
function Re(a,b){function c(p,r){if(!r.ignoreVisibility&&!p.visible)return!1;var q=p.node||n;if(q.disableCollisions&&r.respectColliderSettings||!q.ground&&r.onlyGroundCollisions)return!1;q=r.ray;if(p.matrixWorld)return!0;var w=p.geometry.boundingSphere;if(w.distanceToPoint(q.origin)>r.far||!1===q.isIntersectionSphere(w))return!1;p=p.geometry.boundingBox;return p.distanceToPoint(q.origin)>r.far||!q.isIntersectionBox(p)?!1:!0}var d=a.createRenderTarget(1,1,{format:Mb.RGBA,magFilter:Mb.NEAREST,minFilter:Mb.NEAREST,
stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),e=new Uint8Array(4),f=new Ne(a),g=new Oe(a),k=new C.Color(16777215),h=new Me(!1),l=new C.PerspectiveCamera(1,1,b.near,b.far),n={disableCollisions:!1,ground:!1};this.closestIntersection=function(p,r,q){for(var w=[],x=0;x<p.length;x+=1){var t=p[x];console.assert(null===t.visibilityId);c(t,r)&&(t.visibilityId=w.length,w.push(t))}if(0===w.length)return!1;l.position.set(0,0,0);l.lookAt(r.ray.direction);l.position.copy(r.ray.origin);l.updateMatrixWorld();
f.set(!0,!0,!1);g.set(k);p=a.sortObjects;a.sortObjects=!1;a.renderMeshes(w,h,l,d,!1,r.ignoreVisibility);a.sortObjects=p;g.restore();f.restore();a.readPixels(1,1,e);a.setRenderTarget(null);p=256*e[0]+e[1];x=e[2]+e[3]/255;for(t=0;t<w.length;t+=1)w[t].visibilityId=null;if(65535===p||x>r.far)return!1;console.assert(p<w.length);q.object=w[p];q.distance=x;q.point.copy(r.ray.direction).multiplyScalar(x).add(r.ray.origin);return!0}};function Se(a,b){function c(){return!1}function d(w,x){var t=g.callbacks.onPointerDown(w,x);k=!0;h=w;l=x;return t}function e(w,x,t){var A=g.callbacks.onPointerUp(w,x);if(k){var D=Date.now();A=null!==r&&.03>=Math.abs(n-h)&&.03>=Math.abs(p-l)&&500>=Math.abs(r-D)&&g.callbacks.onDoubleClick!==c?g.callbacks.onDoubleClick(w,x)||A:g.callbacks.onClick(w,x,t)||A;r=D;n=w;p=x}return A}function f(w,x){var t=g.callbacks.onPointerMove(w,x);!k||.03>=Math.abs(w-h)&&.03>=Math.abs(x-l)||(k=!1,r=null);return t}var g=
this,k=!1,h=null,l=null,n=null,p=null,r=null;this.callbacks={onClick:c,onDoubleClick:c,onPointerDown:c,onPointerUp:c,onPointerMove:c};var q=!1;this.isEnabled=function(){return q};this.enable=function(){q||(a.addPointerDownListener(d,b),a.addPointerUpListener(e,b),a.addPointerMoveListener(f,b),q=!0)};this.disable=function(){q&&(a.removePointerDownListener(d),a.removePointerUpListener(e),a.removePointerMoveListener(f),q=!1)};this.enable()};/*
 Copyright (C) 2019-present Shapespark
*/
function Te(a,b,c){a=a.findSkyMesh(S.EDITOR_CONTROLLED_SKY_NAME);c.set(0,-a.radius,0);c.applyEuler(b);c.add(a.position)}function Ue(a,b){b.radius=0;a.visitSubtree(function(c){c.mesh&&Ke(c.mesh.geometry.boundingSphere,b)})}function Ve(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c+=1)if(a[c]!==b[c])return!1;return!0};var We=new qd("vec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\n                     inout float opacity) {\n  return addSpecular(baseColor, totalIntensity, opacity);\n}\nvec3 getBaseColorHook(out float alpha) {\n  return getBaseColor(alpha);\n}"),Xe=new qd("void modifyMvPositionHook(inout vec4 mvPosition, in vec3 normal) {}"),Ye=new C.Vector3(0,0,0),Ze=new C.Vector4(0,0,1,1),$e={autodetect:"autodetect",enabled:"enabled",disabled:"disabled"},af={basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",
occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"};
function bf(){Dd.call(this,"standard_material_vertex.glsl","standard_material_fragment.glsl",this.vertexShaderHooks(),this.fragmentShaderHooks());this.type="standard";this.merged=!1;this._opacity=1;Object.defineProperty(this,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity=.99<a?1:a;this.configureTransparency();this.setUniforms();this._updated()}});this._cutoutMaskThreshold=.5;Object.defineProperty(this,"cutoutMaskThreshold",{get:function(){return this._cutoutMaskThreshold},
set:function(a){this._cutoutMaskThreshold=a;this.setUniforms();this._updated()}});this._cutoutMode=$e.autodetect;this.baseColor=new C.Color(16777215);this._baseColorTexture=null;this._baseColorTextureCorrection=this.planarReflector=!1;this._baseColorTextureContrast=0;this.baseColorTextureHslAdjustment={h:0,s:0,l:0};this._baseColorCorrectionUniform=new C.Vector4;this._emissive=!1;this._emissionStrength=1;this._reflective=!0;this._roughness=1;this._metallic=0;this.cubeCameraIndex=null;this._lastUsedLightProbeIds=
[];this._haveTextureLod=Bc.gl.textureLod;this._mipLevel1=this._mipLevel0=null;this.disableLightProbe=!1;this._envMapProject=!0;this._bumpScale=.001;this.parallaxCorrection=!1;this.parallaxMode="basic";this.parallaxScale=-.03;this.parallaxMinLayers=10;this.parallaxMaxLayers=15;this._uvOffsetScale=this._headLight=null;this._repeatableTexturesRequired=!1;this.highlight=S.EDIT_MODE?S.EDITOR_SELECTION_COLOR:null;this._highlightMix=0;this.doNotImport={baseColor:!1,opacity:!1};this._alphaInLowerHalf=!1;
this._chromaKeyEnabled=void 0;this.chromaKeyColor=(new C.Color).setRGB(0,.94,0);this._chromaKeyDelta=new C.Vector3(.1,.1,.1);this._chromaKeyDeltaCoeff=new C.Vector3;this.toneMappingSupported=this.exposureAndGammaSupported=this.colorMapSupported=this.hdrOutputSupported=this.fogSupported=this.lightMapSupported=!0;this.usePbr=!S.NO_PBR}bf.prototype=Object.create(Dd.prototype);bf.prototype.constructor=bf;
bf.prototype.addTextureProperty=function(a){var b="_"+a;Object.defineProperty(this,a,{get:function(){return this[b]||null},set:function(c){var d=this;(this[b]=c)?c.addLoadedListener(function(){d.setUniforms();d._updated();d=c=null}):(d.setUniforms(),d._updated())}})};bf.prototype.addTextureProperty("roughnessTexture");bf.prototype.addTextureProperty("metallicTexture");bf.prototype.addTextureProperty("bumpTexture");bf.prototype.fragmentShaderHooks=function(){return We};
bf.prototype.vertexShaderHooks=function(){return Xe};bf.prototype._useChromaKey=function(){return!(!this.isAnimated||!this.chromaKeyEnabled)};bf.prototype._useAlphaInLowerHalf=function(){return!(!this.isAnimated||!this.alphaInLowerHalf)};bf.prototype._useBaseColorTextureAsCutout=function(){var a=this._baseColorTexture;return 1===this.opacity&&(a&&a.isCutout||this._useAlphaInLowerHalf()||this._useChromaKey())};
bf.prototype.configureTransparency=function(){var a=this._baseColorTexture;a=a&&(a.hasAlpha||this._useAlphaInLowerHalf()||this._useChromaKey());this.transparent=1>this.opacity||a;a=!!(this._useBaseColorTextureAsCutout()&&this._cutoutMode===$e.autodetect||this._cutoutMode===$e.enabled);this.transparent?(this.blending=C.NormalBlending,this.transparentRenderOrder=a?0:1):this.blending=C.NoBlending;this.depthWrite=!this.transparent||a;this.condDefine(a,"USE_CUTOUT_MASK")};
Object.defineProperty(bf.prototype,"alphaInLowerHalf",{get:function(){return this._alphaInLowerHalf},set:function(a){this._alphaInLowerHalf=a;this.configureTransparency();this.setUniforms();this._updated()}});bf.prototype.getCutoutMode=function(){return this._cutoutMode};bf.prototype.setCutoutMode=function(a){this._cutoutMode=a;this.configureTransparency();this.setUniforms();this._updated()};
Object.defineProperty(bf.prototype,"chromaKeyEnabled",{get:function(){return!!this._chromaKeyEnabled},set:function(a){this._chromaKeyEnabled=!!a;this.configureTransparency();this.setUniforms();this._updated()}});bf.prototype.setChromaKeyColorRGB=function(a,b,c){this.chromaKeyColor.setRGB(a,b,c);this.setUniforms();this._updated()};bf.prototype.getChromaKeyDeltaComponent=function(a){return this._chromaKeyDelta.getComponent(a)};
bf.prototype.setChromaKeyDeltaComponent=function(a,b){this._chromaKeyDelta.setComponent(a,b);this.setUniforms();this._updated()};Object.defineProperty(bf.prototype,"isAnimated",{get:function(){var a=this.baseColorTexture;return a&&a.isAnimated}});Object.defineProperty(bf.prototype,"isPlaying",{get:function(){var a=this.baseColorTexture;return a&&a.isAnimated&&a.isPlaying}});bf.prototype.rewind=function(){this.baseColorTexture.rewind()};
bf.prototype.play=function(){console.assert(this.isAnimated);var a=this.baseColorTexture.isPlaying;this.baseColorTexture.play();this.baseColorTexture.isPlaying!==a&&this._updated()};bf.prototype.pause=function(){console.assert(this.isAnimated);var a=this.baseColorTexture.isPlaying;this.baseColorTexture.pause();this.baseColorTexture.isPlaying!==a&&this._updated()};bf.prototype.sleepAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.sleepAnimation()};
bf.prototype.wakeAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.wakeAnimation()};Object.defineProperty(bf.prototype,"doubleSided",{get:function(){return this.side===C.DoubleSide},set:function(a){this.side=a?C.DoubleSide:C.FrontSide;this.setUniforms();this._updated()}});Object.defineProperty(bf.prototype,"envMapMirror",{get:function(){return 0===this.roughness&&!this.roughnessTexture}});
Object.defineProperty(bf.prototype,"highlightMix",{get:function(){return this._highlightMix},set:function(a){a!==this._highlightMix&&(this._highlightMix=a,this.uniforms.highlightMix.value=a)}});
Object.defineProperty(bf.prototype,"baseColorTexture",{get:function(){return this._baseColorTexture},set:function(a){var b=this;(this._baseColorTexture=a)?a.addLoadedListener(function(){b.configureTransparency();b._repeatableTexturesRequired&&b.ensureTexturesRepeatable();b.setUniforms();b._updated();b=a=null}):(b.setUniforms(),b._updated())}});
Object.defineProperty(bf.prototype,"baseColorTextureCorrection",{get:function(){return this._baseColorTextureCorrection},set:function(a){this._baseColorTextureCorrection=a;this.setUniforms();this._updated()}});Object.defineProperty(bf.prototype,"baseColorTextureContrast",{get:function(){return this._baseColorTextureContrast},set:function(a){this._baseColorTextureContrast=a;this.setUniforms();this._updated()}});
bf.prototype.setBaseColorTextureHslAdjustment=function(a,b,c){this.baseColorTextureHslAdjustment.h=a;this.baseColorTextureHslAdjustment.s=b;this.baseColorTextureHslAdjustment.l=c;this.setUniforms();this._updated()};Object.defineProperty(bf.prototype,"emissive",{get:function(){return this._emissive},set:function(a){this._emissive=a;this.setUniforms();this._updated()}});
Object.defineProperty(bf.prototype,"emissionStrength",{get:function(){return this._emissionStrength},set:function(a){this._emissionStrength=a;this.setUniforms();this._updated()}});Object.defineProperty(bf.prototype,"headLight",{get:function(){return this._headLight},set:function(a){a!==this._headLight&&(this._headLight=a,this.setUniforms(),this._updated())}});
Object.defineProperty(bf.prototype,"reflective",{get:function(){return this._reflective},set:function(a){a!==this._reflective&&(this._reflective=a,this.setUniforms(),this._updated())}});Object.defineProperty(bf.prototype,"roughness",{get:function(){return this._roughness},set:function(a){this._roughness=a;this.setUniforms();this._updated()}});Object.defineProperty(bf.prototype,"metallic",{get:function(){return this._metallic},set:function(a){this._metallic=a;this.setUniforms();this._updated()}});
Object.defineProperty(bf.prototype,"envMapProject",{get:function(){return this._envMapProject},set:function(a){this._envMapProject=a;this.setUniforms();this._updated()}});Object.defineProperty(bf.prototype,"bumpScale",{get:function(){return this._bumpScale},set:function(a){this._bumpScale=a;this.setUniforms();this._updated()}});
Object.defineProperty(bf.prototype,"uvOffsetAndScaleEnabled",{get:function(){return null!==this._uvOffsetScale},set:function(a){a?this.setUvOffsetAndScale(Ze):(this._uvOffsetScale=null,this.setUniforms(),this._updated())}});bf.prototype.setDoNotImport=function(a,b){this.doNotImport[a]=b;this.setUniforms();this._updated()};bf.prototype.isLightProbeDisabled=function(){var a=!0===this.transparent&&!0===this.doubleSided;return this.disableLightProbe||!this.reflective||a};
bf.prototype._setLightProbeUniforms=function(){if(S.ENABLE_REFLECTION_PROBES_BLENDING)for(var a=0;a<S.MAX_BLENDED_REFLECTION_PROBES;a++)this.setUniform("envMap["+a+"]","t",null);else this.setUniform("envMap","t",null);if(!this.condDefine(this._haveTextureLod,"HAVE_TEXTURE_LOD"))if(a=S.LIGHT_PROBE_MIPS_COUNT-1,this._mipLevel0=Math.floor(this.roughness*a),this._mipLevel1=Math.min(this._mipLevel0+1,a),S.ENABLE_REFLECTION_PROBES_BLENDING)for(a=0;a<S.MAX_BLENDED_REFLECTION_PROBES;a++)this.setUniform("envMap2["+
a+"]","t",null);else this.setUniform("envMap2","t",null);this.envMapMirror?this.setUniform("envMipsCount","f",1):this.setUniform("envMipsCount","f",0);if(this.condDefine(this.envMapProject,"USE_ENVMAP_PROJECT"))if(this.condDefine(S.ENABLE_REFLECTION_PROBES_BLENDING,"USE_REFLECTION_PROBE_BLENDING"))for(this.addDefine("MAX_BLENDED_REFLECTION_PROBES "+S.MAX_BLENDED_REFLECTION_PROBES),a=0;a<S.MAX_BLENDED_REFLECTION_PROBES;a++)this.setUniform("reflectionProbe["+a+"].boxMin","v3",Ye),this.setUniform("reflectionProbe["+
a+"].boxMax","v3",Ye),this.setUniform("reflectionProbe["+a+"].posW","v3",Ye);else this.setUniform("reflectionProbe.boxMin","v3",Ye),this.setUniform("reflectionProbe.boxMax","v3",Ye),this.setUniform("reflectionProbe.posW","v3",Ye);this._lastUsedLightProbeIds=[]};bf.prototype.getUvOffsetAndScale=function(a){return a.copy(this._uvOffsetScale||Ze)};bf.prototype._uvOffsetAndScaleModified=function(){this.ensureTexturesRepeatable();this._updated()};
bf.prototype.setUvOffsetAndScale=function(a,b,c,d){this._uvOffsetScale||(this._uvOffsetScale=new C.Vector4,this.setUniforms());a instanceof C.Vector4?this._uvOffsetScale.copy(a):this._uvOffsetScale.set(a,b,c,d);this._uvOffsetAndScaleModified()};bf.prototype.getUvOffsetAndScaleByProperty=function(a){return this._uvOffsetScale[a]};
bf.prototype.setUvOffsetAndScaleByProperty=function(a,b){switch(a){case "x":this._uvOffsetScale.setX(b);break;case "y":this._uvOffsetScale.setY(b);break;case "z":this._uvOffsetScale.setZ(b);break;case "w":this._uvOffsetScale.setW(b)}this._uvOffsetAndScaleModified()};
bf.prototype.ensureTexturesRepeatable=function(){this._repeatableTexturesRequired=!0;var a=this.baseColorTexture;a&&a.parentTexture&&a.parentTexture.loaded&&(this._haveTextureLod&&Bc.gl.standardDerivatives?(this.enableStandardDerivativesExtension(),this.enableTextureLodExtension(),this.addDefine("USE_BASE_COLOR_TEXTURE_ATLAS_REPEAT")):this._baseColorTexture.extractedTexture||(a.extractTexture(),this.setUniforms()))};
bf.prototype.setUniforms=function(){this.setUniform("opacity","f",this.opacity);this.setUniform("cutoutMaskThreshold","f",this.cutoutMaskThreshold);var a=!this.isLightProbeDisabled(),b=!1,c=this.roughnessTexture;this.condDefine(c&&c.loaded&&a,"USE_ROUGHNESS_TEXTURE")?(this.setUniform("roughnessTexture","t",c),b=!0):this.setUniform("roughness","f",this.roughness);c=this.metallicTexture;this.condDefine(c&&c.loaded&&a,"USE_METALLIC_TEXTURE")?(this.setUniform("metallicTexture","t",c),b=!0):this.setUniform("metallic",
"f",this.metallic);this.setUniform("emissionStrength","f",this.emissive?this.emissionStrength:0);this._baseColorTexture&&this.baseColorTextureCorrection?this._baseColorCorrectionUniform.set(this.baseColorTextureHslAdjustment.h,this.baseColorTextureHslAdjustment.s,this.baseColorTextureHslAdjustment.l,this.baseColorTextureContrast):this._baseColorCorrectionUniform.set(0,0,0,0);this.setUniform("baseColorCorrection","v4",this._baseColorCorrectionUniform);c=null;if(this._baseColorTexture)if(this._baseColorTexture.parentTexture&&
!this._baseColorTexture.extractedTexture){c=this._baseColorTexture.parentTexture;var d=this._baseColorTexture.uvOffsetScale}else c=this._baseColorTexture.extractedTexture||this._baseColorTexture,d=Ze;this.condDefine(c&&c.loaded,"USE_BASE_COLOR_TEXTURE")?(this.setUniform("baseColorTexture","t",c),b=!0,this.setUniform("baseColorAtlasUvMod","v4",d),this._useBaseColorTextureAsCutout()?this.setUniform("alphaDiscardThreshold","f",.25):this.setUniform("alphaDiscardThreshold","f",0)):this.setUniform("baseColor",
"c",this.baseColor);this.condDefine(this._useAlphaInLowerHalf(),"USE_ALPHA_IN_LOWER_HALF");this.condDefine(this._useChromaKey(),"USE_CHROMA_KEY")&&(this.setUniform("chromaKeyColor","c",this.chromaKeyColor),c=this._chromaKeyDelta,this._chromaKeyDeltaCoeff.x=1/(1.22*c.x),this._chromaKeyDeltaCoeff.y=1/(1.22*c.y),this._chromaKeyDeltaCoeff.z=1/(1.22*c.z),this.setUniform("chromaKeyDeltaCoeff","v3",this._chromaKeyDeltaCoeff));c=this.bumpTexture;this.condDefine(c&&c.loaded&&a,"USE_BUMP_TEXTURE")&&(this.enableStandardDerivativesExtension(),
this.setUniform("bumpTexture","t",c),b=!0,this.setUniform("bumpScale","f",this.bumpScale),this.condDefine(this.parallaxCorrection,"USE_PARALLAX_CORRECTION")&&(this.addDefine(af[this.parallaxMode]),this.setUniform("parallaxScale","f",this.parallaxScale),this.setUniform("parallaxMinLayers","f",this.parallaxMinLayers),this.setUniform("parallaxMaxLayers","f",this.parallaxMaxLayers)));b&&this.setUniform("uvMod","v4",this._uvOffsetScale||Ze);this.condDefine(a,"USE_ENVMAP")&&(this._haveTextureLod&&this.enableTextureLodExtension(),
this._setLightProbeUniforms());this.condDefine(this.highlight,"USE_HIGHLIGHT")&&(this.setUniform("highlight","c",this.highlight),this.setUniform("highlightMix","f",this.highlightMix));this.condDefine(null!==this.headLight?this.headLight:!this.lightMapEnabled,"USE_HEADLIGHT")};bf.prototype.forceObjectUniformsRefresh=function(){this._lastUsedLightProbeIds=[]};bf.prototype.textureNeedsUv0=function(){return!0};
bf.prototype.hash=function(){return this.baseColorTexture?"standard"+this.baseColorTexture.name:"standard#"+this.baseColor.r+":"+this.baseColor.g+":"+this.baseColor.b};
bf.prototype.canMerge=function(a){if(this.type!==a.type||this.opacity!==a.opacity)return!1;if(this._baseColorTexture||a._baseColorTexture){if(this._baseColorTexture!==a._baseColorTexture||this.baseColorTextureCorrection!==a.baseColorTextureCorrection||this.baseColorTextureContrast!==a.baseColorTextureContrast||this.baseColorTextureHslAdjustment.h!==a.baseColorTextureHslAdjustment.h||this.baseColorTextureHslAdjustment.s!==a.baseColorTextureHslAdjustment.s||this.baseColorTextureHslAdjustment.l!==a.baseColorTextureHslAdjustment.l||
this._useAlphaInLowerHalf()!==a._useAlphaInLowerHalf()||(this._useChromaKey()?!(a._useChromaKey()&&this.chromaKeyColor.equals(a.chromaKeyColor)&&this._chromaKeyDelta.equals(a._chromaKeyDelta)):a._useChromaKey()))return!1}else if(!this.baseColor.equals(a.baseColor))return!1;if(this.emissive||a.emissive)if(this.emissive!==a.emissive||this.emissionStrength!==a.emissionStrength)return!1;if(this.roughnessTexture||a.roughnessTexture){if(this.roughnessTexture!==a.roughnessTexture)return!1}else if(this.roughness!==
a.roughness)return!1;if(this.metallicTexture||a.metallicTexture){if(this.metallicTexture!==a.metallicTexture)return!1}else if(this.metallic!==a.metallic)return!1;return(!this.bumpTexture&&!a.bumpTexture||this.bumpTexture===a.bumpTexture&&this.bumpScale===a.bumpScale)&&this.envMapProject===a.envMapProject&&this.doubleSided===a.doubleSided&&!this.parallaxCorrection&&!a.parallaxCorrection&&this._uvOffsetScale&&a._uvOffsetScale&&this._uvOffsetScale.equals(a._uvOffsetScale)?!0:!1};
bf.prototype.assignLightProbe=function(a,b){var c=this.uniforms;var d=this.envMapMirror?a.getMirrorTexture():this._haveTextureLod?a.getFilteredTexture():a.getFilteredTextureNoLod(this._mipLevel0);null===b?c.envMap.value=d:c["envMap["+b+"]"].value=d;this._haveTextureLod||(null===b?c.envMap2.value=a.getFilteredTextureNoLod(this._mipLevel1):c["envMap2["+b+"]"].value=a.getFilteredTextureNoLod(this._mipLevel1));this.envMapProject&&(a.isBoundingBoxEnabled()?null===b?(c["reflectionProbe.posW"].value=a.position,
c["reflectionProbe.boxMin"].value=a.boxMin,c["reflectionProbe.boxMax"].value=a.boxMax):(c["reflectionProbe["+b+"].posW"].value=a.position,c["reflectionProbe["+b+"].boxMin"].value=a.boxMin,c["reflectionProbe["+b+"].boxMax"].value=a.boxMax):null===b?(c["reflectionProbe.boxMin"].value=Ye,c["reflectionProbe.boxMax"].value=Ye):(c["reflectionProbe["+b+"].boxMin"].value=Ye,c["reflectionProbe["+b+"].boxMax"].value=Ye))};
bf.prototype.refreshPerObjectUniforms=function(a){var b=this.uniforms,c=Dd.prototype.refreshPerObjectUniforms.call(this,a);if(this.isLightProbeDisabled())return c;var d=[];a.lightProbes.forEach(function(g){return d.push(g.id)});if(!Ve(this._lastUsedLightProbeIds,d))if(c=!0,this._lastUsedLightProbeIds=[].concat(m.arrayFromIterable(d)),this.envMapMirror||(b.envMipsCount.value=S.LIGHT_PROBE_MIPS_COUNT),S.ENABLE_REFLECTION_PROBES_BLENDING){for(var e=this.envMapMirror?1:a.lightProbes.length,f=0;f<e;f++)this.assignLightProbe(a.lightProbes[f],
f);for(a=a.lightProbes[0].getFilteredTexture();e<S.MAX_BLENDED_REFLECTION_PROBES;e+=1)b["envMap["+e+"]"].value=a,this._haveTextureLod||(b["envMap2["+e+"]"].value=a),b["reflectionProbe["+e+"].boxMin"].value=Ye,b["reflectionProbe["+e+"].boxMax"].value=Ye}else this.assignLightProbe(a.lightProbes[0],null);return c};bf.prototype.setBaseColorRGB=function(a,b,c){this.baseColor.setRGB(a,b,c);this.setUniforms();this._updated()};
bf.prototype.setTexture=function(a,b){if(b){var c=this.baseColorTexture;c&&(b.wrapS=c.wrapS,b.wrapT=c.wrapT,b.anisotropy=c.anisotropy)}this[a]=b||null;"baseColorTexture"===a?(this._baseColorTextureCorrection=!1,this._baseColorTextureContrast=0,this.baseColorTextureHslAdjustment.h=0,this.baseColorTextureHslAdjustment.s=0,this.baseColorTextureHslAdjustment.l=0):"bumpTexture"===a&&(this._bumpScale=.001)};
bf.prototype.serializeBaseColorProperties=function(){var a=this.baseColor.roundChannels().toArray(),b=this.baseColorTexture?this.baseColorTexture.serialize():null;return{baseColor:a,baseColorTexture:b,baseColorTextureCorrection:this.baseColorTextureCorrection?{contrast:this.baseColorTextureContrast,hslAdjustment:[this.baseColorTextureHslAdjustment.h,this.baseColorTextureHslAdjustment.s,this.baseColorTextureHslAdjustment.l]}:null}};
bf.prototype.serializeUvOffsetScale=function(){return this.uvOffsetAndScaleEnabled?this._uvOffsetScale.toArray():null};bf.prototype.serializeTextureIfNeeded=function(a){return(a=this[a])?a.serialize():null};
bf.prototype.serialize=function(){console.assert(!this.merged);var a=this.serializeBaseColorProperties();a={name:this.name,type:this.type,baseColor:a.baseColor,baseColorTexture:a.baseColorTexture,baseColorTextureCorrection:a.baseColorTextureCorrection,alphaInLowerHalf:this.alphaInLowerHalf,opacity:this.opacity,cutoutMode:this._cutoutMode,cutoutMaskThreshold:this.cutoutMaskThreshold,emissive:this.emissive,emissionStrength:this.emissionStrength,reflective:this.reflective,roughness:this.roughness,metallic:this.metallic,
envMapProject:this.envMapProject,bumpScale:this.bumpScale,doubleSided:this.doubleSided,doNotImport:this.doNotImport,roughnessTexture:this.serializeTextureIfNeeded("roughnessTexture"),metallicTexture:this.serializeTextureIfNeeded("metallicTexture"),bumpTexture:this.serializeTextureIfNeeded("bumpTexture"),uvOffsetScale:this.serializeUvOffsetScale()};void 0!==this._chromaKeyEnabled&&(a.chromaKeyEnabled=this.chromaKeyEnabled,a.chromaKeyColor=this.chromaKeyColor.roundChannels().toArray(),a.chromaKeyDelta=
this._chromaKeyDelta.toArray());return a};function cf(){bf.call(this);this.vertexShaderName="anchor_vertex.glsl";this._vertexShaderBody=rd(this.vertexShaderName);this._metallic=.1;this._roughness=.5;this._bumpScale=.01;this.hideFromLightProbes=!0;this.lightMapSupported=!1}cf.prototype=Object.create(bf.prototype);function rf(){bf.call(this);this.vertexShaderName="sprite_vertex.glsl";this._vertexShaderBody=rd("sprite_vertex.glsl");this.hideFromLightProbes=!0;this.lightMapSupported=!1;this.setUniform("offset","v3",new C.Vector3(0,0,0))}rf.prototype=Object.create(bf.prototype);Object.defineProperty(rf.prototype,"offset",{set:function(a){this.uniforms.offset.value=a}});function sf(a,b,c){function d(){l||(h||k.getDelta(),l=!0,a.vrEnabled()?a.requestAnimationFrame(e):requestAnimationFrame(f))}function e(){q(a.vrEnabled())}function f(){q(!1)}var g=this,k=new C.Clock,h=!1,l=!1,n=!1,p=0,r=!1;var q=function(w){r&&(l=!1,n?(console.assert(!w),c(k.getDelta(),p)?(p+=1,d()):n=!1):(h=!0,b(k.getDelta(),w),S.ALWAYS_RENDER&&g.requestFrame(),h=!1,l||(n=!0,p=0,d())))};this.requestFrame=function(){r&&(n=!1,d())};this.disable=function(){r=!1};this.enable=function(){r=!0;l=!1;this.requestFrame()};
this.isEnabled=function(){return r}};var tf=function(){var a=new C.Vector3;return function(b,c,d){a.copy(b);a.sub(c).normalize();a.multiplyScalar(d);return b.sub(a)}}();
function uf(a,b,c){function d(p,r,q){if(c.camera().current instanceof C.OrthographicCamera){var w=c.camera().current,x=c.camera().getWorldQuaternion(new C.Quaternion);r=(new C.Vector3(r*(w.right-w.left)/2,q*(w.top-w.bottom)/2,0)).applyQuaternion(x);p.ray.origin=(new C.Vector3).copy(g).add(r);p.ray.direction.copy(c.camera().getWorldDirection(new C.Vector3))}else p.ray.direction.set(r,q,1).unproject(c.camera()),p.ray.direction.sub(g).normalize()}var e=this,f=new Td({scene:null,depthMax:Infinity,objectsThreshold:8,
overlapPct:.15}),g=c.cameraWorldPosition(),k=b.camera,h=[];this.addStaticObstacle=function(p,r,q){f.add(p,r,q)};this.addDynamicObstacle=function(p){h.push(p)};this.removeDynamicObstacle=function(p){Ia(p,h)};var l=function(){var p=new Re(a,k);return function(r,q){for(var w=f.search(r.ray.origin,r.far,r.ray.direction),x=0;x<h.length;x+=1)w.push(h[x]);return p.closestIntersection(w,r,q)?!0:!1}}(),n=function(){var p=new Qe;return function(r){return l(r,p)?p.distance:Infinity}}();this.distanceToGroundFrom=
function(){var p=new Pe;p.ray.direction.set(0,0,-1);p.respectColliderSettings=!0;p.onlyGroundCollisions=k.autoClimb;return function(r,q){p.ray.origin.copy(r);p.far=q;r=n(p);return k.autoClimb||1<=r?r:Infinity}}();this.distanceToGround=function(p){return this.distanceToGroundFrom(g,p)};this.findIntersectionBelow=function(){var p=new Pe;p.ray.direction.set(0,0,-1);p.respectColliderSettings=!1;return function(r,q,w){p.ray.origin.copy(r);p.far=q;return l(p,w)}}();this.distanceToCeilingFrom=function(){var p=
new Pe;p.ray.direction.set(0,0,1);p.respectColliderSettings=!0;return function(r,q){p.ray.origin.copy(r);p.far=q;return n(p)}}();this.distanceToCeiling=function(p){return this.distanceToCeilingFrom(g,p)};this.cameraHeightFromPoint=function(p){p=this.distanceToGroundFrom(p,S.MAX_GROUND_SEARCH_DEPTH);return Infinity===p?null:p};this.adjustPointToMatchCameraHeight=function(p){var r=k.fixedHeight||S.CAMERA_FIXED_HEIGHT||c.cameraHeight;if(null===r)return!1;var q=this.distanceToGroundFrom(p,S.MAX_GROUND_SEARCH_DEPTH);
if(Infinity===q)return!1;r-=q;if(.01>Math.abs(r)||0<r&&Infinity!==this.distanceToCeilingFrom(p,r+S.MIN_DISTANCE_TO_CEILING))return!1;p.z+=r;return!0};this.findIntersectionAtPosition=function(){var p=new Pe(g);return function(r,q,w,x){d(p,r,q);p.respectColliderSettings=w;return l(p,x)}}();this.findObstacleMeshAtPosition=function(){var p=new Qe;return function(r,q,w){return this.findIntersectionAtPosition(r,q,w,p)?p.object:null}}();this.findMeshFromListAtPosition=function(){var p=new Pe(g),r=new Qe,
q=new Re(a,k);return function(w,x,t,A,D){p.ignoreVisibility=void 0===A?!1:A;A=void 0===D?r:D;d(p,x,t);return q.closestIntersection(w,p,A)?A.object:null}}();this.clickedPointToMoveTarget=function(){function p(A){var D=q.x-t.x;var H=q.y-t.y;D=Math.sqrt(D*D+H*H);r.far=D+S.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE;w.x=t.x-q.x;w.y=t.y-q.y;if(!(.01>Math.abs(w.x)&&.01>Math.abs(w.y)))if(w.z=0,w.normalize(),l(r,x)){if(H=x.distance-S.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE,0<H&&(A.x=q.x+w.x*H,A.y=q.y+w.y*H,A.z=q.z),
H=Math.min(x.distance-.01,D),q.x+=w.x*H,q.y+=w.y*H,e.adjustPointToMatchCameraHeight(q))return p(A)}else A.x=t.x,A.y=t.y,A.z=q.z}var r=new Pe;r.respectColliderSettings=!0;var q=r.ray.origin,w=r.ray.direction,x=new Qe,t=new C.Vector3;return function(A){q.copy(g);t.copy(A);A.copy(g);p(A);e.adjustPointToMatchCameraHeight(A)}}();this.movePointTowardsTheCamera=function(p,r){return tf(p,g,r)};this.handleCollisions=function(){function p(A){c.applyCameraYaw(q);q.normalize();var D=w.start.distanceTo(g),H=w.end.distanceTo(g);
if(t-.02<D+H&&D+H<t+.02&&H>=A&&x.equals(q))return!1;D=n(r);Infinity===D&&(D=r.far);x.copy(q);w.start.copy(g);w.end.copy(q).multiplyScalar(D).add(g);t=w.distance();return D<A}var r=new Pe(g),q=r.ray.direction,w=new C.Line3,x=new C.Vector3,t=0;r.respectColliderSettings=!0;r.far=5;console.assert(r.far>S.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE);return function(A){A=c.maxFrameMoveLinearDistance(A)+S.KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE;c.movesForward()&&(q.set(0,1,0),p(A)&&c.stopForward());c.movesBackward()&&
(q.set(0,-1,0),p(A)&&c.stopBackward());c.movesLeft()&&(q.set(-1,0,0),p(A)&&c.stopLeft());c.movesRight()&&(q.set(1,0,0),p(A)&&c.stopRight());c.movesDown()&&(q.set(0,0,-1),p(A)&&c.stopDown());c.movesUp()&&(q.set(0,0,1),p(A)&&c.stopUp())}}()};function vf(a){function b(){c&&a.switchToNextVisibleView(4)}var c=!1,d={type:"tourStarted"},e={type:"tourStopped"};a.addEventListener("teleportDone",function(){c&&setTimeout(b,S.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)});this.isRunning=function(){return c};this.start=function(){console.assert(!c);c=!0;this.dispatchEvent(d);b()};this.stop=function(){console.assert(c);c=!1;a.switchToView(a.lastDestinationView,0);this.dispatchEvent(e)}}C.EventDispatcher.prototype.apply(vf.prototype);function wf(){var a=new bf;a.baseColor.setRGB(.298,.619,.851);a.highlight=(new C.Color).setRGB(.033,.125,.445);a.reflective=!1;a.lightMapSupported=!1;a.setUniforms();return a}
function xf(a){var b=new C.CylinderBufferGeometry(.05,.05,.011,32),c=new C.CylinderBufferGeometry(.05,.03,.011,32,1,!1),d=new C.CylinderBufferGeometry(0,.05,.2,32,1,!0);S.EDIT_MODE&&(b.addTriangleOrderAttribute(),c.addTriangleOrderAttribute(),d.addTriangleOrderAttribute());var e=new C.Matrix4;e.makeRotationX(Math.PI/2);b.applyMatrix(e);b.convertNormalsToSpherical();b=new C.Mesh(b,a);b.position.z+=.0055;e.makeTranslation(0,-(.1+.0055),0);c.applyMatrix(e);c.convertNormalsToSpherical();c=new C.Mesh(c,
a);d.convertNormalsToSpherical();a=new C.Mesh(d,a);a.add(c);a.rotateX(-Math.PI/2);a.position.z=.158;d=new C.Object3D;d.add(b);d.add(a);return d}
function yf(a){var b=wf(),c=xf(b),d=c.children[0],e=!1,f=1;this.hide=function(){e&&(a.removeAuxiliaryObject(c),e=!1)};this.isVisible=function(){return e};this.showTargetAtPosition=function(g,k,h,l){e||(a.addAuxiliaryObject(c),e=!0);d.visible=l;c.position.set(g,k,h);c.updateMatrixWorld()};this.update=function(g){b.highlightMix+=g*f;1<=b.highlightMix&&(b.highlightMix=1,f=-1);0>=b.highlightMix&&(b.highlightMix=0,f=1)}}
function zf(a,b,c,d){function e(){d.teleportingToPoint&&d.cancelSwitchToPoint()}function f(){!c.mousePressLook&&d.teleportingToPoint&&d.cancelSwitchToPoint()}var g=new yf(a),k=new Qe;d.addEventListener("teleportDone",function(){g.hide()});this.onMeshClicked=function(h,l){if(!c.isOrbitEnabled()&&!c.isHandlingGesture()&&0!==c.camera().moveMaxSpeed){b.clickedPointToMoveTarget(l);h=l.x;var n=l.y,p=l.z,r=!1;if(b.findIntersectionBelow(l,4,k)){p=k.point.z;var q=k.object.geometry.boundingBox;q&&p>q.max.z-
.01&&(r=!0)}else p-=c.cameraHeight||1.6;S.CLICK_MOVE_SHOW_TARGET_INDICATOR&&g.showTargetAtPosition(h,n,p,r);d.switchToPoint(l)}};this.update=function(h){g.isVisible()&&g.update(h)};this.dispose=function(){document.removeEventListener("keydown",e,!1);document.removeEventListener("mousedown",e,!1);document.removeEventListener("mousemove",f,!1);document.removeEventListener("touchstart",e,!1);document.removeEventListener("DOMMouseScroll",e,!1);document.removeEventListener("mousewheel",e,!1)};document.addEventListener("keydown",
e,!1);document.addEventListener("mousedown",e,!1);document.addEventListener("mousemove",f,!1);document.addEventListener("touchstart",e,!1);document.addEventListener("DOMMouseScroll",e,!1);document.addEventListener("mousewheel",e,!1)};var Af={TRIGGER:0,BACKWARD:1,FORWARD:2,LEFT:3,RIGHT:4,DOWN:5,UP:6,PREVIOUS:7,NEXT:8},Bf=[{gamepadIdPattern:/^Spatial Controller \(Spatial Interaction Source\).*$/,axisMapping:new Map([[2,[Af.PREVIOUS,Af.NEXT]],[3,[Af.UP,Af.DOWN]],[0,[Af.LEFT,Af.RIGHT]],[1,[Af.FORWARD,Af.BACKWARD]]]),buttonMapping:new Map([[1,Af.TRIGGER]])},{gamepadIdPattern:/Oculus Touch \(Left\)/,axisMapping:new Map([[0,[Af.LEFT,Af.RIGHT]],[1,[Af.FORWARD,Af.BACKWARD]]]),buttonMapping:new Map([[1,Af.TRIGGER],[3,Af.DOWN],[4,Af.UP]])},
{gamepadIdPattern:/Oculus Touch \(Right\)/,axisMapping:new Map([[0,[Af.LEFT,Af.RIGHT]],[1,[Af.FORWARD,Af.BACKWARD]]]),buttonMapping:new Map([[1,Af.TRIGGER],[3,Af.NEXT],[4,Af.PREVIOUS]])},{gamepadIdPattern:/OpenVR (Gamepad|Controller)/,axisMapping:new Map([[0,[Af.PREVIOUS,Af.NEXT]],[1,[Af.DOWN,Af.UP]]]),buttonMapping:new Map([[1,Af.TRIGGER]])},{gamepadIdPattern:/.*/,gamepadLayoutMappingId:"standard",axisMapping:new Map([[0,[Af.LEFT,Af.RIGHT]],[1,[Af.FORWARD,Af.BACKWARD]],[2,[Af.LEFT,Af.RIGHT]],[3,
[Af.FORWARD,Af.BACKWARD]]]),buttonMapping:new Map([[0,Af.DOWN],[1,Af.NEXT],[2,Af.PREVIOUS],[3,Af.UP],[4,Af.TRIGGER],[5,Af.TRIGGER]])},{gamepadIdPattern:/.*/,axisMapping:new Map([[0,[Af.PREVIOUS,Af.NEXT]],[1,[Af.UP,Af.DOWN]]]),buttonMapping:new Map([[0,Af.TRIGGER],[1,Af.TRIGGER],[2,Af.TRIGGER],[3,Af.TRIGGER]])}],Cf={axisMapping:new Map([[2,[Af.LEFT,Af.RIGHT]],[3,[Af.FORWARD,Af.BACKWARD]]]),buttonMapping:new Map([[0,Af.TRIGGER],[4,Af.DOWN],[5,Af.UP]])},Df={axisMapping:new Map([[2,[Af.LEFT,Af.RIGHT]],
[3,[Af.FORWARD,Af.BACKWARD]]]),buttonMapping:new Map([[0,Af.TRIGGER],[4,Af.NEXT],[5,Af.PREVIOUS]])};function Ef(a){return-.7>=a?0:.7<=a?1:-1}
function Ff(a,b){if("xr-standard"===a.mapping)return"left"===(a.hand?a.hand:b)?Cf:Df;b=m.makeIterator(Bf);for(var c=b.next();!c.done;c=b.next()){c=c.value;var d=a;var e=c;d=e.gamepadIdPattern.test(d.id)?void 0!==e.gamepadLayoutMappingId?d.mapping===e.gamepadLayoutMappingId:!0:!1;if(d)return c}console.error("No matching action mapping for gamepad found",a.id);return null}
function Gf(a,b){b=Ff(a,b);this.axisMapping=b.axisMapping;this.buttonMapping=b.buttonMapping;this.axisPosition=a.axes.map(Ef);this.buttonPressed=a.buttons.map(function(c){return c.pressed})}
function Hf(){function a(h){var l=h.gamepad;h=new Gf(h.gamepad);c.set(l.index,h)}function b(h){c.delete(h.gamepad.index)}var c=new Map,d=new Map,e=new Set,f=new Set,g={type:"actionActivated",action:null},k={type:"actionDeactivated",action:null};this.hasGamepads=function(){return 0<c.size||0<d.size};this.update=function(){function h(r,q){for(var w=0;w<q.axes.length;++w){var x=Ef(q.axes[w]),t=r.axisPosition[w];if(x!==t){var A=r.axisMapping.get(w);void 0!==A&&(-1!==t&&f.add(A[t]),-1!==x&&e.add(A[x]))}r.axisPosition[w]=
x}for(w=0;w<q.buttons.length;++w)x=q.buttons[w].pressed,t=r.buttonPressed[w],x!==t&&(A=r.buttonMapping.get(w),void 0!==A&&(t?f.add(A):e.add(A))),r.buttonPressed[w]=x}if(this.hasGamepads()){e.clear();f.clear();var l=navigator.getGamepads?navigator.getGamepads():[];l=m.makeIterator(l);for(var n=l.next();!n.done;n=l.next())if(n=n.value){var p=c.get(n.index);h(p,n)}l=m.makeIterator(d);for(n=l.next();!n.done;n=l.next())p=m.makeIterator(n.value),n=p.next().value,p=p.next().value,h(p,n);n=m.makeIterator(f);
for(l=n.next();!l.done;l=n.next())k.action=l.value,this.dispatchEvent(k);n=m.makeIterator(e);for(l=n.next();!l.done;l=n.next())g.action=l.value,this.dispatchEvent(g)}};this.addXrGamepad=function(h,l){l=new Gf(h,l);d.set(h,l)};this.removeXrGamepad=function(h){d.delete(h)};this.removeAllXrGamepads=function(){d.clear()};(function(){if(navigator.getGamepads){window.addEventListener("gamepadconnected",a);window.addEventListener("gamepaddisconnected",b);for(var h=m.makeIterator(navigator.getGamepads()),
l=h.next();!l.done;l=h.next())if(l=l.value){var n=new Gf(l);c.set(l.index,n)}}})()}C.EventDispatcher.prototype.apply(Hf.prototype);function If(a,b,c,d){function e(M,fa){q.getNoPan()?va.copy(q.target):q.collider&&q.mouseZoomToPointer&&q.collider.findIntersectionAtPosition(M/window.innerWidth*2-1,2*-(fa/window.innerHeight)+1,!0,x)?va.copy(x.point):va.copy(q.target)}function f(){var M=b.getYawAngle(),fa=b.getPitchAngle(),ja=b.cameraWorldPosition();q.autoRotate&&ka===Z.NONE&&q.rotateLeft(2*Math.PI/60/60*q.autoRotateSpeed);var ta=q.getMinYawAngle(),X=q.getMaxYawAngle();Math.abs(X-ta)>=2*Math.PI-1E-6?M+=pa:ta===X?M=ta:(ta>X&&(X+=2*
Math.PI,M<ta&&(M+=2*Math.PI)),M=0>pa?Math.min(Math.max(M+pa,ta),X):Math.max(Math.min(M+pa,X),ta));fa=C.Math.clamp(fa+T,q.getMinPitchAngle(),q.getMaxPitchAngle());I.copy(q.target).sub(ja);X=I.length();ta=C.Math.clamp(X*P,q.getMinDistance(),q.getMaxDistance());X=ta/X;V.copy(va).sub(q.target).multiplyScalar(1-X);q.target.add(V);q.target.add(ca);If.computeCameraPosition(ja,q.target,M,fa,ta);b.cameraPositionUpdated();b.setYawAngle(M);b.setPitchAngle(fa);M=If.computeCameraNear(ta);1E-6<Math.abs(M-a.near)&&
(a.near=M,a.updateProjectionMatrix());T=pa=0;P=1;ca.set(0,0,0);d.requestFrame()}function g(){Q=ia=na=L=aa=0;ma&&(ma(),ma=!1)}function k(M){if(!1!==w){M.preventDefault();var fa=c===document?c.body:c;if(ka===Z.ROTATE){if(!0===q.noRotate)return;A.set(M.clientX,M.clientY);D.subVectors(A,t);q.rotateLeft(D.x/fa.clientWidth*q.mouseRotateSpeed);!1===q.noPitchRotate&&q.rotateUp(D.y/fa.clientHeight*q.mouseRotateSpeed);t.copy(A)}else if(ka===Z.DOLLY){if(!0===q.noZoom)return;ea.set(M.clientX,M.clientY);ra.subVectors(ea,
O);0<ra.y?q.dollyIn():0>ra.y&&q.dollyOut();O.copy(ea)}else if(ka===Z.PAN){if(!0===q.getNoPan())return;G.set(M.clientX,M.clientY);K.subVectors(G,H);q.pan(K.x/fa.clientHeight,K.y/fa.clientWidth);H.copy(G)}ka!==Z.NONE&&f()}}function h(){!1!==w&&ma&&(ma(),ma=!1)}function l(M){if(!1!==w&&!0!==q.noZoom&&ka===Z.NONE){M.preventDefault();var fa=0;void 0!==M.wheelDelta?fa=M.wheelDelta:void 0!==M.detail&&(fa=-M.detail);e(M.clientX,M.clientY);0<fa?q.dollyOut():0>fa&&q.dollyIn();f()}}function n(M,fa,ja){return!0===
ja?fa:M===fa?0:M}function p(M,fa){var ja=!1,ta=M.keyCode;if(!1!==w){if(!0===J&&!1===q.getNoPan())if(38===ta||87===ta)ia=n(ia,1,fa),ja=!0;else if(40===ta||83===ta)ia=n(ia,-1,fa),ja=!0;else if(37===ta||65===ta)Q=n(Q,1,fa),ja=!0;else{if(39===ta||68===ta)Q=n(Q,-1,fa),ja=!0}else if(!1===J&&!1===q.noRotate)if((38===ta||87===ta)&&!1===q.noPitchRotate)L=n(L,1,fa),ja=!0;else if((40===ta||83===ta)&&!1===q.noPitchRotate)L=n(L,-1,fa),ja=!0;else if(37===ta||65===ta)na=n(na,1,fa),ja=!0;else if(39===ta||68===ta)na=
n(na,-1,fa),ja=!0;switch(ta){case q.dollyKeys.IN1:case q.dollyKeys.IN2:case q.dollyKeys.IN3:!1===q.noZoom&&(aa=n(aa,1,fa),ja=!0);break;case q.dollyKeys.OUT1:case q.dollyKeys.OUT2:case q.dollyKeys.OUT3:!1===q.noZoom&&(aa=n(aa,-1,fa),ja=!0)}ja&&(M.preventDefault(),d.requestFrame())}}function r(M){return q.getNoPan()?!1:J&&1===M.length?!0:J||2!==M.length?!1:Math.abs(M[0].clientY-M[1].clientY)<=S.MAX_TWO_POINTERS_IN_LINE_DIFF}this.collider=null;this.target=new C.Vector3;this.noZoom=!1;this.mouseZoomToPointer=
!0;this.mouseZoomSpeed=.97;this.keyZoomSpeed=.7;this.minZoom=0;this.maxZoom=Infinity;this.noPitchRotate=this.noRotate=!1;this.mouseRotateSpeed=2*Math.PI;this.keyYawRotateSpeed=S.CAMERA_ARROWS_TURN_SPEED;this.keyPitchRotateSpeed=S.CAMERA_ARROWS_TURN_SPEED/2;this.autoRotate=!1;this.autoRotateSpeed=2;this.getMinPitchAngle=function(){return-Math.PI/2};this.getMaxPitchAngle=function(){return Math.PI/2};this.getMinYawAngle=function(){return-Math.PI};this.getMaxYawAngle=function(){return Math.PI};this.getMinDistance=
function(){return 0};this.getMaxDistance=function(){return Infinity};this.getNoPan=function(){return!1};this.keyPanSpeed=.25;this.dollyKeys={IN1:61,IN2:187,IN3:69,OUT1:173,OUT2:189,OUT3:81};this.primaryMouseButton=C.MOUSE.LEFT;this.secondaryMouseButton=C.MOUSE.RIGHT;this.mouseButtons={ROTATE:this.primaryMouseButton,ZOOM:C.MOUSE.MIDDLE,PAN:this.secondaryMouseButton};var q=this,w=!1,x=new Qe,t=new C.Vector2,A=new C.Vector2,D=new C.Vector2,H=new C.Vector2,G=new C.Vector2,K=new C.Vector2,W=new C.Vector3,
O=new C.Vector2,ea=new C.Vector2,ra=new C.Vector2,va=new C.Vector3,I=new C.Vector3,V=new C.Vector3,pa=0,T=0,P=1,ca=new C.Vector3,J=!1,aa=0,na=0,L=0,Q=0,ia=0,Z={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},ka=Z.NONE,ma=!1;this.enable=function(){w=!0;f()};this.disable=function(){w=!1;g()};this.isEnabled=function(){return w};this.setPanPrimary=function(M){J=M;!0===J?(this.mouseButtons.PAN=this.primaryMouseButton,this.mouseButtons.ROTATE=this.secondaryMouseButton):(this.mouseButtons.ROTATE=
this.primaryMouseButton,this.mouseButtons.PAN=this.secondaryMouseButton)};this.getCameraDistance=function(){var M=new C.Vector3;return function(){M.copy(b.cameraWorldPosition()).sub(this.target);return M.length()}}();this.rotateLeft=function(M){void 0===M&&(M=2*Math.PI/60/60*q.autoRotateSpeed);pa-=M};this.rotateUp=function(M){void 0===M&&(M=2*Math.PI/60/60*q.autoRotateSpeed);T-=M};this.panLeft=function(M){var fa=a.matrixWorld.elements;W.set(fa[0],fa[1],fa[2]);W.multiplyScalar(-M);ca.add(W)};this.panUp=
function(M){var fa=a.matrixWorld.elements;W.set(fa[4],fa[5],fa[6]);W.multiplyScalar(M);ca.add(W)};this.pan=function(M,fa){if(a.isPerspective()){var ja=b.cameraWorldPosition().clone().sub(q.target).length();ja*=Math.tan(a.fov/2*Math.PI/180);q.panLeft(2*M*ja);q.panUp(2*fa*ja)}else a.isOrthographic()&&(q.panLeft(M*(a.right-a.left)),q.panUp(fa*(a.top-a.bottom)))};this.dollyIn=function(M){void 0===M&&(M=this.mouseZoomSpeed);a.isPerspective()?P/=M:a.isOrthographic()&&(a.orthoFrustumSize/=M,a.updateProjectionMatrix())};
this.dollyOut=function(M){void 0===M&&(M=this.mouseZoomSpeed);a.isPerspective()?P*=M:a.isOrthographic()&&(a.orthoFrustumSize*=M,a.updateProjectionMatrix())};this.update=function(M){if(w&&M){var fa=!1;0!==na&&(q.rotateLeft(na*q.keyYawRotateSpeed*M),fa=!0);0!==L&&(q.rotateUp(L*q.keyPitchRotateSpeed*M),fa=!0);if(0!==Q||0!==ia)q.pan(Q*q.keyPanSpeed*M,ia*q.keyPanSpeed*M),fa=!0;0!==aa&&(M=Math.pow(q.keyZoomSpeed,M),-1===aa?q.dollyIn(M):q.dollyOut(M),fa=!0);fa&&f()}};c.addEventListener("mousedown",function(M){if(!1!==
w){c.focus();M.preventDefault();if(M.button===q.mouseButtons.ROTATE){if(!0===q.noRotate)return;ka=Z.ROTATE;t.set(M.clientX,M.clientY)}else if(M.button===q.mouseButtons.ZOOM){if(!0===q.noZoom)return;ka=Z.DOLLY;O.set(M.clientX,M.clientY);e(M.clientX,M.clientY)}else if(M.button===q.mouseButtons.PAN){if(!0===q.getNoPan())return;ka=Z.PAN;H.set(M.clientX,M.clientY)}ka!==Z.NONE&&(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",h,!1),ma=function(){document.removeEventListener("mousemove",
k,!1);document.removeEventListener("mouseup",h,!1);ka=Z.NONE})}},!1);c.addEventListener("mousewheel",l,!1);c.addEventListener("DOMMouseScroll",l,!1);c.addEventListener("touchstart",function(M){if(!1!==w){var fa=M.touches.length;M.preventDefault();if(r(M.touches))ka=Z.TOUCH_PAN,H.set(M.touches[0].clientX,M.touches[0].clientY);else if(q.noRotate||J||1!==fa)if(q.noZoom||2!==fa)ka=Z.NONE;else{ka=Z.TOUCH_DOLLY;fa=M.touches[0].clientX-M.touches[1].clientX;var ja=M.touches[0].clientY-M.touches[1].clientY;
O.set(0,Math.sqrt(fa*fa+ja*ja));e(M.touches[0].clientX-fa/2,M.touches[0].clientY-ja/2)}else ka=Z.TOUCH_ROTATE,t.set(M.touches[0].clientX,M.touches[0].clientY)}},!1);c.addEventListener("touchend",function(){!1!==w&&(ka=Z.NONE)},!1);c.addEventListener("touchmove",function(M){if(!1!==w){var fa=M.touches.length;M.preventDefault();var ja=c===document?c.body:c;r(M.touches)&&ka===Z.TOUCH_PAN?(G.set(M.touches[0].clientX,M.touches[0].clientY),K.subVectors(G,H),q.pan(K.x/ja.clientHeight,K.y/ja.clientWidth),
H.copy(G),f()):q.noRotate||J||1!==fa||ka!==Z.TOUCH_ROTATE?q.noZoom||2!==fa||ka!==Z.TOUCH_DOLLY?ka=Z.NONE:(fa=M.touches[0].clientX-M.touches[1].clientX,M=M.touches[0].clientY-M.touches[1].clientY,ea.set(0,Math.sqrt(fa*fa+M*M)),ra.subVectors(ea,O),0<ra.y?q.dollyOut():0>ra.y&&q.dollyIn(),O.copy(ea),f()):(A.set(M.touches[0].clientX,M.touches[0].clientY),D.subVectors(A,t),q.rotateLeft(D.x/ja.clientWidth*q.mouseRotateSpeed),q.rotateUp(D.y/ja.clientHeight*q.mouseRotateSpeed),t.copy(A),f())}},!1);c.addEventListener("blur",
function(){g()},!1);c.addEventListener("keydown",function(M){M.ctrlKey||M.altKey||M.metaKey||p(M,!0)},!1);c.addEventListener("keyup",function(M){p(M,!1)},!1);a.isPerspective()||a.isOrthographic()||console.warn("WARNING: OrbitControls.js requires perspective or orthographic camers")}If.prototype.constructor=If;If.computeCameraPosition=function(){var a=new C.Vector3;return function(b,c,d,e,f){d-=Math.PI/2;e+=Math.PI/2;a.x=f*Math.sin(e)*Math.cos(d);a.y=f*Math.sin(e)*Math.sin(d);a.z=f*Math.cos(e);b.copy(c).add(a)}}();
If.computeCameraNear=function(a){return a*S.CAMERA_ORBIT_NEAR_FROM_1M};function Jf(a,b,c,d){function e(Y){this.activeDirection=0;this.activeSource=A;this.speed=0;this.moves=function(){return this.activeDirection||this.speed};this.movesInDirection=function(qa){return this.activeDirection===qa||Math.sign(this.speed)===qa};this.activateDirectionFromSource=function(qa,za){this.activeDirection=qa;this.activeSource=za};this.deactivateDirectionFromSource=function(qa,za){this.activeDirection===qa&&this.activeSource===za&&(this.activeDirection=0,this.activeSource=za)};this.deactivateSource=
function(qa){this.activeSource===qa&&(this.activeDirection=0,this.activeSource=A)};this.stopInDirection=function(qa){this.activeDirection===qa&&(this.activeDirection=0,this.activeSource=A);Math.sign(this.speed)===qa&&(this.speed=0)};this.update=function(qa,za){if(!this.moves())return 0;var Ka=Math.sign(this.speed),Ba=this.activeDirection||-Ka;Ba=za*Ba*(Ka===Ba?qa/S.CAMERA_FULL_ACCELERATION_TIME:qa/S.CAMERA_FULL_DECELERATION_TIME);za*=this.speed+Ba/2;this.speed=C.Math.clamp(this.speed+Ba,-qa,qa);this.activeDirection||
Math.sign(this.speed)===Ka||(this.speed=0);return C.Math.clamp(za,-Y,Y)}}function f(){ka.rotation.z=Oa(fa.z+M.z)}function g(){f();Z.rotation.x=Oa(fa.x+M.x);ia.rotation.y=fa.y;ka.updateMatrixWorld(!0)}function k(Y){return Math.abs(Y[0].y-Y[1].y)<=S.MAX_TWO_POINTERS_IN_LINE_DIFF}function h(Y){I[0].copy(va[0]);I[1].copy(va[1]);Y.touches?(va[0].set(Y.touches[0].clientX,Y.touches[0].clientY),2===Y.touches.length?va[1].set(Y.touches[1].clientX,Y.touches[1].clientY):va[1].set(0,0)):(va[0].set(Y.clientX,
Y.clientY),va[1].set(0,0))}function l(Y){if(x)if(Y.preventDefault(),h(Y),J){if(J!==ca){if(J===pa){var qa=aa[0].distanceTo(aa[1]);Y=va[0].distanceTo(va[1]);10<=Math.abs(Y-qa)?(J=T,qa=!0):k(va)&&k(aa)&&10<=Math.abs(va[0].y-aa[0].y)?(J=P,qa=!0):qa=!1;if(!qa)return}J===T?(qa=I[1].distanceTo(I[0]),qa=va[1].distanceTo(va[0])-qa,0<Math.abs(qa)&&(na=Date.now(),O.activateDirectionFromSource(Math.sign(qa),H)),d.requestFrame()):J===P&&k(va)&&(qa=va[0].y-I[0].y,0<Math.abs(qa)&&(L=Date.now(),ea.activateDirectionFromSource(Math.sign(qa),
H)),d.requestFrame())}}else if(!w.mousePressLook||Q||!J&&Y.touches){qa=Y.movementX||Y.mozMovementX||Y.webkitMovementX;void 0===qa&&(qa=va[0].x-I[0].x);var za=Y.movementY||Y.mozMovementY||Y.webkitMovementY;void 0===za&&(za=va[0].y-I[0].y);Y=w.flipMouseLook||!J&&Y.touches?1:-1;X.x+=Y*qa*S.CAMERA_LOOK_SPEED;w.mouseControlsPitch&&(X.y+=Y*za*S.CAMERA_LOOK_SPEED);d.requestFrame()}}function n(Y){x&&(b.focus(),Y.preventDefault(),h(Y),Q=!0,d.requestFrame())}function p(Y){x&&(Y.preventDefault(),Q=!1)}function r(Y){var qa=
0,za;(za=!x)||(za=void 0!==document.hasFocus?document.hasFocus():document.activeElement===b,za=!za);za||(Y||(Y=window.event),Y.preventDefault(),Y.wheelDelta?qa=Y.wheelDelta/120:Y.detail&&(qa=-Y.detail/3),V+=qa*S.CAMERA_SCROLL_SPEED,V=0<=V?Math.min(V,.5):Math.max(V,-.5),d.requestFrame())}function q(){w.stopForward();w.stopBackward();w.stopLeft();w.stopRight();w.stopUp();w.stopDown();ra.stopInDirection(1);ra.stopInDirection(-1)}var w=this,x=!0,t=Math.PI/12,A=Symbol("MOVE_SOURCE_NONE"),D=Symbol("MOVE_SOURCE_KEY"),
H=Symbol("MOVE_SOURCE_GESTURE"),G=Symbol("MOVE_SOURCE_GAMEPAD"),K=1,W=new e(S.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),O=new e(S.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),ea=new e(S.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE),ra=new e(t),va=[new C.Vector2(0,0),new C.Vector2(0,0)],I=[new C.Vector2(0,0),new C.Vector2(0,0)],V=0,pa=Symbol("GESTURE_RECOGNITION"),T=Symbol("GESTURE_PINCH"),P=Symbol("GESTURE_TWO_POINTER_DRAG"),ca=Symbol("GESTURE_IGNORE"),J=null,aa=[new C.Vector2(0,0),new C.Vector2(0,0)],na=0,L=0,Q=!1,
ia=new C.Object3D,Z=new C.Object3D,ka=new C.Object3D,ma=!1,M=new C.Vector3(0,0,0),fa=new C.Euler(0,0,0),ja=new C.Vector2,ta=new C.Vector2,X=new C.Vector2;ia.add(a);Z.add(ia);ka.add(Z);this.flipMouseLook=this.mousePressLook=!1;this.restrictVerticalAngle=this.mouseControlsPitch=!0;this.verticalAngleMin=-Math.PI/2;this.verticalAngleMax=Math.PI/3;this.arrowsTurn=!0;this.orbit=new If(a,this,b,d);this.cameraHeight=null;this.isFpsEnabled=function(){return x};this.isOrbitEnabled=function(){return this.orbit.isEnabled()};
this.orbitModeEnable=function(){x=!1;this.orbit.enable()};this.camera=function(){return a};this.applyCameraYaw=function(Y){Y.applyEuler(ka.rotation)};this.cameraWorldPosition=function(){return ka.position};this.cameraPositionUpdated=function(){var Y={type:"positionChanged",target:null},qa=null,za=null,Ka=null;return function(){ka.updateMatrixWorld(!0);var Ba=ka.position;Y.newPosition=Ba;if(qa!==Ba.x||za!==Ba.y||Ka!==Ba.z)qa=Ba.x,za=Ba.y,Ka=Ba.z,a.dispatchEvent(Y)}}();this.resetRollAngle=function(){0!==
ia.rotation.y&&(fa.y=0,g())};this.getPitchAngle=function(){return Z.rotation.x};this.setPitchAngle=function(Y){Y!==Z.rotation.x&&(M.x=Y,fa.x=0,g())};this.resetPitchAngle=function(){this.setPitchAngle(0)};this.getYawAngle=function(){return ka.rotation.z};this.setYawAngle=function(Y){Y!==ka.rotation.z&&(M.z=Y,fa.z=0,g())};this.resetYawAngle=function(){this.setYawAngle(0)};this.isHandlingGesture=function(){return null!==J};this.hmdReset=function(){ma=!0;this.resetPitchAngle()};this.onHmdUpdate=function(){var Y=
new C.Vector3,qa=new C.Vector3,za=new C.Vector3,Ka=new C.Vector3,Ba=new C.Vector3;return function(Ea,Ga){x&&(fa.copy(Ea),ma?M.z-=fa.z:Ga&&(Ka.subVectors(Ga,za),Y.set(Math.cos(M.z),Math.sin(M.z),0),qa.set(-Math.sin(M.z),Math.cos(M.z),0),Ba.copy(Y.multiplyScalar(Ka.x)),Ba.add(qa.multiplyScalar(Ka.y)),Ba.z=Ka.z,ka.position.add(Ba)),Ga&&za.copy(Ga),ma=!1,g())}}();this.maxFrameMoveLinearDistance=function(Y){return Math.min(Y*a.moveMaxSpeed*K,S.CAMERA_MAX_PER_FRAME_LINEAR_DISTANCE)};this.movesForward=function(){return O.movesInDirection(1)||
0<V};this.stopForward=function(){0<V&&(V=0);O.stopInDirection(1)};this.movesBackward=function(){return O.movesInDirection(-1)||0>V};this.stopBackward=function(){0>V&&(V=0);O.stopInDirection(-1)};this.movesLeft=function(){return W.movesInDirection(-1)};this.stopLeft=function(){W.stopInDirection(-1)};this.movesRight=function(){return W.movesInDirection(1)};this.stopRight=function(){W.stopInDirection(1)};this.movesUp=function(){return ea.movesInDirection(1)};this.stopUp=function(){ea.stopInDirection(1)};
this.movesDown=function(){return ea.movesInDirection(-1)};this.stopDown=function(){ea.stopInDirection(-1)};this.enable=function(){this.orbit.disable();x=!0;Q=0};this.disable=function(){this.orbit.disable();x=!1;q()};this.update=function(Y){if(x){1E-4<ta.distanceTo(X)?(ta.lerp(X,Math.min(Y/S.CAMERA_LOOK_SMOOTHING,1)),M.z+=ta.x-ja.x,M.x+=ta.y-ja.y,w.restrictVerticalAngle&&(M.x>w.verticalAngleMax?M.x=w.verticalAngleMax:M.x<w.verticalAngleMin&&(M.x=w.verticalAngleMin)),g(),ja.copy(ta),d.requestFrame()):
(ja.set(0,0),ta.set(0,0),X.set(0,0));O.activeSource===H&&100<Date.now()-na&&O.deactivateSource(H);ea.activeSource===H&&100<Date.now()-L&&ea.deactivateSource(H);var qa=W.update(a.moveMaxSpeed*K,Y),za=O.update(a.moveMaxSpeed*K,Y),Ka=ea.update(a.moveMaxSpeed*K,Y);var Ba=0;za?V=0:(V&&(za=w.maxFrameMoveLinearDistance(Y),Ba=C.Math.clamp(V,-za,za),V-=Ba),za=Ba);ka.translateX(qa);ka.translateY(za);ka.translateZ(Ka);Y=ra.update(S.CAMERA_ARROWS_TURN_SPEED,Y);M.z+=Y;f();(W.moves()||O.moves()||ea.moves()||ra.moves()||
V)&&d.requestFrame();this.cameraPositionUpdated()}else this.orbit.update(Y)};a.rotation.set(0,0,0);a.up.set(0,0,1);a.lookAt(new C.Vector3(0,1,0));b.setAttribute("tabindex",-1);b.addEventListener("contextmenu",function(Y){Y.preventDefault()},!1);b.addEventListener("mousedown",n,!1);b.addEventListener("touchstart",function(Y){x&&(Y.preventDefault(),h(Y),2===Y.touches.length?(J=pa,aa[0].copy(va[0]),aa[1].copy(va[1])):2<Y.touches.length&&(J=ca))},!1);b.addEventListener("mousemove",l,!1);b.addEventListener("touchmove",
l,!1);b.addEventListener("mouseup",p,!1);b.addEventListener("touchend",function(Y){x&&(Y.preventDefault(),J=0===Y.touches.length?null:ca)},!1);b.addEventListener("keydown",function(Y){var qa=!0;if(x&&!(Y.ctrlKey||Y.altKey||Y.metaKey)){K=Y.shiftKey?S.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:1;switch(Y.keyCode){case 38:case 32:case 87:O.activateDirectionFromSource(1,D);break;case 37:w.arrowsTurn?ra.activateDirectionFromSource(1,D):W.activateDirectionFromSource(-1,D);break;case 65:W.activateDirectionFromSource(-1,
D);break;case 40:case 83:O.activateDirectionFromSource(-1,D);break;case 39:w.arrowsTurn?ra.activateDirectionFromSource(-1,D):W.activateDirectionFromSource(1,D);break;case 68:W.activateDirectionFromSource(1,D);break;case 33:case 69:ea.activateDirectionFromSource(1,D);break;case 34:case 81:ea.activateDirectionFromSource(-1,D);break;default:qa=!1}qa&&(Y.preventDefault(),d.requestFrame())}},!1);b.addEventListener("keyup",function(Y){var qa=!0;if(x){K=Y.shiftKey?S.CAMERA_MOVE_MAX_SPEED_SHIFT_FACTOR:1;
switch(Y.keyCode){case 38:case 32:case 87:O.deactivateDirectionFromSource(1,D);break;case 37:case 65:ra.deactivateDirectionFromSource(1,D);W.deactivateDirectionFromSource(-1,D);break;case 40:case 83:O.deactivateDirectionFromSource(-1,D);break;case 39:case 68:ra.deactivateDirectionFromSource(-1,D);W.deactivateDirectionFromSource(1,D);break;case 33:case 69:ea.deactivateDirectionFromSource(1,D);break;case 34:case 81:ea.deactivateDirectionFromSource(-1,D);break;default:qa=!1}qa&&Y.preventDefault()}},
!1);b.addEventListener("mouseout",function(Y){p(Y)},!1);b.addEventListener("mouseenter",function(Y){0<Y.buttons&&n(Y)},!1);b.addEventListener("DOMMouseScroll",r,!1);b.addEventListener("mousewheel",r,!1);b.addEventListener("blur",function(){q()},!1);c.addEventListener("actionActivated",function(Y){if(x)switch(Y.action){case Af.BACKWARD:O.activateDirectionFromSource(-1,G);break;case Af.FORWARD:O.activateDirectionFromSource(1,G);break;case Af.LEFT:w.arrowsTurn?ra.activateDirectionFromSource(1,G):W.activateDirectionFromSource(-1,
G);break;case Af.RIGHT:w.arrowsTurn?ra.activateDirectionFromSource(-1,G):W.activateDirectionFromSource(1,G);break;case Af.DOWN:ea.activateDirectionFromSource(-1,G);break;case Af.UP:ea.activateDirectionFromSource(1,G)}});c.addEventListener("actionDeactivated",function(Y){if(x)switch(Y.action){case Af.BACKWARD:O.deactivateDirectionFromSource(-1,G);break;case Af.FORWARD:O.deactivateDirectionFromSource(1,G);break;case Af.LEFT:W.deactivateDirectionFromSource(-1,G);ra.deactivateDirectionFromSource(1,G);
break;case Af.RIGHT:W.deactivateDirectionFromSource(1,G);ra.deactivateDirectionFromSource(-1,G);break;case Af.DOWN:ea.deactivateDirectionFromSource(-1,G);break;case Af.UP:ea.deactivateDirectionFromSource(1,G)}});this.isEnabled=function(){return x}};/*
 Copyright (C) 2020-present Shapespark
*/
function Kf(){var a=this,b=!1,c={type:"modeDisabled"},d={type:"modeEnabled"};this.enableMode=function(){b=!0;a.dispatchEvent(d)};this.disableMode=function(){b=!1;a.dispatchEvent(c)};this.modeIsEnabled=function(){return b}}C.EventDispatcher.prototype.apply(Kf.prototype);function Lf(){Dd.call(this,"gaze_pointer_vertex.glsl","gaze_pointer_fragment.glsl");this.blending=C.NormalBlending;this.transparent=!0;this.transparentRenderOrder=2;this.setUniform("circleSpan","f",0)}Lf.prototype=Object.create(Dd.prototype);Lf.prototype.constructor=Lf;Object.defineProperty(Lf.prototype,"circleSpan",{set:function(a){console.assert(1>=a);this.uniforms.circleSpan.value=2*Math.PI*a-Math.PI}});/*
 Copyright (C) 2017-present Shapespark
*/
console.assert(S.GAZE_POINTER_SHOW_LOADING_AFTER_S<=S.GAZE_POINTER_ACTIVATE_AFTER_S);var Mf=Math.PI/60;function Nf(){var a=new C.BufferGeometry,b=new Float32Array(18);a.addAttribute("position",new C.BufferAttribute(b,3));b[0]=.05;b[1]=-.05;b[2]=-2;b[3]=.05;b[4]=.05;b[5]=-2;b[6]=-.05;b[7]=-.05;b[8]=-2;b[9]=.05;b[10]=.05;b[11]=-2;b[12]=-.05;b[13]=.05;b[14]=-2;b[15]=-.05;b[16]=-.05;b[17]=-2;a.computeBoundingSphere();return a}
function Of(a,b,c,d){function e(){if(!g)f();else if(!p){var w=new Lf,x=new C.Mesh(Nf(),w);a.addAuxiliaryObject(x);x.frustumCulled=!1;x.matrixWorld=b.camera().matrixWorld;p={setVisible:function(t){x.visible=t;c()},setCircleSpan:function(t){w.circleSpan=t;c()}};f()}p&&p.setVisible(g)}function f(){k=h=null;l=0;n=!1;p&&p.setCircleSpan(0)}var g=d.modeIsEnabled(),k,h,l,n,p=null,r=null,q=null;this.setGazeHandlers=function(w,x){r=w;q=x};d.addEventListener("modeDisabled",function(){g=!1;e()});d.addEventListener("modeEnabled",
function(){g=!0;e()});this.reset=function(){null!==k&&f()};this.update=function(w){if(g){var x=b.getPitchAngle(),t=b.getYawAngle();null===k?(k=x,h=t):Math.abs(k-x)>Mf||Math.abs(h-t)>Mf?f():(l+=w,l>=S.GAZE_POINTER_SHOW_LOADING_AFTER_S&&(n?(p.setCircleSpan(Math.min((l-S.GAZE_POINTER_SHOW_LOADING_AFTER_S)/(S.GAZE_POINTER_ACTIVATE_AFTER_S-S.GAZE_POINTER_SHOW_LOADING_AFTER_S),1)),l>=S.GAZE_POINTER_ACTIVATE_AFTER_S&&(q&&q(),f())):r&&r()?n=!0:f()))}};e()};/*
 Copyright (C) 2018-present Shapespark
*/
function Pf(a,b){function c(){var d=S.urlHashGetArgument("view");d&&(d=a.findViewByName(d))&&(b.switchToView(d),window.location.hash=S.urlHashRemoveArgument("view"))}window.addEventListener("hashchange",c,!1);this.dispose=function(){window.removeEventListener("hashchange",c,!1)}};function Qf(a,b,c,d,e,f,g,k){function h(K,W){K=K?e:d;for(var O=0;O<K.length;O+=1)if(K[O](W.object,W.point,W.distance))return!0;return!1}function l(){return b.findIntersectionAtPosition(0,0,!0,x)}function n(){h(!1,x)}function p(K,W,O){k&&k.reset();return b.findIntersectionAtPosition(K,W,!0,D)?h(O,D):!1}function r(K){k&&k.reset();K.action===Af.TRIGGER&&p(0,0,!1)}function q(K,W){for(var O=0;O<f.length&&!f[O](K,W);O+=1);}var w=!1,x=new Qe,t=null;k&&k.setGazeHandlers(l,n);var A=new Se(a,S.POINTER_PRIORITY.INTERACTION_DISPATCHER);
a=A.callbacks;var D=new Qe,H=null,G=null;a.onPointerMove=function(K,W){console.assert(w);0!==f.length&&(H=K,G=W,c());return!1};a.onClick=function(K,W){return p(K,W,!1)};a.onDoubleClick=function(K,W){return p(K,W,!0)};g.addEventListener("actionActivated",r);this.handleHover=function(){if(w&&0!==f.length){var K=b.findObstacleMeshAtPosition(H,G,!0);null===K?t&&(q(t,!1),t=null):K!==t&&(t&&q(t,!1),q(K,!0),t=K)}};this.enable=function(){w=!0;A.enable();console.assert(null===t)};this.disable=function(){w=
!1;null!==t&&(q(t,!1),t=null);A.disable()};this.dispose=function(){this.disable();g.removeEventListener("actionActivated",r)};this.enable()};var Rf={MAIN:0,AUXILIARY:1,SECONDARY:2,NONE:-1},Sf={SHIFT:1,CTRL_EQUIVALENT:2,ALT_EQUIVALENT:4};
function Tf(a,b){function c(t){if(void 0===t.button)return Rf.MAIN;switch(t.button){case 0:return Rf.MAIN;case 1:return Rf.AUXILIARY;case 2:return Rf.SECONDARY}return Rf.NONE}function d(t,A,D){if(!D)for(D=0;D<t.changedTouches.length;D++){var H=t.changedTouches[D];if(H.identifier===A)return H}for(D=0;D<t.touches.length;D++)if(H=t.touches[D],H.identifier===A)return H;return null}function e(t,A){if(0!==t.length){var D=void 0!==A.touches;if(!D&&(document.pointerLockElement||document.mozPointerLockElement||
document.webkitPointerLockElement))w.clipX=0,w.clipY=0;else{if(D){var H=d(A,q);console.assert(null!==H);D=H.clientX;H=H.clientY}else D=A.clientX,H=A.clientY;w.clipX=D/window.innerWidth*2-1;w.clipY=2*-(H/window.innerHeight)+1}D=w;for(H=0;H<t.length;H++){var G=t[H].callback,K=D.clipX,W=D.clipY,O=0;if(A.ctrlKey&&!Bc.mac||A.metaKey&&Bc.mac)O|=Sf.CTRL_EQUIVALENT;A.altKey&&(O|=Sf.ALT_EQUIVALENT);A.shiftKey&&(O|=Sf.SHIFT);if(G(K,W,O))break}}}function f(t){c(t)!==Rf.MAIN||r||(r=!0,void 0!==t.touches&&(console.assert(0<
t.changedTouches.length),q=t.changedTouches[0].identifier),e(l,t))}function g(t){if(c(t)===Rf.MAIN){var A=void 0!==t.touches;A&&d(t,q,!0)||!r||(r=!1,e(n,t),A&&(q=-1))}}function k(t){void 0!==t.touches&&-1===q||e(p,t)}function h(t,A,D){var H=t.filter(function(K){return K.callback===A});console.assert(0===H.length,"Do not add the same callback twice!");D={callback:A,priority:D};for(H=H=0;H<t.length;H+=1){var G=t[H];if(D.priority<=G.priority){if(D.priority===G.priority){console.error("Adding two listeners with the same priority is not allowed!");
return}break}}t.splice(H,0,D)}var l=[],n=[],p=[],r=!1,q=-1,w={clipX:0,clipY:0};this.addPointerDownListener=function(t,A){h(l,t,A)};this.removePointerDownListener=function(t){l=l.filter(function(A){return A.callback!==t})};this.addPointerUpListener=function(t,A){h(n,t,A)};this.removePointerUpListener=function(t){n=n.filter(function(A){return A.callback!==t})};this.addPointerMoveListener=function(t,A){h(p,t,A)};this.removePointerMoveListener=function(t){p=p.filter(function(A){return A.callback!==t})};
var x=!1;this.isEnabled=function(){return x};this.enable=function(){x||(a.addEventListener("mousedown",f,!1),a.addEventListener("touchstart",f,!1),a.addEventListener("mouseup",g,!1),a.addEventListener("touchend",g,!1),a.addEventListener("mousemove",k,!1),a.addEventListener("touchmove",k,!1),window.addEventListener("mouseup",g,!1),b&&window.top.addEventListener("mouseup",g,!1),x=!0)};this.disable=function(){x&&(a.removeEventListener("mousedown",f,!1),a.removeEventListener("touchstart",f,!1),a.removeEventListener("mouseup",
g,!1),a.removeEventListener("touchend",g,!1),a.removeEventListener("mousemove",k,!1),a.removeEventListener("touchmove",k,!1),window.removeEventListener("mouseup",g,!1),b&&window.top.removeEventListener("mouseup",g,!1),x=!1)};this.enable()};var Uf=[new C.Vector2(0,1),new C.Vector2(1,0),new C.Vector2(-1,0),new C.Vector2(0,-1)];
function Vf(a,b,c){function d(h,l,n){var p=new C.Vector3,r=[h];Uf.forEach(function(q){p.copy(l);p.x+=.1*q.x;p.y+=.1*q.y;q=a.distanceToGroundFrom(p,1.1*n);isFinite(q)&&r.push(q)});return r.reduce(function(q,w){return Math.min(q,w)},Infinity)}var e,f,g=b.cameraWorldPosition(),k=new C.Vector3;this.updateCameraHeight=function(h){if(e){var l=g.z-k.z;g.x!==k.x||g.y!==k.y?f=a.distanceToGround(S.MAX_GROUND_SEARCH_DEPTH):Infinity!==f&&(f+=l);if(Infinity!==f&&(null!==b.cameraHeight?(b.cameraHeight+=l,b.cameraHeight=
Math.max(.02,b.cameraHeight)):b.cameraHeight=f,l=b.cameraHeight,f<l-.005||f>l+.005)){var n=Math.max(Math.sqrt(Math.pow(g.x-k.x,2)+Math.pow(g.y-k.y,2))/h*1.5,S.CAMERA_DEFAULT_MOVE_MAX_SPEED);l=b.cameraHeight;f=d(f,g,l);h=Math.min(n*h,Math.abs(f-l));f>l&&(h=-h);if(0>h||Infinity===a.distanceToCeiling(h+S.MIN_DISTANCE_TO_CEILING)&&.005<Math.abs(h))g.z+=h,f+=h,c.requestFrame()}k.copy(g)}};this.enable=function(){e=!0;f=a.distanceToGround(S.MAX_GROUND_SEARCH_DEPTH);b.cameraHeight=Infinity!==f?f:null;k.copy(g)};
this.disable=function(){e=!1};this.isEnabled=function(){return e};this.enable()};function Wf(a,b){function c(r){var q=[];this.start=function(){var w=performance.now();q.push({start:w,end:w,delta:0})};this.end=function(){var w=performance.now();void 0!==q[q.length-1]&&(q[q.length-1].end=w,q[q.length-1].delta=q[q.length-1].end-q[q.length-1].start)};this.stats=function(){var w=q[q.length-1].delta,x=q.reduce(function(D,H){return D.delta<H.delta?D:H}).delta,t=q.reduce(function(D,H){return D.delta>H.delta?D:H}).delta,A=e(q,"delta")/q.length;return{name:r,last:d(w),best:d(x),worst:d(t),
average:d(A)}}}function d(r){return parseFloat(r.toFixed(4))}function e(r,q){return r.reduce(function(w,x){return w+x[q]},0)}function f(r,q,w,x){var t=2*r.x;r=2*r.y;x=2*(void 0===x?1:x);n.lineWidth=2*(void 0===w?1:w);n.strokeStyle=void 0===q?"black":q;n.beginPath();n.arc(t,r,x,0,2*Math.PI);n.stroke()}function g(r){r.forEach(function(q){var w=255*q.distanceToObstacle;w=0===q.distanceToObstacle?"black":"rgb(255,"+w+","+w+")";var x=!0;w=void 0===w?"black":w;x=void 0===x?!1:x;var t=2*q.x-1;q=2*q.y-1;
n.lineWidth=0;n.strokeStyle=w;n.fillStyle=w;n.beginPath();n.rect(t,q,2,2);n.stroke();x&&n.fill()})}function k(r){r.forEach(function(q){q=new C.Vector2(q.x,q.y);f(q,"green",.5,.5)})}function h(r){r.forEach(function(q,w){q=new C.Vector2(q.x,q.y);0<w&&(w=new C.Vector2(r[w-1].x,r[w-1].y),n.lineWidth=2,n.strokeStyle="blue",n.beginPath(),n.moveTo(2*w.x,2*w.y),n.lineTo(2*q.x,2*q.y),n.stroke());f(q,"blue",1,1)})}console.warn("Camera path debug mode");var l=document.createElement("canvas"),n=l.getContext("2d");
l.width=2*a;l.height=2*b;l.style.position="absolute";l.style.left="0";l.style.top="0";l.style.maxWidth="100%";document.body.appendChild(l);var p={};this.render=function(r,q,w){n.clearRect(0,0,2*a,2*b);g(r);k(q);h(w)};this.timeStart=function(r){void 0===p[r]&&(p[r]=new c(r));p[r].start()};this.timeEnd=function(r){void 0!==p[r]&&p[r].end()};this.logTime=function(){var r=[];Object.values(p).forEach(function(w){r.push(w.stats())});var q={name:"TOTAL",last:d(e(r,"last")),best:d(e(r,"best")),worst:d(e(r,
"worst")),average:d(e(r,"average"))};r.push(q);console.table(r)}}
function Xf(a){function b(e){for(var f=d[e];0<e;){var g=Math.floor((e-1)/2),k=d[g];if(f[a]<=k[a])d[g]=f,d[e]=k,e=g;else break}}function c(e){for(var f=d[e];;){var g=2*e+1,k=2*e+2,h=void 0,l=null;g<d.length&&(h=d[g],f[a]>h[a]&&(l=g));k<d.length&&(g=d[k],null===l&&f[a]>g[a]||null!==l&&h[a]>g[a])&&(l=k);if(null!==l)d[e]=d[l],d[l]=f,e=l;else break}}a=void 0===a?"score":a;var d=[];this.extract=function(){var e=d[0],f=d.pop();0<d.length&&(d[0]=f,c(0));return e};this.insert=function(e){d.push(e);b(d.length-
1)};this.update=function(e){var f=d.indexOf(e);0!==f&&(e[a]<d[Math.floor((f-1)/2)]?b(f):c(f))};this.size=function(){return d.length}}function Yf(a,b,c,d){this.id=a;this.x=b;this.y=c;this.distanceToObstacle=d;this.parent=null;this.score=0}
Yf.prototype={distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},distanceMeasured:function(){return void 0!==this.distanceToObstacle},isObstacle:function(){return 0===this.distanceToObstacle},visited:function(){return null!==this.parent},visit:function(a,b){this.parent=a;this.score=b}};
function Zf(a,b,c,d){var e=[-1,1,-b,b],f=a.canvasRange,g=a.collisionRange,k=[];(function(h){for(var l=new Xf("distanceToObstacle"),n=0;n<=h.data.length;n+=4){var p=255===h.data[n-1],r=Math.floor(n/(4*b));r=new Yf(n/4,n/4-r*b,r,p?0:void 0);k.push(r);p&&l.insert(r)}for(h={};0<l.size();)h.$jscomp$loop$prop$current$198=l.extract(),e.forEach(function(q){return function(w){w=q.$jscomp$loop$prop$current$198.id+w;1>q.$jscomp$loop$prop$current$198.distanceToObstacle&&void 0!==k[w]&&!1===k[w].distanceMeasured()&&
(k[w].distanceToObstacle=Math.min(1,q.$jscomp$loop$prop$current$198.distanceToObstacle+1/d),l.insert(k[w]))}}(h)),h={$jscomp$loop$prop$current$198:h.$jscomp$loop$prop$current$198}})(a.collisionImageData);this.forEachNeighbour=function(h,l){var n=h.x+h.y*b;e.forEach(function(p){var r;if(r=void 0!==k[n+p])if(r=k[n+p],0!==h.x&&h.x!==b-1)r=!0;else{var q=h.x+r.x!==b-2;r=1===h.x+r.x&&!q}r&&l(k[n+p])})};this.hasObstacleAt=function(h,l){return k[Math.round(h)+Math.round(l)*b].isObstacle()};this.getNodeAtScenePosition=
function(h){var l=Math.round(C.Math.mapLinear(h.position.x,g.x.min,g.x.max,f.x.min,f.x.max));h=Math.round(C.Math.mapLinear(h.position.y,g.y.min,g.y.max,f.y.min,f.y.max));return k[l+h*b]};this.getScenePointFromNode=function(h){var l=C.Math.mapLinear(h.x,f.x.min,f.x.max,g.x.min,g.x.max);h=C.Math.mapLinear(h.y,f.y.min,f.y.max,g.y.min,g.y.max);return new C.Vector2(l,h)};this.resetNodeMap=function(){k.forEach(function(h){h.parent=null;h.score=0})};this.getNodeMap=function(){return k}}
function $f(a,b){function c(l,n){var p=f.getNodeAtScenePosition(l);n=f.getNodeAtScenePosition(n);if(!p||!n)return[];var r=new Xf;r.insert(p);l=[];for(var q={};0<r.size();){q.$jscomp$loop$prop$current$200=r.extract();if(q.$jscomp$loop$prop$current$200===n){for(n=q.$jscomp$loop$prop$current$200;n;n=n.parent)n&&l.push(n);l.reverse();break}f.forEachNeighbour(q.$jscomp$loop$prop$current$200,function(w){return function(x){if(!x.isObstacle()){var t=w.$jscomp$loop$prop$current$200.score+1/(x.distanceToObstacle?
x.distanceToObstacle:1),A=x.visited()||x===p;if(!A||t<x.score)x.visit(w.$jscomp$loop$prop$current$200,t),A?r.update(x):r.insert(x)}}}(q));q={$jscomp$loop$prop$current$200:q.$jscomp$loop$prop$current$200}}return l}function d(l,n,p,r){var q;a:{for(q=l+1;q<n.length;q++){b:{var w=n[l],x=n[q],t=w.x<x.x?w:x,A=w.x<x.x?x:w,D=w.y<x.y?w:x,H=w.y<x.y?x:w;var G=t.x===A.x?null:(A.y-t.y)/(A.x-t.x);var K=null===G?t.x:t.y-G*t.x;if(Math.abs(w.y-x.y)>Math.abs(w.x-x.x))for(t=D.y;t<=H.y;t+=.2){if(f.hasObstacleAt(null===
G?D.x:(t-K)/G,t)){G=!0;break b}}else for(D=t.x;D<=A.x;D+=.2)if(f.hasObstacleAt(D,null===G?t.y:G*D+K)){G=!0;break b}G=!1}if(G)break a}q=-1}-1===q?p.push(n[n.length-1]):(l=q-l,l=l>r?q-r:q-Math.floor(l/2),p.push(n[l]),d(l,n,p,r))}var e=null,f=null;a=b.calculateRenderSize(200,a.collisionBoundingBox);var g=a.width,k=a.height,h=S.DEBUG_CAMERA_PATH?new Wf(g,k):null;this.findPath=function(l,n){h&&h.timeStart("Graph");var p=n.position.z.toFixed(4);if(p!==e){var r={outlineThickness:2,outlineColor:new C.Color(0,
0,0),slicePlaneHeight:n.position.z};r=b.getCollisionData(r,g,k);f=new Zf(r,g,k,7);e=p}else f.resetNodeMap();h&&h.timeEnd("Graph");h&&h.timeStart("Raw path");p=c(l,n);h&&h.timeEnd("Raw path");r=[];var q=[];if(2<=p.length){h&&h.timeStart("Refine path");var w=r.push,x=w.apply,t=m,A=t.arrayFromIterable,D=[p[0]];d(0,p,D,5);x.call(w,r,A.call(t,D));h&&h.timeEnd("Refine path");h&&h.timeStart("Calculate points");w=q.push;x=w.apply;t=m;A=t.arrayFromIterable;D=[];D.push(new C.Vector2(l.position.x,l.position.y));
for(l=1;l<r.length-1;l++)D.push(f.getScenePointFromNode(r[l]));D.push(new C.Vector2(n.position.x,n.position.y));x.call(w,q,A.call(t,D));h&&h.timeEnd("Calculate points")}h&&(h.render(f.getNodeMap(),p,r),h.logTime());return q}};var ag=Math.PI/3,bg=2*S.CAMERA_DEFAULT_MOVE_MAX_SPEED;function cg(a){return-(Math.cos(Math.PI*a)-1)/2}function dg(a){this.distance=a;this.time=this.velocity=0;this.setVelocityFromCornerAngle=function(b){this.velocity=C.Math.mapLinear(Math.max(ag,b),ag,Math.PI,1,bg)}}function gg(a,b,c){this.endTime=function(){return b.time};this.getDistance=function(d){d-=a.time;return a.distance+(a.velocity*d+.5*c*Math.pow(d,2))};this.isTimeWithinEquation=function(d){return d>=a.time&&d<=b.time}}
function hg(a,b,c,d,e,f){this.endTime=function(){return b.time};this.getDistance=function(g){g-=a.time;return g<d?a.distance+(a.velocity*g+.5*f*Math.pow(g,2)):a.distance+e+(c*(g-d)-.5*f*Math.pow(g-d,2))};this.isTimeWithinEquation=function(g){return g>=a.time&&g<=b.time}}
function ig(a,b,c){this.endDistance=b;this.getPoint=function(d){d=C.Math.mapLinear(d,a,b,0,1);return c.get(d)};this.getRotation=function(d){d=C.Math.mapLinear(d,a,b,0,1);d=c.normal(d);return Math.atan2(d.y,d.x)-Math.PI};this.isDistanceWithinCurve=function(d){return d>=a&&d<=b}}
function jg(a,b,c){var d=a.velocity,e=b.velocity,f=b.distance-a.distance,g=Math.sqrt(.5*Math.pow(d,2)+.5*Math.pow(e,2)+f*c);if(g>d&&g>e){var k=.5*(Math.pow(g,2)-Math.pow(d,2))/c;console.assert(.001>Math.abs(f-k-.5*(Math.pow(g,2)-Math.pow(e,2))/c));d=(g-d)/c;b.time=a.time+d+(g-e)/c;return new hg(a,b,g,d,k,c)}if(g<=e)return e=Math.sqrt(Math.pow(d,2)+2*f*c),console.assert(.001>Math.abs(f-.5*(Math.pow(e,2)-Math.pow(d,2))/c)),b.time=a.time+(e-d)/c,b.velocity=e,new gg(a,b,c);c=2*f/(d+e);console.assert(.001>
Math.abs(f-(d*c+.5*(e-d)*c)));b.time=a.time+c;return new gg(a,b,(e-d)/c)}var kg=function(){var a=new C.Vector2,b=new C.Vector2;return function(c,d,e){a.subVectors(d,c);b.subVectors(e,d);return Math.asin((a.x*b.y-a.y*b.x)/(a.length()*b.length()))}}();function lg(a){return new C.Vector2(a.x,a.y)}function mg(a,b){return new re([a,a.clone().lerp(b,1/3),a.clone().lerp(b,2/3),b])}
function ng(a,b,c,d){var e=b.distanceTo(a),f=b.distanceTo(c),g=Math.min(f,e);e=g/e;f=g/f;g=.5>d/g?d/g:.5;d=b.clone().lerp(a,g*e);a=b.clone().lerp(a,g/3*e);e=b.clone().lerp(c,g/3*f);b=b.clone().lerp(c,g*f);return new re([d,a,e,b])}function og(a,b){var c=Oa(b.x-a.x);a=Oa(b.y-a.y);return C.Math.mapLinear(Math.sqrt(1-Math.pow(Math.max(Math.abs(c),Math.abs(a))/Math.PI-1,2)),0,1,0,2)}
function pg(a,b,c,d,e,f,g,k,h,l,n,p){function r(J){return T.find(function(aa){return aa.isDistanceWithinCurve(J)})}function q(){for(var J=[],aa=1;aa<c.length-1;aa++){var na=c[aa-1],L=c[aa],Q=c[aa+1],ia=kg(na,L,Q),Z=C.Math.mapLinear(Math.max(ag,ia),ag,Math.PI,2,6);na=ng(na,L,Q,Z);J.push({bezier:na,angle:ia})}aa=[];aa.push(new dg(0));na=c[0];for(L=ia=0;L<J.length;L++){var ka=J[L-1];Q=J[L];Z=J[L+1];void 0!==ka&&(na=lg(ka.bezier.points[3]));ka=lg(Q.bezier.points[0]);ka=mg(na,ka);if(0<ka.length()){var ma=
ia,M=ia+ka.length();ma=new ig(ma,M,ka);T.push(ma);ia+=ka.length()}ka=Q.bezier.length()/2;ma=new ig(ia,ia+2*ka,Q.bezier);T.push(ma);ia+=ka;ma=Math.abs(Q.angle);ma>ag&&(M=new dg(ia),M.setVelocityFromCornerAngle(ma),aa.push(M));ia+=ka;void 0===Z&&(na=lg(Q.bezier.points[3]))}J=mg(na,c[c.length-1]);na=ia+J.length();na=new ig(ia,na,J);T.push(na);ia+=J.length();aa.push(new dg(ia));for(J=1;J<aa.length;J++)na=jg(aa[J-1],aa[J],n),P.push(na);ra=function(fa){return O.getPoint(fa)};O=T[0];ea=P[0];K=ia;J=P[P.length-
1].endTime();G=Math.max(2,Math.min(J,l));W=P[P.length-1].endTime()/G}function w(){if(5<K){var J=r(1.25),aa=Oa(J.getRotation(1.25)-e.x),na=K-3.75;J=r(na);var L=Oa(k.x-J.getRotation(na));I=function(M){return 1.25>M?(M=cg(M/1.25),e.x+M*aa):M>na?(M=1-cg((M-na)/(K-na)),k.x-M*L):O.getRotation(M)}}else{var Q=Oa(k.x-e.x);I=function(M){M=cg(M/K);return e.x+M*Q}}if(5<K){var ia=Oa(0-e.y),Z=K-3.25,ka=Oa(k.y);V=function(M){return 1.75>M?(M=cg(M/1.75),e.y+M*ia):M>Z?cg((M-Z)/(K-Z))*ka:0}}else{var ma=Oa(k.y-e.y);
V=function(M){M=cg(M/K);return e.y+M*ma}}}function x(){var J=Oa(k.x-e.x);I=function(na){return e.x+cg(na/G)*J};var aa=Oa(k.y-e.y);V=function(na){return e.y+cg(na/G)*aa}}function t(){var J=3<K?3:K;va=function(aa){return aa<J?(aa=cg(aa/J),C.Math.mapLinear(aa,0,1,d,g)):g}}function A(){va=function(J){J=cg(J/G);return C.Math.mapLinear(J,0,1,d,g)}}function D(){var J=H*W;J>ea.endTime()&&(ea=P.find(function(aa){return aa.isTimeWithinEquation(J)}));return ea.getDistance(J)}var H=0,G=og(e,k),K=0,W=1,O=null,
ea=null,ra=null,va=null,I=null,V=null,pa=null,T=[],P=[],ca=.001<c[0].distanceTo(c[c.length-1]);ca&&q();p&&ca?(w(),t()):(x(),void 0!==g&&(!ca&&.001<Math.abs(g-d)&&(K=Math.abs(g-d),G=Math.max(2,Math.min(Math.sqrt(K/n),l))),A()),x());void 0!==h&&(pa=function(J){J=cg(J/G);return C.Math.mapLinear(J,0,1,f,h)});this.update=function(J,aa){H+=J;if(H<G){p&&ca?(J=D(),J>O.endDistance&&(O=r(J))):J=H;if(ra){var na=ra(D());aa.setX(na.x);aa.setY(na.y)}va&&(na=va(J),aa.setZ(na));pa&&(a.fov=pa(H),a.updateProjectionMatrix());
b.setYawAngle(I(J));b.setPitchAngle(V(J));b.cameraPositionUpdated();return!0}return!1}};var qg=1/180;function rg(a){var b=null;this.activateSky=function(c){if(b){if(b.name===c)return;a.removeAuxiliaryObject(b)}var d=a.findSkyMesh(c);(c=d.material.map)&&!c.loaded?(this.activateSky(S.DEFAULT_SKY_NAME),b=d,c.addLoadedListener(function(){b===d&&(a.addAuxiliaryObject(d),d.updateMatrixWorld(!0))})):(a.addAuxiliaryObject(d),d.updateMatrixWorld(!0),b=d)};this.activeSkyName=function(){return b.name}}
function sg(a,b,c){this.position=a||new C.Vector3;this.rotation=b||new C.Vector2;this.fov=c||0}
function tg(a,b,c,d,e){function f(){x=[];for(var P=0;P<a.views.length;P+=1)x[a.views[P].id]=[];for(P=0;P<a.gpuMeshes.length;P+=1){var ca=a.gpuMeshes[P],J=ca.hideInViews;if(J)for(var aa=0;aa<J.length;aa+=1)x[J[aa]]?x[J[aa]].push(ca):console.warn("Invalid view id in hideInViews list: '"+J[P]+"'")}}function g(P){for(var ca=0;ca<P.length;ca+=1){var J=P[ca];J.visible=!1;t.push(J)}}function k(){for(var P=0;P<t.length;P+=1)t[P].visible=!0;t.length=0}function h(P){k();g(P)}function l(){w.fov=H.fov;q.copy(H.position);
b.setYawAngle(H.rotation.x);b.setPitchAngle(H.rotation.y);b.cameraPositionUpdated();D=null}function n(){return[new C.Vector2(T().position.x,T().position.y),new C.Vector2(H.position.x,H.position.y)]}var p=this,r=new rg(a),q=b.cameraWorldPosition(),w=a.camera,x,t=[],A=new $f(a,e),D=null,H=new sg,G=new C.Vector3,K,W,O,ea=!1,ra={type:"teleportStarted",target:this,view:null},va={type:"teleportDone",target:this,view:null},I=null;this.lastDestinationView=null;var V=this.teleportingToPoint=this.teleportingToView=
!1,pa=!1,T=function(){var P=new sg(b.cameraWorldPosition());return function(){P.rotation.set(Oa(b.getYawAngle()),Oa(b.getPitchAngle()));P.fov=w.fov;return P}}();this.update=function(P){if(p.teleportingToView||p.teleportingToPoint){P=Math.min(P,.067);P=Math.max(P,qg);var ca=!0;null!==D&&(this.teleportingToPoint&&(H.position.z=q.z),D.update(P,q)?ca=!1:l());ca&&(this.teleportingToView&&("orbit"!==O.mode||ea?(P=b.camera(),P.near=S.CAMERA_WALK_NEAR,P.updateProjectionMatrix(),b.enable()):(b.orbit.minDistance=
K,b.orbit.maxDistance=W,b.orbit.setPanPrimary(O.panPrimary||!1),b.orbit.noRotate=O.noRotate||!1,b.orbit.noPitchRotate=O.noPitchRotate||!1,b.orbit.getNoPan=function(){return O.noPan},b.orbit.getMinPitchAngle=function(){return-O.maxUpAngle},b.orbit.getMaxPitchAngle=function(){return-O.minUpAngle},b.orbit.getMinYawAngle=function(){return O.minSideAngle},b.orbit.getMaxYawAngle=function(){return O.maxSideAngle},b.orbit.getMinDistance=function(){return O.minDistance},b.orbit.getMaxDistance=function(){return O.maxDistance},
b.orbit.target.copy(G),b.orbitModeEnable()),r.activateSky(O.sky),h(x[O.id]||[])),this.teleportingToView=this.teleportingToPoint=!1,va.view=O,this.dispatchEvent(va));d.requestFrame()}};this.cancelSwitchToPoint=function(){console.assert(this.teleportingToPoint);this.teleportingToPoint=!1;va.view=null;this.dispatchEvent(va)};this.switchToPoint=function(P,ca){var J;if(J=P.x===q.x&&P.y===q.y)(J=void 0===ca)||(J=Oa(ca.yaw)===T().rotation.x&&Oa(ca.pitch)===T().rotation.y);J||(O=null,this.teleportingToPoint=
!0,this.teleportingToView=!1,ra.view=null,this.dispatchEvent(ra),V?H.position.set(P.x,P.y,P.z):H.position.set(P.x,P.y,q.z),ca?H.rotation.set(Oa(ca.yaw),Oa(ca.pitch)):(P=Ra(q,P),P=Oa(P),H.rotation.set(P,0)),H.fov=w.defaultFov,V?(l(),this.update(qg)):(D=new pg(w,b,n(),T().position.z,T().rotation,w.fov,void 0,H.rotation,H.fov,S.TELEPORT_TO_POINT_MAX_TIME,S.TELEPORT_TO_POINT_ACCELERATION,!1),d.requestFrame()))};this.switchToView=function(P,ca){var J="orbit"!==P.mode;var aa=p.lastDestinationView?"orbit"!==
p.lastDestinationView.mode:!0;J=w.autoPath&&J&&aa;P.hideFromMenu||(I=P);this.lastDestinationView=O=P;this.teleportingToView=!0;this.teleportingToPoint=!1;ra.view=O;this.dispatchEvent(ra);b.disable();b.resetRollAngle();g(x[O.id]||[]);void 0!==O.rotation?H.rotation.set(O.rotation.yaw,O.rotation.pitch):H.rotation.set(0,0);H.fov=O.fov||w.defaultFov;"orbit"===O.mode?(void 0!==O.target?G.set(O.target.x,O.target.y,O.target.z):G.set(0,0,0),K=O.minDistance,W=O.maxDistance,P=C.Math.clamp(O.distance||10,K,W),
If.computeCameraPosition(H.position,G,H.rotation.x,H.rotation.y,P),w.near=If.computeCameraNear(P),w.updateProjectionMatrix()):void 0!==O.position?(H.position.set(O.position.x,O.position.y,O.position.z),(pa||null!==S.CAMERA_FIXED_HEIGHT||w.autoClimb&&null!==w.fixedHeight)&&c.adjustPointToMatchCameraHeight(H.position)):H.position.set(0,0,0);if(void 0===ca&&0===S.TELEPORT_TO_VIEW_MAX_TIME||0===ca||V)l(),this.update(qg);else{O.sky!==r.activeSkyName()&&r.activateSky(S.DEFAULT_SKY_NAME);P=J?A.findPath(T(),
H):[];aa=0<P.length;P=(J=J&&aa)?P:n();aa=J?S.TELEPORT_PATH_ACCELERATION:S.TELEPORT_TO_VIEW_ACCELERATION;void 0===ca&&(ca=J?S.TELEPORT_PATH_MAX_TIME:S.TELEPORT_TO_VIEW_MAX_TIME);if(void 0===O.rotation){var na=Ra(P[P.length-2],P[P.length-1]);na=Oa(na);H.rotation.set(na,0)}D=new pg(w,b,P,T().position.z,T().rotation,w.fov,H.position.z,H.rotation,H.fov,ca,aa,J);d.requestFrame()}};this._switchToAdjacentVisibleView=function(P,ca){var J=a.visibleViews();if(0!==J.length)if(null===I)this.switchToView(J[0],
ca);else{var aa=J.indexOf(I);-1===aa&&this.switchToView(J[0],ca);this.switchToView(J[(aa+J.length+P)%J.length],ca)}};this.switchToPreviousVisibleView=function(P){this._switchToAdjacentVisibleView(-1,P)};this.switchToNextVisibleView=function(P){this._switchToAdjacentVisibleView(1,P)};this.updateHiddenMeshes=function(P){f();P?h(x[P.id]||[]):k();d.requestFrame()};this.activateSky=function(P){r.activateSky(P.sky);d.requestFrame()};this.executeWithViewVisibilitySettings=function(P,ca){var J=t.slice();
h(x[P.id]||[]);r.activateSky(P.sky);ca();r.activateSky(this.lastDestinationView.sky);h(J)};this.onVrChange=function(P){pa=V=ea=P;this.lastDestinationView&&"orbit"===this.lastDestinationView.mode&&this.switchToView(this.lastDestinationView,0)};f();a.addEventListener("viewAdded",f);a.addEventListener("viewRemoved",f);a.addEventListener("skyMeshAdded",function(P){r.activateSky(P.skyMesh.name);d.requestFrame()});a.addEventListener("skyMeshRemoved",function(P){r.activeSkyName()===P.skyMesh.name&&(r.activateSky(S.DEFAULT_SKY_NAME),
d.requestFrame())})}C.EventDispatcher.prototype.apply(tg.prototype);function ug(a,b){var c=a.cameraWorldPosition(),d,e,f;this.onHmdPositionUpdate=function(g){d&&!f&&1<g.z&&(a.cameraHeight=g.z,b.adjustPointToMatchCameraHeight(c),a.cameraPositionUpdated(),e=c.z,f=!0)};this.onTeleportDone=function(){d&&(e=c.z)};this.updateCameraHeight=function(){d&&(a.cameraHeight+=c.z-e,e=c.z)};this.enable=function(){d=!0;a.cameraHeight=b.cameraHeightFromPoint(c);null===a.cameraHeight&&(a.cameraHeight=S.FALLBACK_CAMERA_HEIGHT);e=c.z;f=!1};this.disable=function(){d=!1;a.cameraHeight=
null}};function vg(a){a.addTriangleOrderAttribute();a.convertNormalsToSpherical();return a}var wg=null,xg=null,yg={CUBE:"cube",SPHERE:"sphere"},zg=new C.Vector3,Ag=new C.Quaternion;
function Bg(a,b,c,d,e,f){C.EventDispatcher.call(this);this._enterCallbacks=a;this._exitCallbacks=b;this.volumeType=f;console.assert(0<=Object.values(yg).indexOf(this.volumeType));this.position=(new C.Vector3).fromArray(c);this.rotation=(new Ee).setFromDegTriple(d);this.scale=(new C.Vector3).fromArray(e);this._inverse=new C.Matrix4;this._inside=this._inverseCached=!1;this.onCameraPositionUpdated=this.onCameraPositionUpdated.bind(this);this.cameraPosition=null}m.inherits(Bg,C.EventDispatcher);
Bg.prototype.onCameraPositionUpdated=function(a){this.cameraPosition=a.newPosition;this.onUpdated()};Bg.prototype.onUpdated=function(){this.dispatchEvent({type:"updated",target:this});if(null!==this.cameraPosition){var a=this.isPointInside(this.cameraPosition);a!==this._inside&&((this._inside=a)?this._enterCallbacks.forEach(function(b){return b()}):this._exitCallbacks.forEach(function(b){return b()}))}};
Bg.prototype.getVolumeGeometry=function(){null===wg&&(wg=vg(new C.BoxBufferGeometry(2,2,2)),xg=vg(new Zd(1,2)));return this.volumeType===yg.SPHERE?xg:wg};Bg.prototype.setPosition=function(a,b,c){this.position.set(a,b,c);this._inverseCached=!1;this.onUpdated()};Bg.prototype.setRotation=function(a,b,c){this.rotation.yaw=Oa(a);this.rotation.pitch=Oa(b);this.rotation.roll=Oa(c);this._inverseCached=!1;this.onUpdated()};
Bg.prototype.setRotationDeg=function(a,b,c){a=C.Math.degToRad(a);b=C.Math.degToRad(b);c=C.Math.degToRad(c);this.setRotation(a,b,c)};Bg.prototype.setScale=function(a,b,c){this.scale.set(a,b,c);this._inverseCached=!1;this.onUpdated()};Bg.prototype.isPointInsideUnitSphere=function(a){return 1>=a.lengthSq()};Bg.prototype.isPointInsideUnitCube=function(a){return 1>=Math.abs(zg.x)&&1>=Math.abs(a.y)&&1>=Math.abs(a.z)};
Bg.prototype.isPointInside=function(a){this._inverseCached||(this._inverse.compose(this.position,Ag.setFromEuler(this.rotation),this.scale),this._inverse.getInverse(this._inverse),this._inverseCached=!0);zg.set(a.x,a.y,a.z).applyMatrix4(this._inverse);return this.volumeType===yg.SPHERE?this.isPointInsideUnitSphere(zg):this.isPointInsideUnitCube(zg)};Bg.prototype.dispose=function(){this._enterCallbacks=[];this._exitCallbacks=[]};function Cg(a,b){var c=this;this.id=a.id;this.name=a.name;this._type=a.type;this.gamma=a.gamma;this.exposure=a.exposure;this._constructVolumeTrigger(a,b);this.dispose=function(){b.removeEventListener("positionChanged",c.volumeTrigger.onCameraPositionUpdated)};b.addEventListener("positionChanged",this.volumeTrigger.onCameraPositionUpdated)}
Cg.prototype._constructVolumeTrigger=function(a){var b=this;this.volumeTrigger=new Bg([function(){Dg.onSceneReadyToDisplay(function(){Dg.getExposureController().addManualExposure(b.exposure,b.gamma,b.id)})}],[function(){Dg.getExposureController().removeManualExposure(b.id)}],a.position,a.rotation,a.scale,this._type)};Cg.prototype.setPriority=function(a){Dg.getExposureController().setPriority(this.id,a)};
Cg.prototype.onUpdated=function(){Dg.getExposureController().updateManualExposure(this.exposure,this.gamma,this.id)};Cg.prototype.getCameraVolumeTrigger=function(){return this.volumeTrigger};Cg.prototype.setName=function(a){this.name=a};Cg.prototype.setExposure=function(a){this.exposure=a;this.onUpdated()};Cg.prototype.setGamma=function(a){this.gamma=a;this.onUpdated()};
Cg.prototype.serialize=function(){return{id:this.id,name:this.name,type:this._type,position:this.volumeTrigger.position.toArray(),rotation:this.volumeTrigger.rotation.toDegTriple(),scale:this.volumeTrigger.scale.toArray(),exposure:this.exposure,gamma:this.gamma}};function Eg(a,b,c){this.light=a;this.position=b;this.rotation=c;this._directionW=new C.Vector3}
Eg.prototype={constructor:Eg,directionW:function(){this._directionW.set(0,1,0);this._directionW.applyEuler(this.rotation);return this._directionW},get index(){var a=this.light.instances.indexOf(this);console.assert(-1!==a,"Light instance not found");return a},setPosition:function(a,b,c){this.position.set(a,b,c);this.light._updated()},setRotation:function(a,b,c){this.rotation.yaw=Oa(a);this.rotation.pitch=Oa(b);this.rotation.roll=Oa(c);this.light._updated()},setRotationDeg:function(a,b,c){a=C.Math.degToRad(a);
b=C.Math.degToRad(b);c=void 0===c?this.rotation.roll:C.Math.degToRad(c);this.setRotation(a,b,c)},serialize:function(){return{position:this.position.toArray(),rotation:this.rotation.toDegTriple()}}};var Fg="angle color height photometricProfile strength size type width".split(" ");
function Gg(a){this._name=a.name;this._type=a.type||"spot";if(void 0!==a.strength)var b=a.strength;else a:{switch(this._type){case "point":case "spot":case "area":b=25;break a;case "sun":b=8;break a;default:console.assert(!1)}b=void 0}this._strength=b;if(void 0!==a.color)b=(new C.Color).fromArray(a.color);else a:{switch(this._type){case "point":case "spot":case "area":b=new C.Color(1,.88,.799);break a;case "sun":b=new C.Color(1,.799,.658);break a;default:console.assert(!1)}b=void 0}this._color=b;
if(void 0!==a.size)b=a.size;else a:{switch(this._type){case "point":case "spot":case "area":b=.1;break a;case "sun":b=.02;break a;default:console.assert(!1)}b=void 0}this._size=b;this._width=void 0!==a.width?a.width:.2;this._height=void 0!==a.height?a.height:.2;this._angle=void 0!==a.angle?a.angle:140;this._photometricProfile=void 0!==a.photometricProfile?a.photometricProfile:null;!0===a.doNotImport?this.doNotImport=!0:(this.doNotImport={},a.doNotImport&&La(a.doNotImport,Fg,this.doNotImport));this.instances=
[]}
Gg.prototype={constructor:Gg,forEachLightInstance:function(a){for(var b=0;b<this.instances.length;b+=1)a(this.instances[b])},get name(){return this._name},set name(a){this._name=a;this._updated()},get type(){return this._type},set type(a){this._type=a;this._updated()},get size(){return this._size},set size(a){this._size=a;this._updated()},get width(){return this._width},set width(a){this._width=a;this._updated()},get height(){return this._height},set height(a){this._height=a;this._updated()},get angle(){return this._angle},set angle(a){this._angle=
a;this._updated()},get color(){return this._color},setColorRGB:function(a,b,c){this._color.setRGB(a,b,c);this._updated()},get strength(){return this._strength},set strength(a){this._strength=a;this._updated()},get photometricProfile(){return this._photometricProfile},set photometricProfile(a){this._photometricProfile=a;this._updated()},setDoNotImport:function(a,b){this.doNotImport[a]=b;this._updated()},addInstance:function(a,b){b=void 0===b?[0,-90,0]:b;a=(new C.Vector3).fromArray(a);b=(new Ee).setFromDegTriple(b);
b=new Eg(this,a,b);this.instances.push(b);this.dispatchEvent({type:"instanceAdded",instance:b,target:this})},removeInstance:function(a){Ia(a,this.instances);this.dispatchEvent({type:"instanceRemoved",instance:a,target:this})},serialize:function(){return{name:this.name,type:this.type,angle:this.angle,strength:this.strength,photometricProfile:this.photometricProfile,size:this.size,width:this.width,height:this.height,color:this.color.roundChannels().toArray(),doNotImport:this.doNotImport,instances:this.instances.map(function(a){return a.serialize()})}},
_updated:function(){this.dispatchEvent({type:"updated",target:this})}};C.EventDispatcher.prototype.apply(Gg.prototype);Gg.iterateLightInstances=function(a,b){for(var c=1,d=0;d<a.length;d+=1)for(var e=a[d],f=0;f<e.instances.length;f+=1,c+=1)b(e,e.instances[f],c)};function Hg(a){this.id=a.id;this.position=new C.Vector3;a.position&&this.position.fromArray(a.position);this._filteredCubeTexture=null;this._filteredCubeTextureNoLod={};this._mirrorCubeTexture=null;this._boxEnabled=a.box?!("enabled"in a.box)||a.box.enabled:!1;this.boxMin=new C.Vector3;this.boxMax=new C.Vector3;a.box&&(this.boxMin.fromArray(a.box.min),this._setClampedBoxMax(a.box.max[0],a.box.max[1],a.box.max[2]))}
Hg.prototype={constructor:Hg,setFilteredTexture:function(a){this._filteredCubeTexture&&this._filteredCubeTexture.dispose();this._filteredCubeTexture=a},setFilteredTextureNoLod:function(a,b){this._filteredCubeTextureNoLod[b]&&this._filteredCubeTextureNoLod[b].dispose();this._filteredCubeTextureNoLod[b]=a},isBoundingBoxInitialized:function(){return!this.boxMin.equals(this.boxMax)},resetBoundingBox:function(){this.boxMin.set(0,0,0);this.boxMax.set(0,0,0)},isBoundingBoxEnabled:function(){return this._boxEnabled},
disableBoundingBox:function(){this._boxEnabled=!1;this.dispatchEvent({type:"boundsUpdated",target:this})},enableBoundingBox:function(){this._boxEnabled=!0;this.isBoundingBoxInitialized()||this.dispatchEvent({type:"boundsInit",target:this});this.dispatchEvent({type:"boundsUpdated",target:this})},getFilteredTexture:function(){return this._filteredCubeTexture},getFilteredTextureNoLod:function(a){return this._filteredCubeTextureNoLod[a]},setMirrorTexture:function(a){this._mirrorCubeTexture&&this._mirrorCubeTexture.dispose();
this._mirrorCubeTexture=a},setPosition:function(a,b,c){this.position.set(a,b,c);this.dispatchEvent({type:"positionUpdated",target:this})},texturesReady:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},getMirrorTexture:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},_setClampedBoxMin:function(a,b,c){a>this.boxMax.x-.1&&(a=this.boxMax.x-.1);b>this.boxMax.y-.1&&(b=this.boxMax.y-.1);c>this.boxMax.z-
.1&&(c=this.boxMax.z-.1);this.boxMin.set(a,b,c)},setBoxMin:function(a,b,c){this._setClampedBoxMin(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},_setClampedBoxMax:function(a,b,c){a<this.boxMin.x+.1&&(a=this.boxMin.x+.1);b<this.boxMin.y+.1&&(b=this.boxMin.y+.1);c<this.boxMin.z+.1&&(c=this.boxMin.z+.1);this.boxMax.set(a,b,c)},setBoxMax:function(a,b,c){this._setClampedBoxMax(a,b,c);this.dispatchEvent({type:"boundsUpdated",target:this})},serialize:function(){var a={id:this.id,position:this.position.toArray()};
this.isBoundingBoxInitialized()&&(a.box={enabled:this._boxEnabled,min:this.boxMin.toArray(),max:this.boxMax.toArray()});return a},dispose:function(){this._filteredCubeTexture&&(this._filteredCubeTexture.dispose(),this._filteredCubeTexture=null);for(var a in this._filteredCubeTextureNoLod)this._filteredCubeTextureNoLod.hasOwnProperty(a)&&this._filteredCubeTextureNoLod[a].dispose();this._filteredCubeTextureNoLod={};this._mirrorCubeTexture&&(this._mirrorCubeTexture.dispose(),this._mirrorCubeTexture=
null)}};C.EventDispatcher.prototype.apply(Hg.prototype);var Ig=1E3,Jg={internal:!1,position:[0,0,0],rotation:[0,0],hideFromMenu:!0,sky:S.EDITOR_CONTROLLED_SKY_NAME};
function Kg(a){var b=this;void 0===a&&(a=Jg);this.id=void 0!==a.id?a.id:Ig++;this.name=a.name||"view"+this.id;this.internal=a.internal||!1;a.position&&(this.position=new C.Vector3(a.position[0],a.position[1],a.position[2]));a.rotation&&(this.rotation=new Ee(Oa(C.Math.degToRad(a.rotation[0])),Oa(C.Math.degToRad(a.rotation[1])),0));this.hideFromMenu=a.hideFromMenu||!1;this.sky=a.sky||S.EDITOR_CONTROLLED_SKY_NAME;this.mode=a.mode||"fps";this.distance=a.distance;this.panPrimary=a.panPrimary;this.noRotate=
a.noRotate;this.noPitchRotate=a.noPitchRotate;this.noPan=void 0===a.noPan?!1:a.noPan;this.minDistance=void 0===a.minDistance?1:a.minDistance;this.maxDistance=void 0===a.maxDistance?100:a.maxDistance;this.minUpAngle=void 0===a.minUpAngle?-Math.PI/2:a.minUpAngle;this.maxUpAngle=void 0===a.maxUpAngle?Math.PI/2:a.maxUpAngle;this.minSideAngle=void 0===a.minSideAngle?-Math.PI:a.minSideAngle;this.maxSideAngle=void 0===a.maxSideAngle?Math.PI:a.maxSideAngle;a.target&&(this.target=new C.Vector3(a.target[0],
a.target[1],a.target[2]));this.fov=a.fov;var c={type:"updated",target:this};this._updated=function(){return b.dispatchEvent(c)}}
Kg.prototype={constructor:Kg,isTop:function(){return"orbit"===this.mode&&this.panPrimary&&this.noPitchRotate},isOrbit:function(){return"orbit"===this.mode&&!this.isTop()},usesDefaultSky:function(){return this.sky===S.DEFAULT_SKY_NAME},switchSky:function(){this.usesDefaultSky()?this.sky=S.EDITOR_CONTROLLED_SKY_NAME:this.sky=S.DEFAULT_SKY_NAME;this._updated()},setName:function(a){this.name=a;this._updated()},setPosition:function(a,b,c){this.position.set(a,b,c);this._updated()},setYaw:function(a){this.rotation.yaw=
a;this._updated()},setMinUpAngle:function(a){a!==this.minUpAngle&&(this.minUpAngle=a,this._updated())},setMaxUpAngle:function(a){a!==this.maxUpAngle&&(this.maxUpAngle=a,this._updated())},setMinSideAngle:function(a){a!==this.minSideAngle&&(this.minSideAngle=a,this._updated())},setMaxSideAngle:function(a){a!==this.maxSideAngle&&(this.maxSideAngle=a,this._updated())},setHideFromMenu:function(a){a!==this.hideFromMenu&&(this.hideFromMenu=a,this._updated())},setMinDistance:function(a){a!==this.minDistance&&
(this.minDistance=a,this._updated())},setMaxDistance:function(a){a!==this.maxDistance&&(this.maxDistance=a,this._updated())},setNoPan:function(a){a!==this.noPan&&(this.noPan=a,this._updated())},serialize:function(){var a=this,b={id:this.id,name:this.name,mode:this.mode,rotation:this.rotation.toDegTriple().slice(0,2),hideFromMenu:this.hideFromMenu||!1,sky:this.sky};this.position&&(b.position=this.position.toArray());this.target&&(b.target=this.target.toArray());-Infinity!==this.minSideAngle&&(b.minSideAngle=
this.minSideAngle);Infinity!==this.maxSideAngle&&(b.maxSideAngle=this.maxSideAngle);"distance minDistance maxDistance panPrimary noPan noRotate noPitchRotate minUpAngle maxUpAngle fov".split(" ").forEach(function(c){void 0!==a[c]&&(b[c]=a[c])});return b}};C.EventDispatcher.prototype.apply(Kg.prototype);function Lg(){Dd.call(this,"equirect_sky_vertex.glsl","equirect_sky_fragment.glsl");this.depthWrite=!1;this.side=C.FrontSide;this.uniforms={map:{type:"t",value:null}};this.toneMappingSupported=this.exposureAndGammaSupported=this.colorMapSupported=this.hdrOutputSupported=this.fogSupported=!0}Lg.prototype=Object.create(Dd.prototype);Lg.prototype.constructor=Lg;
Object.defineProperty(Lg.prototype,"map",{get:function(){return this.uniforms.map.value},set:function(a){this.uniforms.map.value=a;this.condDefine("rgbm"==this.map.encoding,"USE_RGBM_MAP")}});function Mg(){Dd.call(this,"procedural_sky_vertex.glsl","procedural_sky_fragment.glsl");this.depthWrite=!1;this.side=C.BackSide;this.uniforms={topColor:{type:"c",value:new C.Color(15135487)},bottomColor:{type:"c",value:new C.Color(16777215)},sinBottomAngle:{type:"f",value:Math.sin(C.Math.degToRad(-30))},exponent:{type:"f",value:.9}};this.toneMappingSupported=this.exposureAndGammaSupported=this.colorMapSupported=this.hdrOutputSupported=this.fogSupported=!0}Mg.prototype=Object.create(Dd.prototype);
Mg.prototype.constructor=Mg;function Ng(a){a=void 0===a?{}:a;C.EventDispatcher.call(this);var b=this;this._distanceEnabled=a.distanceEnabled||!1;this._distanceDensity=a.distanceDensity||.01;this._distanceStart=a.distanceStart||0;this._heightEnabled=a.heightEnabled||!1;this._heightDensity=a.heightDensity||.01;this._heightStart=a.heightStart||0;this._color=(new C.Color).fromArray(a.color||[.5,.5,.5]);this._updated=function(){return b.dispatchEvent({type:"updated",target:b})}}m.inherits(Ng,C.EventDispatcher);
Ng.prototype.enabled=function(){return this._distanceEnabled||this.heightEnabled};Ng.prototype.serialize=function(){return{distanceEnabled:this._distanceEnabled,distanceDensity:this._distanceDensity,distanceStart:this._distanceStart,heightEnabled:this._heightEnabled,heightDensity:this._heightDensity,heightStart:this._heightStart,color:this._color.toArray()}};
m.global.Object.defineProperties(Ng.prototype,{distanceEnabled:{configurable:!0,enumerable:!0,get:function(){return this._distanceEnabled},set:function(a){this._distanceEnabled=a;this._updated()}},distanceDensity:{configurable:!0,enumerable:!0,get:function(){return this._distanceDensity},set:function(a){this._distanceDensity=a;this._updated()}},distanceStart:{configurable:!0,enumerable:!0,get:function(){return this._distanceStart},set:function(a){this._distanceStart=a;this._updated()}},heightEnabled:{configurable:!0,
enumerable:!0,get:function(){return this._heightEnabled},set:function(a){this._heightEnabled=a;this._updated()}},heightDensity:{configurable:!0,enumerable:!0,get:function(){return this._heightDensity},set:function(a){this._heightDensity=a;this._updated()}},heightStart:{configurable:!0,enumerable:!0,get:function(){return this._heightStart},set:function(a){this._heightStart=a;this._updated()}},color:{configurable:!0,enumerable:!0,get:function(){return this._color},set:function(a){this._color.fromArray(a);
this._updated()}}});function Og(a,b,c,d){var e=this;C.Mesh.call(this,b,c);d&&this.position.fromArray(d);this.autoPosition=!d;this.name=a;this.fog=null;var f={type:"updated",target:this};this._updated=function(){return e.dispatchEvent(f)}}Og.prototype=Object.create(C.Mesh.prototype);Og.prototype.constructor=Og;Og.prototype.clone=void 0;
Og.prototype.serialize=function(){var a={name:this.name};this.autoPosition||(a.center=this.position.toArray());this.isEquirect?(a.type="equirect",a.yawRotation=this.yawRotationDeg,a.texture=this.material.map?this.material.map.serialize():null):a.type="procedural";this.fog.enabled()&&(a.fog=this.fog.serialize());return a};
Object.defineProperty(Og.prototype,"yawRotationDeg",{get:function(){return C.Math.radToDeg(this.rotation.y)},set:function(a){a=C.Math.degToRad(a);this.rotation.y=a;this.updateMatrixWorld();this._updated()}});Object.defineProperty(Og.prototype,"isEquirect",{get:function(){return this.material instanceof Lg}});Object.defineProperty(Og.prototype,"radius",{get:function(){return this.scale.x},set:function(a){this.scale.set(a,a,a);this.updateMatrixWorld(!0);this._updated()}});function Pg(a){function b(d,e,f){var g=new C.SphereBufferGeometry(1,64,64);return new Og(d,g,e,f)}function c(d){var e=new Mg;return b(d.name,e,d.center)}this.loadSkyTexture=function(d,e){d.material.map&&d.material.map.dispose();d.material.map=a.load(S.LOAD_PRIORITY.SKY,e,!1,!1,S.NO_ANISOTROPY);d.yawRotationDeg=0};this.loadSingleSky=function(d,e,f){if("procedural"===d.type||void 0===d.type)d=c(d);else if("equirect"===d.type){var g=new Lg;g.map=a.load(S.LOAD_PRIORITY.SKY,d.texture,!1,!1,S.NO_ANISOTROPY);
g=b(d.name,g,d.center);g.geometry.applyMatrix((new C.Matrix4).makeScale(1,1,-1));g.rotation.x=Math.PI/2;g.yawRotationDeg=d.yawRotation||0;d=g}else console.warn("Unknown sky type: ",d.type),d=c(d);d.fog=f;e.addSkyMesh(d)};this.load=function(d,e){var f=new Ng(d[0].fog);e.addFog(f);this.loadSingleSky({name:S.DEFAULT_SKY_NAME,type:"procedural"},e,f);for(var g=0;g<d.length;g+=1)this.loadSingleSky(d[g],e,f)}};var Qg=function(){function a(b,c){return{formatIdx:b,gpuFormat:c}}return{ETC1:a(0,Mb.COMPRESSED_RGB_ETC1_WEBGL),BC1:a(2,Mb.COMPRESSED_RGB_S3TC_DXT1_EXT),BC3:a(3,Mb.COMPRESSED_RGBA_S3TC_DXT5_EXT),PVRTC1_4_RGB:a(8,Mb.COMPRESSED_RGB_PVRTC_4BPPV1_IMG),PVRTC1_4_RGBA:a(9,Mb.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),ASTC_4x4:a(10,Mb.COMPRESSED_RGBA_ASTC_4x4_KHR),RGBA32:a(13,Mb.RGBA)}}();
function Rg(a,b,c,d,e){a({wasmBinary:b}).then(function(f){function g(k,h,l){var n=0===Math.log2(h)%1&&0===Math.log2(l)%1;return d.dxtTextures?k?c.BC3:c.BC1:d.pvrtcTextures&&h===l&&n?k?c.PVRTC1_4_RGBA:c.PVRTC1_4_RGB:d.etc1Textures&&!k?c.ETC1:d.astcTextures?c.ASTC_4x4:c.RGBA32}f.initializeBasis();e(function(k){function h(H,G){if(!H)throw l.close(),l.delete(),"Error in .basis file: "+G;}var l=new f.BasisFile(new self.Uint8Array(k));k=l.getHasAlpha();var n=l.getNumImages(),p=l.getNumLevels(0),r=l.getImageWidth(0,
0),q=l.getImageHeight(0,0);h(0!==r&&0!==q&&0!==p,"invalid dimensions");h(1===n,"invalid number of images");n=g(k,r,q);r=n.formatIdx;var w=l.startTranscoding();h(w,"startTranscoding failed");q=[];for(var x=0;x<p;++x){var t=l.getImageWidth(0,x),A=l.getImageHeight(0,x);w=l.getImageTranscodedSizeInBytes(0,x,r);var D=new self.Uint8Array(new self.ArrayBuffer(w));w=l.transcodeImage(D,0,x,r,0,k);h(w,"transcodeImage failed");q.push({data:D,width:t,height:A})}l.close();l.delete();return{gpuFormat:n.gpuFormat,
mipmaps:q}})})}
function Sg(a,b,c,d){function e(){g.removeEventListener("error",f);g.removeEventListener("message",e);g.addEventListener("error",function(l){l="Worker error @L"+l.lineno+": "+l.message;k&&(k.onError(l),k=null)});g.addEventListener("message",function(l){console.assert(k);k.onSuccess(l.data);k=null;d(h)});c();d(h)}function f(l){throw"Worker error @L"+l.lineno+": "+l.message;}var g=new window.Worker(a),k=null,h={processItem:function(l){console.assert(!k);k=l;g.postMessage(l.texBuffer,[l.texBuffer])},
terminate:function(){console.assert(!k);g.terminate()}};g.addEventListener("error",f);g.addEventListener("message",e);g.postMessage(b)}
function Tg(a,b,c,d){function e(){n.deferRun();0!==l.length&&(0<h.length?(h.pop().processItem(l.pop()),e()):k<d&&!g&&(k++,g=!0,Sg(f,c,function(){g=!1},function(p){h.push(p);e()})))}a="\nself.importScripts("+JSON.stringify(a)+");\nconst initBasis = "+Rg.toString()+";\nconst basisFormats = "+JSON.stringify(Qg)+";\nconst glDetector = "+JSON.stringify({astcTextures:b.gl.astcTextures,dxtTextures:b.gl.dxtTextures,etc1Textures:b.gl.etc1Textures,pvrtcTextures:b.gl.pvrtcTextures})+";\n\nfunction initHandler(evt) {\n  self.removeEventListener('message', initHandler);\n\n  const wasmBinary = evt.data;\n  initBasis(BASIS, wasmBinary, basisFormats, glDetector,\n            decodeTexBuffer => {\n    self.addEventListener('message', function(evt) {\n        const texBuffer = evt.data;\n        const texDatas = decodeTexBuffer(texBuffer);\n        // second argument to transfer ownership to the main thread\n        self.postMessage(texDatas, texDatas.mipmaps.map(t => t.data.buffer));\n    });\n    self.postMessage({}); // communicate end of init\n  });\n}\n\nself.addEventListener('message', initHandler);\n";
var f=window.URL.createObjectURL(new window.Blob([a])),g=!1,k=0,h=[],l=[],n=new Id(function(){for(var p=m.makeIterator(h),r=p.next();!r.done;r=p.next())r.value.terminate();k-=h.length;h.length=0},5E3);return function(p,r,q){l.push({texBuffer:p,onSuccess:r,onError:q});e()}}
function Ug(a,b){Qc(ob("lib/basis/basis_transcoder.wasm"),!0,function(c){var d=ob("lib/basis/basis_transcoder.js"),e=a.BASIS_DECODE_WORKERS;if(0>=e){var f=window.document.createElement("script");f.addEventListener("load",function k(){f.removeEventListener("load",k);Rg(window.BASIS,c,Qg,a.gl,function(h){b(function(l,n,p){try{n(h(l))}catch(r){p(r)}})})});f.src=d;window.document.head.appendChild(f)}else b(Tg(d,a,c,e))},function(c){throw c;})}
function Vg(a){function b(){var f=m.getRestArguments.apply(0,arguments);d.push(f)}function c(f){b=f;d.forEach(function(g){return b.apply(null,m.arrayFromIterable(g))});d.length=0}if(!window.WebAssembly||!(a.gl.pvrtcTextures||a.gl.etc1Textures||a.gl.dxtTextures||a.gl.astcTextures))return null;var d=[],e=!1;return{load:function(f,g,k){var h=new dd;e||(e=!0,Ug(a,c));f(function(l){b(l,function(n){h.format=n.gpuFormat;n=n.mipmaps;h.mipmaps=n;h.width=n[0].width;h.height=n[0].height;h.generateMipmaps=!1;
h.minFilter=1===n.length?Mb.LINEAR:Mb.LINEAR_MIPMAP_LINEAR;h.flipY=!1;h.needsUpdate=!0;g(h)},k)},k);return h}}};var Wg=!1;
function Xg(a,b,c){function d(){Wg=!0;var e=CryptoJS.lib.WordArray.create(a),f=e.clone();f.sigBytes=16;f.clamp();e.words.splice(0,4);e.sigBytes-=16;var g=CryptoJS.enc.Base64.parse(b);f=CryptoJS.AES.decrypt({ciphertext:e},g,{iv:f,mode:CryptoJS.mode.CFB});e=f.sigBytes;f=f.words;g=new Uint8Array(e);for(var k=0,h=0;k!==e;){var l=f[h++];g[k++]=(l&4278190080)>>>24;if(k===e)break;g[k++]=(l&16711680)>>>16;if(k===e)break;g[k++]=(l&65280)>>>8;if(k===e)break;g[k++]=l&255}c(g.buffer)}Wg?d():Ic(ob("lib/crypto-js.min.js"),d,
function(){return Cc.error("Cannot load required library")})};function Yg(a){function b(w,x){if(!w)throw"Error in .ktx file: "+x;}var c=[],d=new Int32Array(a,0,16);b(67305985===d[3],"endianness mismatch");b(0===d[4]&&1===d[5]&&0===d[6],"invalid header");if(35842===d[7]){var e=6408;var f=Mb.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG}else 36196===d[7]?(e=6407,f=Mb.COMPRESSED_RGB_ETC1_WEBGL):33776===d[7]?(e=6407,f=Mb.COMPRESSED_RGB_S3TC_DXT1_EXT):33779===d[7]?(e=6408,f=Mb.COMPRESSED_RGBA_S3TC_DXT5_EXT):b(!1,"unknown internal format: "+d[7]);b(d[8]===e,"invalid base internal format: ",
d[8]);e=d[9];var g=d[10];b(0===(e&e-1)&&0===(g&g-1),"non power-of-two size: "+e+" "+g);b(0===d[11]&&0===d[12]&&1===d[13],"invalid header");var k=d[14];d=d[15];b(0===d%4,"invalid header");d=64+d;for(var h=new DataView(a,0),l=e,n=g,p=0;p<k;++p){var r=h.getUint32(d,!0);d+=4;var q=new Uint8Array(a,d,r);c.push({data:q,width:l,height:n});d+=r+(3-(r+3)%4);l=Math.max(l/2,1);n=Math.max(n/2,1)}b(d===a.byteLength,"invalid data size");return{format:f,width:e,height:g,mipmapCount:k,mipmaps:c}}
function Zg(){this.load=function(a,b,c,d){var e=[],f=new dd;f.image=e;Rc(a,b,!0,function(g){try{var k=Yg(g)}catch(n){console.error(n);d();return}if(k.isCubemap){g=k.mipmaps.length/k.mipmapCount;for(var h=0;h<g;h+=1){e[h]={mipmaps:[]};for(var l=0;l<k.mipmapCount;l+=1)e[h].mipmaps.push(k.mipmaps[h*k.mipmapCount+l]),e[h].format=k.format,e[h].width=k.width,e[h].height=k.height}}else f.image.width=k.width,f.image.height=k.height,f.mipmaps=k.mipmaps;1===k.mipmapCount&&(f.minFilter=Mb.LINEAR);f.format=k.format;
f.width=k.width;f.height=k.height;c&&c(f)},d);return f}};function $g(){var a={};this.cacheKey=function(b,c,d,e,f){return b+"@"+c+"@"+d+"@"+e+"@"+f};this.get=function(b){return a[b]};this.insert=function(b,c){a[b]=c}}function ah(a,b){return function(c,d){Rc(a,b,!0,c,d)}}function bh(a,b,c){return function(d,e){ah(a,b)(function(f){Xg(f,c,d,e)},e)}}
function ch(a,b,c,d,e,f){function g(h){k.image=h;k.width=h.width;k.height=h.height;e(k)}var k=new cd;k.format=c;void 0!==d?bh(a,b,d)(function(h){h=new Uint8Array(h);var l=b.endsWith("png")?"image/png":"image/jpeg";h=new Blob([h],{type:l});h=(window.URL||window.webkitURL).createObjectURL(h);var n=new Image;n.onload=function(){g(n)};n.src=h},f):Uc(a,b,g,f);return k}
function dh(a,b,c,d,e,f){var g=new fd;g.format=c;Wc(a,b,function(k){g.video=k;g.width=k.videoWidth;g.height=k.videoHeight;k=C.Math.isPowerOfTwo(g.width)&&C.Math.isPowerOfTwo(g.height);g.wrapS=k?Mb.REPEAT:Mb.CLAMP_TO_EDGE;g.wrapT=k?Mb.REPEAT:Mb.CLAMP_TO_EDGE;e(g);d&&g.pause()},f);return g}function eh(a,b){!1===a.importGpuCompress&&(b.importGpuCompress=!1);!1===a.importAutoScale&&(b.importAutoScale=!1)}
function fh(a,b,c,d,e,f,g){function k(w){var x=w.id,t=w.webFormats;console.assert(t&&0<t.length,"No web format for texture: "+w.id+"."+w.rawExt);if(w.video)return a+"video/"+t[0]+"/"+x+"."+w.stdExt;var A=a+"img/",D=b.ios&&(!!w.encoding||w.rgbm);if(q&&!D){if(!b.mobile&&-1<t.indexOf("large/basis"))return A+"large/basis/"+x+".basis";if(-1<t.indexOf("small/basis"))return A+"small/basis/"+x+".basis"}if(b.gl.pvrtcTextures&&!D&&-1<t.indexOf("small/pvr"))return A+"small/pvr/"+x+".ktx";if(b.gl.etc1Textures&&
-1<t.indexOf("small/etc1"))return A+"small/etc1/"+x+".ktx";if(b.gl.dxtTextures&&-1<t.indexOf("large/dxt"))return A+"large/dxt/"+x+".ktx";D=-1<t.indexOf("small/std");return!(-1<t.indexOf("large/std"))||b.mobile&&D?A+"small/std/"+x+"."+w.stdExt:A+"large/std/"+x+"."+w.stdExt}function h(w){--n.texturesToLoad;w.needsUpdate=!0;c(w);w.notifyLoaded()}function l(w,x,t,A,D){var H=new ed;Rc(w,x,!0,function(G){G=new Uint8Array(G,0,G.byteLength);var K=G[1];H.image.width=Math.pow(2,G[0]);H.image.height=Math.pow(2,
K);H.format=t;H.type=Mb.UNSIGNED_BYTE;H.image.data=G.subarray(2);A&&A(H);H=null},D);return H}var n=this,p=new $g,r=new Zg,q=!S.NO_BASIS&&Vg(b);f&&(p.insert=function(){});this.texturesToLoad=0;this.clearCache=function(){p=null};this.load=function(w,x,t,A,D){function H(){--n.texturesToLoad;console.error("Error while loading video texture: ",W);e()}function G(){--n.texturesToLoad;console.error("Error while loading texture: ",W);d()}var K=x.alpha?Mb.RGBA:Mb.RGB,W=k(x),O=/\.basis$/.test(W),ea=/\.ktx$/.test(W),
ra=/\.buf$/.test(W),va=x.video,I=!(ea||ra||va),V=x.passphrase,pa=p.cacheKey(W,t,A,D,K),T=p.get(pa);if(T)return eh(x,T),T;n.texturesToLoad+=1;ra?T=l(w,W,K,h,G):O?(w=void 0===V?ah(w,W):bh(w,W,V),T=q.load(w,h,G)):ea?T=r.load(w,W,h,G):I?T=ch(w,W,K,V,h,G):(console.assert(va),T=dh(S.LOAD_PRIORITY.VIDEO,W,K,g,h,H));T.hasAlpha=!!x.alpha;T.encoding=x.encoding||null;!T.encoding&&x.rgbm&&(T.encoding="rgbm");t&&(T.wrapS=Mb.REPEAT,T.wrapT=Mb.REPEAT);A&&!va?(T.minFilter=Mb.LINEAR_MIPMAP_LINEAR,T.generateMipmaps=
!ea):(T.minFilter=Mb.LINEAR,T.generateMipmaps=!1);D&&(T.anisotropy=D);p.insert(pa,T);T.id=x.id;T.name=x.name;T.webFormats=x.webFormats;x.passphrase&&(T.passphrase=x.passphrase);eh(x,T);x.rawExt&&(T.rawExt=x.rawExt);T.stdExt=x.stdExt;return T}};/*
 Copyright (C) 2022-present Shapespark
*/
function gh(a){return document.getElementById(a)}function hh(){if(!Bc.ios){var a=gh("walk-canvas");a&&a.focus()}}function ih(a){return function(b){b.stopPropagation();a();hh()}}function jh(a,b){a.addEventListener("click",ih(b))}function kh(a,b){jh(gh(a),b)}function lh(a){a.addEventListener("click",function(b){b.stopPropagation();b.target instanceof HTMLInputElement||b.target instanceof HTMLSelectElement||b.target instanceof HTMLTextAreaElement||hh()})};function mh(){var a=new Qd(S.EDITOR_SELECTION_COLOR);a.depthTest=!0;a.depthWrite=!1;a.side=C.DoubleSide;a.hideFromLightProbes=!0;return a};function nh(a,b){this._selectedMesh=null;this._selectedMeshDispose=vb;this._volumeGroup=new C.Object3D;a.addAuxiliaryObject(this._volumeGroup);this._volumeGroup.visible=!1;this._animationController=b;this._material=mh()}
nh.prototype.setHighlightedCameraVolumeTrigger=function(a){function b(){d.position.copy(a.position);d.rotation.copy(a.rotation);d.scale.copy(a.scale);d.updateMatrixWorld();c._animationController.requestFrame()}var c=this;this._selectedMeshDispose();var d=new C.Mesh(a.getVolumeGeometry(),this._material);d.visibilityId=null;this._volumeGroup.add(d);b(a);a.addEventListener("updated",b);this._selectedMeshDispose=function(){c._volumeGroup.remove(c._selectedMesh);a.removeEventListener("updated",b)};this._selectedMesh=
d;return d.material};nh.prototype.setControlsVisible=function(a){this._volumeGroup.visible=a;this._animationController.requestFrame()};function oh(a,b){Dd.call(this,"rotate_gizmo_material_vertex.glsl","rotate_gizmo_material_fragment.glsl");this.blending=C.NormalBlending;this.depthWrite=this.depthTest=!1;this.transparent=!0;this.transparentRenderOrder=1E3;this.hideFromLightProbes=!0;this.uniforms={opacity:{type:"f",value:1},color:{type:"c",value:a},gizmoPosition:{type:"v3",value:new C.Vector3(0,0,0)},sphereRadius:{type:"f",value:1}};Object.defineProperty(this,"color",{get:function(){return this.uniforms.color.value}});Object.defineProperty(this,
"opacity",{get:function(){return this.uniforms.opacity.value},set:function(c){this.uniforms.opacity.value=c}});Object.defineProperty(this,"gizmoPosition",{get:function(){return this.uniforms.gizmoPosition.value}});Object.defineProperty(this,"sphereRadius",{get:function(){return this.uniforms.sphereRadius.value},set:function(c){this.uniforms.sphereRadius.value=c}});this.opacity=b;this.setUniforms=function(){}}oh.prototype=Object.create(Dd.prototype);oh.prototype.constructor=oh;var ph={TRANSLATE:0,ROTATE:1,SCALE:2},qh=new C.Color(16777215),rh=new C.Color(16711680),sh=new C.Color(65280),th=new C.Color(255),uh=new C.Color(16753920),vh={NONE:0,X:1,Y:2,Z:4,ALL:7},wh=new C.Vector3(0,0,1),xh=new C.Vector3(1,0,0),yh=new C.Vector3(0,1,0);function zh(a){var b=new C.Box3;a instanceof C.Object3D&&a.traverse(function(c){c instanceof C.Mesh&&(c.geometry.boundingBox||c.geometry.computeBoundingBox(),b.union(c.geometry.boundingBox))});return b}
function Ah(a,b){var c=zh(a);a=c.size();a=new C.BoxBufferGeometry(a.x,a.y,a.z);c=c.center();var d=new C.Matrix4;d.makeTranslation(c.x,c.y,c.z);a.applyMatrix(d);a.computeBoundingBox();b=new C.Mesh(a,b);b.visible=!1;b.visibilityId=null;return b}function Bh(a,b){var c=new bf;c.lightMapSupported=!1;c.hideFromLightProbes=!0;c.baseColor.copy(a);c.opacity=b;c.reflective=!1;c.headLight=!1;c.depthTest=!1;c.depthWrite=!1;return c}
function Ch(a,b,c){C.Object3D.call(this);this.add(a);this.add(b);this.material=c;this.collider=b;this.defaultOpacity=c.opacity;this.hoveredOpacity=.99;this.notUsedOpacity=.3;this.usedAxes=vh.NONE}Ch.prototype=Object.create(C.Object3D.prototype);Ch.prototype.constructor=Ch;
function Dh(){var a=m.getRestArguments.apply(0,arguments);console.assert(0<a.length,"Part must have at least one element!");var b=new C.Object3D;a.forEach(function(c){return b.add(c)});a=Ah(b,Bh(qh,.6));return new Ch(b,a,b.children[0].material)}
function Oh(){function a(k){k=Bh(k,.6);k.depthTest=!0;return new C.Mesh(b,k)}C.Object3D.call(this);var b=new C.CylinderBufferGeometry(.005,.005,1E3,4,1,!1),c=a(rh);c.rotation.set(0,0,Math.PI/2);var d=a(sh),e=a(th);e.rotation.set(Math.PI/2,0,0);this.add(c);this.add(d);this.add(e);var f=[!1,!1,!1];this.show=function(k){f[0]=(vh.X&k)===vh.X;f[1]=(vh.Y&k)===vh.Y;f[2]=(vh.Z&k)===vh.Z;c.visible=f[0];d.visible=f[1];e.visible=f[2]};var g=new C.Vector3;this.update=function(k){g.copy(k);g.sub(this.position);
g.normalize();c.visible=f[0]&&.998>Math.abs(xh.dot(g));d.visible=f[1]&&.998>Math.abs(yh.dot(g));e.visible=f[2]&&.998>Math.abs(wh.dot(g))}}Oh.prototype=Object.create(C.Object3D.prototype);Oh.prototype.constructor=Oh;
function Ph(){function a(){var f=Bh(qh,.99);return new C.Mesh(b,f)}C.Object3D.call(this);var b=new C.SphereBufferGeometry(.012,10,10),c=a(),d=a(),e=a();this.add(c);this.add(d);this.add(e);this.show=function(f){c.visible=(vh.X&f)===vh.X;d.visible=(vh.Y&f)===vh.Y;e.visible=(vh.Z&f)===vh.Z};this.update=function(f){c.position.set(f.x,0,0);c.updateMatrixWorld();d.position.set(0,f.y,0);d.updateMatrixWorld();e.position.set(0,0,f.z);e.updateMatrixWorld()}}Ph.prototype=Object.create(C.Object3D.prototype);
Ph.prototype.constructor=Ph;
function Qh(){function a(k){k=Bh(k,.2);k.depthTest=!0;k.side=C.DoubleSide;return Dh(new C.Mesh(b,k))}C.Object3D.call(this);var b=new C.PlaneBufferGeometry(1E3,1E3,1,1),c=a(qh);this.add(c);var d=new C.Object3D;this.add(d);var e=a(th);e.rotation.set(0,0,0);var f=a(sh);f.rotation.set(Math.PI/2,0,0);var g=a(rh);g.rotation.set(0,Math.PI/2,0);d.add(e);d.add(f);d.add(g);this.setLocalRotation=function(k){k?d.rotation.copy(k):d.rotation.set(0,0,0)};this.update=function(k){c.rotation.setFromRotationMatrix(k.matrixWorld);c.updateMatrixWorld()};
this.cameraPlane=c;this.findPlaneIntersectionPoint=function(){function k(n){switch(n){case vh.X:return g;case vh.Y:return f;case vh.Z:return e;case vh.X|vh.Y:return e;case vh.X|vh.Z:return f;case vh.Y|vh.Z:return g;case vh.ALL:return c;default:throw"Impossible";}}var h=new C.Vector3,l=new C.Vector3;return function(n,p,r,q){var w=k(n);w.getWorldPosition(h).sub(p);w.getWorldDirection(l);if(n===vh.X||n===vh.Y||n===vh.Z){n=l.dot(l);w=l.dot(r);var x=r.dot(r),t=l.dot(h),A=r.dot(h);x=n*x-w*w;n=1E-5>Math.abs(x)?
Infinity:(n*A-w*t)/x}else n=l.dot(r),n=1E-5>Math.abs(n)?Infinity:l.dot(h)/n;if(Infinity===n)return!1;q.copy(r).multiplyScalar(n).add(p);return!0}}();this.show=function(k){c.visible=k===vh.ALL?!0:!1;e.visible=(vh.X|vh.Y)===k;f.visible=(vh.X|vh.Z)===k;g.visible=(vh.Y|vh.Z)===k}}Qh.prototype=Object.create(C.Object3D.prototype);Qh.prototype.constructor=Qh;function Rh(a,b,c){var d=a.material;d.opacity=b===a.collider?a.hoveredOpacity:c&&null!==b?a.notUsedOpacity:a.defaultOpacity;d.setUniforms()}
function Sh(){function a(q){for(var w=new Uint8Array(4096),x=Math.floor(255*q.r),t=Math.floor(255*q.g),A=Math.floor(255*q.b),D=0,H=0;32>H;H++)for(var G=0;32>G;G++)w[D]=x,w[D+1]=t,w[D+2]=A,w[D+3]=0===H||0===G||31===H||31===G?220:150,D+=4;w=new ed(w,32,32,C.RGBAFormat);w.hasAlpha=!0;w.needsUpdate=!0;w.loaded=!0;x=new bf;x.lightMapSupported=!1;x.hideFromLightProbes=!0;x.reflective=!1;x.headLight=!1;x.depthTest=!1;x.depthWrite=!1;x.transparent=!0;x.baseColor=q;x.side=C.DoubleSide;x.baseColorTexture=w;
x.opacity=.6;x.configureTransparency();x.setUniforms();return Dh(new C.Mesh(d.squareGeometry,x))}function b(q){q=Bh(q,.6);return Dh(new C.Mesh(d.lineGeometry,q),new C.Mesh(d.arrowHeadGeometry,q))}var c=this;C.Object3D.call(this);var d=function(){var q=new C.Matrix4,w=new C.SphereBufferGeometry(.1,16,16),x=new C.PlaneBufferGeometry(.23,.23,1,1);q.makeTranslation(.45,.45,0);x.applyMatrix(q);x.addTriangleOrderAttribute();var t=new C.CylinderBufferGeometry(.015,.015,1,4,1,!1);q.makeTranslation(0,.65,
0);t.applyMatrix(q);var A=new C.CylinderBufferGeometry(0,.05,.2,10,1,!1);q.makeTranslation(0,1.25,0);A.applyMatrix(q);return{pickerGeometry:w,squareGeometry:x,lineGeometry:t,arrowHeadGeometry:A}}(),e=function(){var q=Bh(qh,.6);return Dh(new C.Mesh(d.pickerGeometry,q))}(),f=b(rh);f.rotation.set(0,0,-Math.PI/2);var g=b(sh),k=b(th);k.rotation.set(Math.PI/2,0,0);var h=a(th),l=a(sh);l.rotation.set(Math.PI/2,0,0);var n=a(rh);n.rotation.set(0,-Math.PI/2,0);e.usedAxes=vh.ALL;f.usedAxes=vh.X;g.usedAxes=vh.Y;
k.usedAxes=vh.Z;h.usedAxes=vh.X|vh.Y;l.usedAxes=vh.X|vh.Z;n.usedAxes=vh.Y|vh.Z;var p=[e,f,g,k,h,l,n];p.forEach(function(q){return c.add(q)});var r=new Map(p.map(function(q){return[q.collider,q]}));this.colliders=[].concat(m.arrayFromIterable(r.keys()));this.highlight=function(q,w){p.forEach(function(x){return Rh(x,q,w)})};this.usedAxes=function(q){return r.get(q).usedAxes}}Sh.prototype=Object.create(C.Object3D.prototype);Sh.prototype.constructor=Sh;
function Th(){function a(p){var r=new C.TorusBufferGeometry(p,.012,6,64);p=new C.TorusBufferGeometry(p,.038,6,64);return{torusGeometry:r,colliderGeometry:p}}function b(p,r){p=new oh(p,.6);var q=new C.Object3D;q.add(new C.Mesh(r.torusGeometry,p));r=new C.Mesh(r.colliderGeometry,p);r.visible=!1;r.visibilityId=null;return new Ch(q,r,p)}var c=this;C.Object3D.call(this);var d=a(.9),e=b(rh,d);e.rotation.set(0,Math.PI/2,0);var f=b(sh,d);f.rotation.set(Math.PI/2,0,0);d=b(th,d);var g=a(1.12),k=b(qh,g),h=function(p,
r){p=Bh(p,0);var q=new C.SphereBufferGeometry(r,32,32);r=new C.Object3D;r.add(new C.Mesh(q,p));q=new C.Mesh(q,p);q.visible=!1;q.visibilityId=null;p=new Ch(r,q,p);p.defaultOpacity=0;p.hoveredOpacity=.2;p.notUsedOpacity=0;return p}(qh,.848),l=[e,f,d,k,h];l.forEach(function(p){return c.add(p)});var n=new Map(l.map(function(p){return[p.collider,p]}));this.colliders=[].concat(m.arrayFromIterable(n.keys()));this.update=function(p){var r=this;l.filter(function(q){return q!==h}).forEach(function(q){q=q.material;
q.gizmoPosition.copy(r.position);q.sphereRadius=.86*r.scale.x});k.rotation.setFromRotationMatrix(p.matrixWorld);k.updateMatrixWorld()};e.usedAxes=vh.X;f.usedAxes=vh.Y;d.usedAxes=vh.Z;k.usedAxes=vh.ALL;h.usedAxes=vh.NONE;this.highlight=function(p,r){l.forEach(function(q){return Rh(q,p,r)})};this.usedAxes=function(p){return n.get(p).usedAxes}}Th.prototype=Object.create(C.Object3D.prototype);Th.prototype.constructor=Th;
function Uh(){function a(q){for(var w=new Uint8Array(4096),x=Math.floor(255*q.r),t=Math.floor(255*q.g),A=Math.floor(255*q.b),D=0,H=0;32>H;H++)for(var G=0;32>G;G++)w[D]=x,w[D+1]=t,w[D+2]=A,w[D+3]=0===H||0===G||31===H||31===G?220:150,D+=4;w=new ed(w,32,32,C.RGBAFormat);w.hasAlpha=!0;w.needsUpdate=!0;w.loaded=!0;x=new bf;x.lightMapSupported=!1;x.hideFromLightProbes=!0;x.reflective=!1;x.headLight=!1;x.depthTest=!1;x.depthWrite=!1;x.transparent=!0;x.baseColor=q;x.side=C.DoubleSide;x.baseColorTexture=w;
x.opacity=.6;x.configureTransparency();x.setUniforms();return Dh(new C.Mesh(d.squareGeometry,x))}function b(q){q=Bh(q,.6);return Dh(new C.Mesh(d.lineGeometry,q),new C.Mesh(d.cubeGeometry,q))}var c=this;C.Object3D.call(this);var d=function(){var q=new C.Matrix4,w=new C.BoxBufferGeometry(.3,.3,.3),x=new C.PlaneBufferGeometry(.23,.23,1,1);q.makeTranslation(.45,.45,0);x.applyMatrix(q);x.addTriangleOrderAttribute();var t=new C.CylinderBufferGeometry(.015,.015,1,4,1,!1);q.makeTranslation(0,.65,0);t.applyMatrix(q);
var A=new C.BoxBufferGeometry(.1,.1,.1);q.makeTranslation(0,1.1,0);A.applyMatrix(q);return{pickerGeometry:w,squareGeometry:x,lineGeometry:t,cubeGeometry:A}}(),e=function(){var q=Bh(qh,.6);return Dh(new C.Mesh(d.pickerGeometry,q))}(),f=b(rh);f.rotation.set(0,0,-Math.PI/2);var g=b(sh),k=b(th);k.rotation.set(Math.PI/2,0,0);var h=a(th),l=a(sh);l.rotation.set(Math.PI/2,0,0);var n=a(rh);n.rotation.set(0,-Math.PI/2,0);e.usedAxes=vh.ALL;f.usedAxes=vh.X;g.usedAxes=vh.Y;k.usedAxes=vh.Z;h.usedAxes=vh.X|vh.Y;
l.usedAxes=vh.X|vh.Z;n.usedAxes=vh.Y|vh.Z;var p=[e,f,g,k,h,l,n];p.forEach(function(q){return c.add(q)});var r=new Map(p.map(function(q){return[q.collider,q]}));this.colliders=[].concat(m.arrayFromIterable(r.keys()));this.highlight=function(q,w){p.forEach(function(x){return Rh(x,q,w)})};this.usedAxes=function(q){return r.get(q).usedAxes}}Uh.prototype=Object.create(C.Object3D.prototype);Uh.prototype.constructor=Uh;
function Vh(){function a(k){k=new C.TorusBufferGeometry(1.8,.01,6,32,k);k=new C.Mesh(k,c);k.rotation.set(0,-Math.PI/2,-Math.PI/2);return k}C.Object3D.call(this);var b=Bh(uh,.6),c=Bh(qh,.6),d=0,e=function(){var k=new C.CylinderBufferGeometry(0,.06,.5,32,1,!1),h=new C.CylinderBufferGeometry(.01,.01,1.5,32,1,!1);k=new C.Mesh(k,b);h=new C.Mesh(h,b);k.position.y=-.25;h.position.y=-1.25;var l=new C.Object3D;l.add(k);l.add(h);return l}(),f=function(){var k=new C.CylinderBufferGeometry(.01,.01,2,32,1,!1);
k=new C.Mesh(k,c);k.position.y=-1;var h=new C.Object3D;h.add(k);return h}(),g=function(){var k=a(Math.PI/2),h=new C.Object3D;h.add(k);return h}();this.add(e);this.add(f);this.add(g);this.update=function(k){e.rotation.copy(k);f.rotation.set(0,0,k.z);g.rotation.set(0,0,k.z);k=k.x;if(k!==d){var h=-1*k,l=g.children.pop();h=a(h);g.remove(l);g.add(h);l.geometry.dispose();d=k}}}Vh.prototype=Object.create(C.Object3D.prototype);Vh.prototype.constructor=Vh;
function Wh(a,b,c,d){function e(J){h.oldPosition.copy(J);h.newPosition.copy(J);l.position.copy(J);n.position.copy(J);p.position.copy(J);r.position.copy(J);q.position.copy(J);w.position.copy(J);x.position.copy(J)}function f(J){h.oldRotation.copy(J);h.newRotation.copy(J);G===ph.SCALE?(l.rotation.copy(J),n.setLocalRotation(J),w.rotation.copy(h.oldRotation)):(l.rotation.set(0,0,0),n.setLocalRotation(null),x.update(J))}function g(){K?G===ph.TRANSLATE?(a.addAuxiliaryObject(l),a.addAuxiliaryObject(n),a.addAuxiliaryObject(p),
a.addAuxiliaryObject(r),a.removeAuxiliaryObject(q),a.removeAuxiliaryObject(w),a.removeAuxiliaryObject(x)):G===ph.ROTATE?(a.addAuxiliaryObject(l),a.removeAuxiliaryObject(r),a.addAuxiliaryObject(q),a.removeAuxiliaryObject(w)):(a.addAuxiliaryObject(l),a.addAuxiliaryObject(n),a.removeAuxiliaryObject(r),a.removeAuxiliaryObject(q),a.addAuxiliaryObject(w),a.removeAuxiliaryObject(x)):(a.removeAuxiliaryObject(l),a.removeAuxiliaryObject(n),a.removeAuxiliaryObject(p),a.removeAuxiliaryObject(r),a.removeAuxiliaryObject(q),
a.removeAuxiliaryObject(w),a.removeAuxiliaryObject(x))}function k(){return void 0!==h.target.light&&"sun"===h.target.light.type}var h=this;this.subTargetsInfo=this.target=null;var l=new Oh;l.show(vh.ALL);var n=new Qh;n.show(vh.NONE);var p=new Ph;p.show(vh.NONE);var r=new Sh,q=new Th,w=new Uh,x=new Vh,t=!1;Object.defineProperty(this,"transforming",{get:function(){return t}});var A=new C.Vector3(0,0,0),D=0,H=new C.Vector3;this.oldPosition=new C.Vector3(0,0,0);this.newPosition=new C.Vector3(0,0,0);this.oldRotation=
new C.Euler(0,0,0);this.newRotation=new C.Euler(0,0,0);this.oldScale=new C.Vector3(1,1,1);this.newScale=new C.Vector3(1,1,1);Object.defineProperty(this,"position",{get:function(){return l.position}});Object.defineProperty(this,"rotation",{get:function(){return h.oldRotation}});var G=!1;Object.defineProperty(this,"scale",{get:function(){return h.oldScale}});var K=!1;Object.defineProperty(this,"mode",{get:function(){return G},set:function(J){G!==J&&(G=J,g(),d.requestFrame())}});Object.defineProperty(this,
"visible",{get:function(){return K},set:function(J){K!==J&&(K=J,g())}});this.mode=ph.TRANSLATE;var W=Infinity,O=Infinity,ea=new C.Vector3(0,0,0),ra=null,va=!1,I=vh.ALL,V=function(){var J=new C.Vector3,aa=new C.Vector3,na=new C.Quaternion;return function(L,Q,ia){J.set(Q,ia,1).unproject(a.camera);J.sub(c).normalize();if(!n.findPlaneIntersectionPoint(L,c,J,aa))return null;aa.sub(l.position);aa.applyQuaternion(na.setFromEuler(l.rotation).inverse());L&vh.X||(aa.x=0);L&vh.Y||(aa.y=0);L&vh.Z||(aa.z=0);return aa}}(),
pa=function(){var J=new C.Vector3,aa=new C.Vector3,na=new C.Vector3;return function(L,Q){var ia=n.cameraPlane;J.set(0,0,-1);J.transformDirection(ia.matrixWorld);aa.set(-1,0,0);aa.transformDirection(ia.matrixWorld);L=V(vh.ALL,L,Q).normalize();na.copy(aa).cross(L);return Math.sign(J.dot(na))*Math.acos(aa.dot(L))}}(),T=new C.Vector3;this.rotationSpeed=5;var P=function(){var J=new C.Vector2(0,0),aa=new C.Quaternion,na=new C.Euler,L=new C.Quaternion,Q=new C.Quaternion,ia=new C.Vector3,Z=new C.Vector3,
ka=new C.Vector3;return function(ma,M){aa.setFromEuler(h.oldRotation);aa.normalize();J.set(W-ma,O-M);J.multiplyScalar(h.rotationSpeed);if(I===vh.NONE)return ma=n.cameraPlane,ia.copy(xh),ia.transformDirection(ma.matrixWorld),Z.set(0,1,0),Z.transformDirection(ma.matrixWorld),Q.setFromAxisAngle(ia,J.y),L.setFromAxisAngle(Z,-J.x),L.multiply(Q),L.multiply(aa),L.normalize(),na.setFromQuaternion(L,"ZXY"),na;if(I===vh.ALL){var fa=n.cameraPlane;ka.set(0,0,-1);ka.transformDirection(fa.matrixWorld);fa=ka;ma=
pa(ma,M);ma-=D}else{I!==vh.Z&&J.multiplyScalar((I===vh.X?-1:1)*Math.sign((I===vh.X?yh:xh).dot(T)));a:{switch(I){case vh.X:fa=xh;break a;case vh.Y:fa=yh;break a;case vh.Z:fa=wh;break a}console.error("Unable to get direction for this value!");fa=void 0}ma=I===vh.Z?-J.x:J.y}L.setFromAxisAngle(fa,ma);L.multiply(aa);L.normalize();na.setFromQuaternion(L,"ZXY");return na}}(),ca=function(){var J={hoveredCollider:null,hasAnythingChanged:!1};return function(aa,na,L){var Q=G===ph.TRANSLATE?r:G===ph.ROTATE?q:
w;aa=b.findMeshFromListAtPosition(Q.colliders,aa,na,!0);na=!1;if(aa!==ra||va!==L)ra=aa,Q.highlight(aa,L),na=!0;J.hoveredCollider=aa;J.hasAnythingChanged=na;return J}}();this.onCanvasPointerMove=function(J,aa){if(this.transforming){if(this.mode===ph.TRANSLATE){var na=V(I,J,aa);na&&this.newPosition.copy(na.sub(A).add(l.position));ea.copy(this.newPosition);ea.sub(l.position);ea.divide(l.scale);p.update(ea);if(J!==W||aa!==O)r.visible=!1,p.show(I),l.show(I)}else if(this.mode===ph.ROTATE){l.show(I);this.newRotation.copy(P(J,
aa));if(J!==W||aa!==O)q.visible=!1;k()&&x.update(this.target.rotation)}else{l.show(I);if(na=V(I,J,aa))na.addScalar(1).divide(H),this.newScale.copy(na);if(J!==W||aa!==O)w.visible=!1}d.requestFrame();return!0}ca(J,aa,va).hasAnythingChanged&&d.requestFrame();return!1};this.onCanvasPointerDown=function(J,aa){var na=ca(J,aa,!0);va=!0;if(null!==na.hoveredCollider)return t=!0,I=(G===ph.TRANSLATE?r:G===ph.ROTATE?q:w).usedAxes(na.hoveredCollider),W=J,O=aa,this.mode===ph.TRANSLATE?(n.show(I),this.newPosition.copy(this.oldPosition),
A.copy(V(I,J,aa))):this.mode===ph.ROTATE?I===vh.ALL&&(this.newRotation.copy(this.oldRotation),D=pa(J,aa)):(n.show(I===vh.ALL?vh.NONE:I),this.newScale.copy(this.oldScale),J=V(I,J,aa),H.copy(J).addScalar(1).divide(this.oldScale)),!0;I=vh.ALL;t=!1;na.hasAnythingChanged&&d.requestFrame();return!1};this.onCanvasPointerUp=function(J,aa){if(this.transforming){e(this.newPosition);f(this.newRotation);var na=this.newScale;h.oldScale.copy(na);h.newScale.copy(na);n.show(vh.NONE);p.show(vh.NONE);I=vh.ALL;l.show(I);
this.mode===ph.TRANSLATE?r.visible=!0:this.mode===ph.ROTATE?q.visible=!0:w.visible=!0}na=this.transforming;t=!1;this.update();ca(J,aa,!1).hasAnythingChanged&&d.requestFrame();va=!1;return na};this.updateHelpers=function(){k()?a.addAuxiliaryObject(x):a.removeAuxiliaryObject(x)};this.update=function(){if(!this.transforming&&(void 0!==this.target.position&&e(this.target.position),void 0!==this.target.rotation&&f(this.target.rotation),void 0!==this.target.scale)){var J=this.target.scale;h.oldScale.copy(J);
h.newScale.copy(J)}T.copy(c);T.sub(l.position);T.normalize();J=.18*l.position.distanceTo(c)*a.camera.fov/90;l.scale.set(J,J,J);n.scale.set(J,J,J);p.scale.set(J,J,J);r.scale.set(J,J,J);q.scale.set(J,J,J);w.scale.set(J,J,J);x.scale.set(J,J,J);q.update(a.camera);n.update(a.camera);l.update(c);l.updateMatrixWorld();n.updateMatrixWorld();p.updateMatrixWorld();r.updateMatrixWorld();q.updateMatrixWorld();w.updateMatrixWorld();x.updateMatrixWorld()}};function Xh(a,b){this.isSupported=function(c){return b[c]};this.offsetPosition=function(c){c=a.position.clone().add(c);a.setPosition(c.x,c.y,c.z)};this.offsetRotation=function(c){a.setRotation(a.rotation.z+c.z,a.rotation.x+c.x,a.rotation.y+c.y)};this.offsetScale=function(c){c=a.scale.clone().add(c);a.setScale(c.x,c.y,c.z)};Object.defineProperty(this,"target",{get:function(){return a}})}
function Yh(a,b,c,d,e){function f(r){e.isEnabled()!==r&&(r?e.enable():e.disable())}var g=this,k=!1,h=new Wh(c,d,e.cameraWorldPosition(),b);h.mode=ph.TRANSLATE;var l={itemModified:vb},n=[];Object.defineProperty(this,"supportedModes",{get:function(){return n}});Object.defineProperty(this,"mode",{get:function(){return h.mode}});this.setItemModifiedCallback=function(r){console.assert(l.itemModified===vb);l.itemModified=r};var p=new Se(a,S.POINTER_PRIORITY.TRANSFORM_CONTROLS);p.callbacks.onPointerDown=
function(r,q){r=h.onCanvasPointerDown(r,q);f(!h.transforming);return r};p.callbacks.onPointerUp=function(r,q){r=h.onCanvasPointerUp(r,q);f(!h.transforming);return r};p.callbacks.onPointerMove=function(r,q){r=h.onCanvasPointerMove(r,q);if(h.transforming)if(h.mode===ph.TRANSLATE){q=h.newPosition;var w=q.clone().sub(g.target.position);g.target.setPosition(q.x,q.y,q.z);l.itemModified(g.target);g.subTargetsData&&g.subTargetsData.forEach(function(A){A.isSupported(h.mode)&&(A.offsetPosition(w),l.itemModified(A.target))})}else if(h.mode===
ph.ROTATE){q=h.newRotation;var x={x:q.x-g.target.rotation.x,y:q.y-g.target.rotation.y,z:q.z-g.target.rotation.z};g.target.setRotation(g.target.rotation.z+x.z,g.target.rotation.x+x.x,g.target.rotation.y+x.y);l.itemModified(g.target);g.subTargetsData&&g.subTargetsData.forEach(function(A){A.isSupported(h.mode)&&(A.offsetRotation(x),l.itemModified(A.target))})}else{q=h.newScale;var t=q.clone().sub(g.target.scale);g.target.setScale(q.x,q.y,q.z);l.itemModified(g.target);g.subTargetsData&&g.subTargetsData.forEach(function(A){A.isSupported(h.mode)&&
(A.offsetScale(t),l.itemModified(A.target))})}return r};p.disable();Object.defineProperty(this,"target",{get:function(){return h.target}});Object.defineProperty(this,"subTargetsData",{get:function(){return h.subTargetsData}});this.setTransformMode=function(r){h.mode=r};this.update=function(){k&&h.update()};this.enable=function(r,q,w){k=!0;h.target=r;h.subTargetsData=w;null!==r&&(h.update(),h.visible=!0,h.updateHelpers());n=q;-1===q.indexOf(h.mode)&&(h.mode=q[0]);p.enable()};this.disable=function(){k=
!1;n=[];h.visible=!1;p.disable()}};function Zh(a,b){this._nodesPrimary=a;this._nodesSecondary=b}Zh.prototype.constructor=Zh;Object.defineProperty(Zh.prototype,"highlightMix",{set:function(a){this._nodesPrimary.forEach(function(b){b.highlightMix=a});this._nodesSecondary.forEach(function(b){b.highlightMix=a})}});Object.defineProperty(Zh.prototype,"selected",{set:function(a){this._nodesPrimary.forEach(function(b){b.selected=a});this._nodesSecondary.forEach(function(b){b.selectedSecondary=a})}});
function $h(a,b,c,d,e,f,g,k){function h(){t.highlightMix=.8*Math.pow(A/x.selectionTimeSec,2)}function l(T){null!==t&&(t.highlightMix=0);null!==T&&(t=T,A=x.selectionTimeSec,h());g.requestFrame()}function n(T){var P=[];switch(T.light.type){case "point":P.push(ph.TRANSLATE);null!==T.light.photometricProfile&&P.push(ph.ROTATE);break;case "sun":P.push(ph.ROTATE);break;default:P.push(ph.TRANSLATE),P.push(ph.ROTATE)}return P}function p(T){var P=T.geometry;P&&void 0===P.getAttribute("order")&&T.visible&&
(T.visible=!1,pa.push(T))}function r(){for(var T=m.makeIterator(pa),P=T.next();!P.done;P=T.next())P.value.visible=!0}function q(){ea.set(!0,!1,!1);ra.set(va);b.gpuMeshes.forEach(function(T){T.geometry.addTriangleOrderAttribute();T.highlightMix=0;T.selected=!1;c.uploadNewBuffers(T)});pa.length=0;b.threeScene.traverse(p);b.threeScene.overrideMaterial=I;b.skyMeshes.forEach(function(T){T.visible=!1})}function w(){ea.restore();ra.restore();r();b.threeScene.overrideMaterial=null;b.gpuMeshes.forEach(function(T){T.highlightMix=
null;T.selected=null;T.selectedSecondary=!1});D=null;b.skyMeshes.forEach(function(T){T.visible=!0})}var x=this,t=null,A=0,D=null,H=0,G=new Qe,K=new Yh(a,g,b,d,k),W={materialClicked:vb,lightInstanceClicked:vb,lightProbeClicked:vb,nodeClicked:vb,extensionClicked:vb,positionClicked:vb},O=new nh(b,g),ea=new Ne(c),ra=new Oe(c),va=new C.Color(16777215),I=new Qd(new C.Color(0));I.highlight=I.meshSelectedLineColor;var V;this.selectionTimeSec=1;this.selectMaterial=function(T){console.assert(V===$h.SELECTION_MODE.MATERIAL);
l(T)};this.selectLights=function(T,P){console.assert(V===$h.SELECTION_MODE.LIGHT);e.showSelectionMesh(T,P);g.requestFrame()};this.selectLightInstances=function(T,P,ca){function J(na){for(var L=[],Q=m.makeIterator(n(T)),ia=Q.next();!ia.done;ia=Q.next())L[ia.value]=!0;return na.map(function(Z){return new Xh(Z,L)})}e.showInstancesSelectionMesh(T,P);console.assert(V===$h.SELECTION_MODE.LIGHT);if(T){var aa=n(T);K.enable(T,aa,J(P))}else K.disable();ca?(P=e.getLightInstanceMaterial(ca),l(P)):g.requestFrame()};
this.selectLightProbe=function(T){var P=null;console.assert(V===$h.SELECTION_MODE.LIGHT_PROBE);T?(f.showLightProbeBoundingBox(T),P=f.getLightProbeMaterial(T),K.enable(T,[ph.TRANSLATE])):K.disable();l(P)};this.selectEditorCameraVolumeTrigger=function(T){console.assert(V===$h.SELECTION_MODE.CAMERA_VOLUME);T?(l(O.setHighlightedCameraVolumeTrigger(T)),K.enable(T,[ph.TRANSLATE,ph.ROTATE,ph.SCALE])):(l(null),K.disable())};this.selectExtension=function(T){console.assert(V===$h.SELECTION_MODE.EXTENSION);
T&&0!==T.triggers.length&&(T=T.triggers[0].mesh)&&l(T.material)};this.selectNodes=function(T,P,ca,J,aa){console.assert(V===$h.SELECTION_MODE.NODE);D&&(D.selected=!1);T||P.length?(T=[T].concat(ca),P=P.concat(J),D=new Zh(T,P),D.selected=!0):D=null;aa&&(aa=new Zh([aa],aa.config.nodes),l(aa))};this.update=function(T){K.update();null!==t&&(A-=T,0<A?h():(t.highlightMix=0,t=null),g.requestFrame())};var pa=[];this.setDistanceToObject=function(T){H=T};this.setSelectionMode=function(T){if(T!==V){V===$h.SELECTION_MODE.NODE&&
w();V===$h.SELECTION_MODE.CAMERA_VOLUME&&O.setControlsVisible(!1);switch(T){case $h.SELECTION_MODE.OFF:case $h.SELECTION_MODE.MATERIAL:case $h.SELECTION_MODE.EXTENSION:case $h.SELECTION_MODE.POSITION:case $h.SELECTION_MODE.CAMERA_VOLUME:e.hideLights();f.hideLightProbes();break;case $h.SELECTION_MODE.LIGHT:e.showLights();f.hideLightProbes();break;case $h.SELECTION_MODE.LIGHT_PROBE:e.hideLights();f.showLightProbes();break;case $h.SELECTION_MODE.NODE:e.hideLights(),f.hideLightProbes(),q()}T===$h.SELECTION_MODE.CAMERA_VOLUME&&
O.setControlsVisible(!0);K.disable();if(T===$h.SELECTION_MODE.MATERIAL||T===$h.SELECTION_MODE.EXTENSION)for(var P=m.makeIterator(b.getAnimatedMaterials()),ca=P.next();!ca.done;ca=P.next())ca.value.play();else for(P=m.makeIterator(b.getAnimatedMaterials()),ca=P.next();!ca.done;ca=P.next())ca.value.pause();V=T}};this.setMaterialClickedCallback=function(T){console.assert(W.materialClicked===vb);W.materialClicked=T};this.setLightInstanceClickedCallback=function(T){console.assert(W.lightInstanceClicked===
vb);W.lightInstanceClicked=T};this.setLightProbeClickedCallback=function(T){console.assert(W.lightProbeClicked===vb);W.lightProbeClicked=T};this.setNodeClickedCallback=function(T){console.assert(W.nodeClicked===vb);W.nodeClicked=T};this.setExtensionClickedCallback=function(T){console.assert(W.extensionClicked===vb);W.extensionClicked=T};this.setPositionClickedCallback=function(T){console.assert(W.positionClicked===vb);W.positionClicked=T};(function(){var T=new Se(a,S.POINTER_PRIORITY.EDITOR_SELECTOR);
T.callbacks.onClick=function(P,ca,J){if(V===$h.SELECTION_MODE.OFF)return!1;var aa=!1;switch(V){case $h.SELECTION_MODE.MATERIAL:P=d.findObstacleMeshAtPosition(P,ca,!1);P=null!==P?P.material:null;null!==P&&(aa=W.materialClicked(P,J));break;case $h.SELECTION_MODE.LIGHT:P=d.findMeshFromListAtPosition(e.lightInstanceMeshes,P,ca);P=null!==P?P.userData.lightInstance:null;null!==P&&(aa=W.lightInstanceClicked(P,J));break;case $h.SELECTION_MODE.LIGHT_PROBE:P=d.findMeshFromListAtPosition(f.lightProbeMeshes,
P,ca);P=null!==P?P.lightProbes[0]:null;null!==P&&(aa=W.lightProbeClicked(P,J));break;case $h.SELECTION_MODE.NODE:P=d.findObstacleMeshAtPosition(P,ca,!1);(P=null!==P?P.node:null)&&(aa=W.nodeClicked(P,J));break;case $h.SELECTION_MODE.EXTENSION:P=d.findIntersectionAtPosition(P,ca,!1,G)?G.object.anchor||null:null;P&&P.extension&&(aa=W.extensionClicked(P.extension,P,J));break;case $h.SELECTION_MODE.POSITION:P=d.findIntersectionAtPosition(P,ca,!1,G)&&!G.object.anchor?d.movePointTowardsTheCamera(G.point,
H):null,P&&(aa=W.positionClicked(P,J))}return aa};T.callbacks.onDoubleClick=function(){return!1}})();Object.defineProperty(this,"transformControls",{get:function(){return K}});this.setSelectionMode($h.SELECTION_MODE.OFF)}$h.SELECTION_MODE={OFF:0,MATERIAL:1,LIGHT:2,LIGHT_PROBE:3,NODE:4,EXTENSION:6,POSITION:7,CAMERA_VOLUME:8};function ai(a){for(var b=0,c=0;c<a.length;c+=1)a[c].id>=b&&(b=a[c].id+1);return b}function bi(a,b){for(var c=0;c<a.length;c+=1)if(a[c].name===b)return!1;return!0}function ci(a,b){for(var c=a,d=2;!bi(b,c);d+=1)c=a+d.toString();return c}
function di(a,b,c,d,e,f,g,k,h,l,n){function p(){Cc.info("Failed to load texture")}this.getLightmapLayoutVersion=function(){return a.lightmapLayoutVersion};var r={geometryFacesCnt:a.nodes.reduce(function(t,A){return t+A.facesInSubtree()},0),objectsCnt:function(){var t=0;a.visitAllNodes(function(A){A.mesh&&t++});return t}(),lightMapsCnt:function(){var t=-1;a.visitAllNodes(function(A){A.mesh&&A.mesh.lightMapIdx>t&&(t=A.mesh.lightMapIdx)});return t+1}()},q=new fh(S.ASSETS_URL,Bc,function(t){null===t.isCutout&&
l.isCutoutTexture(t);k.requestFrame()},p,p,!0,!1),w=new Pg(q),x=e.transformControls;this.getExtensionManager=function(){return f};this.getCameraPosition=function(){var t=c.cameraWorldPosition();return[t.x,t.y,t.z]};this.getCameraRotation=function(){return[C.Math.radToDeg(c.getYawAngle()),C.Math.radToDeg(c.getPitchAngle())]};this.getCamera=function(){return a.camera};this.getSceneStats=function(){return r};this.getMaterials=function(){return a.sortedMaterials()};this.getLights=function(){return a.lights};
this.getLightProbes=function(){return a.lightProbes};this.getCameraVolumes=function(){return a.cameraVolumes};this.getNodes=function(){return a.nodes};this.getMinimap=function(){return h};this.getMinimapConfig=function(){return a.minimapConfig};this.setLevelSelectedCallback=function(t){h.addEventListener("minimapLevelSelected",function(A){null!==A.level&&t(A.level)})};this.getBoundingBox=function(){return a.boundingBox};this.addLight=function(t,A,D){t=new Gg({name:ci(t,a.lights),type:A,doNotImport:!0});
t.addInstance(D);a.addLight(t)};this.removeLight=function(t){a.removeLight(t)};this.renameLight=function(t,A){A=A.trim()||"light";t.name="";t.name=ci(A,a.lights)};this.addLightInstance=function(t,A,D){t.addInstance(A,D)};this.removeLightInstance=function(t,A){t.removeInstance(A)};this.addLightProbe=function(t){var A=ai(a.lightProbes);t=new Hg({id:A,position:t});t.enableBoundingBox();a.addLightProbe(t);1===a.lightProbes.length&&a.enableLightProbesForMaterials()};this.removeLightProbe=function(t){a.removeLightProbe(t);
0===a.lightProbes.length&&a.disableLightProbesForMaterials()};this.getCameraVolumeTypes=function(){return Object.values(yg)};this.addCameraVolume=function(t,A){var D=(new C.Vector3).fromArray(this.getCameraPosition()),H=this.getCameraRotation();H=(new C.Vector3(0,3,0)).applyEuler(new Ee(H[0]/180*Math.PI,H[1]/180*Math.PI,0));var G=ai(a.cameraVolumes);a.addCameraAdjustmentVolume(new Cg({id:G,name:A||t+G,type:t,position:D.add(H).toArray(),rotation:[0,0,0],scale:[1,1,1],exposure:a.camera.defaultExposure,
gamma:a.camera.defaultGamma},a.camera))};this.removeCameraVolume=function(t){a.removeCameraVolume(t)};this.shiftCameraVolume=function(t,A){a.shiftCameraVolume(t,A)};this.getViews=function(){return a.views.filter(function(t){return!t.internal})};this.markScreenshotArea=function(t){g.markArea(t)};this.unmarkScreenshotArea=function(){g.unmarkArea()};this.monoScreenToBuffer=function(t,A,D){return g.monoScreenToBuffer(t,A,D)};this.stereoPanoramaToBuffer=function(t,A,D,H){return g.stereoPanoramaToBuffer(t,
A,D,H)};this.addViewFromCamera=function(t,A){var D=[];console.assert("fps"===A||"top"===A||"orbit"===A);var H=c.cameraWorldPosition(),G=c.orbit;D[0]=C.Math.radToDeg(c.getYawAngle());D[1]=C.Math.radToDeg(c.getPitchAngle());t={id:ai(a.views),name:ci(t.trim()||"view",a.views),rotation:D};"fps"===A?(t.mode="fps",t.sky=S.EDITOR_CONTROLLED_SKY_NAME,t.position=H.toArray()):"top"===A?(t.mode="orbit",t.sky=S.DEFAULT_SKY_NAME,t.panPrimary=!0,t.noPitchRotate=!0,t.rotation[1]=-90,t.minUpAngle=0,t.maxUpAngle=
Math.PI/2,G.isEnabled()?(t.target=[G.target.x,G.target.y,a.boundingBox.min.z],t.distance=G.getCameraDistance(),t.minDistance=G.getMinDistance(),t.maxDistance=G.getMaxDistance()):(t.target=[H.x,H.y,a.boundingBox.min.z],t.distance=Math.max(H.z-a.boundingBox.min.z,1))):(t.mode="orbit",t.sky=S.DEFAULT_SKY_NAME,t.panPrimary=!1,t.noPitchRotate=!1,G.isEnabled()?(t.target=G.target.toArray(),t.distance=G.getCameraDistance(),t.minDistance=G.getMinDistance(),t.maxDistance=G.getMaxDistance(),t.minUpAngle=-G.getMaxPitchAngle(),
t.maxUpAngle=-G.getMinPitchAngle(),t.noPan=G.getNoPan()):(t.minUpAngle=0,t.maxUpAngle=Math.PI/2,A=a.boundingBox.center(),t.target=A.toArray(),A.sub(H),t.distance=A.length(),A.normalize(),t.rotation=[C.Math.radToDeg(Math.atan2(-A.x,A.y)),C.Math.radToDeg(Math.asin(A.z))],t.rotation[1]=C.Math.clamp(t.rotation[1],-t.maxUpAngle,t.minUpAngle)));H=new Kg(t);a.addView(H);return H};this.cloneView=function(t){var A=[C.Math.radToDeg(t.rotation.yaw),C.Math.radToDeg(t.rotation.pitch)],D=t.serialize();D.id=ai(a.views);
D.name=ci(t.name.trim()||"view",a.views);D.rotation=A;"fps"===t.mode?D.position=t.position.toArray():D.target=t.target.toArray();var H=new Kg(D);a.addView(H);a.nodeConfigs.forEach(function(G){G.hideInViews&&G.isOnHideInViews(t.id)&&G.addToHideInViews(H.id)});return H};this.resetViewFromCamera=function(t){var A=c.cameraWorldPosition();"fps"===t.mode?t.position.copy(A):(t.target.copy(c.orbit.target),t.distance=A.distanceTo(t.target));"fps"!==t.mode&&t.isTop()||(t.rotation.pitch=c.getPitchAngle());t.setYaw(c.getYawAngle())};
this.removeView=function(t){a.removeView(t)};this.shiftView=function(t,A){a.shiftView(t,A)};this.activateSkyForView=function(t){d.activateSky(t)};this.setCameraPosition=function(t,A,D){c.cameraWorldPosition().set(t,A,D);c.cameraPositionUpdated()};this.isTeleporting=function(){return d.teleportingToView||d.teleportingToPoint};this.switchToView=function(t,A){n.isRunning()&&n.stop();d.switchToView(t,A);hh()};this.renameView=function(t,A){A=A.trim()||"view";t.name="";t.setName(ci(A,a.views))};this.updateHiddenMeshes=
function(t){d.updateHiddenMeshes(t)};this.getSky=function(){return a.findSkyMesh(S.EDITOR_CONTROLLED_SKY_NAME)};this.loadTexture=function(t,A){t=q.load(S.LOAD_PRIORITY.CORE_RESOURCE,t,!0,!0,S.DEFAULT_ANISOTROPY);"baseColorTexture"===A&&(t.isCutout=null);return t};this.materialTextureUpdated=function(t,A){var D=new Set,H="";t.textureNeedsUv0(A)&&a.visitMeshesWithMaterial(t,function(G){0===G.geometry.vertexCnt||G.uv0InBuffers()||D.has(G.node.type)||(D.add(G.node.type),5<D.size||(""!==H&&(H+=", "),H+=
"'"+G.node.type+"'"))});return 0<D.size&&"Texture "+A+" won't be correctly mapped. The following objects lack base color UV mapping coming from the 3D modeling tool: "+H+(5<D.size?" (plus "+(D.size-5)+" more).":".")};this.changeSkyTexture=function(t){var A=a.findSkyMesh(S.EDITOR_CONTROLLED_SKY_NAME);A.isEquirect?w.loadSkyTexture(A,t):(a.removeSkyMesh(A),w.loadSingleSky({name:S.EDITOR_CONTROLLED_SKY_NAME,type:"equirect",texture:t},a,a.sharedMaterialState.fog));a.adjustSkiesAndCameraFarToSpanWholeScene()};
this.removeSkyTexture=function(){var t=a.findSkyMesh(S.EDITOR_CONTROLLED_SKY_NAME);t.isEquirect&&(a.removeSkyMesh(t),w.loadSingleSky({name:S.EDITOR_CONTROLLED_SKY_NAME,type:"procedural"},a,a.sharedMaterialState.fog));a.adjustSkiesAndCameraFarToSpanWholeScene()};this.getColorMapName=function(){return a.camera.colorMap?a.camera.colorMap.name:null};this.loadColorMap=function(t){t=q.load(S.LOAD_PRIORITY.CORE_RESOURCE,t,!1,!1,S.NO_ANISOTROPY);t.flipY=!1;return t};this.getSceneJson=function(){return a.serialize()};
this.getCoverJson=function(){var t=b.cover;t.extensions=f.getConfig();return t};this.disableSelection=function(){e.setSelectionMode($h.SELECTION_MODE.OFF)};this.enableMaterialSelection=function(){e.setSelectionMode($h.SELECTION_MODE.MATERIAL)};this.enableLightSelection=function(){e.setSelectionMode($h.SELECTION_MODE.LIGHT)};this.enableLightProbeSelection=function(){e.setSelectionMode($h.SELECTION_MODE.LIGHT_PROBE)};this.enableExtensionSelection=function(){e.setSelectionMode($h.SELECTION_MODE.EXTENSION)};
this.enablePositionSelection=function(t){e.setDistanceToObject(t);e.setSelectionMode($h.SELECTION_MODE.POSITION)};this.enableNodeSelection=function(){e.setSelectionMode($h.SELECTION_MODE.NODE)};this.enableCameraVolumeSelection=function(){e.setSelectionMode($h.SELECTION_MODE.CAMERA_VOLUME)};this.selectMaterial=function(t){e.selectMaterial(t)};this.replaceMaterial=function(t,A){t=a.replaceMaterial(t,A);t.isAnimated&&t.play();return t};this.selectLights=function(t,A){e.selectLights(t,A)};this.selectLightInstances=
function(t,A,D){e.selectLightInstances(t,A,D)};this.selectLightProbe=function(t){e.selectLightProbe(t,!1)};this.selectCameraVolumeTrigger=function(t){e.selectEditorCameraVolumeTrigger(t)};this.selectExtension=function(t){e.selectExtension(t,!1)};this.selectNodes=function(t,A,D,H,G){e.selectNodes(t,A,D,H,G)};this.setMaterialClickedCallback=function(t){e.setMaterialClickedCallback(t)};this.setLightInstanceClickedCallback=function(t){e.setLightInstanceClickedCallback(t)};this.setLightProbeClickedCallback=
function(t){e.setLightProbeClickedCallback(t)};this.setNodeClickedCallback=function(t){e.setNodeClickedCallback(t)};this.setExtensionClickedCallback=function(t){e.setExtensionClickedCallback(t)};this.setPositionClickedCallback=function(t){e.setPositionClickedCallback(t)};this.setItemModifiedCallback=function(t){x.setItemModifiedCallback(t)};this.setViewSelectedCallback=function(t){d.addEventListener("teleportStarted",function(A){null!==A.view&&t(A.view)})};this.coverModified=function(t){b.updateCover(t)};
this.autoTourModified=function(){b.refresh()};this.hasLightMap=function(){return a.hasLightMap()};this.getAutoTour=function(){return a.autoTour};this.getDisableProgressiveLoader=function(){return a.disableProgressiveLoader};this.setDisableProgressiveLoader=function(t){a.disableProgressiveLoader=t};this.getInteractionPrompt=function(){return a.interactionPrompt};this.setInteractionPrompt=function(t){a.interactionPrompt=t};this.getSceneScaleHtmlWarning=function(){var t=a.boundingBox;return!t.empty()&&
(t=t.size(),200<t.x||200<t.y||200<t.z)?"The scene has unusually large dimensions: <strong>"+Math.round(t.x)+"m x "+Math.round(t.y)+"m x "+Math.round(t.z)+'m</strong>.</br></br>Shapespark assumes real-world scale, 1 meter in the scene should correspond to 1 meter in the real world. If the scale of the scene is invalid, either re-scale the model or change the scale in the import dialog, otherwise you can disable this message.</br></br>For more information consult <a href="/assets/help.html#importing-the-scene">Importing the scene</a> section of the help.':
null};this.getTransformMode=function(){return x.mode};this.setTransformMode=function(t){x.setTransformMode(t)};this.getSupportedTransformModes=function(){return x.supportedModes};this.seeItem=function(t){Dg.seeItem(t)}}function ei(){this.onSceneLoaded=null;this.enableCollisions=!0;this.forcedInitialCameraRotation=this.forcedInitialCameraPosition=null;this.sendCoverToServer=!1};function fi(a){Dd.call(this,"editor_light_vertex.glsl","editor_light_fragment.glsl");this.setUniform("color","c",a.color);this.setUniform("highlight","c",S.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0)}fi.prototype=Object.create(Dd.prototype);fi.prototype.propertyFromUniform("highlightMix");function gi(){var a=new C.BufferGeometry,b=new Float32Array(288);a.addAttribute("position",new C.BufferAttribute(b,3));var c=0;[[[-1,-1,-1],[-1,-.6,-1],[-.6,-1,-1]],[[-1,-1,-1],[-1,-1,-.6],[-1,-.6,-1]],[[-1,-1,-1],[-.6,-1,-1],[-1,-1,-.6]],[[-.6,-1,-1],[-1,-.6,-1],[-1,-1,-.6]],[[-1,-1,1],[-.6,-1,1],[-1,-.6,1]],[[-1,-1,1],[-1,-.6,1],[-1,-1,.6]],[[-1,-1,1],[-1,-1,.6],[-.6,-1,1]],[[-.6,-1,1],[-1,-1,.6],[-1,-.6,1]],[[1,-1,-1],[.6,-1,-1],[1,-.6,-1]],[[1,-1,-1],[1,-.6,-1],[1,-1,-.6]],[[1,-1,-1],[1,-1,-.6],
[.6,-1,-1]],[[.6,-1,-1],[1,-1,-.6],[1,-.6,-1]],[[-1,1,-1],[-.6,1,-1],[-1,.6,-1]],[[-1,1,-1],[-1,.6,-1],[-1,1,-.6]],[[-1,1,-1],[-1,1,-.6],[-.6,1,-1]],[[-.6,1,-1],[-1,1,-.6],[-1,.6,-1]],[[1,1,1],[.6,1,1],[1,.6,1]],[[1,1,1],[1,.6,1],[1,1,.6]],[[1,1,1],[1,1,.6],[.6,1,1]],[[.6,1,1],[1,1,.6],[1,.6,1]],[[1,-1,1],[1,-.6,1],[.6,-1,1]],[[1,-1,1],[1,-1,.6],[1,-.6,1]],[[1,-1,1],[.6,-1,1],[1,-1,.6]],[[.6,-1,1],[1,-.6,1],[1,-1,.6]],[[1,1,-1],[1,.6,-1],[.6,1,-1]],[[1,1,-1],[1,1,-.6],[1,.6,-1]],[[1,1,-1],[.6,1,-1],
[1,1,-.6]],[[.6,1,-1],[1,.6,-1],[1,1,-.6]],[[-1,1,1],[-1,.6,1],[-.6,1,1]],[[-1,1,1],[-1,1,.6],[-1,.6,1]],[[-1,1,1],[-.6,1,1],[-1,1,.6]],[[-.6,1,1],[-1,.6,1],[-1,1,.6]]].forEach(function(d){for(var e=0;3>e;e+=1)for(var f=0;3>f;f+=1)b[c]=d[e][f],c+=1});a.computeVertexNormals();a.convertNormalsToSpherical();return a}function hi(){var a=new bf;a.lightMapSupported=!1;a.reflective=!1;a.headLight=!0;a.baseColor=S.EDITOR_SELECTION_COLOR;a.setUniforms();return a}
function ii(){function a(h,l){g.push([[h.x,h.y,h.z],[l.x,h.y,h.z],[h.x,l.y,h.z]]);g.push([[h.x,l.y,h.z],[l.x,h.y,h.z],[l.x,l.y,h.z]])}function b(h,l){g.push([[h.x,h.y,h.z],[h.x,l.y,h.z],[h.x,h.y,l.z]]);g.push([[h.x,h.y,l.z],[h.x,l.y,h.z],[h.x,l.y,l.z]])}function c(h,l){g.push([[h.x,h.y,h.z],[l.x,h.y,h.z],[h.x,h.y,l.z]]);g.push([[h.x,h.y,l.z],[l.x,h.y,h.z],[l.x,h.y,l.z]])}function d(h,l,n){var p=Math.min(h.x,l.x),r=Math.min(h.y,l.y),q=Math.min(h.z,l.z),w=Math.max(h.x,l.x),x=Math.max(h.y,l.y);h=Math.max(h.z,
l.z);"XY"!==n&&(a({x:w,y:r,z:q},{x:p,y:x,z:q}),a({x:p,y:r,z:h},{x:w,y:x,z:h}));"YZ"!==n&&(b({x:p,y:x,z:q},{x:p,y:r,z:h}),b({x:w,y:r,z:q},{x:w,y:x,z:h}));"XZ"!==n&&(c({x:w,y:x,z:q},{x:p,y:x,z:h}),c({x:p,y:r,z:q},{x:w,y:r,z:h}))}var e=new C.BufferGeometry,f=new Float32Array(864);e.addAttribute("position",new C.BufferAttribute(f,3));var g=[];d({x:-.876,y:.876,z:.876},{x:.876,y:.866,z:.866},"YZ");d({x:-.876,y:.876,z:-.866},{x:.876,y:.866,z:-.876},"YZ");d({x:-.876,y:-.876,z:-.876},{x:.876,y:-.866,z:-.866},
"YZ");d({x:-.876,y:-.876,z:.876},{x:.876,y:-.866,z:.866},"YZ");d({x:.876,y:.876,z:.876},{x:.866,y:-.876,z:.866},"XZ");d({x:.876,y:.876,z:-.876},{x:.866,y:-.876,z:-.866},"XZ");d({x:-.876,y:.876,z:-.876},{x:-.866,y:-.876,z:-.866},"XZ");d({x:-.876,y:.876,z:.876},{x:-.866,y:-.876,z:.866},"XZ");d({x:.876,y:.876,z:.876},{x:.866,y:.866,z:-.876},"XY");d({x:.876,y:-.876,z:.876},{x:.866,y:-.866,z:-.876},"XY");d({x:-.876,y:.876,z:.876},{x:-.866,y:.866,z:-.876},"XY");d({x:-.876,y:-.876,z:.876},{x:-.866,y:-.866,
z:-.876},"XY");var k=0;g.forEach(function(h){for(var l=0;3>l;l+=1)for(var n=0;3>n;n+=1)f[k]=h[l][n],k+=1});e.computeVertexNormals();e.convertNormalsToSpherical();return e}
function ji(a,b){function c(K){if("spot"===K.type){var W=C.Math.degToRad(K.angle);K=1*Math.cos(W/2);W=new C.CylinderBufferGeometry(0,1*Math.sin(W/2),K,32,1);w.makeTranslation(0,-K/2,0);q.makeRotationZ(Math.PI);x.multiplyMatrices(q,w);W.applyMatrix(x);W.convertNormalsToSpherical()}else W="area"===K.type?A:t;return W}function d(K,W,O){var ea=new fi(K);O=new C.Mesh(O,ea);O.visibilityId=null;var ra=new C.Mesh(D,G);O.add(ra);var va=new C.Mesh(H,G);W===p.selectedLightInstance||p.subSelectedLightInstances.includes(W)||
(va.visible=!1);O.add(va);if("sun"!==K.type){var I=W.rotation.toQuaternion().multiply(O.quaternion);O.setRotationFromQuaternion(I);O.position.copy(W.position);"area"===K.type?(ea.side=C.DoubleSide,O.scale.set(K.width,1,K.height),ea=Math.max(K.width,K.height)/2,ra.scale.set(ea/K.width,ea,ea/K.height),va.scale.set(ea/K.width,ea,ea/K.height)):O.scale.set(K.size,K.size,K.size)}else K=a.findSkyMesh(S.EDITOR_CONTROLLED_SKY_NAME).radius,K=1*Math.PI*K*1.5/360,Te(a,W.rotation,O.position),O.scale.set(K,K,K);
O.userData.lightInstance=W;O.updateMatrixWorld();p.lightInstanceMeshes.push(O);r&&a.addAuxiliaryObject(O)}function e(K){var W=c(K);K.forEachLightInstance(function(O){d(K,O,W)})}function f(K){for(var W=0;W<p.lightInstanceMeshes.length;W+=1){var O=p.lightInstanceMeshes[W];if(O.userData.lightInstance===K)return O}return null}function g(K){for(var W=[],O=0;O<p.lightInstanceMeshes.length;O+=1){var ea=p.lightInstanceMeshes[O];ea.userData.lightInstance.light===K?(r&&a.removeAuxiliaryObject(ea),ea.geometry!==
t&&ea.geometry!==A&&ea.geometry.dispose(),ea.material.dispose()):W.push(ea)}p.lightInstanceMeshes=W}function k(K){K=K.target;g(K);e(K)}function h(K){K=K.instance;var W=K.light;var O=W.instances[0]!==K?f(W.instances[0]).geometry:c(W);d(W,K,O);b.requestFrame()}function l(K){K=K.instance.light;g(K);e(K);b.requestFrame()}function n(K){e(K);K.addEventListener("updated",k);K.addEventListener("instanceAdded",h);K.addEventListener("instanceRemoved",l)}var p=this,r=!1,q=new C.Matrix4,w=new C.Matrix4,x=new C.Matrix4,
t=new C.SphereBufferGeometry(1,32,16);t.convertNormalsToSpherical();var A=new C.PlaneBufferGeometry(1,1);q.makeRotationX(-Math.PI/2);A.applyMatrix(q);A.convertNormalsToSpherical();var D=gi(),H=ii(),G=hi();this.selectedLightInstance=null;this.subSelectedLightInstances=[];this.lightInstanceMeshes=[];this.getLightInstanceMaterial=function(K){return f(K).material};this.showLights=function(){if(!r){r=!0;for(var K=0;K<this.lightInstanceMeshes.length;K+=1)a.addAuxiliaryObject(this.lightInstanceMeshes[K])}};
this.showSelectionMesh=function(K,W){this.lightInstanceMeshes.forEach(function(O){O.children[0].visible=O.userData.lightInstance.light===K||W.includes(O.userData.lightInstance.light)})};this.showInstancesSelectionMesh=function(K,W){this.selectedLightInstance=K;this.subSelectedLightInstances=W;this.lightInstanceMeshes.forEach(function(O){O.children[1].visible=O.userData.lightInstance===K||W.includes(O.userData.lightInstance)})};this.hideLights=function(){if(r){r=!1;for(var K=0;K<this.lightInstanceMeshes.length;K+=
1)a.removeAuxiliaryObject(this.lightInstanceMeshes[K])}};a.lights.forEach(n);a.addEventListener("lightAdded",function(K){n(K.light);b.requestFrame()});a.addEventListener("lightRemoved",function(K){g(K.light);b.requestFrame()})};function ki(a,b){function c(x,t){t.position.addVectors(x.boxMin,x.boxMax).multiplyScalar(.5).sub(x.position);t.scale.subVectors(x.boxMax,x.boxMin);t.scale.subScalar(.005)}function d(x){var t=new bf;t.lightMapSupported=!1;t.hideFromLightProbes=!0;t.disableLightProbe=!1;t.highlight=S.EDITOR_SELECTION_COLOR;t.metallic=1;t.roughness=0;t.setUniforms();t=new C.Mesh(r,t);t.visibilityId=null;t.lightProbes=[];t.lightProbes.push(x);t.position.copy(x.position);var A=new C.Mesh(w,q);A.visible=!1;t.add(A);x.isBoundingBoxEnabled()&&
c(x,A);t.updateMatrixWorld(!0);t.visible=n;l.lightProbeMeshes.push(t);a.addAuxiliaryObject(t);x.addEventListener("positionUpdated",f);x.addEventListener("boundsUpdated",f)}function e(x){return l.lightProbeMeshes.findIndex(function(t){for(var A=0;A<S.MAX_BLENDED_REFLECTION_PROBES;A++)if(t.lightProbes[A]===x)return!0;return!1})}function f(x){x=x.target;var t=l.lightProbeMeshes[e(x)];t.position.copy(x.position);var A=t.children[0];x.isBoundingBoxEnabled()?(c(x,A),A.visible=!0):A.visible=!1;t.updateMatrixWorld()}
function g(x){d(x.lightProbe)}function k(x){x=e(x.lightProbe);var t=l.lightProbeMeshes[x];a.removeAuxiliaryObject(t);t.material.dispose();l.lightProbeMeshes.splice(x,1)}function h(x){n!==x&&(n=x,l.lightProbeMeshes.forEach(function(t){return t.visible=x}));b.requestFrame()}var l=this,n=!1,p=null;this.lightProbeMeshes=[];var r=new C.SphereBufferGeometry(.2,32,16);r.convertNormalsToSpherical();var q=mh(),w=new C.BoxBufferGeometry(1,1,1);w.addTriangleOrderAttribute();w.convertNormalsToSpherical();this.getLightProbeMaterial=
function(x){return(x=l.lightProbeMeshes[e(x)])?x.material:null};this.showLightProbeBoundingBox=function(x){p&&(p.visible=!1,p=null);x.isBoundingBoxEnabled()&&(p=l.lightProbeMeshes[e(x)].children[0],p.visible=!0)};this.showLightProbes=function(){h(!0)};this.hideLightProbes=function(){h(!1)};(function(){a.lightProbes.forEach(function(x){return d(x)});a.addEventListener("lightProbeAdded",g);a.addEventListener("lightProbeRemoved",k)})()};function li(a,b){var c=this;this.camera=a.camera;this.camera.addEventListener("updated",function(){return c._updateTargetExposureAndGamma()});this.autoExposureEnabled=!1;this.lastId=this.currentTargetExposure=this.cameraExposureDeltaSign=this.cameraExposureDeltaPerS=this.cameraExposureDelta=0;this.idToGammaAndExposure={};this.idToPriority={};this.idsInOrder=[];this.lunaMeter=b}
li.prototype._setTargetExposure=function(a){this.currentTargetExposure=a;this.cameraExposureDelta=a-this.camera.exposure;this.cameraExposureDeltaSign=Math.sign(this.cameraExposureDelta);this.cameraExposureDelta=Math.abs(this.cameraExposureDelta);this.cameraExposureDeltaPerS=this.cameraExposureDelta/1};li.prototype.setPriority=function(a,b){this.idToPriority[a]=b};
li.prototype.adaptExposure=function(){if(this.autoExposureEnabled&&this.camera.autoExposure){var a=this.lumaMeter.measureReflectedLuma();0>a?this.cameraExposureDelta=0:(this._setTargetExposure(Math.log2(this.camera.autoExposureDarkness/a)),.3>this.cameraExposureDelta&&(this.cameraExposureDelta=0))}};li.prototype.exposureNeedsUpdate=function(){return 0<this.cameraExposureDelta};li.prototype._setTargetExposureAndGamma=function(a,b){this._setTargetExposure(a);this.camera.setGamma(b)};
li.prototype._getActiveId=function(){for(var a=Infinity,b=this.idsInOrder.at(0),c=m.makeIterator(this.idsInOrder),d=c.next();!d.done;d=c.next()){d=d.value;var e=void 0!==this.idToPriority[d]?this.idToPriority[d]:Infinity;e<a&&(b=d,a=e)}return b};
li.prototype._updateTargetExposureAndGamma=function(){if(0===this.idsInOrder.length)this._setTargetExposureAndGamma(this.camera.defaultExposure,this.camera.defaultGamma);else{var a=this._getActiveId();this._setTargetExposureAndGamma(this.idToGammaAndExposure[a].exposure,this.idToGammaAndExposure[a].gamma)}};
li.prototype.addManualExposure=function(a,b,c){if(this.autoExposureEnabled&&this.camera.autoExposure)return null;if(null===c||void 0===c)c=this.lastId++;this.idToGammaAndExposure[c]={gamma:b,exposure:a};this.idsInOrder.push(c);this._updateTargetExposureAndGamma();return c};
li.prototype.updateManualExposure=function(a,b,c){this.autoExposureEnabled&&this.camera.autoExposure||!this.idToGammaAndExposure.hasOwnProperty(c)||(this.idToGammaAndExposure[c].gamma=b,this.idToGammaAndExposure[c].exposure=a,this._updateTargetExposureAndGamma(),this.updateWithoutDelay())};
li.prototype.removeManualExposure=function(a){this.autoExposureEnabled&&this.camera.autoExposure||!this.idToGammaAndExposure.hasOwnProperty(a)||(delete this.idToGammaAndExposure[a],this.idsInOrder.splice(this.idsInOrder.findIndex(function(b){return b===a}),1),this._updateTargetExposureAndGamma())};
li.prototype.update=function(a){this.exposureNeedsUpdate()&&(a=Math.min(this.cameraExposureDeltaPerS*a,this.cameraExposureDelta),this.cameraExposureDelta-=a,1E-5>this.cameraExposureDelta?(this.cameraExposureDelta=0,this.camera.exposure=this.currentTargetExposure):this.camera.exposure+=a*this.cameraExposureDeltaSign)};li.prototype.updateWithoutDelay=function(){this.update(1)};li.prototype.enableAutoExposure=function(){this.autoExposureEnabled=!0};
li.prototype.disableAutoExposure=function(){this.autoExposureEnabled=!1};var mi=new C.Color(16777215);function ni(a,b){Dd.call(this,"standard_material_vertex.glsl","luma_fragment.glsl");this.lightMapSupported=!0;this.sharedMaterialState=b;this.computeIncidentLuma=a;this.color=new C.Color(mi);this.setUniform("color","c",this.color)}ni.prototype=Object.create(Dd.prototype);ni.prototype.constructor=ni;
ni.prototype.refreshPerObjectUniforms=function(a){var b=Dd.prototype.refreshPerObjectUniforms.call(this,a);a=this.computeIncidentLuma?mi:a.material.baseColor;a.equals(this.color)||(this.color.copy(a),b=!0);return b};function oi(a,b){for(var c=0,d=0,e=0;65536>e;++e){var f=4*e;f=a[f]+255*a[f+1];0!==f&&(d+=1,b[f]+=1,c=Math.max(c,f))}if(256>d)return-1;e=a=0;for(f=1;f<=c;++f)if(b[f]+a<.3*d)a+=b[f],b[f]=0;else break;for(f=c;0<=f;--f)if(b[f]+e<.1*d)e+=b[f],b[f]=0;else break;f=0;for(var g=1;g<=c;++g)f+=b[g]*Math.log(g/255),b[g]=0;return Math.exp(f/(d-a-e))}
function pi(a,b){function c(n){e||(console.assert(!e),e=a.createRenderTarget(256,256,{minFilter:Mb.NEAREST,magFilter:Mb.NEAREST,format:Mb.RGBA,stencilBuffer:!1,generateMipmaps:!1}),f=new Ne(a),g=new Uint8Array(262144),k=new Uint32Array(65280),h=new ni(!0,b.sharedMaterialState),l=new ni(!1,b.sharedMaterialState));n=n?h:l;f.set(!0,!0,!1);var p=b.gpuMeshes.filter(function(r){return!r.material.transparent});a.renderMeshes(p,n,d,e);a.readPixels(256,256,g);a.setRenderTarget(null);f.restore();return oi(g,
k)}var d=b.camera,e,f,g,k,h,l;this.measureIncidentLuma=function(){return c(!0)};this.measureReflectedLuma=function(){return c(!1)}};var qi={"\uf2b9":"address-book","\uf2bb":"address-card","\uf1fe":"area-chart","\uf047":"arrows","\uf062":"arrow-up","\uf063":"arrow-down","\uf2a2":"assistive-listening-systems","\uf069":"asterisk","\uf29e":"audio-description","\uf1fa":"at","\uf0c9":"bars","\uf0f3":"bell","\uf02d":"book","\uf02e":"bookmark","\uf0a1":"bullhorn","\uf1ec":"calculator","\uf030":"camera","\uf080":"chart-bar","\uf200":"chart-pie","\uf0c2":"cloud","\uf013":"cog","\uf075":"comment","\uf14e":"compass","\uf09d":"credit-card",
"\uf05b":"crosshairs","\uf019":"download","\uf0e0":"envelope","\uf08e":"external-link","\uf06e":"eye","\uf1fb":"eye-dropper","\uf008":"film","\uf024":"flag","\uf07b":"folder","\uf06b":"gift","\uf025":"headphones","\uf015":"home","\uf03e":"image","\uf090":"sign-in","\uf129":"info","\uf0eb":"lightbulb","\uf0d0":"magic","\uf076":"magnet","\uf041":"map-marker","\uf276":"map-pin","\uf277":"map-signs","\uf1fc":"paint-brush","\uf040":"pencil","\uf095":"phone","\uf128":"question","\uf064":"share","\uf1e0":"share-alt",
"\uf07a":"shopping-cart","\uf1de":"sliders","\uf005":"star","\uf0e4":"tachometer","\uf02b":"tag","\uf03d":"video","\uf0ad":"wrench","\uf04b":"play","\uf16a":"youtube","\uf27d":"vimeo","\uf09a":"facebook","\uf099":"twitter","\uf16d":"instagram"};function ri(){console.error("This extension cannot be triggered on/off")}function si(){this.nodeTypeToListenerMulti=new Map}
si.prototype._createListenerMulti=function(a){return function(b,c,d){var e=this.nodeTypeToListenerMulti.get(a);console.assert(e,"listenerMulti not found for "+a);e.listeners.forEach(function(f){try{f(b,c,d)}catch(g){console.error(g)}});return!0}.bind(this)};si.prototype.onNodeTypeClicked=function(a,b){var c=this.nodeTypeToListenerMulti.get(a);c?c.listeners.push(b):(c=this._createListenerMulti(a),this.nodeTypeToListenerMulti.set(a,{listenerMulti:c,listeners:[b]}),Dg.onNodeTypeClicked(a,c))};
si.prototype.removeOnNodeTypeClicked=function(a,b){var c=this.nodeTypeToListenerMulti.get(a);console.assert(c,"listenerMulti not registered for "+a);b=c.listeners.indexOf(b);console.assert(0<=b,"listener not registered for "+a);c.listeners.splice(b,1);0===c.listeners.length&&(Dg.removeOnNodeTypeClicked(a,c.listenerMulti),this.nodeTypeToListenerMulti.delete(a))};var ti=new si;
function ui(a){function b(e){return c.definition.properties.some(function(f){return f.id===e})}var c=this;this.triggers=[];this._anchors=[];this.definition=this.constructor.definition;this.viewerApi=Dg;this.running=!1;var d=[];this.config=mb(function(e){e=ib(e);if(void 0!==e.anchor&&void 0===e.trigger&&!b("anchor")&&b("trigger")){var f=e.anchor;f.icon&&f.icon.font&&(f.icon=qi[f.icon.value]);e.trigger=f;e.anchor=void 0}f=m.makeIterator(c.definition.properties);for(var g=f.next();!g.done;g=f.next())g=
g.value,void 0===e[g.id]&&void 0!==g.defaultValue&&(e[g.id]=g.defaultValue);return e}(a));Object.defineProperty(this,"name",{get:function(){return this.config.name}});Object.defineProperty(this,"type",{get:function(){return this.config.type}});Object.defineProperty(this,"vrCompatible",{get:function(){return this.definition.vrCompatible},configurable:!0});this.cloneConfig=function(){return ib(this.config)};this.updateConfig=function(e){this.stop();this.config=mb(e);this.start()};this.doStop=this.doStart=
vb;this.trigger=ri;this.start=function(){this.running||(this.doStart(),this.running=!0)};this.stop=function(){if(this.running){this.doStop();for(var e=m.makeIterator(this._anchors),f=e.next();!f.done;f=e.next())this.viewerApi.removeAnchor(f.value);e=m.makeIterator(this.triggers);for(f=e.next();!f.done;f=e.next())f=f.value,f.constructor===Bg&&(this.viewerApi.removeOnCameraPositionUpdated(f.onCameraPositionUpdated),f.dispose());e=m.makeIterator(d);for(f=e.next();!f.done;f=e.next())f=f.value,ti.removeOnNodeTypeClicked(f[0],
f[1]);d.length=0;this.triggers.length=0;this._anchors.length=0;this.running=!1}};this._vrChanged=function(e){e&&!this.vrCompatible?this.stop():e||this.vrCompatible||this.start()};this.addTrigger=function(e,f){"node"===e.type?(e=e.nodeType,d.push([e,f]),ti.onNodeTypeClicked(e,f),this.triggers.push.apply(this.triggers,m.arrayFromIterable(this.viewerApi.findNodesOfType(e)))):["sphere","sprite"].includes(e.type)?(f=this.viewerApi.addAnchor(e,f),f.extension=this,this._anchors.push(f),this.triggers.push(f)):
"cameraVolumeTrigger"==e.type?(f=new Bg(e.triggerOnEnter?[f]:[],e.triggerOnExit?[f]:[],e.position,e.rotation,e.scale,e.cameraVolumeType),this.triggers.push(f),Dg.onCameraPositionUpdated(f.onCameraPositionUpdated)):console.assert(!1,"Unknown trigger type.")};this.changeTriggersVisibility=function(e){!0!==e&&(this.triggersVisible=e,this.triggers.forEach(function(f){return f.visible=e}))};this.isTriggerable=function(){return this.trigger!==ri};this.isTriggerExclusive=function(){return!!this.config.triggerExclusive};
this.viewerApi.onVrChange(this._vrChanged.bind(this))};var vi=S.EDIT_MODE,wi={HtmlLabel:function(a){function b(){f=null;wi.HtmlLabel._activeLabel===e&&(wi.HtmlLabel._activeLabel=null,d())}function c(g){if(g instanceof HTMLVideoElement||g instanceof HTMLIFrameElement)return!0;g=m.makeIterator(g.children);for(var k=g.next();!k.done;k=g.next())if(c(k.value))return!0;return!1}function d(){wi.HtmlLabel._animatedMaterialsAreSleeping&&(e.viewerApi.wakeAnimatedMaterials(),wi.HtmlLabel._animatedMaterialsAreSleeping=!1)}var e=this;ui.call(this,a);var f=null;this.trigger=
function(g){var k=wi.HtmlLabel._activeLabel===this;!0===g&&k||!1===g&&!k||(k?(console.assert(null!==f),f.close()):(wi.HtmlLabel._activeLabel=this,f=this.viewerApi.openPopup(this.config.content,this.config,b),g=document.createElement("div"),g.innerHTML=this.config.content,c(g)?wi.HtmlLabel._animatedMaterialsAreSleeping||(e.viewerApi.sleepAnimatedMaterials(),wi.HtmlLabel._animatedMaterialsAreSleeping=!0):d()))};this.doStart=function(){var g=this;g.viewerApi.onSceneReadyToDisplay(function(){g.config.trigger&&
g.addTrigger(g.config.trigger,function(){return g.trigger()})})};this.doStop=function(){null!==f&&f.close()}}};
wi.HtmlLabel.definition={name:"HTML label",properties:[{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"content",type:"textArea",label:"Content",optional:!0,defaultValue:"Content to display..."},{id:"centerHorizontally",type:"bool",label:"Center horizontally",defaultValue:!1},{id:"centerVertically",type:"bool",label:"Center vertically",defaultValue:!1},{id:"padding",type:"bool",label:"Padding",defaultValue:!0}],vrCompatible:!1};wi.HtmlLabel._activeLabel=null;
wi.HtmlLabel._animatedMaterialsAreSleeping=!1;
wi.Audio=function(a){function b(){d.trigger()}function c(){var p=d.config;p.trigger&&d.addTrigger(p.trigger,b);p.menuButton&&(h=e.addMenuButton(g.src),h.addEventListener("click",b),l=e.getMenuButtonIcon(h));if(p.autoplay)d.viewerApi.onNextPageInteraction(function(){b()})}a.url&&!a.file&&(a.file={file:a.url.split("/").pop(),url:a.url},delete a.url);a.file.path&&a.file.url&&delete a.file.url;ui.call(this,a);var d=this,e=this.viewerApi,f=null,g=null,k=null,h=null,l=null,n=!1;this.trigger=function(p){!0===
p&&n||!1===p&&!n||(n?k.pause():(d.config.playRewinds&&(k.currentTime=0),k.play()))};this.doStart=function(){zc.log("Audio start");this.config.menuButton&&!f&&(f=Ya(ob("img/audio-on.svg")),g=Ya(ob("img/audio-off.svg")));k=document.createElement("audio");this.config.file&&(this.config.file.path?k.src=tb(this.config.file.path):this.config.file.url&&(k.src=this.config.file.url));k.src&&(k.loop=this.config.loop,k.addEventListener("play",function(){n=!0;l&&(l.src=f.src)}),k.addEventListener("pause",function(){n=
!1;l&&(l.src=g.src)}),document.body.appendChild(k),e.onSceneReadyToDisplay(c))};this.doStop=function(){zc.log("Audio stop");n=!1;h&&(this.viewerApi.removeMenuButton(h),l=h=null);k.pause();k.remove();k=null}};
wi.Audio.definition={name:"Audio",properties:[{id:"file",type:"file",label:"File",fileType:"audio"},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!1},{id:"triggerExclusive",type:"bool",label:"Exclusive",defaultValue:!1},{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"menuButton",type:"bool",label:"Show menu button",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
function xi(a,b){var c=new C.Vector3,d=new C.Vector3;if(b&&"node"!==b.type){c.fromArray(b.position);var e=b.radius}else e=wi.MaterialPicker.VR_RADIUS;this.getPosition=function(f){if(void 0!==f&&null!==f)return b&&"node"!==b.type||(d.copy(a.getCameraPosition()),d.sub(f),d.normalize().multiplyScalar(e),c.copy(f).add(d)),c};this.getRadius=function(){return e}}
wi.MaterialPicker=function(a){function b(){return(k.config.toReplace?[k.config.toReplace]:[]).concat(k.config.toPick||[])}function c(){return b().map(function(p){return k.viewerApi.findMaterial(p)}).filter(function(p){return p})}function d(p){k.viewerApi.apiUserChangeState(n,p.name)}function e(p,r){console.assert(p===n);if(p=k.viewerApi.findMaterial(r)){r=m.makeIterator(h);for(var q=r.next();!q.done;q=r.next())k.viewerApi.setMaterialForMesh(p,q.value)}}function f(p,r){k.triggerAtPosition(void 0,r)}
function g(){k.config.trigger&&k.addTrigger(k.config.trigger,f);h=k.viewerApi.findMeshesWithMaterial(k.config.toReplace||[])}ui.call(this,a);var k=this,h=[],l=new xi(k.viewerApi,k.config.trigger),n="MaterialPicker:"+this.name;this.config.materials&&(a=ib(this.config),0<a.materials.length&&(a.toReplace=a.materials[0],a.toPick=a.materials.slice(1)),a.materials=void 0,this.config=mb(a));k.viewerApi.isSceneReadyToDisplay()||b().map(function(p){k.viewerApi.setMaterialEditable(p)});this.trigger=function(p){!1!==
p&&(k.viewerApi.closeMaterialPicker(),k.viewerApi.openMaterialPicker(c(),d))};this.triggerAtPosition=function(p,r){!1!==p&&(k.viewerApi.closeMaterialPicker(),k.viewerApi.openMaterialPicker(c(),d,null,l.getPosition(r),l.getRadius()))};this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(g);this.viewerApi.onApiUserStateChanged(n,e)};this.doStop=function(){var p=k.viewerApi.findMaterial(k.config.toReplace);p&&d(p);this.viewerApi.removeOnApiUserStateChanged(n,e)}};
wi.MaterialPicker.VR_RADIUS=.07;wi.MaterialPicker.definition={name:"Material picker",properties:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toPick",type:"list",elementType:"material",label:"Materials to pick"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
wi.MaterialComboPicker=function(a){function b(){for(var K=new Set,W=m.makeIterator(H),O=W.next();!O.done;O=W.next()){O=m.makeIterator(O.value);for(var ea=O.next();!ea.done;ea=O.next())ea=ea.value,K.add(ea.toReplace),K.add(ea.toUse)}return K}function c(){for(var K=[H[0][0].toReplace],W=m.makeIterator(H),O=W.next();!O.done;O=W.next())K.push(O.value[0].toUse);return K}function d(){return c().map(function(K){return D.findMaterial(K)})}function e(){if(-1!==G)for(var K=0;K<H[G].length;++K){var W=H[G][K],
O=D.findMaterial(W.toUse);W=D.findMaterial(W.toReplace);O.setUvOffsetAndScale(x[O]);O.setUniforms();O=m.makeIterator(q[G][K]);for(var ea=O.next();!ea.done;ea=O.next())D.setMaterialForMesh(W,ea.value)}}function f(K,W){D.apiUserChangeState(A,W)}function g(K,W){console.assert(K===A);e();if(0!==W)for(G=W-1,K=0;K<H[G].length;++K){var O=H[G][K];W=D.findMaterial(O.toUse);var ea=x[W];W.setUvOffsetAndScale(ea.x,ea.y,ea.z*(O.uvScale?O.uvScale[0]:w[0]),ea.w*(O.uvScale?O.uvScale[1]:w[1]));W.setUniforms();O=m.makeIterator(q[G][K]);
for(ea=O.next();!ea.done;ea=O.next())D.setMaterialForMesh(W,ea.value)}}function k(){wi.MaterialComboPicker._menuPopup.close();wi.MaterialComboPicker._menuPopup=null}function h(){wi.MaterialComboPicker._pickerOpened=!1}function l(K,W){wi.MaterialComboPicker._menuPopup&&k();K=d();D.openMaterialPicker(K,f,h,t.getPosition(W),t.getRadius());wi.MaterialComboPicker._pickerOpened=!0}function n(){for(var K=m.makeIterator(r.config.triggers),W=K.next();!W.done;W=K.next())r.addTrigger(W.value,l);for(K=0;K<H.length;++K){q[K]=
[];W=m.makeIterator(H[K]);for(var O=W.next();!O.done;O=W.next()){O=O.value;var ea=O.toUse;q[K].push(D.findMeshesWithMaterial(O.toReplace));O=D.findMaterial(ea);x.has(O)||(ea=new C.Vector4,x[O]=O.getUvOffsetAndScale(ea))}}}function p(){var K=wi.MaterialComboPicker._startedPickers;console.assert(0<K.length);wi.MaterialComboPicker._pickerOpened&&D.closeMaterialPicker();if(wi.MaterialComboPicker._menuPopup)k();else{var W=document.createElement("div");W.innerHTML='\n        <div class="ext-material-combo-picker-menu-title">\n          <img src="'+
ob("img/sliders-horizontal.svg")+'">\n        </div>\n        <ul class="ext-material-combo-picker-menu-list">\n          <li class="ext-material-combo-picker-menu-item"></li>\n        </ul>';for(var O=W.getElementsByClassName("ext-material-combo-picker-menu-list")[0],ea=O.getElementsByClassName("ext-material-combo-picker-menu-item")[0],ra={},va=0;va<K.length;ra={$jscomp$loop$prop$picker$202:ra.$jscomp$loop$prop$picker$202},++va)0<va&&(ea=ea.cloneNode(!0),O.appendChild(ea)),ra.$jscomp$loop$prop$picker$202=
K[va],Sa(ea,ra.$jscomp$loop$prop$picker$202.name),ea.addEventListener("click",function(I){return function(){I.$jscomp$loop$prop$picker$202._openFromMenu()}}(ra));wi.MaterialComboPicker._menuPopup=D.openPopup(W,{centerHorizontally:!0,centerVertically:!0},function(){wi.MaterialComboPicker._menuPopup=null})}}ui.call(this,a);var r=this,q=[],w=[1,1],x=new Map,t=new xi(r.viewerApi),A="MaterialComboPicker:"+this.name,D=this.viewerApi,H=r.config.options,G=-1;D.isSceneReadyToDisplay()||b().forEach(function(K){D.setMaterialEditable(K)});
this._openFromMenu=function(){k();var K=d();D.openMaterialPicker(K,f);wi.MaterialComboPicker._pickerOpened=!0};this.doStart=function(){D.onSceneReadyToDisplay(n);D.onApiUserStateChanged(A,g);var K=wi.MaterialComboPicker._startedPickers;K.push(this);1===K.length&&(K=D.addMenuButton(ob("img/sliders-horizontal.svg")),K.addEventListener("click",p),wi.MaterialComboPicker._menuButton=K)};this.doStop=function(){e();this.viewerApi.removeOnApiUserStateChanged(A,g);var K=wi.MaterialComboPicker._startedPickers;
K.splice(K.indexOf(this),1);0===K.length&&(D.removeMenuButton(wi.MaterialComboPicker._menuButton),wi.MaterialComboPicker._menuButton=null)}};
wi.MaterialComboPicker.definition={name:"Material combo picker",hideFromEditor:!0,properties:[{id:"triggers",type:"list",label:"Triggers",elementType:"trigger"},{id:"options",type:"list",label:"Options",elementType:{type:"list",label:"option",elementType:[{id:"toReplace",type:"material",label:"Material to replace"},{id:"toUse",type:"material",label:"Material to use"},{id:"uvScale",type:"list",label:"UV Scale",elementType:"float"}]}}],vrCompatible:!0};wi.MaterialComboPicker._startedPickers=[];
wi.MaterialComboPicker._menuButton=null;wi.MaterialComboPicker._menuPopup=null;wi.MaterialComboPicker._pickerOpened=!1;
wi.VideoTextureControl=function(a){function b(){var f=e.baseColorTexture,g=d.config;f.loop=g.loop;if(!g.autoplay)e.pause(),f.muted=g.muted;else if(!g.muted)d.viewerApi.onNextPageInteraction(function(){f.muted=!1});g.trigger&&d.addTrigger(g.trigger,function(){return d.trigger()})}function c(){var f=d.config;(e=d.viewerApi.findMaterial(f.material))?e.baseColorTexture&&void 0!==e.baseColorTexture.video?e.baseColorTexture.addLoadedListener(b):(console.error("Material '"+f.material+"' for video texture control '"+
(f.name+"' does not have a video texture")),e=null):console.error("Material '"+f.material+"' for video texture control '"+(f.name+"' does not exist"))}ui.call(this,a);var d=this,e=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.trigger=function(f){!0===f&&e.isPlaying||!1===f&&!e.isPlaying||(e.isPlaying?e.pause():(d.config.playRewinds&&e.rewind(),e.play()))};this.doStart=function(){this.viewerApi.onSceneLoadComplete(c)};this.doStop=function(){e&&
(e.baseColorTexture.muted=!0,e.pause(),e=null)}};
wi.VideoTextureControl.definition={name:"Video texture control",properties:[{id:"material",type:"material",label:"Material with video"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"triggerExclusive",type:"bool",label:"Exclusive",defaultValue:!1},{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"muted",type:"bool",label:"Muted",defaultValue:!0}],
vrCompatible:!0};wi.OpenWebsite=function(a){ui.call(this,a);var b=this;this.trigger=function(){b.viewerApi.openUrl(b.config.url,b.config.newWindow)};this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(function(){b.config.trigger&&b.addTrigger(b.config.trigger,function(){return b.trigger()})})}};
wi.OpenWebsite.definition={name:"Open URL",properties:[{id:"url",type:"text",label:"URL"},{id:"newWindow",type:"bool",label:"New window",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
wi.ChangeView=function(a){ui.call(this,a);var b=this,c=0;this.trigger=function(){b.viewerApi.switchToView(b.config.views[c],void 0,b.config.doNotMoveCamera);c=(c+1)%b.config.views.length};this.doStart=function(){var d=this.viewerApi;c=0;d.onSceneReadyToDisplay(function(){b.config.trigger&&b.addTrigger(b.config.trigger,function(){return b.trigger()})})}};
wi.ChangeView.definition={name:"Change view",properties:[{id:"views",type:"list",elementType:"view",label:"Views to toggle"},{id:"doNotMoveCamera",type:"bool",label:"Do not move camera",defaultValue:!1},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
wi.HideAnchors=function(a){function b(h){k.src=h?e.src:f.src}ui.call(this,a);var c=this,d=c.viewerApi,e=Ya(ob("img/anchors-on.svg")),f=Ya(ob("img/anchors-off.svg")),g=null,k=null;this.trigger=function(h){!0===h&&d.anchorsVisible||!1===h&&!d.anchorsVisible||(d.anchorsVisible=!d.anchorsVisible)};this.doStart=function(){d=c.viewerApi;d.onAnchorsVisibilityChanged(b);g=d.addMenuButton(e.src);k=d.getMenuButtonIcon(g);g.addEventListener("click",function(){return c.trigger()});var h=c.config;d.onSceneReadyToDisplay(function(){return d.anchorsVisible=
h.visibleOnStart})};this.doStop=function(){d.removeAnchorsVisibilityChangedListener(b);d.removeMenuButton(g);k=g=null;d.anchorsVisible=!0}};wi.HideAnchors.definition={name:"Hide triggers",properties:[{id:"visibleOnStart",type:"bool",label:"Visible on start",defaultValue:!0}],vrCompatible:!0};
wi.Script=function(a){function b(){c.trigger()}ui.call(this,a);var c=this;this.trigger=function(){try{(new Function('"use strict"; '+c.config.code))()}catch(d){console.error("Script extension error: "+d)}};this.doStart=function(){var d=this;if(this.config.trigger)this.viewerApi.onSceneReadyToDisplay(function(){return d.addTrigger(d.config.trigger,b)});else b()}};
wi.Script.definition={name:"Script",properties:[{id:"code",type:"textArea",label:"Code",defaultValue:"\x3c!-- Put your JavaScript code here. If a trigger is set, the code is executed when the trigger is clicked. Otherwise the code is executed when a page is loaded --\x3e"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
wi.ProjectionScreen=function(a){function b(){return["sphere","sprite"].includes(n.config.trigger.type)}function c(){console.assert(b());return n.triggers[0].material}function d(){var A=x.getVideoTexture1();q.baseColorTexture=A?A:w}function e(){zc.log("Presentation stop");x&&(x.uuid===r.myUuid&&r.stopShareScreen(),x.removeEventListener("dispose",e),x.removeEventListener("avatarUpdated",d));x=null;q.baseColorTexture=w;b()&&(c().highlightMix=0)}function f(){t?t.close():t=n.viewerApi.openPopup("In a 3D meeting this trigger will start a screen sharing on the "+
(n.config.material+" material. Outside of a 3D meeting the trigger will be hidden."),{padding:!0,centerVertically:!0,centerHorizontally:!0},function(){t=null})}function g(){var A=r.myUuid;x&&x.getVideoTexture1()?x.uuid===A&&(zc.log("Requesting presentation stop"),n.viewerApi.apiUserChangeState(p,null)):(zc.log("Requesting screen share "+A),r.startShareScreen(function(){n.viewerApi.apiUserChangeState(p,A)},function(){n.viewerApi.apiUserChangeState(p,null)},function(){}))}function k(A,D){console.assert(A===
p);D?(x&&x.uuid!==D&&(zc.log("Changing presenting user"),e()),x||(zc.log("New presenting user "+D),(x=n.viewerApi.findAvatar(D)||null)?(x.addEventListener("dispose",e),x.addEventListener("avatarUpdated",d),b()&&(A=c(),A.highlight=x.getMainMaterial().baseColor,A.setUniforms(),A.highlightMix=.7),d()):console.log("Cannot attach presentation stream of a user "+D+" The user was not found."))):e()}function h(){k(p,n.viewerApi.getApiUserState(p))}function l(A){(q=n.viewerApi.findMaterial(n.config.material))?
(r=A,w=q.baseColorTexture,n.config.trigger&&n.addTrigger(n.config.trigger,g),n.viewerApi.onApiUserStateChanged(p,k),n.viewerApi._onAvatarListChanged(h)):(console.error("Material for a projection screen is missing"),q=null)}ui.call(this,a);var n=this,p="ProjectionScreen:"+this.name,r=null,q=null,w=null,x=null,t=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){vi?this.config.trigger&&this.addTrigger(this.config.trigger,f):
this.viewerApi._onMeetingJoined(l)};this.doStop=function(){vi||(this.viewerApi._removeOnMeetingJoined(l),r&&(this.viewerApi.removeOnApiUserStateChanged(p,k),this.viewerApi._removeOnAvatarListChanged(h)),q=r=null)}};wi.ProjectionScreen.definition={name:"Meeting projection screen",properties:[{id:"material",type:"material",label:"Material to project on"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};
wi.SwitchObjects=function(a){function b(){k.forEach(function(l){return l.hide()});-1===g?k=[]:(k=e.findNodesOfType(d.config.nodeTypes[g]),k.forEach(function(l){return l.show()}));e.requestFrame()}function c(l,n){console.assert(l===f);g=n;b()}ui.call(this,a);var d=this,e=this.viewerApi,f="SwitchObjects:"+this.name,g,k=[];if(!e.isSceneReadyToDisplay()){a=m.makeIterator(this.config.nodeTypes);for(var h=a.next();!h.done;h=a.next())e.setNodeTypeEditable(h.value)}this.trigger=function(){0!==d.config.nodeTypes.length&&
(g+=1,g===d.config.nodeTypes.length&&(g=d.config.hideAllAfterLast?-1:0),e.apiUserChangeState(f,g))};this.doStart=function(){var l=this;k=[];e.onSceneReadyToDisplay(function(){for(var n=0;n<l.config.nodeTypes.length;++n)(0<n||l.config.hideAllOnStart)&&e.findNodesOfType(l.config.nodeTypes[n]).forEach(function(p){return p.hide()});g=0==l.config.nodeTypes.length||l.config.hideAllOnStart?-1:0;b();l.config.trigger&&l.addTrigger(l.config.trigger,function(){return d.trigger()})});this.viewerApi.onApiUserStateChanged(f,
c)};this.doStop=function(){for(var l=0;l<this.config.nodeTypes.length;++l)l!==g&&e.findNodesOfType(this.config.nodeTypes[l]).forEach(function(n){return n.show()});e.requestFrame()}};
wi.SwitchObjects.definition={name:"Switch objects",properties:[{id:"nodeTypes",type:"list",elementType:"nodeType",label:"Objects to switch"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"hideAllOnStart",type:"bool",label:"Hide all on start",defaultValue:!1},{id:"hideAllAfterLast",type:"bool",label:" Hide all after last",defaultValue:!1}],vrCompatible:!0};
wi.VideoStream=function(a){function b(){function l(n){var p=document.createElement("video");p.classList.add("video-js");p.autoplay=!0;p.muted=!0;p.type="application/x-mpegURL";if(Hls.isSupported()){var r=new Hls;r.loadSource(n);r.attachMedia(p)}else p.canPlayType("application/vnd.apple.mpegurl")?p.src=n:console.log("No Hls support");return k.createStreamTextureFromHtmlVideo(p)}(function(){var n=l(h.config.streamUrl);n.addLoadedListener(function(){g=!1;h.running&&(console.log(n),d=e.baseColorTexture,
e.baseColorTexture=n,h.viewerApi.onNextPageInteraction(function(){n.muted=!1}),f=!0)});g=!0;n.play();return!0})()}function c(){var l=h.config;(e=k.findMaterial(l.material))?e.baseColorTexture?Ic(ob("lib/Hls.js"),function(){l.trigger&&h.addTrigger(l.trigger,function(){return h.trigger()});!l.autoplay&&l.trigger||h.trigger()},function(){return Cc.error("Cannot load required library")}):(console.error("Material '"+l.material+"' for stream texture control '"+(l.name+"' does not have a stream texture")),
e=null):console.error("Material '"+l.material+"' for stream texture control '"+(l.name+"' does not exist"))}ui.call(this,a);var d=null,e=null,f=!1,g=!1,k=Dg,h=this;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.trigger=function(l){g||(f||g?!0===l&&e.isPlaying||!1===l&&!e.isPlaying||(e.isPlaying?e.pause():(h.config.playRewinds&&e.rewind(),e.play())):!1!==l&&b())};this.doStart=function(){this.viewerApi.onSceneLoadComplete(c)};this.doStop=function(){if(e){if(f){f=
!1;var l=e.baseColorTexture;e.baseColorTexture=d;l.dispose();d=null}e=null}}};
wi.VideoStream.definition={name:"Video Stream",properties:[{id:"material",type:"material",label:"Material with stream"},{id:"streamUrl",type:"text",label:"Stream URL"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"triggerExclusive",type:"bool",label:"Exclusive",defaultValue:!1},{id:"playRewinds",type:"bool",label:"Play rewinds",defaultValue:!1}],vrCompatible:!0};
function yi(a){var b=m.makeIterator(a.split(":"));a=b.next().value;b=b.next().value;return[a,b]}
wi.MultiTrigger=function(a){function b(){return e.config.extensions.map(function(k){var h=m.makeIterator(yi(k));k=h.next().value;h=h.next().value;return f.getExtension(k,h)}).filter(function(k){return k})}function c(k,h){k=m.makeIterator(b());for(var l=k.next();!l.done;l=k.next()){l=l.value;try{l.triggerAtPosition?l.triggerAtPosition(g,h):l.trigger(g)}catch(n){console.error("Failed to trigger an extension "+n)}}g=!g}function d(){var k=e.config;k.trigger&&e.addTrigger(k.trigger,c)}ui.call(this,a);
var e=this,f=this.viewerApi,g=!0;Object.defineProperty(this,"vrCompatible",{get:function(){for(var k=m.makeIterator(b()),h=k.next();!h.done;h=k.next())if(!h.value.vrCompatible)return!1;return!0}});this.doStart=function(){f.onSceneReadyToDisplay(d);g=!0}};
wi.MultiTrigger.definition={name:"Multi trigger",getListElementsToAdd:function(a,b,c){console.assert("extensions"===a);var d=new Set(b.map(function(e){return yi(e)[0]}));return c.getEditableExtensions().filter(function(e){return e.isTriggerable()&&("VideoTextureControl"===e.type||"SwitchObjects"===e.type||!d.has(e.type))}).map(function(e){return e.type+":"+e.name})},formatListElement:function(a){var b=m.makeIterator(yi(a));a=b.next().value;b=b.next().value;return zi.getExtensionDefinition(a).name+
": "+b},properties:[{id:"extensions",type:"list",elementType:"string",label:"Extensions to trigger",elementLabel:"extension"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}]};function zi(){this.extensionTypes=wi}zi.getExtensionDefinition=function(a){return wi[a].definition};
zi.prototype={constructor:zi,updateConfig:function(a){this.extensions=[];a=m.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this._createExtensionFromConfig(b.value)},_createExtensionFromConfig:function(a){function b(k,h){return k.some(function(l){return l.name===h&&l.config.type===a.type})}var c=this;a.name=a.name.toString();for(var d=a.name,e=2;b(this.extensions,a.name);)a.name=d+e.toString(),e+=1;var f=new this.extensionTypes[a.type](a);if(f.isTriggerExclusive()){console.assert(f.isTriggerable());
var g=f.trigger;f.trigger=function(k){!1!==k&&c.extensions.forEach(function(h){h!==f&&h.isTriggerExclusive()&&h.trigger(!1)});g.call(f,k)}}this.extensions.push(f);return f},startExtensionsByType:function(a){var b=this;this._loadFontAwesomeIfNeeded(function(){b.getExtensionsByType(a).forEach(function(c){return c.start()})})},startExtensions:function(){var a=this;this._loadFontAwesomeIfNeeded(function(){a.extensions.forEach(function(b){return b.start()})})},_loadFontAwesomeIfNeeded:function(a){var b=
this,c=this.extensions.map(function(d){return b._getFonts(d.config)}).concat(S.FONT_FAMILIES_TO_LOAD).reduce(function(d,e){return d.concat(e)},[]).filter(function(d,e,f){return e===f.indexOf(d)});0<c.length&&!S.EDIT_MODE?qb(c,a,a):a()},_getFonts:function(a){function b(g){(g=g.icon&&Xb[g.icon].fontFamily)&&c.push(g)}for(var c=[],d=m.makeIterator(this.extensionTypes[a.type].definition.properties),e=d.next();!e.done;e=d.next())if(e=e.value,"trigger"===e.type&&a[e.id])b(a[e.id]);else if("list"===e.type&&
"trigger"===e.elementType&&a[e.id]){e=m.makeIterator(a[e.id]);for(var f=e.next();!f.done;f=e.next())b(f.value)}return c},stopExtensions:function(){this.extensions.forEach(function(a){return a.stop()})},stopExtensionsByType:function(a){this.getExtensionsByType(a).forEach(function(b){return b.stop()})},getEditableExtensionDefinitions:function(){for(var a=[],b=m.makeIterator(Object.entries(this.extensionTypes||{})),c=b.next();!c.done;c=b.next()){var d=m.makeIterator(c.value);c=d.next().value;d=d.next().value;
d.definition.hideFromEditor||a.push({type:c,definition:d.definition})}return a},getEditableExtensions:function(){return this.extensions.filter(function(a){return!a.definition.hideFromEditor})},getEditableTriggerImagePaths:function(){function a(f){return f.properties.filter(function(g){return"trigger"===g.type}).map(function(g){return g.id})}for(var b=new Set,c={},d=m.makeIterator(this.getEditableExtensions()),e=d.next();!e.done;c={$jscomp$loop$prop$extension$204:c.$jscomp$loop$prop$extension$204},
e=d.next())c.$jscomp$loop$prop$extension$204=e.value,a(c.$jscomp$loop$prop$extension$204.definition).forEach(function(f){return function(g){f.$jscomp$loop$prop$extension$204.config[g]&&f.$jscomp$loop$prop$extension$204.config[g].image&&b.add(f.$jscomp$loop$prop$extension$204.config[g].image)}}(c));return Array.from(b)},addExtension:function(a){a=this._createExtensionFromConfig(a);a.start();return a},removeExtension:function(a){a.stop();a=this.extensions.indexOf(a);-1!==a&&this.extensions.splice(a,
1)},getConfig:function(){return this.extensions.map(function(a){return a.config})},getExtensionsByType:function(a){return this.extensions.filter(function(b){return b.type===a})},getExtension:function(a,b){var c=this.extensions.find(function(d){return d.type===a&&d.name===b});if(c)return c;console.error("Unrecognized extension "+a+" "+b+", supported types: "+Object.keys(this.extensionTypes))}};var Ai;function Bi(a){if(a.empty())return 0;a.size(Ai);return Ai.x*Ai.y*Ai.z}function Ci(a){if(a.empty())return 0;a.size(Ai);a=Ai.x*Ai.y;return 1>Ai.x||1>Ai.y||1.9>Ai.z||1.5>a?0:a*Ai.z}
function Di(a){var b=[],c=[];b.push(a);this.addFilledBox=function(e){c.push(e)};this.findBestFilledBoxes=function(){function e(n){return n[1]}function f(n){n=n[0];n=n.max.x<l.min.x+.2||n.min.x>l.max.x-.2||n.max.y<l.min.y+.2||n.min.y>l.max.y-.2||n.max.z<l.min.z+.2||n.min.z>l.max.z-.2?!1:!0;return!n}var g=[],k=[];for(c.forEach(function(n){k.push([n,Bi(n)])});0<k.length&&10>g.length;){var h=Ha(k,e);var l=k[h][0];g.push(l);k=k.filter(f)}return g};this.isEnclosedInFilledBox=function(e){return c.some(function(f){f=
f.min.x-.1<=e.min.x&&e.max.x<=f.max.x+.1&&f.min.y-.1<=e.min.y&&e.max.y<=f.max.y+.1&&f.min.z-.1<=e.min.z&&e.max.z<=f.max.z+.1?!0:!1;return f})};this.findLargestEmptyBox=function(){var e=Ha(b,Bi);return null!==e?b[e]:null};var d=function(){var e=[];e[0]=new C.Box3;e[1]=new C.Box3;e[2]=new C.Box3;e[3]=new C.Box3;e[4]=new C.Box3;e[5]=new C.Box3;return function(f,g,k){e[0].max.copy(f.max);e[0].min.copy(f.min);e[0].min.z=g.max.z;e[1].max.copy(f.max);e[1].max.z=g.min.z;e[1].min.copy(f.min);e[2].max.copy(f.max);
e[2].min.copy(f.min);e[2].min.x=g.max.x;e[3].max.copy(f.max);e[3].max.x=g.min.x;e[3].min.copy(f.min);e[4].max.copy(f.max);e[4].min.copy(f.min);e[4].min.y=g.max.y;e[5].max.copy(f.max);e[5].max.y=g.min.y;e[5].min.copy(f.min);var h=Ha(e,Ci);0!==Ci(e[h])&&(k.push(e[h].clone()),0===h?f.max.z=g.max.z:1===h?f.min.z=g.min.z:2===h?f.max.x=g.max.x:3===h?f.min.x=g.min.x:4===h?f.max.y=g.max.y:5===h&&(f.min.y=g.min.y),d(f,g,k))}}();this.split=function(e){for(var f=[],g=0;g<b.length;g+=1){var k=b[g];k.isIntersectionBox(e)?
d(k,e,f):f.push(k)}b=f}}
function Ei(a,b,c){function d(x){var t=new Hg({id:a.lightProbes.length});x.center(t.position);t.position.z=x.min.z+1.3;t.enableBoundingBox();t.boxMin.copy(x.min);t.boxMax.copy(x.max);a.lightProbes.push(t)}var e=new Di(a.boundingBox.clone()),f=new C.Box3,g=new C.Box3,k=new C.Vector3,h=new Fd;Ai=new C.Vector3;for(var l=new Hg({id:0}),n=0;200>n;n+=1){var p=e.findLargestEmptyBox();if(null===p)break;p.center(l.position);l.position.z=p.min.z+1.3;l.enableBoundingBox();g.makeEmpty();for(var r=0;5>r;r+=1){b.findBounds(l);
if(!l.isBoundingBoxInitialized())break;f.set(l.boxMin,l.boxMax);var q=Ci(f);if(0===q)break;if(e.isEnclosedInFilledBox(f))break;f.center(k);k.z=f.min.z+1.3;var w=l.position.distanceToSquared(k);Bi(g)<q&&.25>w&&g.set(f.min,f.max);if(.04>w)break;l.position.copy(k)}g.empty()?(p.center(f.min),p.center(f.max),e.split(f)):(e.addFilledBox(g.clone()),e.split(g))}zc.log("Light probes arrangement time "+h.elapsedSec());b=e.findBestFilledBoxes();(b.reduce(function(x,t){return x+Bi(t)},0)>.2*Bi(a.boundingBox)||
c)&&b.forEach(d);0===a.lightProbes.length&&c&&d(a.boundingBox)};var Fi=new C.Vector3;function Gi(a,b,c,d){for(var e=[],f=0;6>f;f+=1){var g=d?new C.OrthographicCamera(-1,1,1,-1,a,b):new C.PerspectiveCamera(90,1,a,b);c.add(g);e.push(g)}e[0].up.set(0,-1,0);Fi.set(1,0,0);e[0].lookAt(Fi);e[1].up.set(0,-1,0);Fi.set(-1,0,0);e[1].lookAt(Fi);e[2].up.set(0,0,1);Fi.set(0,1,0);e[2].lookAt(Fi);e[3].up.set(0,0,-1);Fi.set(0,-1,0);e[3].lookAt(Fi);e[4].up.set(0,-1,0);Fi.set(0,0,1);e[4].lookAt(Fi);e[5].up.set(0,-1,0);Fi.set(0,0,-1);e[5].lookAt(Fi);return e}
function Hi(a,b){C.Object3D.call(this);this.sideCameras=Gi(a,b,this,!1)}Hi.prototype=Object.create(C.Object3D.prototype);Hi.prototype.constructor=Hi;function Ii(a,b){C.Object3D.call(this);this.sideCameras=Gi(a,b,this,!0)}Ii.prototype=Object.create(C.Object3D.prototype);Ii.prototype.constructor=Ii;function Ji(){Dd.call(this,"aabb_query_vertex.glsl","aabb_query_fragment.glsl");this.side=C.DoubleSide;this.uniforms={axis:{type:"i",value:0}}}Ji.prototype=Object.create(Dd.prototype);Ji.prototype.constructor=Ji;Object.defineProperty(Ji.prototype,"axis",{get:function(){return this.uniforms.axis.value},set:function(a){console.assert(0===a||1===a||2===a);this.uniforms.axis.value=a}});/*
 Copyright (C) 2015-present Shapespark
*/
var Ki={uniforms:{gloss:{type:"f",value:.9},roughness:{type:"f",value:.9},face:{type:"f",value:0},mipSize:{type:"f",value:128},envMap:{type:"t",value:null},envMapFiltered:{type:"t",value:null},topMipResolution:{type:"f",value:512}},vertexShaderName:"cubemap_filter_vertex.glsl",fragmentShaderName:"cubemap_filter_fragment.glsl"};function Li(a,b,c){var d=new Me(!0),e=new Hi(S.CAMERA_WALK_NEAR,c),f=S.OBJECT_VISIBILITY_TARGET_SIZE,g=a.createRenderTarget(f,f,{format:Mb.RGBA,magFilter:Mb.NEAREST,minFilter:Mb.NEAREST,depthBuffer:!0,stencilBuffer:!1,generateMipmaps:!1}),k=new Uint8Array(4*f*f),h=new Ne(a),l=new Oe(a),n=new C.Color(16777215);this.findVisibleObjects=function(p){var r=new Set,q=[];e.position.copy(p);e.updateMatrixWorld();for(p=0;p<b.length;p+=1){var w=b[p];console.assert(!w.visibilityId);w.visibilityId=p;q.push(w)}h.set(!0,
!0,!1);l.set(n);for(p=0;6>p;p+=1){a.renderMeshes(q,d,e.sideCameras[p],g);a.readPixels(f,f,k);w=k;for(var x=w.length,t=0;t<x;t+=4){var A=Math.round(65536*w[t]+256*w[t+1]+w[t+2]);16777215!==A&&r.add(A)}}l.restore();h.restore();q=[];r=m.makeIterator(r);for(p=r.next();!p.done;p=r.next())q.push(b[p.value]);for(r=0;r<b.length;r+=1)b[r].visibilityId=null;return q};this.dispose=function(){d.dispose();g.dispose();k=g=null}};var Mi=function(){var a=null;return function(b,c){var d=null,e=0;c*=c;console.assert(c<Math.pow(2,16));null===a&&(a=new Uint16Array(65536));for(var f=0;f<4*c;f+=4)a[256*b[f]+b[f+1]]+=1;a[0]>.7*c&&(e=a[0]);a[0]=0;for(b=1;b<a.length;b+=1)a[b]>e&&(e=a[b],d=Math.floor(b/256)+b%256/255),a[b]=0;return d}}();
function Ni(a,b,c){a.sharedMaterialState.hdrOutput=!0;a.threeScene.traverse(function(d){if(d instanceof C.Mesh&&d.visible){var e=d.material;d.userData.hideFromLightProbes||e.hideFromLightProbes?(b.add(d),d.visible=!1):c.has(e)||(c.set(e,{reflective:e.reflective,headLight:e.headLight}),e.configureTransparency&&(e.transparent=!1,e.blending=C.NoBlending,e.depthWrite=!0),void 0!==e.headLight&&(e.headLight=!1),void 0!==e.reflective&&(e.reflective=!1))}})}
function Oi(a,b,c){a.sharedMaterialState.hdrOutput=!1;a.threeScene.traverse(function(d){if(d instanceof C.Mesh){var e=d.material;e.forceObjectUniformsRefresh&&e.forceObjectUniformsRefresh();if(d.visible){if(d=c.get(e))c.delete(e),e.configureTransparency&&e.configureTransparency(),void 0!==d.headLight&&(e.headLight=d.headLight),void 0!==d.reflective&&(e.reflective=d.reflective)}else b.has(d)&&(d.visible=!0)}})}
var Pi=function(){var a=null;return function(b,c,d){var e=b.renderer,f=b.aabbQueryMaterial,g=b.pixelBuf,k=b.targetCubeRaw;null===a&&(a=new Ii(.01,255));a.position.copy(c.position);a.updateMatrixWorld();var h;for(h=0;6>h;h+=1){k.activeCubeFace=h;f.axis=Math.floor(h/2);e.renderMeshes(b.scene.gpuMeshes,f,a.sideCameras[h],k);e.readPixels(k.width,k.height,g);var l=Mi(g,k.width);if(null===l){zc.log("failed to find light probe bound");break}switch(h){case 0:d.boxMax.x=c.position.x+l;break;case 1:d.boxMin.x=
c.position.x-l;break;case 2:d.boxMax.y=c.position.y+l;break;case 3:d.boxMin.y=c.position.y-l;break;case 4:d.boxMax.z=c.position.z+l;break;case 5:d.boxMin.z=c.position.z-l}}6!==h&&(zc.log("Light probe bounds: X["+d.boxMin.x.toFixed(2)+":"+d.boxMax.x.toFixed(2)+"] Y["+d.boxMin.y.toFixed(2)+":"+d.boxMax.y.toFixed(2)+"] Z["+d.boxMin.z.toFixed(2)+":"+d.boxMax.z.toFixed(2)+"]"),d.resetBoundingBox())}}();
function Qi(a,b){var c={format:Mb.RGBA,magFilter:Mb.LINEAR,minFilter:Mb.LINEAR,stencilBuffer:!1,generateMipmaps:!1};this.renderer=a;this.scene=b;this.threeScene=b.threeScene;this.aabbQueryMaterial=new Ji;this.filterPass=new Ed(Ki,"envMap");this.filterPass.material.condDefine(!S.NO_PBR,"USE_PBR");b=S.LIGHT_PROBE_MAX_MIP_SIZE;this.pixelBuf=new Uint8Array(b*b*4);this.targetCubeRaw=a.createRenderTargetCube(b,b,c);c.depthBuffer=!1;this.targetFiltered=a.createRenderTarget(b,b,c);this.autoClearAlter=new Ne(a);
this.dispose=function(){this.targetCubeRaw.dispose();this.targetFiltered.dispose();this.aabbQueryMaterial.dispose();this.filterPass.material.dispose();this.pixelBuf=null}}Qi.prototype.constructor=Qi;
function Ri(a,b){var c=b.geometry.boundingSphere.center,d=S.ENABLE_REFLECTION_PROBES_BLENDING?S.MAX_BLENDED_REFLECTION_PROBES:1;if(0==b.lightProbes.length)b.lightProbes.push(a);else for(var e=c.distanceTo(a.position),f=0;f<b.lightProbes.length;f++){var g=c.distanceTo(b.lightProbes[f].position);if(e<=g){b.lightProbes=[].concat(m.arrayFromIterable(b.lightProbes.slice(0,f)),[a],m.arrayFromIterable(b.lightProbes.slice(f,Math.min(b.lightProbes.length,d-1))));break}}}
function ej(a,b){for(var c=0;c<b.length;c+=1)Ri(a,b[c])}function fj(a,b){zc.log("No visible light probe found for "+b.length+" objects. Assigning the closest ones.");for(var c=0;c<b.length;c+=1)for(var d=0;d<a.length;d+=1)Ri(a[d],b[c])}
function gj(a,b,c,d,e){function f(n,p){l.position.copy(n.position);l.updateMatrixWorld();var r;if((r=d)&&!(r=e))a:{r=m.makeIterator(a.gpuMeshes);for(var q=r.next();!q.done;q=r.next())if(q=q.value,q.material.envMapMirror&&q.lightProbes.includes(n)){r=!0;break a}r=!1}(q=r)&&zc.log("Mirror texture needed for the light probe.");h.reset();r=k.renderer;k.autoClearAlter.set(!0,!0,!1);if(q){var w=k.renderer;q=S.LIGHT_PROBE_MIRROR_SIZE;q=w.createRenderTargetCube(q,q,{format:Mb.RGBA,magFilter:Mb.LINEAR,minFilter:Mb.LINEAR,
stencilBuffer:!1,generateMipmaps:!1});for(var x=0;6>x;x+=1)q.activeCubeFace=x,w.render(k.threeScene,l.sideCameras[x],q);w.deallocateRenderTargetRenderingBuffers(q);w=q;n.setMirrorTexture(w)}p&&Pi(k,l,n);p=k.renderer;q=k.targetCubeRaw;for(x=0;6>x;x+=1)q.activeCubeFace=x,p.render(k.threeScene,l.sideCameras[x],q);k.autoClearAlter.restore();r.enableScissorTest(!0);k.autoClearAlter.set(!1,!1,!1);c&&(w=r.createCubeTexture(k.targetFiltered.width,!0),n.setFilteredTexture(w),k.filterPass.uniforms.envMapFiltered.value=
w);for(p=0;p<S.LIGHT_PROBE_MIPS_COUNT;p+=1){q=Math.pow(2,Math.log(k.targetFiltered.width)/Math.log(2)-p);r.setScissor(0,0,q,q);x=p/(S.LIGHT_PROBE_MIPS_COUNT-1);var t=S.LIGHT_PROBE_GLOSS_FOR_MIP[p];k.filterPass.uniforms.topMipResolution.value=q;k.filterPass.uniforms.roughness.value=x;k.filterPass.uniforms.mipSize.value=q;k.filterPass.uniforms.gloss.value=t;c||(w=r.createCubeTexture(q,!1),n.setFilteredTextureNoLod(w,p));x=k.filterPass;t=k.targetCubeRaw;var A=k.targetFiltered,D=k.pixelBuf,H=c?p:0,G=
w;if(S.DEBUG_LIGHT_PROBE_MIPS)for(var K=D,W=255*H/S.LIGHT_PROBE_MIPS_COUNT,O=0;O<4*q*q;O+=4)K[O]=W,K[O+1]=W,K[O+2]=W,K[O+3]=31.875;for(K=0;6>K;K+=1){if(!S.DEBUG_LIGHT_PROBE_MIPS)for(x.uniforms.face.value=K,x.render(r,A,t),W=D,O=!0;O;){r.readPixels(q,q,W);for(var ea=0;ea<q*q*4;ea+=4)if(0!==W[ea]||0!==W[ea+1]||0!==W[ea+2]){O=!1;break}if(O){console.warn("Cube face has all pixels black.");break}}r.copyFramebufferToCubeFaceMip(H,q,K,D,G)}}r.enableScissorTest(!1);k.autoClearAlter.restore();zc.log("Cube generation time "+
h.elapsedSec())}var g,k=new Qi(b,a),h=new Fd,l=new Hi(.15,a.camera.far);this.assignLightProbesToObjects=function(){h.reset();void 0===g&&(g=new Li(b,a.gpuMeshes,a.camera.far));for(var n=0;n<a.gpuMeshes.length;n+=1)a.gpuMeshes[n].lightProbes=[];for(n=0;n<a.lightProbes.length;n+=1){var p=a.lightProbes[n],r=g.findVisibleObjects(p.position);zc.log("Have visible objects "+r.length);ej(p,r)}zc.log("Light probe assigment time "+h.elapsedSec());fj(a.lightProbes,a.gpuMeshes.filter(function(q){return 0===q.lightProbes.length}))};
this.findBounds=function(n){l.position.copy(n.position);l.updateMatrixWorld();k.autoClearAlter.set(!0,!0,!1);Pi(k,l,n);k.autoClearAlter.restore()};this.createLightProbeTexture=function(n,p){var r=new Set,q=new Map;Ni(a,r,q);f(n,p);Oi(a,r,q)};this.createAllLightProbeTextures=function(){var n=new Set,p=new Map;Ni(a,n,p);for(var r=0;r<a.lightProbes.length;r+=1)f(a.lightProbes[r],!1);Oi(a,n,p)};this.dispose=function(){k.dispose();g&&g.dispose()}};function hj(){bf.call(this);this.noSharedBuffers=new C.Color(16777215);this.sharedBuffersMaster=new C.Color(255);this.sharedBuffersCopy=new C.Color(65280);this.lightMapSupported=!1;this.headLight=!0;this.reflective=!1;this.setUniforms();this.defaultAttributeValues=Object.assign({},this.defaultAttributeValues);this.defaultAttributeValues.sphericalNormal=[0,0]}hj.prototype=Object.create(bf.prototype);
hj.prototype.refreshPerObjectUniforms=function(a){this.uniforms.baseColor.value=0===a.sharedBuffersDebug?this.noSharedBuffers:1===a.sharedBuffersDebug?this.sharedBuffersMaster:this.sharedBuffersCopy;return!0};function ij(a,b){Dd.call(this,"outline_vertex.glsl","outline_fragment.glsl");this.side=C.DoubleSide;this.uniforms={color:{type:"c",value:a},thickness:{type:"f",value:b}}}ij.prototype=Object.create(Dd.prototype);ij.prototype.constructor=ij;function jj(){Ed.call(this,{uniforms:{inputBuffer:{type:"t",value:null},weight:{type:"f",value:1}},vertexShaderName:"accumulate_vertex.glsl",fragmentShaderName:"accumulate_fragment.glsl"},"inputBuffer");this.material.depthTest=!1;this.material.depthWrite=!1;this.material.blending=C.CustomBlending;this.material.blendEquation=Mb.FUNC_ADD;this.material.blendDst=Mb.ONE_MINUS_SRC_ALPHA;this.material.blendSrc=Mb.SRC_ALPHA}jj.prototype=Object.create(Ed.prototype);jj.prototype.constructor=jj;function kj(a,b,c,d,e){var f=a/b,g=Math.tan(.5*C.Math.degToRad(e.fov));g=e.near*g/e.zoom;var k=-g,h=k*f;f*=g;a=(f-h)/a;b=(g-k)/b;e.projectionMatrix.makeFrustum(h-c*a,f-c*a,k-d*b,g-d*b,e.near,e.far)}function lj(a,b,c,d,e){var f=e.top,g=e.bottom,k=e.left,h=e.right;a=(h-k)/a;b=(g-f)/b;e.projectionMatrix.makeOrthographic(k-c*a,h-c*a,f-d*b,g-d*b,e.near,e.far)}
function mj(){var a=new Ed({uniforms:{tDiffuse:{type:"t",value:null}},vertexShaderName:"copy_opaque_vertex.glsl",fragmentShaderName:"copy_opaque_fragment.glsl"});a.renderToScreen=!0;return a}
function nj(a,b,c){void 0===c&&(c=b.camera.current);var d,e,f=0,g=[[.375,.4375],[.625,.0625],[.875,.1875],[.125,.0625],[.375,.6875],[.875,.4375],[.625,.5625],[.375,.9375],[.625,.3125],[.125,.5625],[.125,.8125],[.375,.1875],[.875,.9375],[.875,.6875],[.125,.3125],[.625,.8125]],k=new jj,h=mj(),l=new Ne(a);if(c instanceof C.PerspectiveCamera)var n=kj;else c instanceof C.OrthographicCamera?n=lj:(console.error("Unsupported camera type"),n=void 0);var p=n;this.reset=function(){f=0};this.renderSample=function(r,
q){console.assert(f<g.length);l.set(!0,!0,!1);p(e.width,e.height,g[f][0]-.5,g[f][1]-.5,c);r?a.renderMeshes(r,q,c,d,!0):(console.assert(!1===(void 0!==q&&void 0===r),"Passing overrideMaterial without passing meshes is not implemented"),a.render(b.threeScene,c,d,!0));l.restore();l.set(!1,!1,!1);k.uniforms.weight.value=1/(f+1);k.render(a,e,d);l.restore();c.updateProjectionMatrix();f+=1};this.renderedSamplesCount=function(){return f};this.allSamplesRendered=function(){return f===g.length};this.renderAllSamples=
function(r,q){for(;!this.allSamplesRendered();)this.renderSample(r,q)};this.renderAccumulatedSamplesToScreen=function(){l.set(!0,!0,!1);h.render(a,void 0,e);l.restore()};this.copyAccumulatedSamplesToBuffer=function(){var r=e.width,q=e.height,w=new Uint8Array(r*q*4);a.readPixels(r,q,w);return w};this.setTargets=function(r,q){console.assert(r.width===q.width&&r.height===q.height);d=r;e=q};this.dispose=function(){k.material.dispose()}};function oj(a){var b=new ij(new C.Color(0,0,0),1),c=new bf;c.sharedMaterialState=a.sharedMaterialState;c.reflective=!1;c.headLight=!1;c.setUniforms();return{outlineMaterial:b,planMaterial:c}}function pj(a,b,c){for(var d=0;d<c;++d)for(var e=0;e<b;++e){var f=4*(d*b+e);if(d<c/2)for(var g=4*((c-d-1)*b+e),k=0;4>k;++k){var h=a[f+k];a[f+k]=a[g+k];a[g+k]=h}}}function qj(a,b){console.assert(0===b%4,"id passed does not point to alpha channel");return 0!==a[b+3]}
function rj(a,b){console.assert(0===b%4,"id passed does not point to alpha channel");return 255>a[b+3]}function sj(a,b,c){return a.createRenderTarget(b,c,{format:Mb.RGBA,magFilter:Mb.NEAREST,minFilter:Mb.NEAREST,stencilBuffer:!1,generateMipmaps:!1})}
function tj(a,b){var c=new Ed({uniforms:{tColor:{type:"t",value:null},tAlpha:{type:"t",value:null},colorFill:{type:"c",value:null}},vertexShaderName:"minimap_add_alpha_vertex.glsl",fragmentShaderName:"minimap_add_alpha_fragment.glsl"},"tColor");c.uniforms.tAlpha.value=a;b&&(c.material.condDefine(!0,"USE_ALPHA_FROM_COLOR"),c.uniforms.colorFill.value=b);return c}
function uj(a,b){function c(g,k,h,l,n,p,r){var q=new Uint8Array(k.width*k.height*4),w=new Ne(a);w.set(!0,!0,!1);var x=[];b.gpuMeshes.forEach(function(A){(A.logicalMeshes||[A]).forEach(function(D){var H=n?!D.node.disableCollisions:!0;(l?!D.material.transparent:1)&&H&&x.push(D)})});if(p){p=sj(a,k.width,k.height);var t=sj(a,k.width,k.height);g=new nj(a,b,g);g.setTargets(p,t);g.renderAllSamples(x,h);h=tj(p,r);w.restore();w.set(!0,!0,!1);h.render(a,k,t);w.restore();a.readPixels(k.width,k.height,q);p.dispose();
t.dispose();g.dispose()}else a.renderMeshes(x,h,g,k),w.restore(),a.readPixels(k.width,k.height,q);pj(q,k.width,k.height);return q}function d(g,k,h,l,n){l=Math.max(l,n);h=Math.max(h.size().x,h.size().y);f.outlineMaterial.setUniform("thickness","f",g/(l/h*.1));f.outlineMaterial.setUniform("color","c",k)}var e=new C.Color(1,1,1),f=oj(b);this.createMinimapImageDataComponents=function(g,k,h,l){d(g.outlineThickness,e,b.boundingBox,h,l);var n=k.cropRange.center(),p=sj(a,h,l),r=new C.OrthographicCamera(k.visibleRange.min.x-
n.x,k.visibleRange.max.x-n.x,k.visibleRange.min.y-n.y,k.visibleRange.max.y-n.y,0,10);r.rotation.set(0,0,-1*k.rotation);r.position.set(n.x,n.y,k.slicePlaneHeight);r.updateMatrixWorld(!0);k=k.slicePlaneHeight-k.farPlaneHeight;r.near=0;r.far=k;r.updateProjectionMatrix();k=c(r,p,f.planMaterial,!0,!0,!0);if(0<b.minimapConfig.outlineThickness){r.near=0;r.far=.1;r.updateProjectionMatrix();var q=c(r,p,f.outlineMaterial,!0,!0,!0,g.outlineColor);if(b.minimapConfig.fillEnabled){r=q;g=g.outlineColor;var w=void 0;
w=void 0===w?.02:w;n=new Uint8Array(r.length);w*=r.length/4;for(var x=[-4,4,4*-h,4*h],t=0;t<r.length;t+=4)if(0===n[t]&&rj(r,t)){var A=r,D=[],H=[],G=t,K=H;n[G]=1;for(K.push(G);H.length;){G=H.pop();D.push(G);K=A;for(var W=H,O=0;O<x.length;++O){var ea=G+x[O];if(0===n[ea]&&255>K[ea+3]&&K[ea+3]>=K[G+3]){ea=G+x[O];var ra=W;n[ea]=1;ra.push(ea)}}}A=D;if(A.length<w)for(D=g,H=r,G=0;G<A.length;++G)H[A[G]]=255*D.r,H[A[G]+1]=255*D.g,H[A[G]+2]=255*D.b,H[A[G]+3]=255}}r=q;for(g=0;g<k.length;g+=4)if(qj(r,g)){n=r[g+
3]/255;for(w=0;3>w;++w)k[g+w]=k[g+w]*(1-n)+r[g+w]*n;k[g+3]=255}}p.dispose();p=new Uint8Array(k.length);for(r=0;r<k.length;r+=4)if(qj(k,r)&&(!q||rj(q,r)))for(g=0;4>g;++g)p[r+g]=255;k=new Uint8ClampedArray(k.buffer);k=new ImageData(k,h,l);p=new Uint8ClampedArray(p.buffer);h=new ImageData(p,h,l);return{minimapImageData:k,walkableImageData:h}};this.getCollisionData=function(g,k,h){var l={x:{min:0,max:k},y:{min:0,max:h}},n={x:{min:b.collisionBoundingBox.min.x,max:b.collisionBoundingBox.max.x},y:{min:b.collisionBoundingBox.max.y,
max:b.collisionBoundingBox.min.y}};d(g.outlineThickness,g.outlineColor,b.collisionBoundingBox,k,h);var p=a.createRenderTarget(k,h,{format:Mb.RGBA,magFilter:Mb.NEAREST,minFilter:Mb.NEAREST,stencilBuffer:!1,generateMipmaps:!1}),r=new C.OrthographicCamera(b.collisionBoundingBox.min.x,b.collisionBoundingBox.max.x,b.collisionBoundingBox.max.y,b.collisionBoundingBox.min.y,0,10);r.position.set(0,0,g.slicePlaneHeight);r.updateMatrixWorld(!0);r.near=0;r.far=.1;r.updateProjectionMatrix();g=c(r,p,f.outlineMaterial,
!1,!0);p.dispose();p=new Uint8ClampedArray(g.buffer);return{collisionImageData:new ImageData(p,k,h),canvasRange:l,collisionRange:n}};this.calculateRenderSize=function(g,k){k=k.size().y/k.size().x;return{width:1>k?g:Math.round(1/k*g),height:1>k?Math.round(g*k):g}}};var vj=null;function wj(a,b){throw Error(WebGLDebugUtils.glEnumToString(a)+" was caused by call to: "+b);}function xj(a,b){Array.from(b).filter(function(c){return void 0===c}).forEach(function(c){c=WebGLDebugUtils.glFunctionArgToString(a,c);console.error("undefined passed to gl."+a+"("+c+")")})}function yj(a,b){console.log("gl."+a+"("+WebGLDebugUtils.glFunctionArgsToString(a,b)+")");xj(a,b)}function zj(a){return new Promise(function(b,c){Ic(a,b,c)})}
function Aj(){return m.asyncExecutePromiseGeneratorProgram(function(a){switch(a.nextAddress){case 1:return a.setCatchFinallyBlocks(2),a.yield(zj(ob("lib/spector.bundle.js")),4);case 4:a.leaveTryBlock(3);break;case 2:return a.enterCatchBlock(),console.error("Cannot load SpectorJS library"),a.return();case 3:console.info("SpectorJS loaded"),vj=new SPECTOR.Spector,vj.displayUI(),a.jumpToEnd()}})}
function Bj(){return m.asyncExecutePromiseGeneratorProgram(function(a){if(1==a.nextAddress)return a.setCatchFinallyBlocks(2),a.yield(zj(ob("lib/webgl-debug.js")),4);if(2!=a.nextAddress)return console.info("WebGLDebugUtils loaded"),a.leaveTryBlock(0);a.enterCatchBlock();console.error("Cannot load WebGLDebugUtils library");a.jumpToEnd()})}
function Cj(){return m.asyncExecutePromiseGeneratorProgram(function(a){return 1==a.nextAddress?S.DEBUG_SPECTOR?a.yield(Aj(),2):a.jumpTo(2):S.DEBUG_WEBGL?a.yield(Bj(),0):a.jumpTo(0)})}function Dj(){}Dj.setDebugMarker=function(a){vj&&vj.setMarker(a)};Dj.clearDebugMarker=function(){vj&&vj.clearMarker()};var Ej={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new C.Vector2(1/1024,1/512)}},vertexShaderName:"fxaa_vertex.glsl",fragmentShaderName:"fxaa_fragment.glsl"};function Fj(){this.shaderPass=new Ed(Ej);this.shaderPass.clear=!1;this.shaderPass.renderToScreen=!1;this.shaderPass.material.depthTest=!1;this.shaderPass.material.depthWrite=!1;this.shaderPass.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight)}
Fj.prototype.onResize=function(a,b){this.shaderPass.uniforms.resolution.value.set(1/a,1/b)};Fj.prototype.update=function(){};m.global.Object.defineProperties(Fj.prototype,{renderToScreen:{configurable:!0,enumerable:!0,get:function(){return this.shaderPass.renderToScreen},set:function(a){this.shaderPass.renderToScreen=a}}});var Gj={uniforms:{tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new C.Vector2(1/1024,1/512)},delta:{type:"f",value:1},velocityFactor:{type:"f",value:.5},cameraMove:{type:"v3",value:new C.Vector3(0,0,0)},clipToWorldMatrix:{type:"m4",value:new C.Matrix4},previousWorldToClipMatrix:{type:"m4",value:new C.Matrix4}},vertexShaderName:"motion_blur_vertex.glsl",fragmentShaderName:"motion_blur_fragment.glsl"};
function Hj(a){this.camera=a;this.shaderPass=new Ed(Gj);this.shaderPass.clear=!1;this.shaderPass.renderToScreen=!1;this.shaderPass.material.depthTest=!0;this.shaderPass.material.depthWrite=!0;this.shaderPass.uniforms.resolution.value.set(1/(window.innerWidth*window.devicePixelRatio),1/(window.innerHeight*window.devicePixelRatio));this.shaderPass.uniforms.velocityFactor.value=a.motionBlurIntensity;this.previousMatrixWorldInverse=new C.Matrix4;this.previousProjectionMatrix=new C.Matrix4;this.previousCameraPosition=
new C.Vector3;this.cameraPosition=new C.Vector3;this.inverseProjectionMatrix=new C.Matrix4}Hj.prototype.onResize=function(a,b){this.shaderPass.uniforms.resolution.value.set(1/a,1/b)};
Hj.prototype.update=function(a){this.shaderPass.uniforms.delta.value=a;this.shaderPass.uniforms.clipToWorldMatrix.value.getInverse(this.camera.matrixWorldInverse).multiply(this.inverseProjectionMatrix.getInverse(this.camera.projectionMatrix));this.shaderPass.uniforms.previousWorldToClipMatrix.value.copy(this.previousProjectionMatrix.multiply(this.previousMatrixWorldInverse));this.shaderPass.uniforms.cameraMove.value.copy(this.camera.position).sub(this.previousCameraPosition);this.camera.updateMatrixWorld();
this.cameraPosition.setFromMatrixPosition(this.camera.matrixWorld);this.previousMatrixWorldInverse.copy(this.camera.matrixWorldInverse);this.previousProjectionMatrix.copy(this.camera.projectionMatrix);this.previousCameraPosition.copy(this.cameraPosition)};
m.global.Object.defineProperties(Hj.prototype,{renderToScreen:{configurable:!0,enumerable:!0,get:function(){return this.shaderPass.renderToScreen},set:function(a){this.shaderPass.renderToScreen=a}},intensity:{configurable:!0,enumerable:!0,set:function(a){this.shaderPass.uniforms.velocityFactor.value=a}}});var Ij={minFilter:Mb.LINEAR,magFilter:Mb.LINEAR,format:Mb.RGBA,depthBuffer:!0,useDepthTexture:!0,stencilBuffer:!1,generateMipmaps:!1};function Jj(a,b,c){C.EventDispatcher.call(this);var d=this;this.renderer=a;this.camera=c;this.scene=b;this.renderModel=new Pd(b,c);this.renderTarget2=this.renderTarget1=null;this.passes=[];this.postProcessChain=[];c.addEventListener("motionBlurUpdated",function(){return d.updateMotionBlur()})}m.inherits(Jj,C.EventDispatcher);
Jj.prototype.init=function(){this.configureTarget(1024,1024,Ij);this.passes.push(this.renderModel)};Jj.prototype.onResize=function(a,b){this.renderer&&(this.configureTarget(a,b,Ij),this.ssaa&&this.ssaa.setTargets(this.renderTarget1,this.renderTarget2));this.postProcessChain.forEach(function(c){c.onResize(a,b)})};Jj.prototype.removePostProcess=function(a){this.passes=this.passes.filter(function(b){return b!==a.shaderPass});this.postProcessChain=this.postProcessChain.filter(function(b){return b!==a})};
Jj.prototype.disposeTarget=function(){this.renderTarget1&&(this.renderTarget1.dispose(),this.renderTarget1=null);this.renderTarget2&&(this.renderTarget2.dispose(),this.renderTarget2=null)};Jj.prototype.configureTarget=function(a,b,c){this.disposeTarget();this.renderTarget1=this.renderer.createRenderTarget(a,b,c);this.renderTarget2=this.renderer.createRenderTarget(a,b,c)};
Jj.prototype.setup=function(){this.isEnabled&&(this.renderer.autoClear=!1,this.postProcessChain.forEach(function(a,b,c){a.renderToScreen=b===c.length-1}))};Jj.prototype.render=function(a){var b=this,c=this.renderTarget1,d=this.renderTarget2;this.passes.filter(function(e){return e.enabled}).forEach(function(e){e.render(b.renderer,c,d,a);e.needsSwap&&e!==b.passes.at(-1)&&(e=m.makeIterator([d,c]),c=e.next().value,d=e.next().value)})};
Jj.prototype.update=function(a){this.postProcessChain.forEach(function(b){b.update(a)});this.render(a)};Jj.prototype.updateMotionBlur=function(){var a=this.postProcessChain.find(function(c){return c instanceof Hj}),b=!a&&this.camera.motionBlurEnabled;a&&!this.camera.motionBlurEnabled&&(this.removePostProcess(a),this.setup());b&&(this.addMotionBlur(),this.setup());a&&(a.intensity=this.camera.motionBlurIntensity)};Jj.prototype.addFXAA=function(){var a=new Fj;this.passes.push(a.shaderPass);this.postProcessChain.push(a)};
Jj.prototype.addMotionBlur=function(){var a=new Hj(this.camera);this.passes.push(a.shaderPass);this.postProcessChain.push(a)};Jj.prototype.addSSAA=function(a){this.ssaa=new nj(this.renderer,a)};Jj.prototype.resetSSAA=function(){this.ssaa&&this.ssaa.reset()};Jj.prototype.updateSSAA=function(){if(!this.ssaa)return!1;this.ssaa.renderSample();4<=this.ssaa.renderedSamplesCount()&&this.ssaa.renderAccumulatedSamplesToScreen();return!this.ssaa.allSamplesRendered()};
m.global.Object.defineProperties(Jj.prototype,{isEnabled:{configurable:!0,enumerable:!0,get:function(){return 0<this.postProcessChain.length}}});function Kj(){this.camera=new C.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new C.Scene;this.material=new Dd("fxaa_vertex.glsl","fxaa_fragment.glsl");this.quad=new C.Mesh(new C.PlaneBufferGeometry(2,2),this.material);this.scene.add(this.quad)};function Lj(a,b,c,d,e){this.renderGraph=a;this.frameEvaluation=b;this.renderTargetManager=c;this.scene=d;this.camera=e;this.renderNodesToDependencyCount=new Map;this.quadRenderHelper=new Kj;this.portsWithRequestCounterZero=[]}Lj.prototype.buildFrame=function(){this.resetFrame();if(null!==this.renderGraph)for(var a=this.renderGraph.rootNode,b=m.makeIterator(a.inputs),c=b.next();!c.done;c=b.next())a.buildInput(c.value,this)};
Lj.prototype.resetFrame=function(){for(var a=m.makeIterator(this.renderNodesToDependencyCount.keys()),b=a.next();!b.done;b=a.next())b=b.value,b.requiredDependenciesCount=0,b.followingNodes.clear(),b.requiresRun=!1,b.needsRebuilding=!0,b.clearResults();this.renderNodesToDependencyCount.clear()};
Lj.prototype.addDependency=function(a,b){var c=a.followingNodes.size;a.followingNodes.add(b).size>c&&(b.requiredDependenciesCount++,this.renderNodesToDependencyCount.set(b,0));this.renderNodesToDependencyCount.set(a,0)};Lj.prototype.notifyResultUnuse=function(a){this.portsWithRequestCounterZero.push(a)};Lj.prototype.buildAndUpdate=function(){this.buildFrame();for(var a=m.makeIterator(this.renderNodesToDependencyCount.keys()),b=a.next();!b.done;b=a.next())b.value.update(this);this.frameEvaluation.onUpdateFinished()};
Lj.prototype.runRenderNode=function(a,b){Dj.setDebugMarker(a.nodeName);console.assert(a.requiredDependenciesCount===this.renderNodesToDependencyCount.get(a),"Attempt to run node without it's dependencies ready.Nodes count required: "+a.requiredDependenciesCount+" nodes ran: "+this.renderNodesToDependencyCount.get(a));a.render(this,b);Dj.clearDebugMarker();for(var c=m.makeIterator(this.portsWithRequestCounterZero),d=c.next();!d.done;d=c.next())d=d.value,d.parentNode.unuseResultResources(d,this,b);
this.portsWithRequestCounterZero=[];a=m.makeIterator(a.followingNodes);for(c=a.next();!c.done;c=a.next())c=c.value,this.renderNodesToDependencyCount.set(c,this.renderNodesToDependencyCount.get(c)+1),this.renderNodesToDependencyCount.get(c)===c.requiredDependenciesCount&&this.runRenderNode(c,b)};
Lj.prototype.render=function(a){this.renderTargetManager.unuseAllRenderTargets();for(var b=m.makeIterator(this.renderNodesToDependencyCount.keys()),c=b.next();!c.done;c=b.next())this.renderNodesToDependencyCount[c.value]=0;b=m.makeIterator(this.renderNodesToDependencyCount.keys());for(c=b.next();!c.done;c=b.next())c=c.value,0===c.requiredDependenciesCount&&this.runRenderNode(c,a)};function Mj(a){this.parentNode=a;this.shaderId=this.resultType=null;this.result=void 0;this.connectedPorts=[];this.requestCounter=0}Mj.prototype.getConnectedPort=function(){return 1==this.connectedPorts.length?this.connectedPorts[0]:null};Mj.prototype.connect=function(a){this.connectedPorts.includes(a)||this.connectedPorts.push(a);a.connectedPorts.includes(this)||a.connectedPorts.push(this)};
Mj.prototype.disconnect=function(a){var b=this.connectedPorts.indexOf(a);-1<b&&this.connectedPorts.splice(b,1);b=a.connectedPorts.indexOf(this);-1<b&&a.connectedPorts.splice(b,1)};
Mj.prototype.acquireResult=function(a,b){void 0===this.result&&this.parentNode.acquireResult(this,a,b);0===--this.requestCounter&&a.notifyResultUnuse(this);console.assert(0<=this.requestCounter,"The port result of node "+this.parentNode.nodeName+" was acquired more times that was detected during frame building phase! requestCounter: "+this.requestCounter);return this.result};
function Nj(a){this.inputs=[];this.outputs=[];this.requiredDependenciesCount=0;this.followingNodes=new Set;this.requiresRun=!1;this.needsRebuilding=!0;this.nodeName=a}Nj.prototype.addInputPort=function(a,b){return this.addPort(!0,a,void 0===b?null:b)};Nj.prototype.addOutputPort=function(a,b){return this.addPort(!1,a,void 0===b?null:b)};Nj.prototype.addPort=function(a,b,c){c=void 0===c?null:c;var d=new Mj(this);d.resultType=b;d.shaderId=c;a?this.inputs.push(d):this.outputs.push(d);return d};
Nj.prototype.buildInput=function(a,b){console.assert(this.inputs.includes(a),"Invalid port used!");for(var c=m.makeIterator(a.connectedPorts),d=c.next();!d.done;d=c.next())d=d.value,d.parentNode.buildOutput(d,b,this);a.requestCounter=a.connectedPorts.length};
Nj.prototype.buildOutput=function(a,b,c){console.assert(this.outputs.includes(a),"Invalid port used!");if(this.needsRebuilding){this.needsRebuilding=!1;b.addDependency(this,c);c=m.makeIterator(this.inputs);for(var d=c.next();!d.done;d=c.next())this.buildInput(d.value,b)}a.requestCounter++};Nj.prototype.clearResults=function(){for(var a=m.makeIterator(this.inputs),b=a.next();!b.done;b=a.next())b.value.result=void 0;a=m.makeIterator(this.outputs);for(b=a.next();!b.done;b=a.next())b.value.result=void 0};
Nj.prototype.connectToInput=function(a,b){var c=this.inputs.find(function(d){return d.resultType===b});a=a.outputs.find(function(d){return d.resultType===b});void 0!==c&&void 0!==a?c.connect(a):console.error("Couldn't find valid ports for connecting by result of type "+b+".")};Nj.prototype.update=function(){};Nj.prototype.render=function(){};Nj.prototype.acquireResult=function(){};Nj.prototype.unuseResultResources=function(){};function Oj(a,b){Nj.call(this,b);this.material=new Dd(a.vertexShaderName,a.fragmentShaderName);this.material.uniforms=C.UniformsUtils.clone(a.uniforms);this.uniforms=this.material.uniforms;this.uniforms.resolution.value.set(1/(window.innerWidth*window.devicePixelRatio),1/(window.innerHeight*window.devicePixelRatio));this.material.depthTest=!1;this.material.depthWrite=!1;this.enabled=!0}m.inherits(Oj,Nj);
Oj.prototype.update=function(a){a=a.frameEvaluation;this.uniforms.resolution.value.set(1/a.viewportWidth,1/a.viewportHeight)};Oj.prototype.render=function(a,b){this.bindInputsOutputs(a,b);try{b.setMaterial(this.material),b.setMaterialFaces(this.material),b.renderBufferDirect(a.quadRenderHelper.camera,this.material,a.quadRenderHelper.quad.geometry,a.quadRenderHelper.quad)}catch(c){console.error("Failed to render material "+(this.material?this.material.name:"null")+": "+c.stack)}};
Oj.prototype.onResize=function(a,b){this.uniforms.resolution.value.set(1/a,1/b)};
Oj.prototype.bindInputsOutputs=function(a,b){for(var c=m.makeIterator(this.inputs),d=c.next();!d.done;d=c.next()){d=d.value;var e=d.getConnectedPort().acquireResult(a,b);if(void 0!==e){var f=this.material.uniforms[d.shaderId];f?f.value=e:console.error("Invalid uniform id in render node! Input name: "+d.shaderId)}else console.error("Invalid input for rendering postprocess!")}console.assert(1===this.outputs.length);c=m.makeIterator(this.outputs);for(d=c.next();!d.done;d=c.next())d=d.value.getConnectedPort().acquireResult(a,
b),void 0!==d?b.setRenderTarget(d):console.error("Invalid render target for render node!")};Oj.prototype.dispose=function(){this.material.dispose()};var Pj={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new C.Vector2(1/1024,1/512)}},vertexShaderName:"fxaa_vertex.glsl",fragmentShaderName:"fxaa_fragment.glsl"};function Qj(){Oj.call(this,Pj,"FXAA");this.addInputPort("RenderResult","tDiffuse");this.addOutputPort("RenderResult");this.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight)}m.inherits(Qj,Oj);var Rj={uniforms:{tDepth:{type:"t",value:null},tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new C.Vector2(1/1024,1/512)},delta:{type:"f",value:1},velocityFactor:{type:"f",value:.5},cameraMove:{type:"v3",value:new C.Vector3(0,0,0)},clipToWorldMatrix:{type:"m4",value:new C.Matrix4},previousWorldToClipMatrix:{type:"m4",value:new C.Matrix4}},vertexShaderName:"motion_blur_vertex.glsl",fragmentShaderName:"motion_blur_fragment.glsl"};
function Sj(){Oj.call(this,Rj,"MotionBlur");this.material.depthTest=!0;this.addInputPort("RenderResult","tDiffuse");this.addInputPort("DepthRenderResult","tDepth");this.addOutputPort("RenderResult");this.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight)}m.inherits(Sj,Oj);
Sj.prototype.update=function(a){Oj.prototype.update.call(this,a);a=a.frameEvaluation;var b=a.simState;this.uniforms.delta.value=a.timeDelta;this.uniforms.clipToWorldMatrix.value.copy(a.invViewProjMatrix);this.uniforms.previousWorldToClipMatrix.value.copy(a.prevViewProjMatrix);this.uniforms.cameraMove.value.copy(b.cameraLocationState.position).sub(a.prevCameraPosition);this.uniforms.velocityFactor.value=b.postprocessState.motionBlurIntensity};function Tj(){this.format=Mb.RGBA;this.minFilter=this.magFilter=Mb.NEAREST;this.generateMipmaps=this.depthBuffer=this.stencilBuffer=!1}function Uj(a,b){a=void 0===a?null:a;b=void 0===b?!1:b;Nj.call(this,a?a:"RenderTarget");this.addInputPort("RenderResult");this.addOutputPort("RenderResult");this.renderTarget=null;this.renderTargetParams=new Tj;(this.renderTargetParams.depthBuffer=b)&&this.addOutputPort("DepthRenderResult")}m.inherits(Uj,Nj);
Uj.prototype.acquireResult=function(a,b,c){console.assert(a===this.inputs[0]||a===this.outputs[0],"Invalid port result acquire!");a=this.inputs[0].result;void 0===a&&(a=this.outputs[0].result);void 0===a&&(a=b.renderTargetManager.getRenderTarget(this.renderTargetParams,c));this.outputs[0].result=this.inputs[0].result=a;this.renderTargetParams.depthBuffer&&(this.outputs[1].result=a.depthTexture)};
Uj.prototype.unuseResultResources=function(a,b){0===this.inputs[0].requestCounter&&0===this.outputs[0].requestCounter&&(b.renderTargetManager.unuseRenderTarget(a.result),this.outputs[0].result=this.inputs[0].result=void 0)};function Vj(){Nj.call(this,"SceneRender");this.resultPort=this.addOutputPort("RenderResult")}m.inherits(Vj,Nj);Vj.prototype.render=function(a,b){var c=this.resultPort.getConnectedPort().acquireResult(a,b);void 0!==c&&(b.setRenderTarget(c),b.state.setDepthTest(!0),b.state.setDepthWrite(!0),b.state.setColorWrite(!0),b.clearDepth(),b.clearColor(),b.render(a.scene,a.camera,c,!0))};function Wj(){Uj.call(this,"ScreenRenderTarget")}m.inherits(Wj,Uj);Wj.prototype.acquireResult=function(){this.outputs[0].result=this.inputs[0].result=null};Wj.prototype.unuseResultResources=function(){};function Xj(a){this.renderGraph=a;this.currentNode=null}Xj.prototype.add=function(a,b){this.currentNode&&a.connectToInput(this.currentNode,b);this.currentNode=a;this.renderGraph.nodes.push(a);return this};function Yj(){this.nodes=[];this.createStandardPipeline()}Yj.prototype.createSceneRenderOnlyPipeline=function(){var a=new Xj(this);a.add(new Vj).add(new Wj,"RenderResult");this.rootNode=a.currentNode};
Yj.prototype.createStandardPipeline=function(){var a=new Xj(this),b=new Uj(null,!0),c=new Sj;a.add(new Vj).add(b,"RenderResult").add(c,"RenderResult").add(new Uj(null,!0),"RenderResult").add(new Qj,"RenderResult").add(new Wj,"RenderResult");c.connectToInput(b,"DepthRenderResult");this.rootNode=a.currentNode};function Zj(){this.unusedRenderTargets=[];this.createdRenderTargets=[];this.viewportHeight=this.viewportWidth=100}Zj.prototype.getRenderTarget=function(a,b){return 0<this.unusedRenderTargets.length?this.unusedRenderTargets.pop():this.createRenderTarget(a,b)};
Zj.prototype.unuseRenderTarget=function(a){console.assert(null===a||this.createdRenderTargets.includes(a),"Unusing some unknown render target!");console.assert(!this.unusedRenderTargets.includes(a),"RenderTarget was already declared as unused!");this.unusedRenderTargets.push(a)};Zj.prototype.unuseAllRenderTargets=function(){this.unusedRenderTargets=[].concat(m.arrayFromIterable(this.createdRenderTargets))};
Zj.prototype.createRenderTarget=function(a,b){a=b.createRenderTarget(this.viewportWidth,this.viewportHeight,a);this.createdRenderTargets.push(a);return a};Zj.prototype.onResize=function(a,b){this.viewportWidth=a;this.viewportHeight=b;a=m.makeIterator(this.createdRenderTargets);for(b=a.next();!b.done;b=a.next())b.value.dispose();this.createdRenderTargets=[];this.unusedRenderTargets=[]};function ak(a){this.position=new C.Vector3;this.rotation=new C.Quaternion;null!==a&&void 0!==a&&this.set(a,a.position)}ak.prototype.set=function(a,b){this.position.copy(b);a.getWorldQuaternion(this.rotation)};ak.prototype.isNeq=function(a){return!this.position.equals(a.position)||!this.rotation.equals(a.rotation)};ak.prototype.interpolate=function(a,b,c){this.position.lerpVectors(a.position,b.position,c);C.Quaternion.slerp(a.rotation,b.rotation,this.rotation,c)};
ak.prototype.assign=function(a){this.position.copy(a.position);this.rotation.copy(a.rotation)};function bk(a){console.assert(null!=a,"Camera cannot be null!");console.assert(a instanceof C.PerspectiveCamera,"Invalid camera type passed!");this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.fov=a.fov;this.aspect=a.aspect}bk.prototype.isNeq=function(a){return this.zoom!==a.zoom||this.near!==a.near||this.far!==a.far||this.fov!==a.fov||this.aspect!==a.apect};
bk.prototype.interpolate=function(a,b,c){this.zoom=Le(a.zoom,b.zoom,c);this.near=Le(a.near,b.near,c);this.far=Le(a.far,b.far,c);this.fov=Le(a.fov,b.fov,c);this.aspect=Le(a.aspect,b.aspect,c)};bk.prototype.assign=function(a){this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.fov=a.fov;this.aspect=a.aspect};
function ck(a){console.assert(a instanceof C.OrthographicCamera,"Invalid camera type passed!");this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom}ck.prototype.isNeq=function(a){return this.zoom!==a.zoom||this.near!==a.near||this.far!==a.far||this.left!==a.left||this.right!==a.right||this.top!==a.top||this.bottom!==a.bottom};
ck.prototype.interpolate=function(a,b,c){this.zoom=Le(a.zoom,b.zoom,c);this.near=Le(a.near,b.near,c);this.far=Le(a.far,b.far,c);this.left=Le(a.left,b.left,c);this.right=Le(a.right,b.right,c);this.top=Le(a.top,b.top,c);this.bottom=Le(a.bottom,b.bottom,c)};ck.prototype.assign=function(a){this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom};function dk(){this.motionBlurIntensity=1}
dk.prototype.isNeq=function(a){return this.motionBlurIntensity!=a.motionBlurIntensity};dk.prototype.interpolate=function(a,b,c){this.motionBlurIntensity=Le(a.motionBlurIntensity,b.motionBlurIntensity,c)};dk.prototype.assign=function(a){this.motionBlurIntensity=a.motionBlurIntensity};
function ek(a,b,c,d){a=void 0===a?null:a;b=void 0===b?null!==a?new ak(a):null:b;this.camera=a;this.cameraLocationState=b;this.postprocessState=void 0===c?null:c;this.projectionState=null;null!==this.camera&&(void 0===d?0:d)&&this.setProjectionState(this.camera)}
ek.prototype.interpolate=function(a,b,c){null!==a.cameraLocationState&&null!==b.cameraLocationState?this.cameraLocationState.interpolate(a.cameraLocationState,b.cameraLocationState,c):b.cameraLocationState&&this.cameraLocationState.assign(b.cameraLocationState);null!==a.projectionState&&null!==b.projectionState?this.projectionState.interpolate(a.projectionState,b.projectionState,c):b.projectionState&&this.projectionState.assign(b.projectionState);null!==a.postprocessState&&null!==b.postprocessState?
this.postprocessState.interpolate(a.postprocessState,b.postprocessState,c):b.postprocessState&&this.postprocessState.assign(b.postprocessState)};
ek.prototype.assignIfNotNull=function(a){if(null!==a){a.cameraLocationState&&(null===this.cameraLocationState&&(this.cameraLocationState=new ak),this.cameraLocationState.assign(a.cameraLocationState));if(a.projectionState){var b=a.projectionState instanceof bk;this.projectionState instanceof bk!=b&&(this.camera=a.camera.clone(),this.projectionState=b?new bk(this.camera):new ck(this.camera));this.projectionState.assign(a.projectionState)}a.postprocessState&&(null===this.postprocessState&&(this.postprocessState=
new dk),this.postprocessState.assign(a.postprocessState))}};
ek.prototype.assignIfDifferent=function(a,b){if(null!==b){b.cameraLocationState&&(null===a.cameraLocationState||a.cameraLocationState.isNeq(b.cameraLocationState))&&(null===this.cameraLocationState&&(this.cameraLocationState=new ak),this.cameraLocationState.assign(b.cameraLocationState));if(b.projectionState){var c=b.projectionState instanceof bk,d=a.projectionState instanceof bk!=c,e=null===a.projectionState||a.projectionState.isNeq(b.projectionState);if(d||null===this.camera)this.camera=b.camera.clone();
if(d||e)this.projectionState=c?new bk(this.camera):new ck(this.camera);e&&this.projectionState.assign(b.projectionState)}b.postprocessState&&(null===a.postprocessState||a.postprocessState.isNeq(b.postprocessState))&&(null===this.postprocessState&&(this.postprocessState=new dk),this.postprocessState.assign(b.postprocessState))}};ek.prototype.setProjectionState=function(a){this.projectionState=null===a?null:a instanceof C.PerspectiveCamera?new bk(a):new ck(a)};
function fk(){this.viewMatrix=new C.Matrix4;this.projectionMatrix=new C.Matrix4;this.viewProjMatrix=new C.Matrix4;this.invViewMatrix=new C.Matrix4;this.invProjMatrix=new C.Matrix4;this.invViewProjMatrix=new C.Matrix4;this.prevViewMatrix=new C.Matrix4;this.prevProjMatrix=new C.Matrix4;this.prevViewProjMatrix=new C.Matrix4;this.prevCameraPosition=new C.Vector3;this.timeDelta=this.viewportHeight=this.viewportWidth=0;this.viewportSizeUpdated=this.cameraParamsUpdated=this.postprocessParamsUpdated=!0;var a=
new C.PerspectiveCamera;a.zoom=1;a.fov=50;a.aspect=1;a.near=.1;a.far=2E3;this.simState=new ek(a,new ak(a),new dk,!0)}
fk.prototype.interpolate=function(a,b,c,d){var e=this.simState;this.timeDelta=b;this.prevCameraPosition.copy(e.cameraLocationState.position);e.interpolate(c,d,a);a=e.camera;this.postprocessParamsUpdated=null!==d.postprocessState;this.cameraParamsUpdated=!1;d.cameraLocationState&&(a.position.copy(e.cameraLocationState.position),a.setRotationFromQuaternion(e.cameraLocationState.rotation),a.updateMatrixWorld(),this.cameraParamsUpdated=!0);d.projectionState&&(a.updateProjectionMatrix(),this.cameraParamsUpdated=
!0);this.updatePrevMatrices();this.cameraParamsUpdated&&this.computeMatrices()};fk.prototype.setViewportSize=function(a,b){if(this.viewportWidth!==a||this.viewportHeight!==b)this.viewportWidth=a,this.viewportHeight=b,this.simState.camera.aspect=a/b,this.simState.camera.updateProjectionMatrix(),this.viewportSizeUpdated=this.cameraParamsUpdated=!0};fk.prototype.updatePrevMatrices=function(){this.prevViewMatrix.copy(this.viewMatrix);this.prevProjMatrix.copy(this.projectionMatrix);this.prevViewProjMatrix.copy(this.viewProjMatrix)};
fk.prototype.computeMatrices=function(){this.viewMatrix.copy(this.simState.camera.matrixWorldInverse);this.projectionMatrix.copy(this.simState.camera.projectionMatrix);this.viewProjMatrix.multiplyMatrices(this.projectionMatrix,this.viewMatrix);this.invViewMatrix.copy(this.simState.camera.matrixWorld);this.invProjMatrix.getInverse(this.projectionMatrix);this.invViewProjMatrix.getInverse(this.viewProjMatrix)};
fk.prototype.onUpdateFinished=function(){this.viewportSizeUpdated=this.cameraParamsUpdated=!1};function gk(){this.frameEval=new fk;this.prevState=new ek;this.prevState.assignIfNotNull(this.frameEval.simState);this.nextState=new ek}gk.prototype.setTransition=function(a){this.prevState.assignIfNotNull(this.nextState);this.nextState.assignIfDifferent(this.prevState,a)};gk.prototype.update=function(a,b){this.frameEval.interpolate(a,b,this.prevState,this.nextState)};function hk(a,b){this.simulationEvaluator=new gk;this.renderGraph=new Yj;this.renderTargetManager=new Zj;this.frameBuilder=new Lj(this.renderGraph,this.simulationEvaluator.frameEval,this.renderTargetManager,a,b)}hk.prototype.onViewportResize=function(a,b){this.renderTargetManager.onResize(a,b);this.simulationEvaluator.frameEval.setViewportSize(a,b)};hk.prototype.setSimulationChange=function(a){this.simulationEvaluator.setTransition(a)};
hk.prototype.update=function(a,b,c){this.simulationEvaluator.update(a,b);this.frameBuilder.buildAndUpdate();this.frameBuilder.render(c)};function ik(a){return a.split("\n").map(function(b,c){return c+1+": "+b}).join("\n")}function jk(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);var d=!1===a.getShaderParameter(b,a.COMPILE_STATUS);d&&console.error("Shader failed to compile.");if(d||S.LOG_INFO)a=a.getShaderInfoLog(b),""!==a&&console.warn("Shader info log: ",a,ik(c));return b};var kk="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition".split(" "),lk=0;
function mk(){this.recompileProgram=function(a,b){this.program&&a.deleteProgram(this.program);var c=b.index0AttributeName,d=a.createProgram(),e=jk(a,a.VERTEX_SHADER,b.generateVertexShader()),f=jk(a,a.FRAGMENT_SHADER,b.generateFragmentShader());a.attachShader(d,e);a.attachShader(d,f);void 0!==c&&a.bindAttribLocation(d,0,c);a.linkProgram(d);c=a.getProgramInfoLog(d).trim();!1===a.getProgramParameter(d,a.LINK_STATUS)&&console.error("Shader link error: "+a.getError(),"validate status: ",a.getProgramParameter(d,
a.VALIDATE_STATUS));""!==c&&"\x00"!==c&&console.warn("program info log: "+c);a.deleteShader(e);a.deleteShader(f);e={};f=0;for(c=kk.length;f<c;f++){var g=kk[f];e[g]=a.getUniformLocation(d,g)}this.transformUniformCache=e;e=b.uniforms;f={i:[],f:[],v2:[],v3:[],c:[],v4:[],m4:[],t:[]};var k;for(h in e)e.hasOwnProperty(h)&&(c=a.getUniformLocation(d,h))&&(g=e[h].type,console.assert(f.hasOwnProperty(g)),"i"===g||"f"===g||"t"===g?k=null:"v2"===g?k=[null,null]:"v3"===g||"c"===g?k=[null,null,null]:"v4"===g?k=
[null,null,null,null]:"m4"===g?k=null:console.assert(!1),f[g].push({id:h,value:k,location:c}));this.materialUniformCache=f;b=b.attributes;k={};var h=0;for(e=b.length;h<e;h++)f=b[h],k[f]=a.getAttribLocation(d,f);this.attributes=k;this.attributesKeys=Object.keys(this.attributes);this.program=d};this.id=lk++;this.usedTimes=1;return this}
function nk(a){var b=new Map;this.recompileProgram=function(c){var d=c.generateProgramId();(d=b[d])?d.recompileProgram(a,c):console.error("Couldn't find program to recompile!")};this.assignProgramToMaterial=function(c){console.assert(c instanceof Dd);var d=c.generateProgramId(),e=b[d];e?e.usedTimes++:(e=new mk,e.recompileProgram(a,c),b[d]=e);c.program&&this.resetProgramAssignment(c);c.program=e};this.resetProgramAssignment=function(c){var d=c.program;c.program=null;--d.usedTimes;if(0===d.usedTimes){for(var e in b)if(b.hasOwnProperty(e)&&
b[e]===d){delete b[e];break}a.deleteProgram(d.program)}}};function ok(a){var b=Array(16).fill(0),c=Array(16).fill(null),d=b.map(function(){return 0}),e=null,f=null,g=null,k=null,h=null,l=null,n=null,p=null,r=null,q=null,w=null,x=null,t=null,A=null,D=null,H=null;this.resetAttributeStates=function(){for(var G=0,K=b.length;G<K;G++)b[G]=0};this.disableAttributeStates=function(){for(var G=0,K=b.length;G<K;G++)a.disableVertexAttribArray(G),b[G]=0};this.enableAttributeArray=function(G){2!==b[G]&&(a.enableVertexAttribArray(G),b[G]=2)};this.disableAttributeArray=
function(G,K){1!==b[G]&&(a.disableVertexAttribArray(G),b[G]=1);c[G]!==K&&(2===K.length?a.vertexAttrib2fv(G,K):3===K.length?a.vertexAttrib3fv(G,K):4===K.length&&a.vertexAttrib4fv(G,K),c[G]=K)};this.resetAttributeDivisors=function(){for(var G=0,K=d.length;G<K;G++)d[G]&&(a.vertexAttribDivisor(G,0),d[G]=0)};this.setAttributeDivisor=function(G,K){a.vertexAttribDivisor(G,K);d[G]=K};this.setBlending=function(G){var K=G.blending;K!==e&&(K===C.NoBlending?a.disable(a.BLEND):K===C.AdditiveBlending?(a.enable(a.BLEND),
a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):K===C.SubtractiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):K===C.MultiplyBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):K===C.CustomBlending?a.enable(a.BLEND):(a.enable(a.BLEND),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),e=K);if(K===C.CustomBlending){K=G.blendEquation;
var W=G.blendEquationAlpha||K,O=G.blendSrc,ea=G.blendDst,ra=G.blendSrcAlpha||O;G=G.blendDstAlpha||ea;if(K!==f||W!==h)a.blendEquationSeparate(K,W),f=K,h=W;if(O!==g||ea!==k||ra!==l||G!==n)a.blendFuncSeparate(O,ea,ra,G),g=O,k=ea,l=ra,n=G}else n=l=h=k=g=f=null};this.setDepthTest=function(G){p!==G&&(G?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),p=G)};this.setDepthWrite=function(G){r!==G&&(a.depthMask(G),r=G)};this.setColorWrite=function(G){q!==G&&(a.colorMask(G,G,G,G),q=G)};this.setDoubleSided=function(G){w!==
G&&(G?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),w=G)};this.setFlipSided=function(G){x!==G&&(G?a.frontFace(a.CW):a.frontFace(a.CCW),x=G)};this.setViewport=function(G,K,W,O){if(t!==G||A!==K||D!==W||H!==O)a.viewport(G,K,W,O),t=G,A=K,D=W,H=O}};function pk(){this.texture=null;this.locked=!1;this.usedCount=0}function qk(a){for(var b=[],c=0;c<a;c+=1)b[c]=new pk;return b}
function rk(a){var b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),c=qk(b);this.setSlot=function(d,e){var f=d.__webglSlot;if(null!==f){var g=c[f];g.usedCount+=1;g.locked=g.locked||e;return!1}for(var k=Infinity,h=0;h<b;h+=1)g=c[h],!g.locked&&g.usedCount<k&&(k=g.usedCount,f=h);null===f&&(console.warn("Not enough texture units"),f=0);g=c[f];g.texture&&(g.texture.__webglSlot=null);g.texture=d;g.usedCount=1;g.locked=e;d.__webglSlot=f;return!0};this.unlockAllSlots=function(){for(var d=0;d<b;d+=1)c[d].locked=
!1};this.freeSlot=function(d){if(null!==d.__webglSlot){var e=c[d.__webglSlot];d.__webglSlot=null;e.texture=null;e.locked=!1;e.usedCount=0}}}function sk(a){var b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),c=0;this.setSlot=function(d,e){c===b&&(console.warn("Not enough texture units"),c=0);d.__webglSlot=c;e&&(c+=1);return!0};this.unlockAllSlots=function(){c=0};this.freeSlot=function(d){d.__webglSlot=null}};function tk(a,b){a.drawArraysInstanced=function(){var c=m.getRestArguments.apply(0,arguments);return b.drawArraysInstancedANGLE.apply(b,m.arrayFromIterable(c))};a.drawElementsInstanced=function(){var c=m.getRestArguments.apply(0,arguments);return b.drawElementsInstancedANGLE.apply(b,m.arrayFromIterable(c))};a.vertexAttribDivisor=function(){var c=m.getRestArguments.apply(0,arguments);return b.vertexAttribDivisorANGLE.apply(b,m.arrayFromIterable(c))}}
function uk(a,b){for(var c={HALF_FLOAT_OES:"OES_texture_half_float",COMPRESSED_RGB_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT3_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT5_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGB_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",
COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_ETC1_WEBGL:"WEBGL_compressed_texture_etc1",COMPRESSED_RGBA_ASTC_4x4_KHR:"WEBGL_compressed_texture_astc"},d=m.makeIterator(Object.entries(Mb)),e=d.next();!e.done;e=d.next()){var f=m.makeIterator(e.value);e=f.next().value;f=f.next().value;var g=c[e];void 0!==g?(g=b.gl.extension(g))&&console.assert(g[e]===f):console.assert(a[e]===f)}}function vk(a){return Bc.gl.disableTextureSlotReuse?new sk(a):new rk(a)}
function wk(a,b){function c(L,Q){if(!Bc.gl.webgl2)return L;if(Q===Mb.FLOAT){if(L===Mb.RGB)return b.RGB32F;console.assert("Missing mapping")}return L}function d(){va=!!Bc.gl.instances;W=K=null;O=-1;ra=ea=null;!Bc.gl.webgl2&&va&&tk(b,Bc.gl.instances);I=new ok(b);V=new nk(b);b.clearColor(0,0,0,1);b.clearDepth(1);b.clearStencil(0);b.enable(b.DEPTH_TEST);b.depthFunc(b.LEQUAL);b.frontFace(b.CCW);b.cullFace(b.BACK);b.enable(b.CULL_FACE);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFunc(b.SRC_ALPHA,
b.ONE_MINUS_SRC_ALPHA);I.setViewport(0,0,a.width,a.height);b.clearColor(t.r,t.g,t.b,A);Bc.ie||b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.NONE)}function e(L){L=L.target;L.removeEventListener("dispose",e);delete L.__webglInit;L=L.attributes;for(var Q in L)if(L.hasOwnProperty(Q)){var ia=L[Q];void 0!==ia.buffer&&(b.deleteBuffer(ia.buffer),delete ia.buffer)}I.disableAttributeStates();ea=null}function f(L){L=L.target;L.removeEventListener("dispose",f);ca.freeSlot(L);L.__webglTexture&&(b.deleteTexture(L.__webglTexture),
L.__webglTexture=null)}function g(L){L=L.target;L.removeEventListener("dispose",g);ca.freeSlot(L);b.deleteTexture(L.__webglTexture);L.__webglTexture=null;L.__webglFramebuffer&&G.deallocateRenderTargetRenderingBuffers(L)}function k(L){L=L.target;L.removeEventListener("dispose",k);V.resetProgramAssignment(L)}function h(L,Q,ia){var Z=ia.attributes,ka=Q.attributes;Q=Q.attributesKeys;ia=16*(ia.instanceId||0);for(var ma=0,M=Q.length;ma<M;ma++){var fa=Q[ma],ja=ka[fa];if(0<=ja){var ta=Z[fa];if(void 0!==ta){fa=
ta.itemSize;var X=ta.glType;b.bindBuffer(b.ARRAY_BUFFER,ta.buffer);ta=ta.divisor||0;I.enableAttributeArray(ja);b.vertexAttribPointer(ja,fa,X,!1,0,ia*ta);va&&I.setAttributeDivisor(ja,ta)}else I.disableAttributeArray(ja,L.defaultAttributeValues[fa])}}}function l(L,Q){var ia=Bc;b.texParameteri(L,b.TEXTURE_WRAP_S,Q.wrapS);b.texParameteri(L,b.TEXTURE_WRAP_T,Q.wrapT);b.texParameteri(L,b.TEXTURE_MAG_FILTER,Q.magFilter);b.texParameteri(L,b.TEXTURE_MIN_FILTER,Q.minFilter);var Z=ia.gl.extension("EXT_texture_filter_anisotropic");
Z&&1<Q.anisotropy&&b.texParameterf(L,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Q.anisotropy,ia.gl.maxAnisotropy))}function n(L,Q){var ia=L.material,Z=Q.material,ka=ia.program,ma=Z.program;return ka&&ma&&ka.id!==ma.id?ka.id-ma.id:ia.id-Z.id||L.id-Q.id}function p(L,Q){var ia=L.material.transparentRenderOrder-Q.material.transparentRenderOrder;return ia?ia:Q.cameraDistance-L.cameraDistance||L.id-Q.id}function r(L,Q,ia){if(ia||!1!==L.visible){L instanceof C.Mesh&&(!1===L.frustumCulled||!0===pa.intersectsObject(L))&&
((Q||L.material).transparent?(!0===G.sortObjects&&(L.cameraDistance=pa.nearPlaneDistanceToCenter(L)),H.push(L)):D.push(L));for(var Z=0,ka=L.children.length;Z<ka;Z++)r(L.children[Z],Q,ia)}}function q(L){L.__webglTexture||(L.addEventListener("dispose",f),L.__webglTexture=b.createTexture());b.activeTexture(b.TEXTURE0+L.__webglSlot);b.bindTexture(b.TEXTURE_2D,L.__webglTexture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,L.flipY);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,L.premultiplyAlpha);b.pixelStorei(b.UNPACK_ALIGNMENT,
L.unpackAlignment);var Q=L.image,ia=C.Math.isPowerOfTwo(Q.width)&&C.Math.isPowerOfTwo(Q.height),Z=L.format,ka=L.type,ma=c(Z,ka);l(b.TEXTURE_2D,L);var M=L.mipmaps;if(L instanceof ed)if(0<M.length&&ia){for(var fa=0,ja=M.length;fa<ja;fa++)Q=M[fa],b.texImage2D(b.TEXTURE_2D,fa,ma,Q.width,Q.height,0,Z,ka,Q.data),L.releaseOnLoadedToGpu&&(Q.data=null);L.generateMipmaps=!1}else b.texImage2D(b.TEXTURE_2D,0,ma,Q.width,Q.height,0,Z,ka,Q.data),L.releaseOnLoadedToGpu&&(Q.data=null);else if(L instanceof dd)for(fa=
0,ja=M.length;fa<ja;fa++)Q=M[fa],L.format!==Mb.RGBA&&L.format!==Mb.RGB?b.compressedTexImage2D(b.TEXTURE_2D,fa,ma,Q.width,Q.height,0,Q.data):b.texImage2D(b.TEXTURE_2D,fa,ma,Q.width,Q.height,0,Z,ka,Q.data),L.releaseOnLoadedToGpu&&(Q.data=null);else if(0<M.length&&ia){fa=0;for(ja=M.length;fa<ja;fa++)Q=M[fa],b.texImage2D(b.TEXTURE_2D,fa,ma,Z,ka,Q);L.releaseOnLoadedToGpu&&(L.mipmaps=null);L.generateMipmaps=!1}else b.texImage2D(b.TEXTURE_2D,0,ma,Z,ka,L.image),L.releaseOnLoadedToGpu&&(L.image=null);L.generateMipmaps&&
ia&&b.generateMipmap(b.TEXTURE_2D);L.needsUpdate=!1}function w(L,Q){b.bindRenderbuffer(b.RENDERBUFFER,L);Q.depthBuffer?(b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,Q.width,Q.height),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,L)):b.renderbufferStorage(b.RENDERBUFFER,b.RGBA4,Q.width,Q.height)}function x(L,Q){Q.addEventListener("dispose",g);Q.__webglTexture=b.createTexture();var ia=Q.format,Z=Q.type,ka=c(ia,Z);ca.setSlot(Q,!1);b.activeTexture(b.TEXTURE0+
Q.__webglSlot);if(L){b.bindTexture(b.TEXTURE_CUBE_MAP,Q.__webglTexture);l(b.TEXTURE_CUBE_MAP,Q);for(L=0;6>L;L++){Q.__webglFramebuffer[L]=b.createFramebuffer();Q.__webglRenderbuffer[L]=b.createRenderbuffer();b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+L,0,ka,Q.width,Q.height,0,ia,Z,null);var ma=b.TEXTURE_CUBE_MAP_POSITIVE_X+L,M=Q.__webglTexture;b.bindFramebuffer(b.FRAMEBUFFER,Q.__webglFramebuffer[L]);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,ma,M,0);w(Q.__webglRenderbuffer[L],Q)}Q.generateMipmaps&&
b.generateMipmap(b.TEXTURE_CUBE_MAP)}else Q.__webglFramebuffer=b.createFramebuffer(),Q.__webglRenderbuffer=Q.shareDepthFrom?Q.shareDepthFrom.__webglRenderbuffer:b.createRenderbuffer(),b.bindTexture(b.TEXTURE_2D,Q.__webglTexture),l(b.TEXTURE_2D,Q),b.texImage2D(b.TEXTURE_2D,0,ka,Q.width,Q.height,0,ia,Z,null),ia=b.TEXTURE_2D,Z=Q.__webglTexture,b.bindFramebuffer(b.FRAMEBUFFER,Q.__webglFramebuffer),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,ia,Z,0),Q.useDepthTexture?(Q.depthTexture=new ed(null,
Q.width,Q.height,b.DEPTH_COMPONENT),Q.depthTexture.__webglTexture=b.createTexture(),ca.setSlot(Q.depthTexture,!1),b.activeTexture(b.TEXTURE0+Q.depthTexture.__webglSlot),b.bindTexture(b.TEXTURE_2D,Q.depthTexture.__webglTexture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),Bc.gl.useDepthExtension||b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_COMPARE_MODE,b.NONE),b.texImage2D(b.TEXTURE_2D,0,Bc.gl.useDepthExtension?b.DEPTH_COMPONENT:b.DEPTH_COMPONENT32F,Q.width,Q.height,0,b.DEPTH_COMPONENT,Bc.gl.useDepthExtension?b.UNSIGNED_SHORT:b.FLOAT,null),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,Q.depthTexture.__webglTexture,0),b.bindTexture(b.TEXTURE_2D,null)):Q.shareDepthFrom?Q.depthBuffer&&b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,Q.__webglRenderbuffer):w(Q.__webglRenderbuffer,
Q),Q.generateMipmaps&&b.generateMipmap(b.TEXTURE_2D);b.bindRenderbuffer(b.RENDERBUFFER,null);b.bindFramebuffer(b.FRAMEBUFFER,null)}var t=new C.Color(0),A=0,D=[],H=[];this.domElement=a;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;var G=this,K,W,O,ea,ra,va,I,V,pa=new Ge,T=new C.Matrix4,P=new C.Vector3;this.recompileProgram=function(L){V.recompileProgram(L)};d();uk(b,Bc);this.webGLContextRestored=function(){d()};this.context=b;this.state=I;var ca=vk(b),
J=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setCanvasSize=function(L,Q){a.width=L;a.height=Q;null===W&&this.setViewport(0,0,L,Q)};this.setViewport=function(L,Q,ia,Z){I.setViewport(L,Q,ia,Z)};this.setScissor=function(L,Q,ia,Z){b.scissor(L,Q,ia,Z)};this.enableScissorTest=function(L){L?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST)};this.setClearColor=function(L,Q){t.copy(L);A=void 0!==Q?Q:1;b.clearColor(t.r,t.g,t.b,A)};this.getClearColor=function(){return t};this.getClearAlpha=function(){return A};
this.clear=function(L,Q,ia){var Z=0;L&&(Z|=b.COLOR_BUFFER_BIT);Q&&(Z|=b.DEPTH_BUFFER_BIT);ia&&(Z|=b.STENCIL_BUFFER_BIT);b.clear(Z)};this.clearColor=function(){b.clear(b.COLOR_BUFFER_BIT)};this.clearDepth=function(){b.clear(b.DEPTH_BUFFER_BIT)};this.clearStencil=function(){b.clear(b.STENCIL_BUFFER_BIT)};this.deallocateRenderTargetRenderingBuffers=function(L){if(L.isCube)for(var Q=0;6>Q;Q++)b.deleteFramebuffer(L.__webglFramebuffer[Q]),b.deleteRenderbuffer(L.__webglRenderbuffer[Q]);else b.deleteFramebuffer(L.__webglFramebuffer),
b.deleteRenderbuffer(L.__webglRenderbuffer);L.__webglFramebuffer=null;L.__webglRenderbuffer=null};var aa=new C.Matrix4,na=new C.Matrix3;this.setMaterialFaces=function(L){I.setDoubleSided(L.side===C.DoubleSide);I.setFlipSided(L.side===C.BackSide)};this.setRenderTarget=function(L){if(L){var Q=L.isCube?L.__webglFramebuffer[L.activeCubeFace]:L.__webglFramebuffer;var ia=L.x;var Z=L.y;var ka=L.width;L=L.height}else Q=null,Z=ia=0,ka=a.width,L=a.height;Q!==W&&(b.bindFramebuffer(b.FRAMEBUFFER,Q),W=Q);I.setViewport(ia,
Z,ka,L)};this.setMaterial=function(L){I.setBlending(L);I.setDepthTest(L.depthTest);I.setDepthWrite(L.depthWrite);I.setColorWrite(L.colorWrite)};this.renderBufferDirect=function(L,Q,ia,Z){if(!1!==Q.visible&&0!==ia.vertexCnt){console.assert(Q instanceof Dd);Q.programNeedsUpdate&&(V.assignProgramToMaterial(Q),Q.addEventListener("dispose",k),Q.programNeedsUpdate=!1);console.assert(!Q.morphTargets);var ka=!1,ma=!1,M=Q.program,fa=M.transformUniformCache;M.id!==K&&(b.useProgram(M.program),K=M.id,ma=ka=!0);
Q.id!==O&&(O=Q.id,ma=!0);ka&&(b.uniformMatrix4fv(fa.projectionMatrix,!1,L.projectionMatrix.elements),null!==fa.cameraPosition&&(P.setFromMatrixPosition(L.matrixWorld),b.uniform3f(fa.cameraPosition,P.x,P.y,P.z)),null!==fa.viewMatrix&&b.uniformMatrix4fv(fa.viewMatrix,!1,L.matrixWorldInverse.elements));if(ka||Z.matrixWorld!==ra)(ra=Z.matrixWorld)?(aa.multiplyMatrices(L.matrixWorldInverse,Z.matrixWorld),L=aa):L=L.matrixWorldInverse,b.uniformMatrix4fv(fa.modelViewMatrix,!1,L.elements),fa.normalMatrix&&
(na.getNormalMatrix(L),b.uniformMatrix3fv(fa.normalMatrix,!1,na.elements)),null!==fa.modelMatrix&&(Z.matrixWorld?b.uniformMatrix4fv(fa.modelMatrix,!1,Z.matrixWorld.elements):b.uniformMatrix4fv(fa.modelMatrix,!1,J));Q.refreshPerObjectUniforms&&Q.refreshPerObjectUniforms(Z)&&(ma=!0);1<Q.renderSteps&&(ma=!0);if(ma){ma=Q.uniforms;fa=M.materialUniformCache.i;L=0;for(ka=fa.length;L<ka;L+=1){var ja=fa[L];var ta=ja.id;var X=ma[ta].value;ja.value!==X&&(b.uniform1i(ja.location,X),ja.value=X)}fa=M.materialUniformCache.f;
L=0;for(ka=fa.length;L<ka;L+=1)ja=fa[L],ta=ja.id,X=ma[ta].value,ja.value!==X&&(b.uniform1f(ja.location,X),ja.value=X);fa=M.materialUniformCache.v2;L=0;for(ka=fa.length;L<ka;L+=1){ja=fa[L];ta=ja.id;X=ma[ta].value;ta=X.x;var Y=X.y;if(ja.value[0]!==ta||ja.value[1]!==Y)b.uniform2f(ja.location,ta,Y),ja.value[0]=ta,ja.value[1]=Y}fa=M.materialUniformCache.v3;L=0;for(ka=fa.length;L<ka;L+=1){ja=fa[L];ta=ja.id;X=ma[ta].value;ta=X.x;Y=X.y;var qa=X.z;if(ja.value[0]!==ta||ja.value[1]!==Y||ja.value[2]!==qa)b.uniform3f(ja.location,
ta,Y,qa),ja.value[0]=ta,ja.value[1]=Y,ja.value[2]=qa}fa=M.materialUniformCache.c;L=0;for(ka=fa.length;L<ka;L+=1)if(ja=fa[L],ta=ja.id,X=ma[ta].value,ta=X.r,Y=X.g,qa=X.b,ja.value[0]!==ta||ja.value[1]!==Y||ja.value[2]!==qa)b.uniform3f(ja.location,ta,Y,qa),ja.value[0]=ta,ja.value[1]=Y,ja.value[2]=qa;fa=M.materialUniformCache.v4;L=0;for(ka=fa.length;L<ka;L+=1)if(ja=fa[L],ta=ja.id,X=ma[ta].value,ta=X.x,Y=X.y,qa=X.z,X=X.w,ja.value[0]!==ta||ja.value[1]!==Y||ja.value[2]!==qa||ja.value[3]!==X)b.uniform4f(ja.location,
ta,Y,qa,X),ja.value[0]=ta,ja.value[1]=Y,ja.value[2]=qa,ja.value[3]=X;fa=M.materialUniformCache.m4;L=0;for(ka=fa.length;L<ka;L+=1)ja=fa[L],ta=ja.id,b.uniformMatrix4fv(ja.location,!1,ma[ta].value.elements);fa=M.materialUniformCache.t;L=0;for(ka=fa.length;L<ka;L+=1)if(ja=fa[L],ta=ja.id,ta=ma[ta].value)if(Y=ca.setSlot(ta,!0),qa=ta.__webglSlot,ja.value!==qa&&(b.uniform1i(ja.location,qa),ja.value=qa),Y||ta.needsUpdate)if(ta.isCube){if(ja=ta,b.activeTexture(b.TEXTURE0+ja.__webglSlot),b.bindTexture(b.TEXTURE_CUBE_MAP,
ja.__webglTexture),ja.needsUpdate){b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,ja.flipY);ta=ja instanceof dd;Y=ja.image;qa=ja.format;X=ja.type;var za=c(qa,X);l(b.TEXTURE_CUBE_MAP,ja);for(var Ka=0;6>Ka;Ka++)if(ta)for(var Ba=Y[Ka].mipmaps,Ea=0,Ga=Ba.length;Ea<Ga;Ea++){var Da=Ba[Ea];ja.format!==Mb.RGBA&&ja.format!==Mb.RGB?b.compressedTexImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Ka,Ea,za,Da.width,Da.height,0,Da.data):b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Ka,Ea,za,Da.width,Da.height,0,qa,X,Da.data);ja.releaseOnLoadedToGpu&&
(Da.data=null)}else b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Ka,0,za,qa,X,Y[Ka]),ja.releaseOnLoadedToGpu&&(Y[Ka]=null);ja.generateMipmaps&&b.generateMipmap(b.TEXTURE_CUBE_MAP);ja.needsUpdate=!1}}else ja=ta,ja.needsUpdate?q(ja):(b.activeTexture(b.TEXTURE0+ja.__webglSlot),b.bindTexture(b.TEXTURE_2D,ja.__webglTexture));ca.unlockAllSlots()}fa=!1;if(ia.id!==ea||M.id!==K)ea=ia.id,fa=!0;console.assert(Z instanceof C.Mesh);Z=b.TRIANGLES;(ka=ia.attributes.index)?(ma=ka.glType,L=ia.indexUint?4:2,fa&&(h(Q,
M,ia),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,ka.buffer)),void 0!==ia.indexOffset?(Q=ia.indexCnt,M=L*ia.indexOffset):(Q=ka.length,M=0),ia.isInstanced?b.drawElementsInstanced(Z,Q,ma,M,ia.instanceCount):b.drawElements(Z,Q,ma,M)):(fa&&h(Q,M,ia),Q=ia.attributes.position,void 0!==ia.vertexOffset?(Q=ia.vertexCnt,M=ia.vertexOffset):(Q=Q.length/Q.itemSize,M=0),ia.isInstanced?b.drawArraysInstanced(Z,M,Q,ia.instanceCount):b.drawArrays(Z,M,Q));va&&I.resetAttributeDivisors()}};this.renderObjects=function(L,Q,ia){if(ia){var Z=
ia;this.setMaterial(Z);this.setMaterialFaces(Z)}for(var ka=0,ma=L.length;ka<ma;ka+=1){var M=L[ka],fa=M.geometry,ja=M.material;try{for(ia?ia.doNotOverrideSide&&ja&&this.setMaterialFaces(ja):(Z=ja,this.setMaterial(Z),this.setMaterialFaces(Z)),ja=0;ja<Z.renderSteps;ja++)Z.updateRenderStep(ja),this.renderBufferDirect(Q,Z,fa,M)}catch(ta){console.error("Failed to render material "+(Z?Z.name:"null")+": "+ta.stack)}}};this.render=function(L,Q,ia,Z){this.renderMeshes(L.children,L.overrideMaterial,Q,ia,Z)};
this.renderMeshes=function(L,Q,ia,Z,ka,ma){ea=null;O=-1;ra=K=null;ia.matrixWorldInverse.getInverse(ia.matrixWorld);T.multiplyMatrices(ia.projectionMatrix,ia.matrixWorldInverse);pa.setFromMatrix(T);D.length=0;H.length=0;ma=void 0===ma?!1:ma;for(var M=0;M<L.length;M+=1)r(L[M],Q,ma);!0===G.sortObjects&&(D.sort(n),H.sort(p));this.setRenderTarget(Z);(this.autoClear||ka)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);this.renderObjects(D,ia,Q);this.renderObjects(H,ia,Q);Z&&Z.generateMipmaps&&
(L=ca.setSlot(Z,!1),b.activeTexture(b.TEXTURE0+Z.__webglSlot),Z.isCube?(L&&b.bindTexture(b.TEXTURE_CUBE_MAP,Z.__webglTexture),b.generateMipmap(b.TEXTURE_CUBE_MAP)):(L&&b.bindTexture(b.TEXTURE_2D,Z.__webglTexture),b.generateMipmap(b.TEXTURE_2D)));I.setDepthTest(!0);I.setDepthWrite(!0);I.setColorWrite(!0);I.resetAttributeStates()};this.uploadNewBuffers=function(L){var Q=L.geometry;L=Q.attributes;var ia=Q.attributesKeys;void 0===Q.__webglInit&&(Q.__webglInit=!0,Q.addEventListener("dispose",e));console.assert(Q instanceof
C.BufferGeometry);Q=0;for(var Z=ia.length;Q<Z;Q+=1){var ka=ia[Q],ma=L[ka];ka="index"===ka?b.ELEMENT_ARRAY_BUFFER:b.ARRAY_BUFFER;if(ma.buffer)!0===ma.needsUpdate&&console.assert(!1);else{ma.buffer=b.createBuffer();b.bindBuffer(ka,ma.buffer);var M=ma.array;Bc.ios&&ka===b.ARRAY_BUFFER&&console.assert(0===ma.itemSize*M.BYTES_PER_ELEMENT%4);b.bufferData(ka,M,b.STATIC_DRAW);M instanceof Float32Array?ma.glType=b.FLOAT:M instanceof Int8Array?ma.glType=b.BYTE:M instanceof Int16Array?ma.glType=b.SHORT:M instanceof
Uint16Array?ma.glType=b.UNSIGNED_SHORT:M instanceof Uint32Array?ma.glType=b.UNSIGNED_INT:console.assert(!1);ma.releaseOnLoadedToGpu&&(ma.array=null);ma.needsUpdate=!1}}};this.uploadTexture=function(L){ca.setSlot(L,!1);q(L)};this.copyFramebufferToCubeFaceMip=function(L,Q,ia,Z,ka){ca.setSlot(ka,!1);b.activeTexture(b.TEXTURE0+ka.__webglSlot);b.bindTexture(b.TEXTURE_CUBE_MAP,ka.__webglTexture);b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+ia,L,b.RGBA,Q,Q,0,b.RGBA,b.UNSIGNED_BYTE,Z)};this.createCubeTexture=
function(L,Q){var ia=new cd;ia.isCube=!0;ia.minFilter=Q?Mb.LINEAR_MIPMAP_NEAREST:Mb.LINEAR;ia.generateMipmaps=!1;ia.needsUpdate=!1;ia.addEventListener("dispose",f);ia.__webglTexture=b.createTexture();ca.setSlot(ia,!1);b.activeTexture(b.TEXTURE0+ia.__webglSlot);b.bindTexture(b.TEXTURE_CUBE_MAP,ia.__webglTexture);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1);b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_CUBE_MAP,
b.TEXTURE_MAG_FILTER,b.LINEAR);Q?b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_NEAREST):b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR);for(var Z=0;6>Z;Z+=1)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,b.RGBA,L,L,0,b.RGBA,b.UNSIGNED_BYTE,null);Q&&b.generateMipmap(b.TEXTURE_CUBE_MAP);return ia};this.createFrameBufferRenderTarget=function(L){return new hd(L)};this.createRenderTarget=function(L,Q,ia){L=new gd(L,Q,ia);x(!1,L);return L};this.createRenderTargetCube=
function(L,Q,ia){L=new id(L,Q,ia);x(!0,L);return L};this.readPixels=function(L,Q,ia){b.readPixels(0,0,L,Q,b.RGBA,b.UNSIGNED_BYTE,ia)}};function xk(a){if(S.DEBUG_WEBGL){var b=S.DEBUG_WEBGL_ERROR?wj:void 0,c=S.DEBUG_WEBGL_CALL?yj:void 0;try{var d=WebGLDebugUtils.makeDebugContext(a,b,c,void 0)}catch(e){console.error("WebGLDebugUtils library not loaded"),d=a}}else d=a;return d}
function yk(a,b){void 0===b.alpha&&(b.alpha=!0);void 0===b.depth&&(b.depth=!0);void 0===b.stencil&&(b.stencil=!1);void 0===b.premultipliedAlpha&&(b.premultipliedAlpha=!0);void 0===b.antialias&&(b.antialias=!0);void 0===b.preserveDrawingBuffer&&(b.preserveDrawingBuffer=!1);try{var c=(S.FORCE_WEBGL1?null:xk(a.getContext("webgl2",b)))||xk(a.getContext("webgl",b))||xk(a.getContext("experimental-webgl",b))}catch(d){c=null}b=c;if(!b)return null;Bc.resetGlDetector(b);Bc.gl.reportToConsole();Bc.gl.webgl2||
(S.ENABLE_REFLECTION_PROBES_BLENDING=!1);return new wk(a,b)}function zk(a){if(a=yk(a,{antialias:!S.FORCE_FXAA}))a.autoClear=!0,a.autoClearColor=!1,a.autoClearDepth=!0,a.autoClearStencil=!1,a.sortObjects=!0;return a}
function Ak(a,b,c,d){var e=c.camera,f=c.threeScene,g=new Jj(a,f,e),k;S.DEV_NEW_RENDER_ARCHITECTURE&&(k=new hk(f,e));var h=function(){var l=new Ge,n=new C.Matrix4;return function(p){if(0!==c.mirrors.length){p.matrixWorldInverse.getInverse(p.matrixWorld);n.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse);l.setFromMatrix(n);for(var r=0;r<c.mirrors.length;r+=1){var q=c.mirrors[r];q.updateCameraPosition(p,l);q.inFrustum()&&q.render(a)}}}}();this.resize=function(l){if(!l){var n=window.innerWidth;
var p=window.innerHeight;var r=n*window.devicePixelRatio;var q=p*window.devicePixelRatio;e.aspect=r/q;e.updateProjectionMatrix();a.setCanvasSize(r,q);a.domElement.style.width=n+"px";a.domElement.style.height=p+"px";g.onResize(r,q);if(S.DEV_NEW_RENDER_ARCHITECTURE)k.onViewportResize(r,q)}n=q;l?(l=r/2,r=70):(l=r,r=e.fov);p=l/n;for(q=0;q<c.mirrors.length;q+=1)c.mirrors[q].configure(l,n,p,r)};this.onSimStateChange=function(l){S.DEV_NEW_RENDER_ARCHITECTURE&&k.setSimulationChange(l)};this.renderIdle=function(l,
n){0===n&&(d.adaptExposure(),g.resetSSAA());return d.exposureNeedsUpdate()?(this.renderToScreen(l,!1),!0):g.updateSSAA()};this.renderToScreen=function(l,n,p){S.DEV_NEW_RENDER_ARCHITECTURE?k.update(p,l,a):(d.update(l),n?b.render(f,e.matrixWorld,h):(h(e),g.isEnabled?g.update(l):a.render(f,e)))};this.enableAutoExposure=function(){d.enableAutoExposure()};this.disableAutoExposure=function(){d.disableAutoExposure()};Bc.gl.antialiasPostprocess&&(g.init(),Bc.gl.antialiasNative||g.addFXAA(),e.motionBlurEnabled&&
g.addMotionBlur(),g.setup(),g.addSSAA(c))};function Bk(a,b,c,d,e){return a.createRenderTarget(b,c,{format:Mb.RGBA,magFilter:d,minFilter:d,depthBuffer:e,stencilBuffer:!1,generateMipmaps:!1})}
function Ck(a,b,c){var d=[],e=[],f=[{totalFovFraction:.25,count:2},{totalFovFraction:.25,count:16},{totalFovFraction:.375,count:48},{totalFovFraction:.125,count:8}];(function(){for(var g=0,k=0,h=0,l=0;l<f.length;l++){var n=f[l],p=n.totalFovFraction*a/n.count;console.assert(p===Math.floor(p),"Height ("+p+")must be an integer");var r=n.totalFovFraction*Math.PI/2/n.count,q=Bk(c,4*b,4*p,Mb.LINEAR,!0);e.push(q);for(var w=0;w<n.count;w++)d.push({fov:r,fovOffset:g+(w+.5)*r,height:p,yOffset:k+w*p,renderTarget:q});
g+=n.count*r;k+=n.count*p;h+=n.totalFovFraction}console.assert(1===h,"Invalid fractions sum");console.assert(g===Math.PI/2,"Invalid fov definition for rectangles");console.assert(k===a,"Invalid rectangles height")})();this.getRectangleHeight=function(g){return d[g].height};this.getRectangleOffset=function(g){return d[g].yOffset};this.getRectangleFov=function(g){return d[g].fov};this.getRectangleFovOffset=function(g){return d[g].fovOffset};this.getRectangleRenderTarget=function(g){return d[g].renderTarget};
this.dispose=function(){e.forEach(function(g){g.dispose()});d.length=0;e.length=0};this.getRectangleCount=function(){return d.length}}
function Dk(a,b,c){function d(){var r=(document.body.offsetWidth-document.body.offsetHeight*k)/2,q=r+"px";r=Math.max(r,0)+"px";h.style.width=r;l.style.width=r;n.style.left=q;n.style.right=q}function e(r,q,w,x,t,A){function D(X,Y){for(var qa=fa[X].hemisphere,za=fa[X].eyeOffset,Ka=fa[X].parallaxOffset,Ba=fa[X].targetYOffset,Ea=0;Ea<L;Ea++){K(qa,Y,Ea,za);var Ga=na.getRectangleRenderTarget(Ea);a.render(b.threeScene,aa,Ga);var Da=na.getRectangleHeight(Ea),Va=na.getRectangleOffset(Ea);ma.y=qa===P?Ba+va+
Va:Ba+va-Va-Da;ma.x=(Y*V+Ka+w)%w;ma.height=Da;M.render(a,ma,Ga)}A()?G(null):(qa=m.makeIterator(H(X,Y)),X=qa.next().value,Y=qa.next().value,-1===X?(qa=new Uint8Array(2*w*ea*4),a.readPixels(w,2*ea,qa),G(qa)):(0===Y%ta&&x({done:512*X+Y,total:ja}),setTimeout(function(){return D(X,Y)},0)))}function H(X,Y){Y++;if(512===Y){X++;if(X===fa.length)return[-1,-1];Y=0}return[X,Y]}function G(X){ma.dispose();na.dispose();M.dispose();t(X)}function K(X,Y,qa,za){Y=-(Y*I-ca);X=X===P?-na.getRectangleFovOffset(qa):na.getRectangleFovOffset(qa);
Q.set(za,0,0).applyMatrix4(ka.makeRotationZ(Y));aa.position.copy(r).add(Q);ia.copy(ra).applyMatrix4(ka.makeRotationX(X)).applyMatrix4(ka.makeRotationZ(Y));Z.copy(aa.position).add(ia);aa.lookAt(Z);qa=W*Math.tan(na.getRectangleFov(qa)/2);za=J*Math.cos(X);aa.projectionMatrix.makeFrustum(-za,za,-qa,qa,W,O);aa.updateMatrix();aa.updateMatrixWorld()}var W=b.camera.near,O=b.camera.far;console.assert(0===w%512,"Invalid width for stereo panorama");var ea=w/2,ra=new C.Vector3(0,-1,0),va=ea/2,I=2*Math.PI/512,
V=w/512,pa=-V,T=Symbol("Bottom"),P=Symbol("Top"),ca=Math.floor(q/I)*I,J=W*Math.tan(I/2),aa=new C.PerspectiveCamera;aa.up.set(0,0,1);var na=new Ck(va,V,a),L=na.getRectangleCount(),Q=new C.Vector3,ia=new C.Vector3,Z=new C.Vector3,ka=new C.Matrix4,ma=Bk(a,w,2*ea,Mb.NEAREST,!1);ma.width=V;var M=new jj,fa=[{hemisphere:P,eyeOffset:.03,parallaxOffset:pa,targetYOffset:ea},{hemisphere:T,eyeOffset:.03,parallaxOffset:pa,targetYOffset:ea},{hemisphere:P,eyeOffset:-.03,parallaxOffset:V,targetYOffset:0},{hemisphere:T,
eyeOffset:-.03,parallaxOffset:V,targetYOffset:0}],ja=512*fa.length,ta=Math.ceil(ja/100);D(0,0)}function f(r,q,w,x){var t=new Hi(b.camera.near,b.camera.far);t.rotateZ(q);t.position.copy(r);t.updateMatrixWorld();r=a.createRenderTargetCube(4096,4096,{format:Mb.RGBA,magFilter:Mb.LINEAR,minFilter:Mb.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(q=0;6>q;q+=1)r.activeCubeFace=q,a.render(b.threeScene,t.sideCameras[q],r);t=Bk(a,w,x,Mb.NEAREST,!0);q=new Ed({uniforms:{panoramaCube:{type:"t",value:null}},
vertexShaderName:"cube_to_equirect_vertex.glsl",fragmentShaderName:"cube_to_equirect_fragment.glsl"},"panoramaCube");q.render(a,t,r);q.dispose();r.dispose();r=new Uint8Array(w*x*4);a.readPixels(w,x,r);t.dispose();return r}function g(r,q){var w=Bk(a,r,q,Mb.NEAREST,!0);r=Bk(a,r,q,Mb.NEAREST,!1);q=new nj(a,b);q.setTargets(w,r);q.renderAllSamples();var x=q.copyAccumulatedSamplesToBuffer();w.dispose();r.dispose();q.dispose();return x}var k=null,h=null,l=null,n=null,p=new C.Vector3;this.markArea=function(r){function q(x,
t){x.style.zIndex=1;x.style.pointerEvents="none";x.style.position="absolute";x.style.top=0;x.style.bottom=0;x.style[t]=0;x.style.backgroundColor="rgba(0, 0, 0, 0.5)"}function w(x){x.style.zIndex=1;x.style.pointerEvents="none";x.style.position="absolute";x.style.boxSizing="border-box";x.style.top=0;x.style.bottom=0;x.style.border="4px solid rgba(35, 181, 233, 0.5)"}n||(h=document.createElement("div"),q(h,"left"),l=document.createElement("div"),q(l,"right"),n=document.createElement("div"),w(n),document.body.appendChild(h),
document.body.appendChild(l),document.body.appendChild(n),window.addEventListener("resize",d));k=r;d()};this.unmarkArea=function(){n&&(h.remove(),l.remove(),n.remove(),window.removeEventListener("resize",d),n=l=h=k=null)};this.monoScreenToBuffer=function(r,q,w){return r?f(c.cameraWorldPosition(),c.getYawAngle(),q,w):g(q,w)};this.stereoPanoramaToBuffer=function(r,q,w,x){e(c.cameraWorldPosition(),c.getYawAngle(),r,q,w,x)};this.monoScreenToDataUrl=function(r,q,w){r=this.monoScreenToBuffer(r,q,w);for(var x=
0;x<w;++x)for(var t=0;t<q;++t){var A=4*(x*q+t);if(x<w/2)for(var D=4*((w-x-1)*q+t),H=0;3>H;++H){var G=r[A+H];r[A+H]=r[D+H];r[D+H]=G}r[A+3]=255}r=new Uint8ClampedArray(r);r=new ImageData(r,q,w);x=document.createElement("canvas");x.width=q;x.height=w;x.getContext("2d").putImageData(r,0,0);return x.toDataURL("image/jpeg")};this.monoScreenToLocalImage=function(r,q,w){r=this.monoScreenToDataUrl(r,q,w);navigator.msSaveOrOpenBlob?fetch(r).then(function(x){return x.blob()}).then(function(x){return navigator.msSaveOrOpenBlob(x,
"screen.jpg")}):(q=document.createElement("a"),document.body.appendChild(q),q.style.cssText="display: none",q.href=r,q.download="screenshot",q.click(),window.URL.revokeObjectURL(r),q.parentNode.removeChild(q))};this.coverToServer=function(r,q){var w=g(r,q);uc("screenshot?width="+r+"&height="+q,"application/binary",w)};this.monoPanoramaToServer=function(r,q){r.position?p.fromArray(r.position):p.copy(c.cameraWorldPosition());var w=void 0!==r.width?r.width:8E3,x=void 0!==r.height?r.height:4E3,t=m,A=
t.makeIterator;var D=Math.min(S.MAX_PANORAMA_SIZE,Bc.gl.maxRenderBufferSize);if(w<=D&&x<=D)w=[w,x];else{var H=w/x;w=w>x?[D,Math.floor(D/H)]:[Math.floor(D*H),D]}x=A.call(t,w);w=x.next().value;x=x.next().value;t=void 0!==r.rotation?C.Math.degToRad(r.rotation):0;t=f(p,t,w,x);uc("panorama?width="+w+"&height="+x+"&name="+r.name,"application/binary",t,q,q)}};var Ek={BY_NORMALS:"By normals",UP:"Up"},Fk=new C.Vector4(0,0,1,1);function Gk(){bf.call(this);this.type="grass";this._grassHeight=.05;this._heightTexture=null;this._direction=Ek.BY_NORMALS;this._repeatableTexturesRequired=!0;this.renderSteps=8;this.grassScale=1;this.doNotImport={baseColor:!0,baseColorTexture:!0};this.setUniform("currentStep","f",0);this.setUniform("grassOffsetScaled","f",0);this.setUniform("grassDirectionality","f",1);this.setUniform("renderSteps","f",this.renderSteps)}
m.inherits(Gk,bf);Gk.prototype.hash=function(){return"grass"};Gk.prototype.canMerge=function(){return!1};Gk.prototype.vertexShaderHooks=function(){return rd("grass_vertex.glsl")};Gk.prototype.fragmentShaderHooks=function(){return rd("grass_fragment.glsl")};Gk.prototype.configureTransparency=function(){this.blending=C.NormalBlending};Gk.prototype.updateRenderStep=function(a){this.uniforms.grassOffsetScaled.value=this.grassHeight/this.renderSteps*a*this.grassScale;this.uniforms.currentStep.value=a};
Gk.prototype.refreshPerObjectUniforms=function(a){var b=Dd.prototype.refreshPerObjectUniforms.call(this,a);this.grassScale=a.grassScaleOverride||1;this._direction===Ek.UP&&(this.uniforms.grassDirectionality.value=a.grassScaleOverride?1:0);return b};
Gk.prototype.serialize=function(){var a=this.serializeBaseColorProperties();return{name:this.name,type:this.type,baseColor:a.baseColor,baseColorTexture:a.baseColorTexture,baseColorTextureCorrection:a.baseColorTextureCorrection,heightTexture:this.serializeTextureIfNeeded("heightTexture"),grassHeight:this.grassHeight,grassLayers:this.grassLayers,grassDirection:this.grassDirection,doNotImport:this.doNotImport,uvOffsetScale:this.serializeUvOffsetScale()}};
m.global.Object.defineProperties(Gk.prototype,{grassHeight:{configurable:!0,enumerable:!0,set:function(a){this._grassHeight=a;this._updated()},get:function(){return this._grassHeight}},grassLayers:{configurable:!0,enumerable:!0,set:function(a){this.renderSteps=a;this.uniforms.renderSteps.value=this.renderSteps;this._updated()},get:function(){return this.renderSteps}},grassDirectionMode:{configurable:!0,enumerable:!0,get:function(){return Ek}},grassDirection:{configurable:!0,enumerable:!0,get:function(){return this._direction},
set:function(a){this._direction=a;this.uniforms.grassDirectionality.value=this._direction===Ek.UP?0:1;this._updated()}},heightTexture:{configurable:!0,enumerable:!0,set:function(a){var b=this;this._heightTexture=a;a.addLoadedListener(function(){b.setUniform("heightTexture","t",b._heightTexture);b.condDefine(b._heightTexture,"USE_HEIGHT_TEXTURE");b.setUniform("uvMod","v4",b._uvOffsetScale||Fk);b._updated()})},get:function(){return this._heightTexture}}});function Hk(){bf.call(this);this.type="water";this._isPlaying=!0;this._isSleeping=!1;this.setUniform("time","f",0);this._roughness=0;this.baseColor=new C.Color(0);this._wavesScale=this._wavesSpeed=1;this._refractionFactor=0;this.opacity=.2;this.doNotImport={baseColor:!0,baseColorTexture:!0,opacity:!0}}Hk.prototype=Object.create(bf.prototype);Hk.prototype.constructor=Hk;Hk.prototype.addTextureProperty("normalTexture");Hk.prototype.textureNeedsUv0=function(){return!1};Hk.prototype.hash=function(){return"water"};
Hk.prototype.canMerge=function(a){return this.type===a.type&&this.opacity===a.opacity&&this.baseColor.equals(a.baseColor)&&this.normalTexture===a.normalTexture&&this.wavesSpeed===a.wavesSpeed&&this.wavesScale===a.wavesScale&&this.refractionFactor===a.refractionFactor};
Hk.prototype.setUniforms=function(){bf.prototype.setUniforms.call(this);var a=this.normalTexture;this.condDefine(a&&a.loaded&&!this.isLightProbeDisabled(),"USE_NORMAL_TEXTURE")&&(this.setUniform("normalTexture","t",a),this.setUniform("wavesScale","f",this.wavesScale),1!==this.opacity?this.setUniform("refractionFactor","f",this.refractionFactor):this.setUniform("refractionFactor","f",0))};Hk.prototype.fragmentShaderHooks=function(){return rd("water.glsl")};
Object.defineProperty(Hk.prototype,"refractionFactor",{get:function(){return this._refractionFactor},set:function(a){this._refractionFactor=a;this.setUniforms();this._updated()}});Object.defineProperty(Hk.prototype,"wavesSpeed",{get:function(){return this._wavesSpeed},set:function(a){this._wavesSpeed=a;this.setUniforms();this._updated()}});Object.defineProperty(Hk.prototype,"wavesScale",{get:function(){return this._wavesScale},set:function(a){this._wavesScale=a;this.setUniforms();this._updated()}});
Object.defineProperty(Hk.prototype,"hideFromLightProbes",{get:function(){return 1!==this.opacity&&0!==this.refractionFactor}});Object.defineProperty(Hk.prototype,"isAnimated",{get:function(){return!0}});Object.defineProperty(Hk.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying&&0<this.wavesSpeed}});Hk.prototype.play=function(){this._isPlaying=!0};Hk.prototype.pause=function(){this._isPlaying=!1};Hk.prototype.sleepAnimation=function(){this._isSleeping=!0};
Hk.prototype.wakeAnimation=function(){this._isSleeping=!1};Hk.prototype.update=function(a){this.uniforms.time.value+=a*this.wavesSpeed*.1};Hk.prototype.serialize=function(){return{name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),baseColorTexture:null,opacity:this.opacity,normalTexture:this.normalTexture?this.normalTexture.serialize():null,wavesSpeed:this.wavesSpeed,wavesScale:this.wavesScale,refractionFactor:this.refractionFactor,doNotImport:this.doNotImport}};function Ik(a,b){Dd.call(this,"mirror_vertex.glsl","mirror_fragment.glsl");this.hideFromLightProbes=!0;this.uniforms={mirrorColor:{type:"c",value:a},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:b}};this.hdrOutputSupported=!0}Ik.prototype=Object.create(Dd.prototype);Ik.prototype.constructor=Ik;Object.defineProperty(Ik.prototype,"mirrorSampler",{get:function(){return this.uniforms.mirrorSampler.value},set:function(a){this.uniforms.mirrorSampler.value=a}});function Jk(a,b,c){C.Object3D.call(this);this.name="mirror_"+this.id;this.scene=a;this.mirrorCamera=b.clone();this.renderTargetParams={minFilter:Mb.LINEAR,magFilter:Mb.LINEAR,format:Mb.RGBA,stencilBuffer:!1,generateMipmaps:!0};this.texture=null;c=c||{};this.matrixNeedsUpdate=!0;this.clipBias=void 0!==c.clipBias?c.clipBias:0;a=void 0!==c.color?new C.Color(c.color):new C.Color(8355711);this.textureMatrix=new C.Matrix4;this.mirrorWorldPosition=new C.Vector3;this.mirrorRotationMatrix=new C.Matrix4;this.mirrorNormal=
new C.Vector3;this.cameraWorldPosition=new C.Vector3;this.cameraRotationMatrix=new C.Matrix4;this.mirrorToCamera=new C.Vector3;this.cameraFrustum=null;this.material=new Ik(a,this.textureMatrix)}Jk.prototype=Object.create(C.Object3D.prototype);
Jk.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};
Jk.prototype.updateMatrixWorld=function(a){C.Object3D.prototype.updateMatrixWorld.call(this,a);this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.mirrorRotationMatrix.extractRotation(this.matrixWorld);this.mirrorNormal.set(0,0,1);this.mirrorNormal.applyMatrix4(this.mirrorRotationMatrix)};
Jk.prototype.updateCameraPosition=function(a,b){this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld);this.cameraRotationMatrix.extractRotation(a.matrixWorld);this.matrixNeedsUpdate=!0;this.cameraFrustum=b};Jk.prototype.inFrustum=function(){this.mirrorToCamera.subVectors(this.cameraWorldPosition,this.mirrorWorldPosition);return this.mirrorToCamera.angleTo(this.mirrorNormal)<Math.PI/2&&this.cameraFrustum.intersectsBox(this.parent.geometry.boundingBox)};
Jk.prototype.updateTextureMatrix=function(){var a=new C.Vector3,b=new C.Vector3,c=new C.Vector3,d=new C.Vector4,e=new C.Plane,f=new C.Vector4;return function(){a.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);c.set(0,0,-1);c.applyMatrix4(this.cameraRotationMatrix);c.add(this.cameraWorldPosition);b.copy(this.mirrorWorldPosition).sub(c).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);this.up.set(0,-1,0);
this.up.applyMatrix4(this.cameraRotationMatrix);this.up.reflect(this.mirrorNormal).negate();this.mirrorCamera.position.copy(a);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(b);this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);
e.setFromNormalAndCoplanarPoint(this.mirrorNormal,this.mirrorWorldPosition);e.applyMatrix4(this.mirrorCamera.matrixWorldInverse);d.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var g=this.mirrorCamera.projectionMatrix;f.x=(Math.sign(d.x)+g.elements[8])/g.elements[0];f.y=(Math.sign(d.y)+g.elements[9])/g.elements[5];f.z=-1;f.w=(1+g.elements[10])/g.elements[14];d.multiplyScalar(2/d.dot(f));g.elements[2]=d.x;g.elements[6]=d.y;g.elements[10]=d.z+1-this.clipBias;g.elements[14]=d.w}}();
Jk.prototype.configure=function(a,b,c,d){this.mirrorCamera.aspect=c;this.mirrorCamera.fov=d;this.mirrorCamera.updateProjectionMatrix();null!==this.texture&&this.texture.dispose();this.material.mirrorSampler=this.texture};Jk.prototype.render=function(a){this.material.visible&&(this.matrixNeedsUpdate&&(this.updateTextureMatrix(),this.matrixNeedsUpdate=!1),this.material.visible=!1,a.render(this.scene,this.mirrorCamera,this.texture,!0),this.material.visible=!0)};
Jk.prototype.renderTemp=function(a){this.matrixNeedsUpdate&&this.updateTextureMatrix();a.render(this.scene,this.mirrorCamera,this.tempTexture,!0)};function Kk(a){C.EventDispatcher.call(this);var b=this;this._fog=null;this._hdrOutput=!1;this._camera=a;this._lightMapEncoding=this._brdfLUT=null;this._updated=function(){return b.dispatchEvent({type:"updated",target:b})};a.addEventListener("toneMappingUpdated",this._updated);a.addEventListener("colorMapUpdated",this._updated);a.addEventListener("exposureUpdated",this._updated);a.addEventListener("gammaUpdated",this._updated)}m.inherits(Kk,C.EventDispatcher);
m.global.Object.defineProperties(Kk.prototype,{fog:{configurable:!0,enumerable:!0,get:function(){return this._fog},set:function(a){this._fog=a;this._fog.addEventListener("updated",this._updated);this._updated()}},hdrOutput:{configurable:!0,enumerable:!0,get:function(){return this._hdrOutput},set:function(a){this._hdrOutput!==a&&(this._hdrOutput=a,this._updated())}},toneMapping:{configurable:!0,enumerable:!0,get:function(){return this._camera.toneMapping}},colorMap:{configurable:!0,enumerable:!0,get:function(){return this._camera.colorMapReady()?
this._camera.colorMap:null}},colorMapIntensity:{configurable:!0,enumerable:!0,get:function(){return this._camera.colorMapIntensity}},cameraExposure:{configurable:!0,enumerable:!0,get:function(){return this._camera.exposure}},cameraGamma:{configurable:!0,enumerable:!0,get:function(){return this._camera.gamma}},brdfLUT:{configurable:!0,enumerable:!0,set:function(a){this._brdfLUT=a;this._updated()},get:function(){return this._brdfLUT}},lightMapEncoding:{configurable:!0,enumerable:!0,set:function(a){this._lightMapEncoding=
a;this._updated()},get:function(){return this._lightMapEncoding}},lightMapEnabled:{configurable:!0,enumerable:!0,get:function(){return!!this._lightMapEncoding}}});var Lk=0;function Mk(a,b,c){a=new Jk(a,b,{clipBias:0,color:8355711,debugMode:!1});a.material.name=c.material.name;c=c.geometry;console.assert(c.boundingBox);b=c.boundingBox;var d=Math.sqrt(Math.pow(b.max.x-b.min.x,2)+Math.pow(b.max.z-b.min.z,2)),e=b.max.y-b.min.y;d&&e?(d=new C.Mesh(new C.PlaneBufferGeometry(d,e),a.material),d.rotation.y=Math.atan2(c.normals[0],c.normals[2]),b.center(d.position),d.geometry.boundingBox=b,d.add(a),a=d):(zc.log("mirror with 0 dimension"),a=null);return a}
function Nk(a,b,c){c=c||"id";return a.some(function(d){return d.hasOwnProperty(c)&&d[c]===b})?!1:!0}function Ok(a,b,c){c=c||"id";return a.find(function(d){return d[c]===b})}function Pk(a,b){a=a.name.toUpperCase();b=b.name.toUpperCase();return a<b?-1:a>b?1:0}
function Qk(a){function b(){f.dispatchEvent(g)}function c(){f.dispatchEvent(k);b()}function d(h){h=h.target;var l=f._mainAnimatedMaterials.has(h);h.isAnimated&&!l?f._mainAnimatedMaterials.add(h):!h.isAnimated&&l&&f._mainAnimatedMaterials.delete(h);b()}function e(){f._animatedRootNodes.length=0;f.visitAllNodes(function(h){h.isAnimatedRoot&&f._animatedRootNodes.push(h)});b()}var f=this,g={type:"updated",target:this},k={type:"anyViewUpdated",target:this};this.id=Lk++;this.threeScene=new C.Scene;this.autoAddLightProbes=
!0;this.autoTour={disabled:!1,startOnLoad:!1};this.canStartAutoTour=function(){return!this.autoTour.disabled&&1<this.visibleViews().length};this.startAutoTourOnLoad=function(){return this.canStartAutoTour()&&this.autoTour.startOnLoad};this.interactionPrompt=this.disableProgressiveLoader=!1;this.camera=a;this.materials=[];this._mainAnimatedMaterials=new Set;this._disabledMaterials=[];this._sortedMaterials=null;this.nodeConfigs=[];this._nodeConfigsLookup={};this.nodes=[];this._animatedRootNodes=[];
this._nodeLookup={};this.gpuMeshes=[];this.mirrors=[];this._animatableAuxiliaryObjects=new Set;this.boundingBox=new C.Box3;this.collisionBoundingBox=new C.Box3;this._sumLogicalMeshCenter=new C.Vector3;this._logicalNonemptyMeshCount=0;this._center=new C.Vector3;this.skyMeshes=[];this.hideViewsMenu=!1;this.views=[];this.lights=[];this.lightProbes=[];this.cameraVolumes=[];this.lightmapLayoutVersion=0;this.minimapConfig=null;this.sharedMaterialState=new Kk(a);this.serialize=function(){return{disableProgressiveLoader:this.disableProgressiveLoader,
interactionPrompt:this.interactionPrompt,autoTour:this.autoTour,camera:this.camera.serialize(),materials:this.materials.map(function(h){return h.serialize()}),nodeConfigs:this.nodeConfigs.map(function(h){return h.serialize()}),nodes:this.nodes.map(function(h){return h.serialize()}),lights:this.lights.map(function(h){return h.serialize()}),lightProbes:this.lightProbes.map(function(h){return h.serialize()}),cameraVolumes:this.cameraVolumes.map(function(h){return h.serialize()}),autoAddLightProbes:!1,
views:this.views.filter(function(h){return!h.internal}).map(function(h){return h.serialize()}),skies:this.skyMeshes.filter(function(h){return h.name!==S.DEFAULT_SKY_NAME}).map(function(h){return h.serialize()}),minimap:this.minimapConfig.serialize()}};this.addMaterial=function(h){this.materials.push(h);h.addEventListener("updated",d);h.sharedMaterialState=this.sharedMaterialState;h.isAnimated&&this._mainAnimatedMaterials.add(h)};this.getMaterials=function(){return this.materials};this.replaceMaterial=
function(h,l){var n=this.materials.indexOf(h);void 0===this._disabledMaterials[n]&&(this._disabledMaterials[n]=new Map);this._disabledMaterials[n].set(h.type,h);var p=this._disabledMaterials[n].get(l);p||(p=Rk(l),p.addEventListener("updated",d),p.name=h.name,p.sharedMaterialState=this.sharedMaterialState,0===this.lightProbes.length&&(p.disableLightProbe=!0));this.materials[n]=p;b();for(l=0;l<this.gpuMeshes.length;l+=1)this.gpuMeshes[l].material===h&&(this.gpuMeshes[l].material=p);h.isAnimated&&this._mainAnimatedMaterials.delete(h);
p.isAnimated&&this._mainAnimatedMaterials.add(p);this._sortedMaterials=null;p.setUniforms();return p};this.addNodeConfig=function(h){this.nodeConfigs.push(h);this._nodeConfigsLookup[h.name]=h;h.addEventListener("updated",e)};this.findNodeConfig=function(h){return this._nodeConfigsLookup.hasOwnProperty(h)?this._nodeConfigsLookup[h]:null};this.addNode=function(h){var l=this;this.nodes.push(h);h.visitSubtree(function(n){l._nodeLookup[n.id]=n;n.isAnimatedRoot&&l._animatedRootNodes.push(n)})};this.findNode=
function(h){return this._nodeLookup[h]};this.visitAllNodes=function(h){for(var l=0;l<this.nodes.length;l+=1)this.nodes[l].visitSubtree(h)};this.visitMeshesWithMaterial=function(h,l){this.visitAllNodes(function(n){(n=n.mesh)&&n.material===h&&l(n)})};this.sortedMaterials=function(){null===this._sortedMaterials&&(this._sortedMaterials=this.materials.slice(0).sort(Pk));return this._sortedMaterials};this._updateSceneCenterWithGpuMesh=function(){var h=new C.Vector3;return function(l){if(l.logicalMeshes)for(var n=
0;n<l.logicalMeshes.length;n+=1){var p=l.logicalMeshes[n].geometry.boundingBox;p.empty()||(p.center(h),this._sumLogicalMeshCenter.add(h),++this._logicalNonemptyMeshCount)}else l=l.geometry.boundingBox,l.empty()||(l.center(h),this._sumLogicalMeshCenter.add(h),++this._logicalNonemptyMeshCount);this._logicalNonemptyMeshCount&&this._center.copy(this._sumLogicalMeshCenter).divideScalar(this._logicalNonemptyMeshCount)}}();this.addGpuMesh=function(h){var l=this;if(h.material.planarReflector){var n=Mk(this.threeScene,
this.camera,h);this.mirrors.push(n.children[0]);this.addAuxiliaryObject(n)}else this.addAuxiliaryObject(h);this.gpuMeshes.push(h);this.boundingBox.union(h.geometry.boundingBox);(h.logicalMeshes||[h]).forEach(function(p){p.node.disableCollisions||l.collisionBoundingBox.union(p.geometry.boundingBox)});this._updateSceneCenterWithGpuMesh(h)};this.addAuxiliaryObject=function(h,l){var n=this;l=void 0===l?!1:l;this.threeScene.add(h);h.traverse(function(p){(p=p.material)&&null===p.sharedMaterialState&&(p.sharedMaterialState=
n.sharedMaterialState)});l&&this._animatableAuxiliaryObjects.add(h);b()};this.removeAuxiliaryObject=function(h){this.threeScene.remove(h);this._animatableAuxiliaryObjects.delete(h);b()};this.addFog=function(h){console.assert(null===this.sharedMaterialState.fog);this.sharedMaterialState.fog=h};this.addBrdfLUT=function(h){this.sharedMaterialState.brdfLUT=h};this.setLightMapEncoding=function(h){this.sharedMaterialState.lightMapEncoding=h};this.getLightMapEncoding=function(){return this.sharedMaterialState.lightMapEncoding};
this.hasLightMap=function(){return this.sharedMaterialState.lightMapEnabled};this.addSkyMesh=function(h){this.skyMeshes.push(h);h.addEventListener("updated",b);this.dispatchEvent({type:"skyMeshAdded",skyMesh:h,target:this})};this.removeSkyMesh=function(h){Ia(h,this.skyMeshes);this.dispatchEvent({type:"skyMeshRemoved",skyMesh:h,target:this});h.geometry.dispose();h.material.map&&h.material.map.dispose();h.material.dispose()};this.findSkyMesh=function(h){return Ok(this.skyMeshes,h,"name")};this.addLight=
function(h){console.assert(Nk(this.lights,h.name,"name"));this.lights.push(h);h.addEventListener("updated",b);h.addEventListener("instanceAdded",b);h.addEventListener("instanceRemoved",b);b();this.dispatchEvent({type:"lightAdded",light:h,target:this})};this.removeLight=function(h){Ia(h,this.lights);b();this.dispatchEvent({type:"lightRemoved",light:h,target:this})};this.addLightProbe=function(h){console.assert(Nk(this.lightProbes,h.id));this.lightProbes.push(h);h.addEventListener("positionUpdated",
b);h.addEventListener("boundsUpdated",b);b();this.dispatchEvent({type:"lightProbeAdded",lightProbe:h,target:this})};this.removeLightProbe=function(h){Ia(h,this.lightProbes);for(var l=0;l<this.gpuMeshes.length;l+=1)this.gpuMeshes[l].lightProbe===h&&(this.gpuMeshes[l].lightProbe=null);b();this.dispatchEvent({type:"lightProbeRemoved",lightProbe:h,target:this});h.dispose()};this.findLightProbe=function(h){return Ok(this.lightProbes,h)};this.closestLightProbe=function(h){for(var l=null,n=Infinity,p=m.makeIterator(this.lightProbes),
r=p.next();!r.done;r=p.next()){r=r.value;var q=h.distanceTo(r.position);q<n&&(n=q,l=r)}return l};this.addCameraAdjustmentVolume=function(h){console.assert(Nk(this.cameraVolumes,h.id));this.cameraVolumes.push(h);h.getCameraVolumeTrigger().addEventListener("updated",b);b()};this.removeCameraVolume=function(h){Ia(h,this.cameraVolumes);b();h.dispose()};this.findCameraVolume=function(h){return Ok(this.cameraVolumes,h)};this.shiftCameraVolume=function(h,l){console.assert(0<this.cameraVolumes.length);Ja(this.cameraVolumes,
h,l);for(h=0;h<this.cameraVolumes.length;h+=1)this.cameraVolumes[h].setPriority(h);this.cameraVolumes.at(-1).onUpdated()};this.findView=function(h){return Ok(this.views,h)};this.findViewByName=function(h){return Ok(this.views,h,"name")};this.visibleViews=function(){return this.views.filter(function(h){return!h.hideFromMenu})};this.addView=function(h){console.assert(Nk(this.views,h.id));this.views.push(h);h.addEventListener("updated",c);b();this.dispatchEvent({type:"viewAdded",view:h,target:this})};
this.removeView=function(h){Ia(h,this.views);this.nodeConfigs.forEach(function(l){l.removeFromHideInViews(h.id)});b();this.dispatchEvent({type:"viewRemoved",view:h,target:this})};this.shiftView=function(h,l){Ja(this.views,h,l);this.dispatchEvent({type:"viewShifted",view:h,target:this})};this.adjustSkiesAndCameraFarToSpanWholeScene=function(){function h(x,t){var A=0;x.forEach(function(D){if("orbit"===D.mode){var H=void 0===D.maxDistance?D.distance:D.maxDistance;H=D.target&&H?D.target.distanceTo(t)+
H:void 0}else"fps"===D.mode&&(H=D.position?D.position.distanceTo(t):void 0);H&&H>A&&(A=H)});return A}function l(x,t){var A=Math.max(Math.abs(x.min.x-t.x),Math.abs(x.max.x-t.x)),D=Math.max(Math.abs(x.min.y-t.y),Math.abs(x.max.y-t.y));x=Math.max(Math.abs(x.min.z-t.z),Math.abs(x.max.z-t.z));return Math.sqrt(A*A+D*D+x*x)}for(var n=0,p=0;p<this.skyMeshes.length;p+=1){var r=this.skyMeshes[p];r.autoPosition&&r.position.copy(this.center);var q=void 0;if(this.boundingBox.empty())q=0;else{q=l(this.boundingBox,
r.position);var w=h(this.views,r.position);q=Math.max(q,w)}q+=S.SKY_DISTANCE_TO_SCENE;r.radius=q;n=Math.max(n,q)}this.camera.far=Math.max(this.camera.far,2*n);zc.log("Camera far set to "+this.camera.far)};a.addEventListener("updated",b);this.disableLightProbesForMaterials=function(){for(var h=0;h<this.materials.length;h+=1)this.materials[h].disableLightProbe=!0,this.materials[h].setUniforms()};this.enableLightProbesForMaterials=function(){for(var h=0;h<this.materials.length;h+=1)this.materials[h].disableLightProbe=
!1,this.materials[h].setUniforms()};this.getAnimatedMaterials=function(){var h=!1,l=new Map;return function(){function n(x){x instanceof C.Mesh&&x.material.isAnimated&&l.set(x.material,p)}for(var p=!h,r=m.makeIterator(f._mainAnimatedMaterials),q=r.next();!q.done;q=r.next())l.set(q.value,p);r=m.makeIterator(f._animatableAuxiliaryObjects);for(q=r.next();!q.done;q=r.next())q.value.traverse(n);r=m.makeIterator(l);for(q=r.next();!q.done;q=r.next()){q=m.makeIterator(q.value);var w=q.next().value;q.next().value===
h&&l.delete(w)}h=p;return l.keys()}}();this.getAnimatedRootNodes=function(){return this._animatedRootNodes}}Qk.prototype={constructor:Qk,get center(){return this._center}};C.EventDispatcher.prototype.apply(Qk.prototype);function Rk(a){switch(a){case "grass":return new Gk;case "water":return new Hk;default:return new bf}}
function Sk(a,b){b=void 0===b?!1:b;new C.Object3D;for(var c=0;c<a.gpuMeshes.length;c+=1){var d=a.gpuMeshes[c];if(d instanceof C.Mesh&&(!b||d.material.transparent)){d=d.geometry;d.boundingBox||d.computeBoundingBox();d=d.boundingBox;var e=new Qd(new C.Color(16777215*Math.random())),f=new C.BoxBufferGeometry(d.max.x-d.min.x,d.max.y-d.min.y,d.max.z-d.min.z);f.addTriangleOrderAttribute();e=new C.Mesh(f,e);d.center(e.position);e.updateMatrixWorld();a.addAuxiliaryObject(e)}}};function Tk(){var a=new Set,b=[];this.add=function(c){c instanceof RegExp?b.push(c):a.add(c)};this.matchesAny=function(c){return a.has(c)?!0:b.some(function(d){return d.test(c)})}};function Uk(a,b,c){function d(){p.set({x:b.min.x,y:b.min.y},{x:b.max.x,y:b.max.y})}function e(){var w=p.center(),x=Math.abs(Math.sin(l)),t=Math.abs(Math.cos(l)),A=Math.abs(p.max.x-p.min.x),D=Math.abs(p.max.y-p.min.y),H=A*t+D*x;x=A*x+D*t;q.set({x:w.x-H/2,y:w.y+x/2},{x:w.x+H/2,y:w.y-x/2})}function f(){var w=Math.abs(b.min.x-b.max.x),x=Math.abs(b.min.y-b.max.y);w=p.size().x/w;x=p.size().y/x;w>x?r.set(1,x/w):r.set(w/x,1)}var g=a.name||"level",k=a.slicePlaneHeight,h=a.farPlaneHeight,l=a.rotation||0,n=
!!a.cropRange,p=a.cropRange?new C.Box2((new C.Vector2).fromArray(a.cropRange.min),(new C.Vector2).fromArray(a.cropRange.max)):new C.Box2,r=new C.Vector2(1,1),q=new C.Box2;n&&f();this.setRange=function(w,x,t){w>p.max[t]&&(w=p.max[t]);x<p.min[t]&&(x=p.min[t]);p.min[t]=w;p.max[t]=x;e();f();c()};this.serialize=function(){var w=n?{min:p.min.toArray(),max:p.max.toArray()}:null;return{name:g,slicePlaneHeight:k,farPlaneHeight:h,cropRange:w,rotation:l}};Object.defineProperty(this,"name",{get:function(){return g},
set:function(w){g=w?w.trim()||"level":"level";c()}});Object.defineProperty(this,"slicePlaneHeight",{get:function(){return k},set:function(w){w>=h&&(k=w,c())}});Object.defineProperty(this,"farPlaneHeight",{get:function(){return h},set:function(w){w<=k&&(h=w,c())}});Object.defineProperty(this,"crop",{get:function(){return n},set:function(w){(n=w)||d();e();f();c()}});Object.defineProperty(this,"cropRange",{get:function(){p.empty()&&d();return p}});Object.defineProperty(this,"visibleRange",{get:function(){q.empty()&&
e();return q}});Object.defineProperty(this,"ratio",{get:function(){0!==r.x&&0!==r.y&&isNaN(r.x)&&isNaN(r.y)||f();return r}});Object.defineProperty(this,"rotation",{get:function(){return l},set:function(w){l=w;n||d();e();f();c()}});Object.defineProperty(this,"rotationDeg",{get:function(){return C.Math.radToDeg(this.rotation)},set:function(w){this.rotation=C.Math.degToRad(w)}})}
function Vk(a,b,c){function d(){return g.dispatchEvent(k)}function e(){return new Uk({name:"level0",slicePlaneHeight:c?c:b.min.z+S.FALLBACK_CAMERA_HEIGHT,farPlaneHeight:b.min.z},b,d)}function f(){return r.map(function(q){return q.serialize()})}var g=this;a=void 0!==a?a:{enabled:!1,outlineColor:[0,0,0],outlineThickness:1,fillEnabled:!0,levels:[]};var k={type:"updated",target:this},h=a.enabled,l=(new C.Color).fromArray(a.outlineColor),n=a.outlineThickness,p=a.fillEnabled,r=a.levels.map(function(q){return new Uk(q,
b,d)});this.addLevel=function(q){var w=r.length;if(0===w)r.push(e());else{var x=r,t=x.push;var A="level"+w;var D=r[w-1];w=D.slicePlaneHeight+(b.max.z-D.slicePlaneHeight)/2;var H=D.farPlaneHeight;D=D.rotation;q=q.crop?{min:q.cropRange.min.toArray(),max:q.cropRange.max.toArray()}:null;A=new Uk({name:A,slicePlaneHeight:w,farPlaneHeight:H,cropRange:q,rotation:D},b,d);t.call(x,A)}d()};this.removeLevel=function(q){Ia(q,r);0===r.length&&r.push(e());d()};this.shiftLevel=function(q,w){Ja(r,q,w);d()};this.setOutlineColorRGB=
function(q,w,x){l.setRGB(q,w,x);d()};this.serialize=function(){return{enabled:this.enabled,outlineColor:this.outlineColor.toArray(),outlineThickness:this.outlineThickness,fillEnabled:this.fillEnabled,levels:f()}};Object.defineProperty(this,"enabled",{get:function(){return h},set:function(q){q&&0===r.length&&this.addLevel();h=q;d()}});Object.defineProperty(this,"outlineColor",{get:function(){return l}});Object.defineProperty(this,"outlineThickness",{get:function(){return n},set:function(q){n=q;d()}});
Object.defineProperty(this,"fillEnabled",{get:function(){return p},set:function(q){p=q;d()}});Object.defineProperty(this,"levels",{get:function(){return r}})}C.EventDispatcher.prototype.apply(Vk.prototype);function Wk(a){return null!==a&&void 0!==a}
function Xk(a){var b=this;this.name=a.name;this._editable=a.editable||!1;this._setsDisableCollisions=Wk(a.disableCollisions);this._disableCollisions=a.disableCollisions||!1;this._setsHideInViews=Wk(a.hideInViews);this.hideInViews=null;a.hideInViews&&(this.hideInViews=a.hideInViews,this.hideInViews.sort());this._lightmapResolution=(this._setsLightmapResolution=Wk(a.lightmapResolution))?a.lightmapResolution:null;this._ground=Wk(a.ground)?a.ground:!1;this._faceCamera=a.faceCamera||null;this._rotate=
a.rotate||!1;this._rotationSpeed=a.rotationSpeed||.1;this._isolateShadows=Wk(a.isolateShadows)?a.isolateShadows:!1;this._simplificationParams=(this._setsSimplificationParams=Wk(a.simplificationParams))?a.simplificationParams:null;this.nodes=[];var c={type:"updated",target:this};this._updated=function(){return b.dispatchEvent(c)}}Xk.prototype.constructor=Xk;C.EventDispatcher.prototype.apply(Xk.prototype);function Yk(a){a.configure()}function Zk(a){a.visitSubtree(Yk)}
Xk.prototype._configUpdated=function(){this.nodes.forEach(Zk);this._updated()};Xk.prototype.addNode=function(a){this.nodes.push(a)};Xk.prototype.isOnHideInViews=function(a){return-1!==this.hideInViews.indexOf(a)};Xk.prototype.addToHideInViews=function(){var a=m.getRestArguments.apply(0,arguments);console.assert(this.setsHideInViews);a=m.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,console.assert(!this.isOnHideInViews(b)),this.hideInViews.push(b);this._updated()};
Xk.prototype.removeFromHideInViews=function(a){if(this.hideInViews)for(var b=0;b<this.hideInViews.length;)this.hideInViews[b]===a?this.hideInViews.splice(b,1):b+=1;this._updated()};
Xk.prototype.serialize=function(){return{name:this.name,disableCollisions:this.setsDisableCollisions?this.disableCollisions:null,hideInViews:this.setsHideInViews?this.hideInViews:null,lightmapResolution:this.setsLightmapResolution?this.lightmapResolution:null,ground:this.ground?!0:null,faceCamera:this.faceCamera,rotate:this.rotate?!0:null,rotationSpeed:this.rotate?this.rotationSpeed:null,isolateShadows:this.isolateShadows?!0:null,simplificationParams:this.setsSimplificationParams?this.simplificationParams:
null}};Object.defineProperty(Xk.prototype,"setsDisableCollisions",{get:function(){return this._setsDisableCollisions},set:function(a){this._setsDisableCollisions=a;this._configUpdated()}});Object.defineProperty(Xk.prototype,"disableCollisions",{get:function(){return this._disableCollisions},set:function(a){console.assert(this._setsDisableCollisions);this._disableCollisions=a;this._configUpdated()}});
Object.defineProperty(Xk.prototype,"editable",{get:function(){return this._editable||this.faceCamera||this.rotate},set:function(a){this._editable=a;this._configUpdated()}});Object.defineProperty(Xk.prototype,"ground",{get:function(){return this._ground},set:function(a){this._ground=a;this._configUpdated()}});Object.defineProperty(Xk.prototype,"faceCamera",{get:function(){return this._faceCamera},set:function(a){this._faceCamera=a;this._configUpdated()}});
Object.defineProperty(Xk.prototype,"rotate",{get:function(){return this._rotate},set:function(a){this._rotate=a;this._configUpdated()}});Object.defineProperty(Xk.prototype,"rotationSpeed",{get:function(){return this._rotationSpeed},set:function(a){0===a&&(a=.01);this._rotationSpeed=a;this._configUpdated()}});Object.defineProperty(Xk.prototype,"setsLightmapResolution",{get:function(){return this._setsLightmapResolution},set:function(a){this._setsLightmapResolution=a;this._configUpdated()}});
Object.defineProperty(Xk.prototype,"lightmapResolution",{get:function(){return this._lightmapResolution},set:function(a){console.assert(this._setsLightmapResolution);this._lightmapResolution=a;this._configUpdated()}});Object.defineProperty(Xk.prototype,"isolateShadows",{get:function(){return this._isolateShadows},set:function(a){this._isolateShadows=a;this._configUpdated()}});
Object.defineProperty(Xk.prototype,"setsSimplificationParams",{get:function(){return this._setsSimplificationParams},set:function(a){this._setsSimplificationParams=a;this._configUpdated()}});Object.defineProperty(Xk.prototype,"simplificationParams",{get:function(){return this._simplificationParams},set:function(a){console.assert(this._setsSimplificationParams);this._simplificationParams=a;this._configUpdated()}});
Object.defineProperty(Xk.prototype,"setsHideInViews",{get:function(){return this._setsHideInViews},set:function(a){this._setsHideInViews=a;null===this.hideInViews&&(this.hideInViews=[]);this._configUpdated()}});
function $k(a){function b(){e=new C.Vector3;var k=new C.Box3;a.visitSubtree(function(h){(h=h.mesh)&&k.union(h.geometry.boundingBox)});k.center(e);d.elements[12]=-e.x;d.elements[13]=-e.y;d.elements[14]=-e.z}var c=new C.Matrix4,d=new C.Matrix4,e,f=new C.Vector3,g=new Ee;return function(k,h){e||b();if(a.config.faceCamera)return f.copy(h).sub(e).normalize(),g.setFromDirection(f),"yaw"===a.config.faceCamera&&(g.pitch=0),c.makeRotationFromEuler(g),a.animationMatrix.identity().setPosition(e).multiply(c).multiply(d),
!1;console.assert(a.config.rotate);g.yaw=Oa(g.yaw+2*Math.PI*a.config.rotationSpeed*k);c.makeRotationFromEuler(g);a.animationMatrix.identity().setPosition(e).multiply(c).multiply(d);return!0}}
function al(a,b,c){this.id=c.id;this.initialLightProbeId=void 0===c.lightProbeId?null:c.lightProbeId;this.parent=a;this.config=b;this.children=[];this._originalFacesSubtreeCnt=this._facesCnt=this.mesh=null;this._originalFaceCnt=c.originalFaceCnt||0;this.shadowsIsolatedWithin=this.lightmapResolution=this.hideInViews=this.animationMatrix=this.ground=this.disableCollisions=null;this.editable=!1;this.editableRoot=null;b.addNode(this);this.configure()}al.prototype.constructor=al;
al.prototype.configure=function(){this.ground=(this.disableCollisions=this.config.setsDisableCollisions?this.config.disableCollisions:this.parent?this.parent.disableCollisions:!1)?!1:this.config.ground;this.isAnimatedRoot?(this.animationMatrix=new C.Matrix4,this.update=$k(this)):this.animationMatrix=this.parent?this.parent.animationMatrix:null;this.hideInViews=this.config.setsHideInViews?this.config.hideInViews:this.parent?this.parent.hideInViews:null;this.lightmapResolution=this.config.setsLightmapResolution?
this.config.lightmapResolution:this.parent?this.parent.lightmapResolution:null;this.simplificationParams=this.config.setsSimplificationParams?this.config.simplificationParams:this.parent?this.parent.simplificationParams:null;this.shadowsIsolatedWithin=this.config.isolateShadows?this.config.name:this.parent&&this.parent.shadowsIsolatedWithin?this.parent.shadowsIsolatedWithin:null;this.editableRoot=(this.editable=this.config.editable)?this:this.parent?this.parent.editableRoot:null};
al.prototype.visitSubtree=function(a){a(this);this.children&&this.children.forEach(function(b){return b.visitSubtree(a)})};al.prototype.facesInSubtree=function(){var a=this;null===a._facesCnt&&(a._facesCnt=0,a.visitSubtree(function(b){b.mesh&&(a._facesCnt+=b.mesh.geometry.vertexCnt/3)}));return a._facesCnt};
al.prototype.originalFacesInSubtree=function(){var a=this;null===a._originalFacesSubtreeCnt&&(a._originalFacesSubtreeCnt=0,a.visitSubtree(function(b){b.mesh&&(a._originalFacesSubtreeCnt+=b._originalFaceCnt)}));return a._originalFacesSubtreeCnt};al.prototype.hide=function(){this.visitSubtree(function(a){a.mesh&&(a.mesh.visible=!1)})};al.prototype.show=function(){this.visitSubtree(function(a){a.mesh&&(a.mesh.visible=!0)})};
Object.defineProperty(al.prototype,"isAnimatedRoot",{get:function(){return this.config.faceCamera||this.config.rotate}});al.prototype.serialize=function(){var a={id:this.id,children:this.children.map(function(c){return c.serialize()})},b=this.mesh;b&&(a.lightProbeId=b.lightProbe?b.lightProbe.id:null,a.mesh=!0);return a};Object.defineProperty(al.prototype,"type",{get:function(){return this.config.name}});
Object.defineProperty(al.prototype,"highlightMix",{set:function(a){this.visitSubtree(function(b){b.mesh&&(b.mesh.highlightMix=a)})}});Object.defineProperty(al.prototype,"selected",{set:function(a){this.visitSubtree(function(b){b.mesh&&(b.mesh.selected=a)})}});Object.defineProperty(al.prototype,"selectedSecondary",{set:function(a){this.visitSubtree(function(b){b.mesh&&(b.mesh.selectedSecondary=a)})}});function bl(a){var b=new cd;b.wrapS=Mb.CLAMP_TO_EDGE;b.wrapT=Mb.CLAMP_TO_EDGE;b.minFilter=Mb.LINEAR;b.magFilter=Mb.LINEAR;b.format=Mb.RGBA;b.hasAlpha=!0;b.anisotropy=S.DEFAULT_ANISOTROPY;b.flipY=!1;var c=ob("3dassets/brdfLut."+(Bc.webp?"webp":"png"));Uc(S.LOAD_PRIORITY.SPECULARITY,c,function(d){b.needsUpdate=!0;b.image=d;b.width=d.naturalWidth;b.height=d.naturalHeight;b.notifyLoaded()},a);return b};function cl(a,b){var c={};this.onHaveBuffer=this.onFailure=this.onProgress=null;this._buffersDone={};this.buffers={meshes:null,transforms:null,bounds:null,faces16:null,faces:null,vertices:null,normals:null,uvs0:null,uvs1:null};this.haveAllBuffers=function(){for(var d in this.buffers)if(this.buffers.hasOwnProperty(d)&&null===this.buffers[d])return!1;return!0};this.haveCoreBuffers=function(){var d=this.buffers;return d.faces16&&d.faces&&d.vertices&&d.normals&&d.transforms};this.releaseCoreBuffers=function(){var d=
this.buffers;d.faces16=d.faces=d.vertices=d.normals=null};this.load=function(){function d(h){return function(l){f.buffers[h]=l;f.onHaveBuffer()}}function e(h){return function(l){c[h]=l.loaded;f.onProgress()}}var f=this,g=S.LOAD_PRIORITY.CORE_RESOURCE,k={meshes:g,transforms:g,bounds:g,faces16:g,faces:g,vertices:g,normals:g,uvs0:b?g:S.LOAD_PRIORITY.UV0,uvs1:b?g:S.LOAD_PRIORITY.LIGHTMAP};(function(){for(var h in f.buffers)if(f.buffers.hasOwnProperty(h)){var l=k[h];console.assert(void 0!==l);Rc(l,a+h+
".buf",!0,d(h),f.onFailure,e(h),!0)}})()};this.totalDone=function(){var d=0,e;for(e in c)c.hasOwnProperty(e)&&(d+=c[e]);return d}};var dl=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0]);function el(a){this.minVerticesUntilTimeCall=a;this.verticesCount=0;this.timer=new Fd}el.prototype.shouldInterrupt=function(a){this.verticesCount+=a;return this.verticesCount>this.minVerticesUntilTimeCall&&10<this.timer.elapsedMSec()?(this.verticesCount=0,this.timer.reset(),!0):!1};
function fl(a,b,c,d,e,f,g){var k=0;for(c*=3;k<c;k+=3){var h=a[k+b]*e,l=a[k+b+1]*e,n=a[k+b+2]*e;f[g+k]=d[0]*h+d[1]*l+d[2]*n+d[3];f[g+k+1]=d[4]*h+d[5]*l+d[6]*n+d[7];f[g+k+2]=d[8]*h+d[9]*l+d[10]*n+d[11]}}
function gl(a,b,c,d,e,f){var g=0;for(c*=2;g<c;g+=2){var k=(a[g+b]/254+.5)*Math.PI,h=Math.PI/127*a[g+b+1],l=Math.sin(k),n=l*Math.cos(h);h=l*Math.sin(h);k=Math.cos(k);l=d[0]*n+d[1]*h+d[2]*k;var p=d[4]*n+d[5]*h+d[6]*k;k=2*(Math.acos(d[8]*n+d[9]*h+d[10]*k)/Math.PI-.5);h=Math.atan2(p,l)/Math.PI;e[f+g]=Ie(k);e[f+g+1]=Ie(h)}}function hl(a){return 0!==a.instanceId||!1===a.parent.ownsGpuBuffers}function il(a,b,c,d,e,f){var g=!1,k=0;for(c*=2;k<c;k+=1){var h=a[k+b]*d;e[f+k]=h;if(0>h||1<h)g=!0}return g}
function Pl(a,b,c,d,e){var f=!1,g=0;for(c*=2;g<c;g+=1){var k=a[g+b];d[e+g]=k;if(0>k||1<k)f=!0}return f}function Ql(a,b,c,d,e,f,g,k,h){var l=0;for(c*=2;l<c;l+=2){var n=a[l+b],p=a[l+b+1];0!==n||0!==p?(k[h+l]=Math.round(n*d)+f,k[h+l+1]=Math.round(p*e)+g):(k[h+l]=0,k[h+l+1]=0)}}
function Rl(a,b,c,d,e){function f(){for(;k<a.length;){var l=a[k];if(0!==h||b(l)){for(;h<l.logicalMeshes.length;){var n=l.logicalMeshes[h];c(n);h+=1;if(g.shouldInterrupt(n.vertexCnt)){setTimeout(f,0);return}}d(l);k+=1;h=0}else k+=1}e()}var g=new el(5E4),k=0,h=0;f()}function Sl(a,b){b.geometry.allocateCoreBuffers(a);return!0}function Tl(a){return a.anyLogicalMeshHasUvs?(a.geometry.allocateUv0(),!0):!1}function Ul(a){return a.lightMap?(a.geometry.allocateUv1(),!0):!1}
function Vl(a,b,c,d){var e=new Uint16Array(a),f=new Float32Array(a);Rl(b,Tl,function(g){if(g.uv0InBuffers()){var k=g.geometry;if(!hl(k)){var h=k.vertexOffset;k=k.parent;if(g.quantUv0Disabled()?Pl(f,g.uv0ByteOffset/4,g.vertexCnt,k.uvs0,2*h):il(e,g.uv0ByteOffset/2,g.vertexCnt,g.quantUv0Factor(),k.uvs0,2*h))k.isUvs0Repeating=!0}}},c,d)}function Wl(a,b,c,d,e){var f=4*e.instanceId;e=e.parent.uvs1Mod;e[f]=c/65535;e[f+1]=d/65535;e[f+2]=a/65535;e[f+3]=b/65535}
function Xl(a,b,c,d,e,f){var g=c?Yl(d,a):new Uint16Array(a);Rl(b,Ul,function(k){if(k.uv1InBuffers()){var h=k.uv1CoordUScale,l=k.uv1CoordVScale,n=k.uv1CoordUOffset,p=k.uv1CoordVOffset,r=k.geometry;if(r.isInstanced){Wl(h,l,n,p,r);if(hl(r))return;h=l=1;n=p=0}Ql(g,k.uv1ByteOffset/2,k.vertexCnt,h,l,n,p,r.parent.uvs1,2*r.vertexOffset)}},e,f)}
function Zl(a,b){var c=b.parent;b=4*b.instanceId;var d=c.transforms0;d[b]=a[0];d[b+1]=a[1];d[b+2]=a[2];d[b+3]=a[3];d=c.transforms1;d[b]=a[4];d[b+1]=a[5];d[b+2]=a[6];d[b+3]=a[7];c=c.transforms2;c[b]=a[8];c[b+1]=a[9];c[b+2]=a[10];c[b+3]=a[11]}
function $l(a,b,c,d,e,f){c=c?am(d,b,a.faces):[new Uint16Array(a.faces16),new Uint32Array(a.faces)];var g=c[0],k=c[1],h=new Int8Array(a.vertices),l=new Int16Array(a.vertices),n=new Int32Array(a.vertices),p=new Int8Array(a.normals);Rl(b,Sl.bind(null,!0),function(r){var q=r.geometry,w=q.parent,x=new Float32Array(a.transforms,r.transformByteOffset,16);if(q.isInstanced){Zl(x,q);if(hl(q))return;x=dl}switch(Je(r.quantVertexMax)){case 1:var t=h;var A=r.vertexByteOffset;break;case 2:t=l;A=r.vertexByteOffset/
2;break;case 4:t=n,A=r.vertexByteOffset/4}var D=q.vertexOffset;fl(t,A,r.vertexCnt,x,r.quantVertexFactor(),w.vertices,3*D);gl(p,r.normalByteOffset,r.vertexCnt,x,w.normals,2*D);w=w.index;q=q.indexOffset;r.useFaces16?(A=r.faceByteOffset/2,x=g):(A=r.faceByteOffset/4,x=k);t=A;for(r=A+3*r.faceCnt;t<r;t+=1,q+=1)w[q]=x[t]+D},e,f)}function bm(a){return new Uint8Array(a.buffer,a.byteOffset,a.byteLength)}
function am(a,b,c){function d(r,q){return r[0]-q[0]}var e=[],f=[],g=0,k=0;b=m.makeIterator(b);for(var h=b.next();!h.done;h=b.next()){h=m.makeIterator(h.value.logicalMeshes);for(var l=h.next();!l.done;l=h.next())l=l.value,l.useFaces16?(e.push([l.faceByteOffset/2,l.faceCnt,l.useFaces16]),g+=l.faceCnt):(f.push([l.faceByteOffset/4,l.faceCnt,l.useFaces16]),k+=l.faceCnt)}e.sort(d);f.sort(d);g=0<g?new Uint32Array(3*g):null;k=0<k?new Uint32Array(3*k):null;b=0;h=-1;e=m.makeIterator([].concat(m.arrayFromIterable(e),
m.arrayFromIterable(f)));for(f=e.next();!f.done;f=e.next()){var n=f.value;l=n[0];f=n[1];var p=n[2];h!=l&&(h=l,n=(new Uint32Array(c.slice(b,b+=4))).at(0),l=bm((p?g:k).subarray(l)),n=(new Uint8Array(c)).subarray(b,b+=n),a.decodeIndexBuffer(l,3*f,4,n))}return[new Uint16Array(g),k]}function Yl(a,b){if(!b)return null;var c=new Uint8Array(b.slice(4));b=(new Uint32Array(b.slice(0,4))).at(0);var d=new Uint8Array(4*b);a.decodeVertexBuffer(d,b,4,c);return new Uint16Array(d.buffer)}
function cm(a,b,c,d,e,f){var g=c?am(d,b,a.faces):[new Uint16Array(a.faces16),new Uint32Array(a.faces)],k=g[0],h=g[1],l=new Int8Array(a.vertices),n=new Int16Array(a.vertices),p=new Int32Array(a.vertices),r=new Int8Array(a.normals),q=new Uint16Array(a.uvs0),w=new Float32Array(a.uvs0),x=c?Yl(d,a.uvs1):new Uint16Array(a.uvs1);Rl(b,function(t){Sl(!1,t);Tl(t);Ul(t);return!0},function(t){var A=t.geometry,D=t.geometry.parent,H=new Float32Array(a.transforms,t.transformByteOffset,16);if(t.uv0InBuffers()&&D.uvs0)var G=
D.uvs0;if(t.uv1InBuffers()&&D.uvs1){var K=D.uvs1;var W=t.uv1CoordUScale;var O=t.uv1CoordVScale;var ea=t.uv1CoordUOffset;var ra=t.uv1CoordVOffset}if(A.isInstanced){Zl(H,A);K&&Wl(W,O,ea,ra,A);if(hl(A))return;H=dl;W=O=1;ea=ra=0}if(t.useFaces16){A=k;var va=t.faceByteOffset/2}else A=h,va=t.faceByteOffset/4;switch(Je(t.quantVertexMax)){case 1:var I=l;var V=t.vertexByteOffset;break;case 2:I=n;V=t.vertexByteOffset/2;break;case 4:I=p,V=t.vertexByteOffset/4}var pa=t.quantUv0Disabled();if(pa)var T=t.uv0ByteOffset/
4;else{var P=t.quantUv0Factor();T=t.uv0ByteOffset/2}var ca=3*t.geometry.vertexOffset,J=2*t.geometry.vertexOffset,aa=t.quantVertexFactor(),na=D.vertices,L=D.normals,Q=t.normalByteOffset,ia=t.uv1ByteOffset/2,Z=va;for(t=va+3*t.faceCnt;Z<t;Z+=1,ca+=3,J+=2){va=A[Z];fl(I,V+3*va,1,H,aa,na,ca);gl(r,Q+2*va,1,H,L,J);if(G){var ka=T+2*va;if(pa?Pl(w,ka,1,G,J):il(q,ka,1,P,G,J))D.isUvs0Repeating=!0}K&&Ql(x,ia+2*va,1,W,O,ea,ra,K,J)}},e,f)};function dm(a,b,c){function d(){--f;if(0===f)e.onComplete()}var e=this,f=b;this.lightmaps=[];this.lightMapEncoding=this.onComplete=null;this.load=function(){var g=void 0!==c&&void 0!==c.encoding?c.encoding:"rgbm",k=void 0!==c&&void 0!==c.formats&&0<=c.formats.indexOf("webp");var h=Bc.webp&&k?"webp":"png";k=Mb.NEAREST;e.lightMapEncoding=g;h={id:null,name:null,stdExt:h,webFormats:["large/std"],alpha:!0,encoding:g};for(var l=0;l<b;l+=1){h.id=h.name="lightmap-"+g+l;var n=a.load(S.LOAD_PRIORITY.LIGHTMAP,
h,!1,!1,S.NO_ANISOTROPY);n.magFilter=k;n.minFilter=k;var p=void 0!==c&&void 0!==c.thresholds&&c.thresholds.length>l?c.thresholds[l]:0;n.ycocgmThreshold=p;n.encoding=g;n.addLoadedListener(d);e.lightmaps.push(n)}}};var em="cutoutMaskThreshold doubleSided name opacity parallaxCorrection parallaxMode parallaxScale parallaxMinLayers parallaxMaxLayers planarReflector".split(" "),fm="bumpScale cutoutMode emissive emissionStrength envMapProject metallic roughness alphaInLowerHalf chromaKeyEnabled".split(" "),gm="baseColor bumpScale bumpTexture doubleSided emissive metallic opacity roughness".split(" ");function hm(a,b,c){for(var d=0;d<b.length;d+=1){var e=b[d],f=a[e];void 0!==f&&(c["_"+e]=f)}}
function im(a,b,c){function d(k,h){if(h=h.baseColorTexture){if(h.atlasId){var l=b[h.atlasId].getAtlasEntry(h.id,h.name,h.atlasOffset[0],h.atlasOffset[1],h.atlasScale[0],h.atlasScale[1]);null!==l.rawExt&&l.rawExt!==h.rawExt&&console.warn("Atlas entries with not matching rawExt "+h.name);l.rawExt=h.rawExt;null!==l.stdExt&&l.stdExt!==h.stdExt&&console.warn("Atlas entries with not matching stdExt "+h.name);l.stdExt=h.stdExt;!1===h.importGpuCompress&&(l.importGpuCompress=!1);!1===h.importAutoScale&&(l.importAutoScale=
!1);h=l}else h=a.load(S.LOAD_PRIORITY.DIFFUSE,h,!0,!0,S.DEFAULT_ANISOTROPY);h.isCutout=null;k.baseColorTexture=h}}function e(k,h){h.baseColor&&(k.baseColor.fromArray(h.baseColor),k.baseColor.roundChannels())}function f(k,h){if(h=h.baseColorTextureCorrection){k._baseColorTextureCorrection=!0;void 0!==h.contrast&&(k._baseColorTextureContrast=h.contrast);var l=k.baseColorTextureHslAdjustment;h.hslAdjustment?(l.h=h.hslAdjustment[0],l.s=h.hslAdjustment[1],l.l=h.hslAdjustment[2]):(k=k.baseColor.getHSL(),
l.h=h.hslOffset[0],l.s=Math.max(-1,Math.min(h.hslOffset[1]/(0==k.s?1:k.s),4)),l.l=Math.max(-1,Math.min(h.hslOffset[2]/(0==k.l?1:k.l),4)))}}function g(k,h){h.uvOffsetScale&&(h=h.uvOffsetScale,k.setUvOffsetAndScale(h[0],h[1],h[2],h[3]))}this.load=function(k,h){for(var l=new Map,n=0,p=0;p<k.length;p+=1){a:{var r=k[p];var q=Rk(r.type);switch(q.type){case "grass":q.name=r.name;d(q,r);r.heightTexture&&(q.heightTexture=a.load(S.LOAD_PRIORITY.DIFFUSE,r.heightTexture,!0,!1,S.DEFAULT_ANISOTROPY));e(q,r);f(q,
r);r.grassHeight&&(q.grassHeight=r.grassHeight);r.grassLayers&&(q.grassLayers=r.grassLayers);r.grassDirection&&(q.grassDirection=r.grassDirection);g(q,r);r=q;break a;case "water":q.name=r.name;r.normalTexture&&(q.normalTexture=a.load(S.LOAD_PRIORITY.SPECULARITY,r.normalTexture,!0,!1,S.DEFAULT_ANISOTROPY));e(q,r);r.opacity&&(q.opacity=r.opacity);hm(r,["wavesSpeed","wavesScale","refractionFactor"],q);q.setUniforms();r=q;break a;default:La(r,em,q);q._reflective=void 0!==r.reflective?r.reflective:!(!r.roughnessTexture&&
1===r.roughness);hm(r,fm,q);e(q,r);f(q,r);d(q,r);r.roughnessTexture&&(q.roughnessTexture=a.load(S.LOAD_PRIORITY.SPECULARITY,r.roughnessTexture,!0,!0,S.DEFAULT_ANISOTROPY));r.metallicTexture&&(q.metallicTexture=a.load(S.LOAD_PRIORITY.SPECULARITY,r.metallicTexture,!0,!0,S.DEFAULT_ANISOTROPY));r.bumpTexture&&Bc.gl.standardDerivatives&&(q.bumpTexture=a.load(S.LOAD_PRIORITY.SPECULARITY,r.bumpTexture,!0,!0,S.DEFAULT_ANISOTROPY));r.doNotImport&&La(r.doNotImport,gm,q.doNotImport);var w=q,x=r;x.chromaKeyColor&&
(w.chromaKeyColor.fromArray(x.chromaKeyColor),w.chromaKeyColor.roundChannels());x.chromaKeyDelta&&w._chromaKeyDelta.fromArray(x.chromaKeyDelta);g(q,r);r=q}}if(!c.isMaterialEditable(r.name)){q=r.hash();w=l.get(q)||[];x=m.makeIterator(w);for(var t=x.next();!t.done;t=x.next())if(t=t.value,t.canMerge(r)){n+=1;t.merged=!0;r=t;break}r.merged||(w.push(r),l.set(q,w))}h.addMaterial(r);r.merged||r.setUniforms()}zc.log("Have "+k.length+" materials and "+(k.length-n)+" merged materials.")}};function jm(a,b,c){C.BufferAttribute.call(this,a,b);this._length=a.length;this.releaseOnLoadedToGpu=!0;this.divisor=c||0;this.glType=this.buffer=null}jm.prototype={constructor:jm,get length(){return this._length}};C.BufferGeometry.prototype.addTriangleOrderAttribute=function(){if(void 0===this.getAttribute("order")){for(var a=this.getAttribute("position").length/3,b=new Float32Array(a),c=0;c<a;c+=1)b[c]=c%3;this.addAttribute("order",new jm(b,1))}};
C.BufferGeometry.prototype.convertNormalsToSpherical=function(){console.assert(void 0===this.getAttribute("sphericalNormal"));var a=this.getAttribute("normal");console.assert(!a.buffer);a=a.array;for(var b=a.length/3,c=Bc.ios?new Int16Array(2*b):new Int8Array(2*b),d=0;d<b;d+=1){var e=3*d,f=2*d,g=Math.atan2(a[e+1],a[e])/Math.PI;c[f]=Ie(2*(Math.acos(a[e+2])/Math.PI-.5));c[f+1]=Ie(g)}delete this.attributes.normal;this.addAttribute("sphericalNormal",new jm(c,2))};
C.BufferGeometry.prototype.changePosition=function(a){var b=this.getAttribute("position"),c=b.length/3;b=b.array;for(var d=0;d<3*c;d+=3)b[d]+=a.x,b[d+1]+=a.y,b[d+2]+=a.z};C.BufferGeometry.prototype.clone=function(){console.error("WALK.BufferGeometry cloning not supported")};function km(a,b,c,d,e){c=new jm(c,d,e||0);a.addAttribute(b,c)}
function lm(){C.BufferGeometry.call(this);this.isInstanced=!1;this.instanceCount=0;this.index=null;this.indexUint=!0;this.uvs0=this.normals=this.vertices=null;this.isUvs0Repeating=!1;this.uvs1=null;this.vertexOffset=this.vertexCnt=this.indexOffset=this.indexCnt=0;this.boundingBox=new C.Box3;this.boundingSphere=new C.Sphere;this.gpuSize=0}lm.prototype=Object.create(C.BufferGeometry.prototype);lm.prototype.constructor=lm;
lm.prototype.allocateCoreBuffers=function(a){console.assert(!this.vertices);a&&(65536>=this.vertexCnt?(this.indexUint=!1,this.index=new Uint16Array(this.indexCnt),this.gpuSize+=2*this.indexCnt):(this.indexUint=!0,this.index=new Uint32Array(this.indexCnt),this.gpuSize+=4*this.indexCnt));this.vertices=new Float32Array(3*this.vertexCnt);this.gpuSize+=12*this.vertexCnt;this.normals=Bc.ios?new Int16Array(2*this.vertexCnt):new Int8Array(2*this.vertexCnt);this.gpuSize+=2*this.vertexCnt};
lm.prototype.addCoreAttributes=function(){this.index&&(km(this,"index",this.index,1),this.index=null);km(this,"position",this.vertices,3);this.vertices=null;km(this,"sphericalNormal",this.normals,2);this.normals=null};lm.prototype.allocateUv0=function(){console.assert(!this.uvs0);this.uvs0=new Float32Array(2*this.vertexCnt);this.gpuSize+=8*this.vertexCnt};lm.prototype.addUv0Attribute=function(){km(this,"uv",this.uvs0,2);this.uvs0=null};
lm.prototype.allocateUv1=function(){console.assert(!this.uvs1);this.uvs1=new Uint16Array(2*this.vertexCnt);this.gpuSize+=4*this.vertexCnt};lm.prototype.addUv1Attribute=function(){km(this,"uv2",this.uvs1,2);this.uvs1=null};lm.prototype.computeBoundingBox=void 0;lm.prototype.computeBoundingSphere=void 0;
function mm(a,b){C.BufferGeometry.call(this);this.parent=a;this.ownsGpuBuffers=b;this.isInstanced=!0;this.instanceCount=0;this.transforms2=this.transforms1=this.transforms0=this.uvs1Mod=null;this.vertexOffset=this.indexOffset=0;this.boundingBox=new C.Box3;this.boundingSphere=new C.Sphere;this._gpuSize=0}mm.prototype=Object.create(C.BufferGeometry.prototype);mm.prototype.constructor=mm;
mm.prototype.allocateCoreBuffers=function(a){console.assert(!this.transforms0);this.parent.vertices||this.parent.allocateCoreBuffers(a);a=4*this.instanceCount;this.transforms0=new Float32Array(a);this.transforms1=new Float32Array(a);this.transforms2=new Float32Array(a);this._gpuSize+=12*a};
mm.prototype.addCoreAttributes=function(){this.parent.attributes.position||this.parent.addCoreAttributes();for(var a=m.makeIterator(Object.keys(this.parent.attributes)),b=a.next();!b.done;b=a.next())b=b.value,this.addAttribute(b,this.parent.attributes[b]);km(this,"t0",this.transforms0,4,1);km(this,"t1",this.transforms1,4,1);km(this,"t2",this.transforms2,4,1);this.transforms2=this.transforms1=this.transforms0=null};mm.prototype.allocateUv0=function(){this.parent.uvs0||this.parent.allocateUv0()};
mm.prototype.addUv0Attribute=function(){this.parent.attributes.uv||this.parent.addUv0Attribute();this.addAttribute("uv",this.parent.attributes.uv)};mm.prototype.allocateUv1=function(){console.assert(!this.uvs1Mod);this.parent.uvs1||this.parent.allocateUv1();this.uvs1Mod=new Float32Array(4*this.instanceCount);this._gpuSize+=16*this.instanceCount};
mm.prototype.addUv1Attribute=function(){this.parent.attributes.uv2||this.parent.addUv1Attribute();this.addAttribute("uv2",this.parent.attributes.uv2);km(this,"uv2Mod",this.uvs1Mod,4,1);this.uvs1Mod=null};mm.prototype.computeBoundingBox=void 0;mm.prototype.computeBoundingSphere=void 0;Object.defineProperty(mm.prototype,"index",{get:function(){return this.parent.index}});Object.defineProperty(mm.prototype,"vertices",{get:function(){return this.parent.vertices}});
Object.defineProperty(mm.prototype,"normals",{get:function(){return this.parent.normals}});Object.defineProperty(mm.prototype,"uvs0",{get:function(){return this.parent.uvs0}});Object.defineProperty(mm.prototype,"uvs1",{get:function(){return this.parent.uvs1}});Object.defineProperty(mm.prototype,"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(mm.prototype,"vertexCnt",{get:function(){return this.parent.vertexCnt},set:function(a){this.parent.vertexCnt=a}});
Object.defineProperty(mm.prototype,"indexCnt",{get:function(){return this.parent.indexCnt},set:function(a){this.parent.indexCnt=a}});Object.defineProperty(mm.prototype,"gpuSize",{get:function(){return this.ownsGpuBuffers?this._gpuSize+this.parent.gpuSize:this._gpuSize}});Object.defineProperty(mm.prototype,"isUvs0Repeating",{get:function(){return this.parent.isUvs0Repeating},set:function(a){this.parent.isUvs0Repeating=a}});
function nm(a,b,c,d,e,f,g){C.BufferGeometry.call(this);this.indexCnt=a;this.vertexCnt=b;this.parent=c;this.vertexOffset=e;this.indexOffset=d;this.boundingBox=f;this.boundingSphere=g;this.isInstanced=c.isInstanced;this.instanceId=0;this.instanceCount=1}nm.prototype=Object.create(C.BufferGeometry.prototype);nm.prototype.constructor=nm;Object.defineProperty(nm.prototype,"attributes",{set:function(){},get:function(){return this.parent.attributes}});
Object.defineProperty(nm.prototype,"attributesKeys",{set:function(){},get:function(){return this.parent.attributesKeys}});Object.defineProperty(nm.prototype,"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(nm.prototype,"isUvs0Repeating",{get:function(){return this.parent.isUvs0Repeating}});nm.prototype.computeBoundingBox=void 0;nm.prototype.computeBoundingSphere=void 0;nm.prototype.addTriangleOrderAttribute=function(){this.parent.addTriangleOrderAttribute()};function om(a,b,c){this._visible=!0;C.Mesh.call(this,b,c);this.node=a;this.useFaces16=!1;this.quantUv0Max=this.quantUv0Range=this.quantVertexMax=this.quantVertexRange=this.transformByteOffset=this.uv1CoordVOffset=this.uv1CoordUOffset=this.uv1CoordVScale=this.uv1CoordUScale=this.lightMapIdx=this.uv1ByteOffset=this.uv0ByteOffset=this.normalByteOffset=this.vertexCnt=this.vertexByteOffset=this.faceCnt=this.faceByteOffset=0;this.lightMap=null;this.autoLightmapResolution=-1;this.lightProbes=[];this.matrixAutoUpdate=
this.rotationAutoUpdate=!1;this.selected=this.highlightMix=null;this.selectedSecondary=!1;this.visibilityId=null;this.cameraDistance=0;var d=this.matrix=this.matrixWorld=null;Object.defineProperty(this,"matrixWorld",{get:function(){return d||this.node.animationMatrix},set:function(e){d=e}});this.sharedBuffersDebug=0;this._mergedMesh=null}om.prototype=Object.create(C.Mesh.prototype);om.prototype.constructor=om;om.prototype.clone=void 0;om.prototype.updateMatrixWorld=function(){};
om.prototype.uv0InBuffers=function(){return-1!==this.uv0ByteOffset};om.prototype.uv1InBuffers=function(){return-1!==this.uv1ByteOffset};om.prototype.quantVertexFactor=function(){return this.quantVertexRange/this.quantVertexMax};om.prototype.quantUv0Disabled=function(){return 0===this.quantUv0Max};om.prototype.quantUv0Factor=function(){return this.quantUv0Range/this.quantUv0Max};Object.defineProperty(om.prototype,"hideInViews",{get:function(){return this.node.hideInViews},set:function(){console.assert(!1)}});
Object.defineProperty(om.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this._mergedMesh&&!S.EDIT_MODE&&(this._mergedMesh.visible=a))}});
function pm(a,b){this._visible=!0;C.Mesh.call(this,a,b);this.anyLogicalMeshHasUvs=!1;this.lightMap=null;this.lightProbes=[];this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.hideInViews=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.center=null;this.cameraDistance=0;this.editableRootNode=this.matrix=this.matrixWorld=null;Object.defineProperty(this,"matrixWorld",{get:function(){return this.editableRootNode?this.editableRootNode.mesh?this.editableRootNode.mesh.matrixWorld:this.editableRootNode.animationMatrix:
null},set:function(){console.assert("Cannot set matrixWorld for a merged mesh. The mesh needs to be marked as editable to prevent merging.")}});this.logicalMeshes=[]}pm.prototype=Object.create(C.Mesh.prototype);pm.prototype.constructor=pm;pm.prototype.clone=void 0;pm.prototype.updateMatrixWorld=function(){};pm.prototype.addLogicalMesh=function(a){this.logicalMeshes.push(a);a._mergedMesh=this};
Object.defineProperty(pm.prototype,"visible",{get:function(){return this._visible},set:function(a){if(a!==this._visible){this._visible=a;for(var b=0;b<this.logicalMeshes.length;b+=1)this.logicalMeshes[b]._visible=a}}});function qm(a,b,c,d){b/=4;for(var e=0;6>e;++e)if(!isFinite(a[b+e]))return;c.max.x=a[b];c.max.y=a[b+1];c.max.z=a[b+2];c.min.x=a[b+3];c.min.y=a[b+4];c.min.z=a[b+5];c.center(d.center);d.radius=a[b+6]}function rm(a,b,c,d,e,f){this.meshPropsSet=new Set;this.meshPropsSet.add(a);this.material=b;this.lightMap=c;this.lightProbe=d;this.hideInViews=e;this.editableRootNode=f;this.anyLogicalMeshHasUvs=-1!==a.uv0ByteOffset;this.sharedGeometryId=a.useInstances?a.vertexByteOffset:null}
rm.prototype.canUseLightMap=function(a){return null===this.lightMap||null===a||this.lightMap===a};
function sm(a,b,c,d){function e(p){var r=[],q=new Map;g.forEach(function(w){var x=a.findNode(w.nodeId),t=a.materials[w.materialIdx],A=null;null!==x.initialLightProbeId&&(A=a.findLightProbe(x.initialLightProbeId));var D=null;-1!==w.lightMapIdx&&(D=p[w.lightMapIdx]);var H=x.hideInViews||[],G=x.editableRoot;x=x.editable||1!==t.opacity;t.reflective&&.2>t.roughness&&(x=!0);if(x)r.push(new rm(w,t,D,A,H,G));else{var K=w.useInstances?w.vertexByteOffset:null;x=q.get(t)||[];for(var W=m.makeIterator(x),O=W.next();!O.done;O=
W.next())if(O=O.value,O.lightProbe===A&&O.editableRootNode===G&&O.canUseLightMap(D)&&O.sharedGeometryId===K&&Ve(O.hideInViews,H)){null!==D&&(O.lightMap=D);O.anyLogicalMeshHasUvs=O.anyLogicalMeshHasUvs||-1!==w.uv0ByteOffset;O.meshPropsSet.add(w);return}w=new rm(w,t,D,A,H,G);x.push(w);q.set(t,x);r.push(w)}});return r}var f=this,g=[],k=b.byteLength,h=0,l=0,n=0;this.mergedMeshes=[];this.lightmapCount=this.geometryDownloadSize=this.coreGeometryDownloadSize=0;this.encodedUsingMeshOpt=!1;this.createMeshes=
function(p){var r=p?p[0]:null,q=e(p);p={};q=m.makeIterator(q);for(var w=q.next();!w.done;w=q.next()){var x=w.value;w=x.sharedGeometryId;if(null!==w){var t=p[w],A=!1;t||(t=new lm,A=!0,p[w]=t);w=new mm(t,A)}else w=new lm;t=new pm(w,x.material);t.lightProbe=x.lightProbe;t.lightMap=x.lightMap||r;t.hideInViews=x.hideInViews;t.anyLogicalMeshHasUvs=x.anyLogicalMeshHasUvs;t.editableRootNode=x.editableRootNode;this.mergedMeshes.push(t);x=m.makeIterator(x.meshPropsSet);for(A=x.next();!A.done;A=x.next()){A=
A.value;var D,H=w;if(d){var G=3*A.faceCnt;var K=A.vertexCnt}else G=0,K=3*A.faceCnt;if(H.isInstanced)var W=D=0;else D=H.indexCnt,W=H.vertexCnt;W=new nm(G,K,H,D,W,A.boundingBox,A.boundingSphere);H.boundingBox.union(A.boundingBox);Ke(A.boundingSphere,H.boundingSphere);H.isInstanced?(W.instanceId=H.instanceCount,H.instanceCount+=1,H.indexCnt=G,H.vertexCnt=K):(H.indexCnt+=G,H.vertexCnt+=K);G=W;K=a.findNode(A.nodeId);G=new om(K,G,t.material);G.lightMap=t.lightMap;G.lightProbe=t.lightProbe;G.autoLightmapResolution=
A.autoLightmapResolution;G.useFaces16=A.useFaces16;G.faceByteOffset=A.faceByteOffset;G.faceCnt=A.faceCnt;G.vertexByteOffset=A.vertexByteOffset;G.vertexCnt=A.vertexCnt;G.normalByteOffset=A.normalByteOffset;G.uv0ByteOffset=A.uv0ByteOffset;G.uv1ByteOffset=A.uv1ByteOffset;G.lightMapIdx=A.lightMapIdx;G.uv1CoordUScale=A.uv1CoordUScale;G.uv1CoordVScale=A.uv1CoordVScale;G.uv1CoordUOffset=A.uv1CoordUOffset;G.uv1CoordVOffset=A.uv1CoordVOffset;G.transformByteOffset=A.transformByteOffset;G.quantVertexRange=A.quantVertexRange;
G.quantVertexMax=A.quantVertexMax;G.quantUv0Range=A.quantUv0Range;G.quantUv0Max=A.quantUv0Max;A.hasCopies&&(G.sharedBuffersDebug=A.isMasterCopy?1:2);h+=1;t.addLogicalMesh(G);K.mesh=G}}zc.log("Have "+h+" meshes and "+this.mergedMeshes.length+" merged meshes.")};(function(p,r,q){var w=new Int32Array(p);p=new Float32Array(p);r=new Float32Array(r);var x={},t=w[0];f.encodedUsingMeshOpt=3<=t;for(var A=w[1],D=2;D<w.length;D+=A){var H={nodeId:w[D],materialIdx:w[D+1],useFaces16:1===w[D+2],faceByteOffset:w[D+
3],faceCnt:w[D+4],vertexByteOffset:w[D+5],vertexCnt:w[D+6],normalByteOffset:w[D+7],uv0ByteOffset:w[D+8],uv1ByteOffset:w[D+9],lightMapIdx:w[D+10],uv1CoordUScale:p[D+11],uv1CoordVScale:p[D+12],uv1CoordUOffset:w[D+13],uv1CoordVOffset:w[D+14],transformByteOffset:w[D+15],boundsByteOffset:w[D+16],quantVertexRange:p[D+17],quantVertexMax:w[D+18],quantUv0Range:p[D+19],quantUv0Max:w[D+20],autoLightmapResolution:2<=t?w[D+21]:-1,useInstances:!1,hasCopies:!1,isMasterCopy:!1};H.boundingBox=new C.Box3;H.boundingSphere=
new C.Sphere;qm(r,H.boundsByteOffset,H.boundingBox,H.boundingSphere);f.lightmapCount=Math.max(f.lightmapCount,H.lightMapIdx+1);if(Bc.gl.instances){var G=H.vertexByteOffset;if(x.hasOwnProperty(G)){G=x[G];var K=G[0];K.isMasterCopy=!0;K.hasCopies=!0;H.hasCopies=!0;G.push(H)}else x[G]=[H]}q.push(H)}q=m.makeIterator(Object.values(x));for(w=q.next();!w.done;w=q.next())w=w.value,500<(w.length-1)*w[0].faceCnt&&w.forEach(function(W){return W.useInstances=!0})})(b,c,g);(function(){for(var p=0,r=0,q=0,w=0,x=
0,t=0,A=0,D=m.makeIterator(g),H=D.next();!H.done;H=D.next()){H=H.value;var G=H.vertexCnt;l+=G;n+=H.faceCnt;p=Math.max(p,H.faceByteOffset+3*H.faceCnt*(H.useFaces16?2:4));r=Math.max(r,H.vertexByteOffset+3*G*Je(H.quantVertexMax)+3&-4);q=Math.max(q,H.normalByteOffset+2*G);w=Math.max(w,H.transformByteOffset+64);x=Math.max(x,H.boundsByteOffset+28);-1!==H.uv0ByteOffset&&(t=Math.max(t,H.uv0ByteOffset+2*G*Je(H.quantVertexMax)+3&-4));-1!==H.uv1ByteOffset&&(A=Math.max(A,H.uv1ByteOffset+4*G))}f.coreGeometryDownloadSize=
k+p+r+q+w+x;f.geometryDownloadSize+=f.coreGeometryDownloadSize+t+A})();zc.log("Have "+l+" vertices, "+n+" faces and "+this.lightmapCount+" lightmaps.")};function tm(a,b){this.atlases={};this.load=function(c){for(var d=0;d<c.length;++d){var e=a.load(S.LOAD_PRIORITY.DIFFUSE,c[d],!1,!0,S.DEFAULT_ANISOTROPY);e.flipY=!1;e.enableAtlas(b);this.atlases[c[d].id]=e}}};function um(a,b){a.forEach(function(c){b.addView(new Kg(c))})}function vm(a){if(0!==a.length&&a[0].position)return a[0].position[2]}function wm(a,b,c){a.forEach(function(d){c.isNodeTypeEditable(d.name)&&(d.editable=!0);b.addNodeConfig(new Xk(d))})}function xm(a,b){a.forEach(function(c){var d=new Gg(c);c=c.instances;for(var e=0;e<c.length;e+=1){var f=c[e];d.addInstance(f.position,f.rotation)}b.addLight(d)})}function ym(a,b){a.forEach(function(c){b.addLightProbe(new Hg(c))})}
function zm(a,b,c){c=c.camera;a&&(a.fov&&(c.defaultFov=a.fov),a.exposure&&(c.defaultExposure=a.exposure),a.gamma&&(c.defaultGamma=a.gamma),a.lutTexture&&(b=b.load(S.LOAD_PRIORITY.COLORMAP,a.lutTexture,!1,!1,S.NO_ANISOTROPY),b.flipY=!1,c.colorMap=b),void 0!==a.lutIntensity&&(c.colorMapIntensity=a.lutIntensity),a.toneMapping&&(c.toneMapping=a.toneMapping),c.autoPath=!!a.autoPath,c.autoClimb=!!a.autoClimb,c.autoExposure=!!a.autoExposure,c.fixedHeight=a.fixedHeight,c.motionBlurEnabled=!!a.motionBlurEnabled||
S.FORCE_MOTION_BLUR,void 0!==a.motionBlurIntensity&&(c.motionBlurIntensity=a.motionBlurIntensity),void 0!==a.autoExposureDarkness&&(c.autoExposureDarkness=a.autoExposureDarkness),void 0!==a.moveMaxSpeed&&(c.moveMaxSpeed=a.moveMaxSpeed),c.updateProjectionMatrix())}function Am(a,b){function c(d,e){var f=b.findNodeConfig(e.config),g=new al(d,f,e);void 0!==e.children&&(g.children=e.children.map(function(k){return c(g,k)}));return g}a.forEach(function(d){b.addNode(c(null,d))})}
function Bm(){var a=null;Bc.whatsApp?a="WhatsApp":Bc.facebookApp&&(a="Facebook app");null===a?Cc.error("Scene failed to load. Reload the page to retry."):Cc.error("Scene failed to load. Open the scene outside of "+a+" by copying the link to the native web browser: <div class='message-scrollable-line'><a href='"+(window.location+"' target='_blank'>"+window.location+"</a></div>"))}
function Cm(a,b,c,d,e){var f=!c&&Bc.gl.indexUint,g=!c&&!S.DEBUG_SHARED_BUFFERS,k=new Fd;this.onComplete=this.onReadyToDisplay=this.onTextureLoaded=this.onMeshBuffersLoaded=this.onProgress=null;this.panoramas=[];this.load=function(){function h(){if(void 0!==Q.total)O.onProgress(Q)}function l(){V||(V=!0,O.onReadyToDisplay(a))}function n(Z){0===Z.name.indexOf("lightmap-")?Q.texturesDone+=12582912:Q.texturesDone+=524288;h();O.onTextureLoaded(Z);ia()}function p(){console.warn("Failed to load video texture");
ia()}function r(){if(0===ea.texturesToLoad&&na&&T){ea.clearCache();for(var Z=0,ka=m.makeIterator(va.mergedMeshes),ma=ka.next();!ma.done;ma=ka.next())Z+=ma.value.geometry.gpuSize;zc.log("Total GPU geometry buffers size "+Z+" bytes");ea=ra=va=null;setTimeout(function(){l();O.onComplete(a)},0)}}function q(){P&&pa&&I&&(ia=r,J&&a.setLightMapEncoding(aa),ia())}function w(Z){Z.geometry.addUv1Attribute();O.onMeshBuffersLoaded(Z)}function x(){ra.buffers.uvs1&&(ia=q,Xl(ra.buffers.uvs1,va.mergedMeshes,va.encodedUsingMeshOpt,
ad,w,function(){ra.buffers.uvs1=null;P=!0;ia()}))}function t(Z){Z.geometry.isUvs0Repeating&&Z.material.ensureTexturesRepeatable();Z.geometry.addUv0Attribute();O.onMeshBuffersLoaded(Z)}function A(){ra.buffers.uvs0&&(ia=x,Vl(ra.buffers.uvs0,va.mergedMeshes,t,function(){ra.buffers.uvs0=null;T=!0;ia()}))}function D(){I=!0;0===a.views.length&&a.addView(new Kg({id:0,name:"Start place",hideFromMenu:!0,position:a.center.toArray(),rotation:[0,0],internal:!0,sky:S.EDITOR_CONTROLLED_SKY_NAME}));if(!c&&!a.disableProgressiveLoader){var Z=
1E3*S.PROGRESSIVE_LOADER_AFTER_SEC-k.elapsedMSec();0>=Z?l():setTimeout(l,Z)}ia()}function H(Z){a.addGpuMesh(Z)}function G(Z){Z.geometry.addCoreAttributes();var ka=Z.logicalMeshes;console.assert(!ka[0].node.editable||1===ka.length);ka[0].node.editable||!g?ka.forEach(H):H(Z);O.onMeshBuffersLoaded(Z)}function K(Z){Z.geometry.isUvs0Repeating&&Z.material.ensureTexturesRepeatable();Z.geometry.uvs0&&Z.geometry.addUv0Attribute();Z.geometry.uvs1&&Z.geometry.addUv1Attribute();G(Z)}function W(){if(f){if(!ra.haveCoreBuffers())return;
zc.log("Using indexed geometry");ia=A;$l(ra.buffers,va.mergedMeshes,va.encodedUsingMeshOpt,ad,G,D)}else{if(!ra.haveAllBuffers())return;ia=q;cm(ra.buffers,va.mergedMeshes,va.encodedUsingMeshOpt,ad,K,function(){P=T=!0;D()})}ra&&ra.releaseCoreBuffers()}var O=this,ea=null,ra=null,va=null,I=!1,V=!1,pa=!1,T=!1,P=!1,ca=null,J=!1,aa=null,na=!1,L=!1,Q={total:void 0,texturesDone:0,totalDone:function(){return this.texturesDone+ra.totalDone()}};k.reset();var ia=function(){if(ca&&ra.buffers.meshes&&ra.buffers.bounds&&
L){ia=W;void 0!==ca.autoAddLightProbes&&(a.autoAddLightProbes=ca.autoAddLightProbes);a.disableProgressiveLoader=ca.disableProgressiveLoader||!1;ca.interactionPrompt&&(a.interactionPrompt=ca.interactionPrompt);void 0!==ca.autoTour&&(a.autoTour.disabled=ca.autoTour.disabled||!1,a.autoTour.startOnLoad=ca.autoTour.startOnLoad||!1);xm(ca.lights,a);ym(ca.lightProbes||[],a);ea=new fh(b,Bc,n,Bm,p,!1,!0);zm(ca.camera,ea,a);ca.cameraVolumes&&ca.cameraVolumes.forEach(function(M){a.addCameraAdjustmentVolume(new Cg(M,
a.camera))});var Z=new tm(ea,e);Z.load(ca.atlases||[]);(new im(ea,Z.atlases,d)).load(ca.materials||[],a);a.lightmapLayoutVersion=ca.lightmap?ca.lightmap.lightmapLayoutVersion:0;a.lightmapLayoutVersion=a.lightmapLayoutVersion||0;(new Pg(ea)).load(ca.skies||[],a);null===a.findSkyMesh(S.EDITOR_CONTROLLED_SKY_NAME)&&console.error("A sky with name "+S.EDITOR_CONTROLLED_SKY_NAME+" is missing.");um(ca.views||[],a);ca.hideViewsMenu&&(a.hideViewsMenu=!0);wm(ca.nodeConfigs,a,d);Am(ca.nodes,a);va=new sm(a,ra.buffers.meshes,
ra.buffers.bounds,f);Z=null;if(0!==va.lightmapCount){J=!0;var ka=new dm(ea,va.lightmapCount,ca.lightmap);ka.onComplete=function(){pa=!0;ia()};ka.load();aa=ka.lightMapEncoding;Z=ka.lightmaps;ka=null}else pa=!0;va.createMeshes(Z);Q.total=va.geometryDownloadSize+524288*(ea.texturesToLoad-va.lightmapCount)+12582912*va.lightmapCount;ca.panoramas&&(O.panoramas=ca.panoramas);a.minimapConfig=new Vk(ca.minimap,a.boundingBox,vm(ca.views||[]));if(Bc.ios&&!Bc.webp||S.NO_PBR)na=!0;else{var ma=bl(Bm);ma.addLoadedListener(function(){a.addBrdfLUT(ma);
na=!0;ia()})}ca=null;ia()}};Rc(S.LOAD_PRIORITY.CORE_RESOURCE,b+"scene.json",!1,function(Z){ca=Z;ia()},Bm);ra=new cl(b,!f);ra.onProgress=h;ra.onFailure=Bm;ra.onHaveBuffer=function(){ia()};ra.load();(function(){ad.ready.then(function(){L=!0;ia()})})()};this.elapsedLoadTimeSec=function(){return k.elapsedSec()}};function Dm(){function a(n){e.appendChild(n.dom);return n}function b(n){for(var p=0;p<e.children.length;p++)e.children[p].style.display=p===n?"block":"none";c=n}var c=0,d=null,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";e.addEventListener("click",function(n){n.preventDefault();b(++c%e.children.length)},!1);var f=(performance||Date).now(),g=f,k=0,h=a(new Dm.Panel("FPS","#0ff","#002")),l=a(new Dm.Panel("MS","#0f0","#020"));self.performance&&
self.performance.memory&&(d=a(new Dm.Panel("MB","#f08","#201")));b(0);return{REVISION:16,dom:e,addPanel:a,showPanel:b,begin:function(){f=(performance||Date).now()},end:function(){k++;var n=(performance||Date).now();l.update(n-f,200);if(n>=g+1E3&&(h.update(1E3*k/(n-g),100),g=n,k=0,d)){var p=performance.memory;d.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return n},update:function(){f=this.end()},domElement:e,setMode:b}}
Dm.Panel=function(a,b,c){var d=Infinity,e=0,f=Math.round,g=f(window.devicePixelRatio||1),k=100*g,h=48*g,l=3*g,n=2*g,p=3*g,r=15*g,q=94*g,w=30*g,x=document.createElement("canvas");x.width=k;x.height=h;x.style.cssText="width:100px;height:48px";var t=x.getContext("2d");t.font="bold "+9*g+"px Helvetica,Arial,sans-serif";t.textBaseline="top";t.fillStyle=c;t.fillRect(0,0,k,h);t.fillStyle=b;t.fillText(a,l,n);t.fillRect(p,r,q,w);t.fillStyle=c;t.globalAlpha=.9;t.fillRect(p,r,q,w);return{dom:x,update:function(A,
D){d=Math.min(d,A);e=Math.max(e,A);t.fillStyle=c;t.globalAlpha=1;t.fillRect(0,0,k,r);t.fillStyle=b;t.fillText(f(A)+" "+a+" ("+f(d)+"-"+f(e)+")",l,n);t.drawImage(x,p+g,r,q-g,w,p,r,q-g,w);t.fillRect(p+q-g,r,g,w);t.fillStyle=c;t.globalAlpha=.9;t.fillRect(p+q-g,r,g,f((1-A/D)*w))}}};function Em(a){var b=new Dm;b.showPanel(0);var c=null,d=null,e=null;S.BENCHMARK&&(c=new Hd(a,S.BENCHMARK),d=b.addPanel(new Dm.Panel("RenderMS","#ff8","#221")),e=b.addPanel(new Dm.Panel("ApproxFPS","#ff8","#221")));document.body.appendChild(b.dom);this.begin=function(){S.BENCHMARK&&c.begin();b.begin()};this.end=function(){S.BENCHMARK&&(c.end(),d.update(c.lastMS,100),e.update(c.lastFPS,100));b.end()}};function Fm(a,b){a=document.getElementsByClassName(a);for(var c=0;c<a.length;c+=1)b(a[c])}function Gm(a){var b=[];Fm(a,function(d){b.push(d)});for(var c=0;c<b.length;c+=1)b[c].classList.remove(a)}function Hm(a,b){a.style.display=b?"":"none"}function Im(a,b){Hm(gh(a),b)}function Jm(a,b){Fm(a,function(c){Hm(c,b)})}function Km(a){Hm(a,!0);a.style.opacity=0;setTimeout(function(){a.style.opacity=1},0)}
function Lm(){var a=document.getElementById("qr-code-canvas");a?a.remove():(a=document.createElement("canvas"),a.setAttribute("id","qr-code-canvas"),document.body.appendChild(a),QRCode.toCanvas(a,window.location.toString()))}function Mm(a){a.style.opacity=0;var b=window.getComputedStyle(a).transitionDuration;if(b){var c=parseFloat(b);-1===b.indexOf("ms")&&(c*=1E3);setTimeout(function(){Hm(a,!1);a.style.opacity=1},c)}else Hm(a,!1),a.style.opacity=1}
function Nm(a,b,c,d,e){function f(X){var Y=null===ca?[]:ca.visibleViews();return Y.length>X?Y[X]:null}function g(X){if(X){var Y=null===ca?[]:ca.visibleViews(),qa;for(qa=0;qa<Y.length&&Y[qa]!==X;qa+=1);X=gh("view-list-items").children;if(qa<X.length)return X[qa]}return null}function k(X){return function(){X.classList.remove("active-view");X.classList.remove("next-active-view")}}function h(){for(var X=gh("view-list-items").children,Y=0;Y<X.length;Y+=1)X[Y].classList.remove("active-view"),X[Y].classList.remove("next-active-view")}
function l(){gh("tour-button").classList.add("tour-on")}function n(){gh("tour-button").classList.remove("tour-on");h()}function p(){aa.isRunning()?aa.stop():aa.start()}function r(){return aa.isRunning()?(aa.stop(),!0):!1}function q(X){h();(X=g(X.view))&&X.classList.add("next-active-view")}function w(X){if(X=g(X.view))X.classList.remove("next-active-view"),X.classList.add("active-view"),setTimeout(k(X),S.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)}function x(X){return ih(function(){var Y=r();J.switchToView(X,
Y?0:void 0)})}function t(){var X=gh("info-bar"),Y=gh("info-bar-slide"),qa=gh("view-list"),za=gh("view-list-slide"),Ka=gh("menu-bar"),Ba=gh("menu-bar-slide"),Ea=gh("menu-bar-folder");Hm(Ea,ca&&!Z);if(T.visible){X.style.pointerEvents=null;Y.style.left=0;qa.style.pointerEvents=null;za.style.top=0;Ka.style.pointerEvents=null;Ba.style.right=0;Ea.style.pointerEvents=null;Ea.children[0].style.transform="";if(null!==T.cover){Ka=T.cover.title;za=T.cover.author;Ba=T.cover.authorHref;qa=T.cover.engineLogoOn;
X=T.cover.engineLogoText;Y=T.cover.engineLogoUrl;Ea=T.cover.authorLogoUrl;T.cover.authorLogo&&(Ea=tb(T.cover.authorLogo.path));var Ga=gh("author-logo"),Da=Ga.firstElementChild;Ea?(Ba&&(Ga.href=Ba),Da.src=Ea):(Hm(Ga,!1),Da.removeAttribute("src"));Ea=null===ca||null!==ja;Im("info-text",Ea&&(Ka||za));Ea&&(Sa(gh("info-title"),Ka),Sa(gh("info-author"),za),Ba&&(gh("info-author").href=Ba));Ka=Ka?Ka:"3D scene";za&&(Ka+=" by "+za);document.title=Ka;za=gh("engine-logo");Hm(za,qa);qa&&(X&&(qa=gh("engine-logo-text"),
Hm(qa,!0),Sa(qa,X)),Y&&(za.href=Y))}X=null===ca?[]:ca.visibleViews();Y=gh("view-list-items");Im("view-list",0<X.length&&!Z);if(0<X.length){qa=Y.children[0];for(k(qa)();1!==Y.children.length;)Y.removeChild(Y.children[Y.children.length-1]);for(za=0;za<X.length;za+=1)Ka=X[za],Ka.hideFromMenu||(Sa(qa,Ka.name),qa.onclick=x(Ka),Y.appendChild(qa),qa=qa.cloneNode(!0))}Im("menu-buttons",ca&&!Z);ca&&ca.canStartAutoTour()&&!ka?Im("tour-button",!0):(aa&&aa.isRunning()&&aa.stop(),Im("tour-button",!1))}else Ga=
gh("menu-bar-content"),X.style.pointerEvents="none",Y.style.left=-Y.offsetWidth+"px",qa.style.pointerEvents="none",za.style.top=-za.offsetHeight+"px",Ka.style.pointerEvents="none",Ea.style.pointerEvents="auto",Ba.style.right=-Ga.offsetWidth+"px",Ea.children[0].style.transform="rotate(180deg)";X=T.helpVisible;Bc.mobile?Im("mobile-help",X):(Im("desktop-help",X),X&&(X=gh("desktop-help-switch"),Y=gh("desktop-help-content"),qa=fa?1:0,X.children[qa].classList.add("selected"),Hm(Y.children[qa],!0),X.children[1-
qa].classList.remove("selected"),Hm(Y.children[1-qa],!1)))}function A(){T.visible=!ma}function D(){T.helpVisible=!M}function H(){fa=!1;t()}function G(){fa=!0;t()}function K(){var X=r();J.switchToPreviousVisibleView(X?0:void 0)}function W(){var X=r();J.switchToNextVisibleView(X?0:void 0)}function O(){var X=gh("interaction-prompt");X&&(ta=!0,Km(X))}function ea(){ta&&(ta=!1,Mm(gh("interaction-prompt")))}function ra(X){ea();if(!(X.ctrlKey||X.altKey||X.metaKey)){var Y=X.target||X.srcElement;Y=Y.nodeType===
Node.ELEMENT_NODE?Y.nodeName.toUpperCase():"";if(!/INPUT|SELECT|TEXTAREA/.test(Y))if(67===X.keyCode&&S.DEBUG)X.shiftKey?Bc.gl.extension("WEBGL_lose_context").restoreContext():Bc.gl.extension("WEBGL_lose_context").loseContext();else if(S.DEBUG&&82==X.keyCode&&Om(),null!==ca){switch(X.keyCode){case 27:r();break;case 70:Q&&d();break;case 76:ia&&e();break;case 72:D();break;case 77:A();break;case 86:L&&c();break;case 80:S.NO_SCREENSHOTS||(X.shiftKey?na.monoScreenToLocalImage(!0,4E3,2E3):na.monoScreenToLocalImage(!1,
window.innerWidth,window.innerHeight));break;case 85:Ic(ob("lib/qrcode.js"),Lm,function(){return Cc.error("Cannot load required library")});break;case 219:K();break;case 221:W()}Y=X.keyCode-48;1<=Y&&9>=Y&&(Y=f(Y-1),null!==Y&&x(Y)(X))}}}function va(){ea()}function I(){ea()}function V(){ea()}function pa(X){ea();switch(X.action){case Af.PREVIOUS:K();break;case Af.NEXT:W()}}var T=this,P={type:"visibilityChanged"},ca=null,J=null,aa=null,na=null,L=!1,Q=!1,ia=!1,Z=!1,ka=!1,ma=!0,M=!1,fa=!1,ja=null,ta=!1;
this.cover=null;Object.defineProperty(this,"visible",{get:function(){var X=ka&&Bc.mobile;return ma&&!X},set:function(X){var Y=this.visible;ma=X;Y!==this.visible&&this.dispatchEvent(P);t()}});Object.defineProperty(this,"helpVisible",{get:function(){var X=ka&&Bc.mobile;return M&&!X&&!Z},set:function(X){M=X;t()}});this.updateCover=function(X){this.cover=X;null!==ja&&clearTimeout(ja);ja=setTimeout(function(){ja=null;t()},5E3);t()};this.refresh=function(){t()};this.onFullScreenChange=function(){};this.onPointerLockChange=
function(X){Z=X;t()};this.onVrChange=function(X){var Y=this.visible;ka=X;Y!==this.visible&&this.dispatchEvent(P);t()};this.onResize=function(){if(!this.visible){var X=gh("info-bar-slide"),Y=gh("menu-bar-slide"),qa=gh("view-list-slide");X.style.transition="none";Y.style.transition="none";qa.style.transition="none";t();X.style.transition="";Y.style.transition="";qa.style.transition=""}};this.enablePlayButton=function(X){var Y=gh("play-button");Y.addEventListener("click",X);Hm(Y,!0)};this.setVrSupported=
function(X){L=X;Jm("vr-specific",X)};this.setFullScreenSupported=function(){(Q=!a)&&Jm("fullscreen-specific",!0)};this.setPointerLockSupported=function(){ia=!a};this.addExtraButton=function(X){var Y=gh("tour-button"),qa=document.createElement("img");qa.src=X;X=document.createElement("div");X.className="menu-button menu-item ui-hoverable ui-panel";X.appendChild(qa);Y.parentNode.insertBefore(X,Y);return X};this.removeExtraButton=function(X){X.remove()};this.getExtraButonIcon=function(X){return X.firstElementChild};
this.sceneLoadStarted=function(){Im("play-button",!1);Im("primary-progress",!0)};this.loadProgress=function(X){X=X.totalDone()/X.total;if(null===ca){var Y=Math.max(314.159*(1-X),0);gh("primary-progress-done").style.strokeDashoffset=Y}X=Math.floor(100*X);gh("secondary-progress-done").style.width=X+"%"};this.sceneReadyToDisplay=function(X,Y,qa,za){ca=X;J=Y;J.addEventListener("teleportStarted",q);J.addEventListener("teleportDone",w);aa=qa;aa.addEventListener("tourStarted",l);aa.addEventListener("tourStopped",
n);na=za;Mm(gh("cover-image"));Mm(gh("primary-progress"));Km(gh("secondary-progress"));X=Dg;!ca.interactionPrompt||M||S.EDIT_MODE||(X._isMeeting()?X._onMeetingJoined(function(){return O()}):O());ca.addEventListener("viewAdded",t);ca.addEventListener("viewRemoved",t);ca.addEventListener("viewShifted",t);document.body.style.backgroundImage="none";document.body.style.backgroundColor="#000";t()};this.sceneLoadComplete=function(){Im("secondary-progress",!1)};this.init=function(){a&&(Jm("viewer-specific",
!1),Jm("editor-specific",!0));Fm("ui-panel",function(qa){lh(qa)});Bc.mobile&&Gm("ui-hoverable");var X=gh("author-logo"),Y=X.firstElementChild;Y.onload=function(){Hm(X,!0)};Y.onerror=function(){Hm(X,!1)};document.addEventListener("keydown",ra,!1);document.addEventListener("mousedown",va,!1);document.addEventListener("wheel",I,!1);document.addEventListener("touchstart",V,!1);kh("help-button",D);kh("fullscreen-button",d);kh("vr-button",c);kh("tour-button",p);kh("menu-bar-folder",A);kh("view-list-folder",
A);kh("basic-desktop-help-option",H);kh("advanced-desktop-help-option",G);kh("close-desktop-help-button",D);kh("close-mobile-help-button",D);b.addEventListener("actionActivated",pa);t()};this.contextLost=function(){ca=J=aa=na=null;t()}}C.EventDispatcher.prototype.apply(Nm.prototype);function Pm(a,b){return Math.abs(a.x-b.x)<Number.EPSILON&&Math.abs(a.y-b.y)<Number.EPSILON&&Math.abs(a.z-b.z)<Number.EPSILON}function Qm(a,b,c){var d=Math.sin(b);b=Math.cos(b);a.set((a.x-c.x)*b-(a.y-c.y)*d+c.x,(a.x-c.x)*d+(a.y-c.y)*b+c.y,a.z)}
function Rm(a){var b=document.createElement("canvas");b.width=a;b.height=a;var c=60*Math.PI/180,d=-c/2-Math.PI/2;c=c/2-Math.PI/2;var e=b.getContext("2d");e.beginPath();e.arc(a/2,a/2,4,0,2*Math.PI);e.fillStyle="rgb(0, 220, 255)";e.fill();e.moveTo(a/2,a/2);e.arc(a/2,a/2,12,d,c,!0);e.lineTo(a/2,a/2);e.arc(a/2,a/2,90,d,c);e.lineTo(a/2,a/2);e.fillStyle="rgba(0, 220, 255, 0.5)";e.fill();return b}
function Sm(a,b){var c=document.createElement("div"),d=Rm(200);c.style.width="200px";c.style.height="200px";c.style.position="absolute";c.style.pointerEvents="none";c.style.zIndex="2";c.style.opacity="1";c.style.transition="opacity 0.5s";c.id="minimap-camera";c.appendChild(d);this.update=function(e,f){c.style.left=e.x/a*100+"%";c.style.top=e.y/b*100+"%";c.style.transform="translate(-100px, -100px) rotate("+f+"rad)"};this.show=function(){c.style.opacity="1"};this.hide=function(){c.style.opacity="0"};
this.getContainer=function(){return c}}function Tm(a,b){function c(){e=!0;var h=d.width,l=d.height;g!==h||k!==l?(g=h,k=l,b(),window.requestAnimationFrame(c)):0<f?(--f,window.requestAnimationFrame(c)):e=!1}if("ResizeObserver"in window)(new ResizeObserver(b)).observe(a);else{var d=window.getComputedStyle(a),e,f,g,k;(new MutationObserver(function(){f=60;e||c()})).observe(a,{attributes:!0});window.addEventListener("resize",function(){f=60;e||c()})}}
function Um(a,b,c,d){function e(){h.style.transform="translate("+g.x+","+g.y+")"}function f(){h.style.width=l.width;h.style.height=l.height}var g={x:0,y:0},k=document.createElement("canvas");k.width=3*a;k.height=3*b;k.style.position="absolute";k.style.maxWidth="100%";k.style.maxHeight="100%";var h=document.createElement("div");h.classList.add("minimap-content-controller");var l=window.getComputedStyle(k);d.appendChild(k);d.appendChild(h);Tm(c,f);this.add=function(n){h.appendChild(n)};this.clear=function(){h.innerHTML=
""};this.updateOffset=function(n){g.x=50-n.x/a*100+"%";g.y=50-n.y/b*100+"%";e()};this.addOffset=function(){e()};this.removeOffset=function(){h.style.transform=""};this.updateRatio=function(n){window.requestAnimationFrame(function(){var p=Math.abs(Math.sin(n.rotation)),r=Math.abs(Math.cos(n.rotation));k.width=3*(a*n.ratio.x*r+b*n.ratio.y*p);k.height=3*(a*n.ratio.x*p+b*n.ratio.y*r);f()})}}
function Vm(a,b,c,d){function e(){T=b.minimapConfig.levels.map(function(Ea){return{level:Ea,canvas:null,tab:null}})}function f(){T.forEach(function(Ea){Ea.tab=document.createElement("div");Ea.tab.classList.add("minimap-tab");Ea.tab.innerText=Ea.level.name;Ea.tab.addEventListener("click",function(){O.selectLevel(Ea.level);hh()});ja.appendChild(Ea.tab)})}function g(Ea){pa=Ea;I.show();T.forEach(function(Ga){Ga.level===Ea?Ga.tab.classList.add("minimap-tab-current"):Ga.tab.classList.remove("minimap-tab-current")})}
function k(Ea){T.forEach(function(Ga){Ga.canvas&&(Ga.canvas.style.opacity=Ga.level===Ea?"1":"0",Ga.canvas.style.zIndex=Ga.level===Ea?"1":"0");Ga.level===Ea?Ga.tab.classList.add("minimap-tab-active"):Ga.tab.classList.remove("minimap-tab-active")})}function h(){var Ea=T.find(function(Ga){return Ga.level===pa})?pa:T[T.length-1].level;O.selectLevel(Ea,!0)}function l(Ea){var Ga=T.filter(function(Va){return Va.level.slicePlaneHeight<Ea.slicePlaneHeight}).sort(function(Va,jb){return jb.level.slicePlaneHeight-
Va.level.slicePlaneHeight})[0],Da=T.filter(function(Va){return Va.level.slicePlaneHeight>Ea.slicePlaneHeight}).sort(function(Va,jb){return Va.level.slicePlaneHeight-jb.level.slicePlaneHeight})[0];ca=Ga?Ea.slicePlaneHeight-(Ea.slicePlaneHeight-Ga.level.slicePlaneHeight)/2:-Infinity;J=Da?Ea.slicePlaneHeight-(Ea.slicePlaneHeight-Da.level.slicePlaneHeight)/2:Infinity}function n(Ea){return T.reduce(function(Ga,Da){return Math.abs(Da.level.slicePlaneHeight-Ea.z)<Math.abs(Ga.level.slicePlaneHeight-Ea.z)?
Da:Ga}).level}function p(Ea,Ga){pa&&(Ea||Ga||(Ea=d.getCameraPosition(),Ga=d.getCameraRotation()),Y.set(Ea.x,Ea.y),Qm(Y,pa.rotation,pa.cropRange.center()),qa.set(C.Math.mapLinear(Y.x,pa.visibleRange.max.x,pa.visibleRange.min.x,za.max,za.min),C.Math.mapLinear(Y.y,pa.visibleRange.max.y,pa.visibleRange.min.y,Ka.max,Ka.min)),I.update(qa,-1*Ga.z+-1*pa.rotation),va&&V.updateOffset(qa))}function r(){va=!0;ma.classList.add("minimap-container-minimized");M.classList.add("minimap-wrapper-minimized");V.addOffset();
p()}function q(){va=!1;ma.classList.remove("minimap-container-minimized");M.classList.remove("minimap-wrapper-minimized");V.removeOffset()}function w(){ea=!0;M.style.transform="translate(-101%, 0)"}function x(){d.menuVisible?va&&(640>window.innerWidth||640>window.innerHeight)?(q(),ea=!1,M.style.transform=""):ea?(ea=!1,M.style.transform=""):w():w()}function t(){ea&&d.menuVisible&&(640>window.innerWidth||640>window.innerHeight)||x()}function A(Ea,Ga,Da){var Va=new C.Vector3;Ga.addEventListener("click",
function(jb){var hc=Ga.getBoundingClientRect(),Ib=(jb.clientX-hc.left)/hc.width;jb=(jb.clientY-hc.top)/hc.height;0!==Ea.data[4*(Math.round(Ib*na)+Math.round(jb*L)*na)+3]&&(Va.set(C.Math.mapLinear(Ib,0,1,Da.visibleRange.min.x,Da.visibleRange.max.x),C.Math.mapLinear(jb,0,1,Da.visibleRange.min.y,Da.visibleRange.max.y),Da.slicePlaneHeight),Qm(Va,-1*Da.rotation,Da.cropRange.center()),Ib=new Kg({position:[Va.x,Va.y,Va.z]}),c.switchToView(Ib),Da!==pa&&g(Da));hh()})}function D(){V.add(I.getContainer());ka.style.display=
"";ma.style.display="";1<T.length&&(ja.style.display="",M.classList.add("minimap-wrapper-tabs"))}function H(){V.clear();ja.innerHTML="";ja.style.display="none";ma.style.display="none";ka.style.display="none";M.classList.remove("minimap-wrapper-tabs")}function G(Ea){var Ga=document.createElement("canvas");Ga.width=na;Ga.height=L;Ga.style.transition="opacity 0.5s";var Da=a.createMinimapImageDataComponents(b.minimapConfig,Ea,na,L),Va=Da.minimapImageData;Da=Da.walkableImageData;Ga.getContext("2d").putImageData(Va,
0,0);A(Da,Ga,Ea);V.add(Ga);return Ga}function K(){if(!(Q&&ia&&Z&&ka&&ma&&M&&fa))return!0}function W(){K()||(V=new Um(na,L,M,fa),I=new Sm(na,L),640>window.innerWidth||640>window.innerHeight?w():r(),jh(Q,r),jh(ia,q),jh(Z,w),jh(ka,x),d.onMenuVisibilityChanged(t),ra=!0,e(),f(),h(),D())}var O=this,ea=!1,ra=!1,va=!1,I=null,V=null,pa=null,T=[],P=!1,ca=-Infinity,J=Infinity;d.onViewSwitchStarted(function(){return P=!0});d.onViewSwitchDone(function(){return P=!1});var aa=a.calculateRenderSize(700,b.boundingBox),
na=aa.width,L=aa.height,Q=document.getElementById("minimap-button-minimize"),ia=document.getElementById("minimap-button-maximize"),Z=document.getElementById("minimap-button-close"),ka=document.getElementById("minimap-button-toggle"),ma=document.getElementById("minimap-container"),M=document.getElementById("minimap-wrapper"),fa=document.getElementById("minimap-content"),ja=document.getElementById("minimap-tabs"),ta=new C.Vector3(0,0,0),X=new C.Vector3(0,0,0),Y=new C.Vector2,qa=new C.Vector2,za={min:0,
max:na},Ka={min:0,max:L},Ba={type:"minimapLevelSelected",target:this,level:null};C.EventDispatcher.prototype.apply(Vm.prototype);this.selectLevel=function(Ea,Ga){Ga=void 0===Ga?!1:Ga;var Da=T.filter(function(Va){return Va.level===Ea})[0];Ga&&g(Ea);Da.canvas||(Da.canvas=G(Ea));Ea===pa?I.show():I.hide();k(Ea);l(Ea);p();V.updateRatio(Ea);Ba.level=Ea;this.dispatchEvent(Ba)};this.update=function(){if(!K()){var Ea=d.getCameraPosition(),Ga=d.getCameraRotation();if(!1===Pm(ta,Ea)||!1===Pm(X,Ga)){p(Ea,Ga);
if(!P&&(Ea.z>J||Ea.z<ca)){var Da=n(Ea);l(Da);O.selectLevel(Da,!0)}ta.set(Ea.x,Ea.y,Ea.z);X.set(Ga.x,Ga.y,Ga.z)}}};b.minimapConfig.enabled&&W();b.minimapConfig.addEventListener("updated",function(){ra?b.minimapConfig.enabled?(H(),e(),f(),h(),D()):H():W()});d._onMeetingJoined(w)};function Wm(a,b,c,d,e,f,g){function k(){return Bc.ios&&void 0!==DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&void 0!==DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?new Promise(function(O,ea){Promise.all([DeviceMotionEvent.requestPermission(),DeviceOrientationEvent.requestPermission()]).then(function(ra){"granted"===ra[0]&&"granted"===ra[1]?O():ea()},function(){ea()})}):Promise.resolve()}function h(){r=null;G.dispose();w=q=t=G=null;
b.removeAllXrGamepads();g(!1);if(H){var O=H;H=null;O()}}function l(O){for(var ea=m.makeIterator(O.removed),ra=ea.next();!ra.done;ra=ea.next())ra=ra.value,ra.gamepad&&b.removeXrGamepad(ra.gamepad);O=m.makeIterator(O.added);for(ra=O.next();!ra.done;ra=O.next())ea=ra.value,ea.gamepad&&b.addXrGamepad(ea.gamepad,ea.handedness)}var n=navigator.xr,p=c?!c.nativeWebXR:!1,r,q,w,x=!1,t,A,D,H=null,G,K=new C.Matrix4,W=S.CAMERA_MIN_FAR;this.setCameraFar=function(O){W=O;r&&(t.depthFar=W,r.updateRenderState(t))};
this.render=function(O,ea,ra){D.set(!1,!0,!1);A.matrixWorld=ea;ea=A.projectionMatrix;for(var va=w.views,I=0;I<va.length;++I){var V=va[I];K.fromArray(V.transform.inverse.matrix);ea.fromArray(w.transform.matrix);K.multiply(ea);ea.fromArray(V.projectionMatrix);ea.multiply(K);ra(A);a.enableScissorTest(!0);V=t.baseLayer.getViewport(V);a.setScissor(V.x,V.y,V.width,V.height);G.x=V.x;G.y=V.y;G.width=V.width;G.height=V.height;a.render(O,A,G);a.enableScissorTest(!1)}D.restore()};this.enableVr=function(O){n?
x?(f(!0),k().then(function(){return O.makeXRCompatible().then(function(){return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"]})}).then(function(ea){r=ea;return r.requestReferenceSpace("local-floor")}).then(function(ea){q=ea;ea=new XRWebGLLayer(r,O);G=a.createFrameBufferRenderTarget(ea.framebuffer);t={baseLayer:ea};A||(A=new C.PerspectiveCamera,D=new Ne(a));t.depthNear=S.CAMERA_WALK_NEAR;t.depthFar=W;r.updateRenderState(t);r.addEventListener("end",h);p||r.addEventListener("inputsourceschange",
l);f(!1);g(!0)}).catch(function(){f(!1);Cc.info("Failed to enable VR mode")})}).catch(function(){f(!1);Cc.info("Permissions necessary for VR mode not granted")})):Cc.info("VR device not connected"):Cc.info('You need a <a href="https://mozvr.com/#start" target="_blank">VR ready browser</a>.')};this.disableVr=function(){r.end().then(function(){Cc.hideInfo()},function(){Cc.info("Failed to exit VR mode")})};this.vrEnabled=function(){return!!q};this.requestAnimationFrame=function(){function O(ea,ra){w=
ra.getViewerPose(q);H&&(ra=H,H=null,ra(ea))}return function(ea){H=ea;r.requestAnimationFrame(O)}}();this.update=function(){var O=new Ee,ea=new C.Vector3;return function(){if(w){var ra=w.transform;if(null!==ra.orientation){O.setFromQuaternion(ra.orientation,"YXZ");var va=O.y;O.y=-O.z;O.z=va;ra=ra.position;e(O,ra&&ea.set(ra.x,-ra.z,ra.y,ra.w))}}}}();(Bc.https||Bc.localhost)&&n?(c=function(){navigator.xr.isSessionSupported("immersive-vr").then(function(O){x=O;d(O)})},c(),navigator.xr.addEventListener("devicechange",
c,!1)):d(!1)};var Xm=document.getElementById("walk-canvas"),Ym=S.EDIT_MODE,Zm=0,$m,an,bn,cn,Dg,dn,en,fn,gn,hn,jn,kn,ln,mn,nn,on,pn,qn,rn,sn,tn,un,vn,wn,xn,yn,zn=null,An=null,Bn=null,Cn,Dn,En,Fn,Gn=0,Hn=!1,In=!1,Jn,Kn=!1,Ln=new Kf;function Mn(a,b){return on.renderIdle(a,b)}
function Nn(a,b){b&&fn.update();un.update(a);Dn&&nn.minimapConfig.enabled&&Dn.update();hn.enableCollisions&&!b&&pn.handleCollisions(a);sn&&sn.handleHover();tn.update(a);en.update(a);qn&&qn.updateCameraHeight(a);rn&&rn.updateCameraHeight();b&&!un.teleportingToPoint&&(an.update(),gn.requestFrame());vn&&(b&&!fn.hasGamepads()?vn.update(a):vn.reset());b=S.BENCHMARK;for(var c=m.makeIterator(nn.getAnimatedRootNodes()),d=c.next();!d.done;d=c.next())d.value.update(a,en.cameraWorldPosition())&&(b=!0);c=m.makeIterator(nn.getAnimatedMaterials());
for(d=c.next();!d.done;d=c.next())d=d.value,d.isPlaying&&(d.update(a),b=!0);b&&gn.requestFrame();yn&&yn.update(a);Dg._update(a)}function On(a,b){An&&An.begin();if(S.DEV_NEW_RENDER_ARCHITECTURE){a=Math.min(a,.25);for(Zm+=a;.02<=Zm;)Nn(.02,b),Fn.cameraLocationState.set(nn.camera,en.cameraWorldPosition()),Zm-=.02,on.onSimStateChange(Fn);on.renderToScreen(a,b,Zm/.02);Fn.setProjectionState(null)}else Nn(a,b),on.renderToScreen(a,b);An&&An.end()}
function Pn(a){a.view&&(qn&&qn.disable(),sn&&sn.disable())}function Qn(a){!qn||qn.isEnabled()||an.vrEnabled()||qn.enable();if(rn&&an.vrEnabled())rn.onTeleportDone();a.view&&sn&&sn.enable();an.vrEnabled()&&en.hmdReset()}
function Rn(){if("hidden"===document.visibilityState){if(nn)for(var a=m.makeIterator(nn.getAnimatedMaterials()),b=a.next();!b.done;b=a.next())b.value.sleepAnimation()}else if("visible"===document.visibilityState&&nn){a=m.makeIterator(nn.getAnimatedMaterials());for(b=a.next();!b.done;b=a.next())b.value.wakeAnimation();gn.requestFrame()}}
function Sn(){Bc.ios&&(document.documentElement.style.height=window.innerHeight+"px",0!==document.body.scrollTop&&window.scrollTo(0,0));on.resize(an.vrEnabled());gn.requestFrame();bn.onResize()}function Tn(){return document.pointerLockElement===Xm||document.mozPointerLockElement===Xm||document.webkitPointerLockElement===Xm}function Un(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}
function Vn(){if(Tn()){en.mousePressLook=!1;bn.onPointerLockChange(!0);var a=S.GAZE_IN_POINTER_LOCK;a?Ln.enableMode():Ln.disableMode();Dg.anchorsVisible=a}else en.mousePressLook=!0,bn.onPointerLockChange(!1),Ln.disableMode(),Dg.anchorsVisible=!0}function Wn(){if(Un())bn.onFullScreenChange(!0),screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary");else bn.onFullScreenChange(!1)}
function Xn(){var a=document.body;return void 0!==document.fullscreenEnabled||void 0!==document.webkitFullscreenEnabled||void 0!==document.mozFullScreenEnabled||void 0!==document.msFullscreenEnabled?!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled):void 0!==a.mozRequestFullScreen||void 0!==a.webkitRequestFullscreen||void 0!==a.msRequestFullscreen||void 0!==a.requestFullscreen}
function Yn(a){$m.uploadNewBuffers(a);gn&&gn.requestFrame()}function Zn(a){$m.uploadTexture(a);a.isAtlas()?a.forEachAtlasEntry(function(b){console.assert(null===b.isCutout);Bn.isCutoutTexture(b)}):null===a.isCutout&&Bn.isCutoutTexture(a);gn&&gn.requestFrame()}
function $n(){var a=[],b=[],c=[];a.push(Dg._clickListener.bind(Dg));var d=Dg._createHoverListener();d&&c.push(d);tn=new zf(nn,pn,en,un);b.push(tn.onMeshClicked);Ym||a.push(tn.onMeshClicked);sn=new Qf(jn,pn,function(){gn.requestFrame()},a,b,c,fn,vn)}function ao(){qn&&qn.disable();rn&&rn.enable();en.mouseControlsPitch=!1;en.hmdReset();un.onVrChange(!0);Ln.enableMode();bn.onVrChange(!0);Dg._vrChange(!0);Sn()}
function bo(a){gn.isEnabled()&&(a?ao():(en.resetRollAngle(),en.resetPitchAngle(),en.mouseControlsPitch=!0,console.assert(!an.vrEnabled()),rn&&rn.disable(),qn&&qn.enable(),un.onVrChange(!1),Ln.disableMode(),bn.onVrChange(!1),Dg._vrChange(!1),Sn(),setTimeout(Sn,1E3)))}function co(a){Ym||Bc.mobile&&!S.ALLOW_MOBILE_VR||(Bc.ios||Bc.mobile&&Bc.firefox)&&Bc.inCrossOriginIframe||bn.setVrSupported(a)}function eo(a,b){if(rn&&null!==b)rn.onHmdPositionUpdate(b);en.onHmdUpdate(a,b)}
function fo(a,b){a&&en.cameraWorldPosition().set(a[0],a[1],a[2]);b&&(a=new Ee,a.setFromDegTriple(b),en.setYawAngle(a.yaw),en.setPitchAngle(a.pitch))}function go(a){return a.every(function(b){return 0!==b.lightProbes.length})}function ho(a,b,c){pn=new uf(a,b,c);b.visitAllNodes(function(d){d.mesh&&pn.addStaticObstacle(d.mesh)})}function io(){var a=C.Scene.prototype.add;C.Object3D.prototype.add=function(b){b instanceof C.Mesh&&$m.uploadNewBuffers(b);a.call(this,b)}}
function jo(a){var b=S.urlHashGetArgument("view"),c=null;b&&(c=a.findViewByName(b));return c||a.views[0]}
function ko(a){function b(){gn.requestFrame()}nn=a;nn.adjustSkiesAndCameraFarToSpanWholeScene();nn.addEventListener("updated",function(){return gn.requestFrame()});nn.addEventListener("anyViewUpdated",function(){return bn.refresh()});nn.disableLightProbesForMaterials();en.enable();nn.threeScene.updateMatrixWorld(!0);an.setCameraFar(nn.camera.far);on=new Ak($m,an,nn,ln);S.DEV_NEW_RENDER_ARCHITECTURE&&(Fn=new ek(nn.camera,new ak(nn.camera),null,!0));En=new uj($m,nn);jn=new Tf($m.domElement,Ym);if((a=
hn.enableCollisions)||Ym)ho($m,nn,en),en.orbit.collider=pn;un=new tg(nn,en,pn,gn,En);un.addEventListener("teleportStarted",Pn);un.addEventListener("teleportDone",Qn);xn=new vf(un);a&&nn.camera.autoClimb&&(qn=new Vf(pn,en,gn));a&&(rn=new ug(en,pn));un.switchToView(jo(nn),0);ln.updateWithoutDelay();wn=new Pf(nn,un);Cn=new Dk($m,nn,en);a&&!0!==S.NO_GAZE_TELEPORT&&(vn=new Of(nn,en,b,Ln));Dg._sceneReadyToDisplay($m,nn,en,un,xn,pn,Cn,kn,an,Ln,jn,gn,dn,ln);$n(a);document.addEventListener("visibilitychange",
Rn);window.addEventListener("resize",function(){Bc.ios?setTimeout(Sn,1E3):Sn()},!1);Xn()&&bn.setFullScreenSupported();Bc.mobile||Bc.opera||void 0===document.pointerLockElement&&void 0===document.mozPointerLockElement&&void 0===document.webkitPointerLockElement||bn.setPointerLockSupported();bn.sceneReadyToDisplay(nn,un,xn,Cn);Sn();S.DEBUG&&(An=new Em($m.context));hh();S.DEBUG_SHARED_BUFFERS&&(nn.threeScene.overrideMaterial=new hj);S.DEBUG_GEOMETRY_MERGING&&Sk(nn,!1);nn.startAutoTourOnLoad()&&xn.start();
gn.enable();an.vrEnabled()&&ao();Jn=zn.elapsedLoadTimeSec()}function lo(a){Ym||S.urlHashContains("nostats")||0!==Gn||bn.cover.sendStats&&uc("./stats/"+a,null,null)}
function mo(a,b){function c(k){function h(){f.delete(l);null!==a.findLightProbe(l.id)&&(b.assignLightProbesToObjects(),b.createLightProbeTexture(l,!1),gn.requestFrame())}var l=k.target;k=f.get(l);void 0===k&&(k=new Id(h,1E3),f.set(l,k));k.deferRun()}function d(k){k=k.target;b.createLightProbeTexture(k,!0);if(!k.isBoundingBoxInitialized()){var h=k.boxMax;k.boxMin.copy(k.position).addScalar(-1);h.copy(k.position).addScalar(1);k.enableBoundingBox()}}function e(){for(var k=0;k<a.materials.length;k+=1)a.materials[k].forceObjectUniformsRefresh()}
var f=new Map;a.addEventListener("lightProbeAdded",function(k){k=k.lightProbe;b.assignLightProbesToObjects();b.createLightProbeTexture(k,!0);k.isBoundingBoxInitialized()||k.disableBoundingBox();k.addEventListener("boundsInit",d);k.addEventListener("positionUpdated",c);k.addEventListener("boundsUpdated",e)});a.addEventListener("lightProbeRemoved",function(){b.assignLightProbesToObjects()});for(var g=0;g<a.lightProbes.length;g+=1)a.lightProbes[g].addEventListener("positionUpdated",c),a.lightProbes[g].addEventListener("boundsInit",
d),a.lightProbes[g].addEventListener("boundsUpdated",e)}function no(a,b,c){function d(f){if(f===a.length)c();else{var g=a[f],k=g.name;e.has(k)?d(f+1):(e.add(k),b.monoPanoramaToServer(g,function(){return d(f+1)}))}}var e=new Set;d(0)}
function oo(a){function b(){if(hn.onSceneLoaded)hn.onSceneLoaded(new di(a,bn,en,un,yn,dn,Cn,gn,Dn,Bn,xn));bn.sceneLoadComplete();for(var g=m.makeIterator(a.getAnimatedMaterials()),k=g.next();!k.done;k=g.next())k.value.play();Dg._sceneLoadComplete();gn.requestFrame();g=zn.elapsedLoadTimeSec();lo("loaded?readyToDisplayTime="+Jn.toFixed(1)+"&loadTime="+g.toFixed(1));zn=null}var c=S.urlHashContains("headless");null===hn.onSceneLoaded&&Bn.dispose();if(0<a.lightProbes.length||Ym){var d=new gj(a,$m,Bc.gl.textureLod,
Bc.gl.mirrorCubeMaps,Ym);0===a.lightProbes.length&&Ym&&a.autoAddLightProbes&&Ei(a,d,c);if(0<a.lightProbes.length){go(a.gpuMeshes)||(console.warn("Some objects do not have light probes assigned, this is not optimal."),d.assignLightProbesToObjects());var e;for(e=0;e<a.views.length&&"orbit"===a.views[e].mode;e+=1);e===a.views.length&&(e=0);un.executeWithViewVisibilitySettings(a.views[e],function(){d.createAllLightProbeTextures()});a.enableLightProbesForMaterials()}}a.hasLightMap()&&on.enableAutoExposure();
if(Ym){d?mo(a,d):console.warn("Cube maps support is required in the edit mode");e=new ji(a,gn);var f=new ki(a,gn);yn=new $h(jn,a,$m,pn,e,f,gn,en);hn.sendCoverToServer&&(dn.startExtensionsByType("SwitchObjects"),e=dn.getExtensionsByType("SwitchObjects"),e.forEach(function(g){return g.changeTriggersVisibility(!1)}),Cn.coverToServer(S.EDITOR_COVER_WIDTH,S.EDITOR_COVER_HEIGHT),e.forEach(function(g){return g.changeTriggersVisibility(!0)}),dn.stopExtensionsByType("SwitchObjects"));fo(hn.forcedInitialCameraPosition,
hn.forcedInitialCameraRotation)}else d&&(d.dispose(),d=null);Dn=new Vm(En,a,un,Dg);Ym&&c?no(zn.panoramas,Cn,b):b()}function po(){if(Hn){Hn=!1;zn.load();bn.sceneLoadStarted();S.SHOW_HELP_ON_LOAD&&(bn.helpVisible=!0);var a=Bc.getPlatformInfo(),b="";a=m.makeIterator(Object.entries(a));for(var c=a.next();!c.done;c=a.next()){var d=m.makeIterator(c.value);c=d.next().value;d=d.next().value;""!=d&&(b+=(0==b.length?"?":"&")+c+"="+d)}lo("play"+b)}}
function qo(a){bn.updateCover(a);dn.updateConfig(a.extensions||[]);Bc.canForceBrotliBuffers=!0===a.canForceBrotliBuffers;1===a.webwalkLogMode?(zc.logInfoMessages(),Ac(!0)):2===a.webwalkLogMode&&Ac(!1);Ym||dn.startExtensions();Dg._viewerConfigLoaded(a);if(a.language){var b=Ob[a.language];b?Wb(b):console.log("Unknown language: "+a.language)}Bn=new Ld($m);mn=new Md($m);Hn=!0;a=new Qk(en.camera());void 0!==hn.assetsUrl&&null!==hn.assetsUrl&&(S.ASSETS_URL=hn.assetsUrl);zn=new Cm(a,S.ASSETS_URL,Ym,cn,mn);
kn=new pi($m,a);ln=new li(a,kn);zn.onProgress=bn.loadProgress;zn.onTextureLoaded=Zn;zn.onMeshBuffersLoaded=Yn;zn.onReadyToDisplay=ko;zn.onComplete=oo;S.AUTO_PLAY||In||0<Gn?po():S.HIDE_PLAY||bn.enablePlayButton(po)}function ro(a){a.preventDefault();Gn+=1;gn.disable();!Ym&&null===zn&&Gn<=S.CONTEXT_LOST_RESTORE_LIMIT?(dn.stopExtensions(),Dg._contextLost(),wn.dispose(),wn=null,sn.dispose(),sn=null,tn&&(tn.dispose(),tn=null),bn.contextLost()):Cc.error("Graphics context lost, reload to retry.")}
function so(a){a.preventDefault();!Ym&&null===zn&&Gn<=S.CONTEXT_LOST_RESTORE_LIMIT&&(Cc.info("Graphics context switched, reloading the scene to use the new context.",5E3),Bc.resetGlDetector($m.context),Bc.gl.reportToConsole(),$m.webGLContextRestored(),qo(bn.cover))}function to(){Qc(S.COVER_JSON_URL,!1,function(a){Bc.onAsyncPropertiesDetected(function(){qo(a)})},function(a,b){var c="Failed to initialize the scene.";401==a&&void 0!==b&&(c=b);Cc.error(c)})}
function uo(a){Kn=!0;io();hn=a;if($m=zk(Xm))if(Bc.gl.missingCapabilities)Cc.error(Bc.gl.missingCapabilities);else{Xm.addEventListener("webglcontextlost",ro,!1);Xm.addEventListener("webglcontextrestored",so,!1);bn.init();dn=new zi;a=null;try{S.VR_LO?Nb.cardboardConfig.BUFFER_SCALE*=.5:S.VR_HI&&(Nb.cardboardConfig.BUFFER_SCALE*=1.5),a=new WebXRPolyfill(Nb)}catch(b){zc.log("Failed to initialize WebXR polyfill")}an=new Wm($m,fn,a,co,eo,function(b){b?gn.disable():gn.enable()},bo);gn=new sf(an,On,Mn);gn.disable();
a=new kd;en=new Jf(a,Xm,fn,gn);en.mousePressLook=!0;S.FLIP_MOUSE&&(en.flipMouseLook=!0);en.disable();to()}else Cc.error(window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a> or your browser has WebGL disabled.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>':'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a>.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>')}
fn=new Hf;
bn=new Nm(Ym,fn,function(){an.vrEnabled()?an.disableVr():(xn.isRunning()&&xn.stop(),an.enableVr($m.context))},function(){if(Un())Un()&&(document.exitFullScreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,document.exitFullScreen&&document.exitFullScreen());else{var a=document.body;(a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen||a.requestFullscreen).call(a);document.addEventListener("fullscreenchange",Wn,
!1);document.addEventListener("mozfullscreenchange",Wn,!1);document.addEventListener("webkitfullscreenchange",Wn,!1);document.addEventListener("MSFullscreenChange",Wn,!1)}},function(){Tn()?Tn()&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()):(Xm.requestPointerLock=Xm.requestPointerLock||Xm.mozRequestPointerLock||Xm.webkitRequestPointerLock,Xm.requestPointerLock(),document.addEventListener("pointerlockchange",
Vn,!1),document.addEventListener("mozpointerlockchange",Vn,!1),document.addEventListener("webkitpointerlockchange",Vn,!1))});
cn=new function(){this._editableNodeTypes=new Tk;this._editableMaterialNames=new Tk;this._allMaterialsEditable=!1;this.setNodeTypeEditable=function(a){this._editableNodeTypes.add(a)};this.setMaterialEditable=function(a){this._editableMaterialNames.add(a)};this.setAllMaterialsEditable=function(){this._allMaterialsEditable=!0};this.isMaterialEditable=function(a){return this._allMaterialsEditable||this._editableMaterialNames.matchesAny(a)};this.isNodeTypeEditable=function(a){return this._editableNodeTypes.matchesAny(a)}};
Ym&&cn.setAllMaterialsEditable();Dg=new vo(Ym,bn,cn);function wo(a){Ym||uo(a)}var xo=!1;
function Om(){xo||(xo=!0,console.log("Reloading shaders..."),fetch(ob("shaders.js")).then(function(a){a.text().then(function(b){b.split("\n").forEach(function(f){if(f.includes("SHADERS[")){var g=f.substring(f.indexOf("['")+2,f.indexOf("']"));f=f.substring(f.indexOf('= "')+3,f.lastIndexOf('";')).replaceAll("\\n","\n").replaceAll("\\\\","\\");ld[g]=f}});var c=new Map;b=0;nn.threeScene.traverse(function(f){(f=f.material)&&void 0!==f.generateProgramId&&c.set(f.generateProgramId(),f)});for(var d=m.makeIterator(c.values()),
e=d.next();!e.done;e=d.next())e=e.value,e.tryToRefreshShaderCode()&&($m.recompileProgram(e),b++);xo=!1;console.log("Updated "+b+" shaders.")})}))};var yo=512-2*Math.floor(512*(.5-.5*Math.sin(70/180*Math.PI/2))),zo=null,Ao,Bo,Co=null,Do;function Eo(a){zo&&Co===a.id||(zo=new C.SphereBufferGeometry(1,32,16),zo.convertNormalsToSpherical(),Ao=new C.PlaneBufferGeometry(1,1),Ao.convertNormalsToSpherical(),Bo=new C.CylinderBufferGeometry(.5,.5,1,16,1),Do||(Do=new C.Matrix4,Do.makeRotationX(Math.PI/2)),Bo.applyMatrix(Do),Bo.convertNormalsToSpherical(),Co=a.id)}var Fo=new C.Color;
function Go(a,b,c){var d=a.getContext("2d");d.fillStyle=b;c?(b=a.width,a=a.height,c=.5*c*Math.min(b,a),d.beginPath(),d.moveTo(0+c,0),d.lineTo(0+b-c,0),d.quadraticCurveTo(0+b,0,0+b,0+c),d.lineTo(0+b,0+a-c),d.quadraticCurveTo(0+b,0+a,0+b-c,0+a),d.lineTo(0+c,0+a),d.quadraticCurveTo(0,0+a,0,0+a-c),d.lineTo(0,0+c),d.quadraticCurveTo(0,0,0+c,0),d.closePath(),d.fill()):d.fillRect(0,0,a.width,a.height)}
function Ho(a,b,c,d,e){var f=this;cd.call(this);this.hasAlpha=e;Uc(S.LOAD_PRIORITY.CORE_RESOURCE,a,function(g){var k=m,h=k.makeIterator,l=d?512:2048,n=g.naturalWidth,p=g.naturalHeight;n>=p&&n>l?(p=p/n*l,n=l):p>n&&p>l&&(n=n/p*l,p=l);k=h.call(k,[Math.round(n),Math.round(p)]);f.width=k.next().value;f.height=k.next().value;C.Math.isPowerOfTwo(f.width)&&C.Math.isPowerOfTwo(f.height)||(f.minFilter=Mb.LINEAR);k=f.width;h=f.height;l=document.createElement("canvas");l.width=k;l.height=h;Go(l,b,c);l.getContext("2d").drawImage(g,
0,0,k,h);f.image=l;f.needsUpdate=!0;f.notifyLoaded()},function(){console.log("Failed to load trigger image: "+a)})}Ho.prototype=Object.create(cd.prototype);Ho.prototype.constructor=Ho;Ho.prototype.serialize=function(){console.assert("Anchor texture serialize is not suported")};Ho.prototype.clone=function(){console.assert("Anchor texture clone is not supported")};var Io=new Map;
function Jo(a){var b=a.icon&&Xb[a.icon],c=b?b.value:a.text,d=a.image||"",e=b?b.fontFamily:"Open Sans",f=a.color||"#4c9ed9";var g=a.opacity;void 0===g||1<=g?g=f:(Fo.setStyle(f),g="rgba("+(255*Fo.r|0)+","+(255*Fo.g|0)+","+(255*Fo.b|0)+","+g+")");var k=g;g=a.textColor||"#ffffff";var h=void 0!==a.opacity&&1>a.opacity,l="sphere"===a.type;b=[b||"",c||"",d,e,k,g,l,20,a.borderRadius||0,h].join("_");var n=Io.get(b);if(n)return n.usedTimes++,[f,g,b,n.texture];if(d)e=tb(a.image),h=new Ho(e,k,a.borderRadius,
l,h);else{d=c;c=a.borderRadius;a=document.createElement("canvas");if(l)n=d,a.width=512,a.height=512,l=a.getContext("2d"),l.font="400 128px "+e,n=l.measureText(n).width,n=Math.floor(yo/n*128),n=Math.min(n,yo),l.font="400 "+n+"px "+e,e=l;else{l=m;n=l.makeIterator;var p=S.SPRITE_ANCHOR_FONT_SIZE,r=a.getContext("2d");r.font="400 "+p+"px "+e;for(var q=d,w=d.length-1,x;;){x=r.measureText(q).width;x+=40;if(2048>=x)break;q=d.substring(0,w)+"...";--w}a.width=x;a.height=1.5*p;r=a.getContext("2d");r.font="400 "+
p+"px "+e;d=n.call(l,[r,q]);e=d.next().value;d=d.next().value}Go(a,k,c);e.fillStyle=g;e.textAlign="center";e.textBaseline="middle";e.shadowColor="black";e.shadowBlur=16;e.fillText(d,a.width/2,a.height/2);k=new cd(a);k.width=a.width;k.height=a.height;k.hasAlpha=h;k.minFilter=Mb.LINEAR;k.loaded=!0;k.needsUpdate=!0;h=k}Io.set(b,{usedTimes:1,texture:h});return[f,g,b,h]}
function Ko(a,b){var c=this;Eo(a);var d=new C.Vector3;d.fromArray(b.position);var e=m.makeIterator(Jo(b)),f=e.next().value,g=e.next().value,k=e.next().value;e=e.next().value;this._textureSignature=k;var h=new C.Color;h.setStyle(f);h.convertGammaToLinear();Object.defineProperty(this,"color",{get:function(){return h}});var l=new C.Color;l.setStyle(g);l.convertGammaToLinear();Object.defineProperty(this,"textColor",{get:function(){return l}});var n;if("sphere"===b.type){f=zo;var p=new cf;a=a.closestLightProbe(d);
b.image||(p.bumpTexture=e);p.disableLightProbe=null===a||!a.texturesReady();p.headLight=!0}else{f=Ao;p=new rf;a=null;p.headLight=!1;p.reflective=!1;var r=new C.Mesh(Bo,null)}p.baseColor=h;p.baseColorTexture=e;p.configureTransparency();p.setUniforms();C.Mesh.call(this,f,p);this.visible=!1;this.position.copy(d);this.lightProbes=[a];r?(r.position.copy(d),this.colliderMesh=r,this.colliderMesh.visible=!1):this.colliderMesh=this;this.colliderMesh.visibilityId=null;this.colliderMesh.anchor=this;e.addLoadedListener(function(){n=
"sphere"===b.type?[b.radius,b.radius,b.radius]:[p.baseColorTexture.width/p.baseColorTexture.height*b.height,b.height,1];c.scale.fromArray(n);c.updateMatrixWorld(!0);if(r){var q=Math.max(n[0],n[1]);r.scale.fromArray([q,q,b.height]);r.updateMatrixWorld(!0);r.visible=!0}c.visible=!0;Dg.requestFrame()});this.extension=null}Ko.prototype=Object.create(C.Mesh.prototype);
Ko.prototype.dispose=function(){var a=this.material;a.dispose();var b=this._textureSignature,c=Io.get(b),d=c.texture;console.assert(a.baseColorTexture===d);setTimeout(function(){c.usedTimes--;0===c.usedTimes&&(d.dispose(),Io.delete(b))},5E3)};Ko.prototype.enableLightProbe=function(){if(0<this.lightProbes.length&&null!==this.lightProbes[0]){console.assert(this.lightProbes[0].texturesReady());var a=this.material;a.disableLightProbe=!1;a.setUniforms()}};var Lo=null,Mo=!1,No=[{name:"mainMaterial",baseColor:[.5,.5,.5],roughness:.7,metallic:1},{name:"displayMaterial",baseColor:[0,0,0],roughness:.001,metallic:0}],Oo={sphere:null,cylinder:null,head:[],torso:[],displayPortrait:[],displayLandscape:[]},Po={};function Qo(a){Oo.plane&&Lo===a.id||(Oo.sphere=new C.SphereBufferGeometry(.08,32,16),Oo.sphere.convertNormalsToSpherical(),Oo.cylinder=new C.CylinderBufferGeometry(.005,.005,1,3),Oo.cylinder.convertNormalsToSpherical(),Lo=a.id)}
function Ro(a,b,c){var d=new C.Box3;Oo.head.forEach(function(e){d.union(e.geometry.boundingBox)});return new Ko(a,{type:"sprite",position:[0,0,.1+(d.max.z-d.min.z)/2],height:.1,text:b,textColor:c,opacity:0})}function So(a){a=new C.Mesh(Oo.sphere,a);a.scale.set(.4,.4,.4);a.visible=!1;return a}
function To(a){var b=new bf;b.lightMapSupported=!1;b.headLight=!1;b.baseColor.setStyle(a).convertGammaToLinear();b.transparent=!0;b.opacity=.5;b.emissive=!0;b.disableLightProbe=!0;b.setUniforms();a=new C.Mesh(Oo.cylinder,b);a.visible=!1;return a}
function Uo(a){var b=new bf;b.lightMapSupported=!1;b.baseColor.fromArray(a.baseColor);b.roughness=a.roughness||1;b.metallic=a.metallic||0;b.opacity=a.opacity||1;b.highlight=new C.Color(16777215);b.highlightMix=0;b.baseColorTexture=a.baseColorTexture||null;b.disableLightProbe=a.disableLightProbe||!1;b.headLight=a.headLight||!1;b.setUniforms();return b}
function Vo(a,b){a&&No.push.apply(No,m.arrayFromIterable(a));No.forEach(function(c){if(c.baseColorTexture){var d=new Image;d.src=b+c.baseColorTexture.file;c.baseColorTexture=Dg.createTextureFromHtmlImage(d)}Po[c.name]=Uo(c)})}
function Wo(a,b,c){function d(k,h){Oo[h].forEach(function(l){a:{var n=l.materialName;switch(n){case "mainMaterial":n=e.mainMaterial;break a;case "displayMaterial":n=e.displayMaterial;break a;default:n=Po[n]}}l=new C.Mesh(l.geometry,n);k.add(l);l.visibilityId=null;e.colliders.push(l)})}var e=this;C.Object3D.call(this);this.uuid=b;this.displayName=c.displayName;this._scene=a;this._lastLightProbeCheckPosition=new C.Vector3(0,0,0);this.colliders=[];Qo(a);this._haveLightProbe=0<this._scene.lightProbes.length;
b=m.makeIterator(Object.values(Po));for(var f=b.next();!f.done;f=b.next())f=f.value,f.disableLightProbe=!this._haveLightProbe,f.headLight=this._haveLightProbe,f.setUniforms();this.mainMaterial=Uo(Po.mainMaterial);Mo?(this.displayMaterial=new rf,this.displayMaterial.reflective=!1,this.displayMaterial.headLight=!1):this.displayMaterial=Uo(Po.displayMaterial);this.mainMaterial.baseColor.setStyle(c.color).convertGammaToLinear();this._body=new C.Object3D;this._head=new C.Object3D;this._head.rotation.order=
"ZXY";this._torso=new C.Object3D;this._displayLandscape=new C.Object3D;this._displayPortrait=new C.Object3D;d(this._head,"head");d(this._torso,"torso");d(this._displayLandscape,"displayLandscape");d(this._displayPortrait,"displayPortrait");this._pointer=So(this.mainMaterial);this._pointerLeaderStartOffset=new C.Vector3(0,.3,-.35);this._pointerLeader=To(c.color);this._displayNameAnchor=Ro(a,c.displayName,c.color);this._body.add(this._torso);this._body.add(this._head);Mo?(this.add(this._displayLandscape),
this.add(this._displayPortrait)):(this._head.add(this._displayLandscape),this._head.add(this._displayPortrait));this.add(this._body);this.add(this._displayNameAnchor);this.add(this._pointerLeader);this.add(this._pointer);c.position&&this.position.fromArray(c.position);this.updateMatrixWorld(!0);this._setClosestLightProbe();if(Mo){var g=new C.Box3;this._displayLandscape.children.forEach(function(k){g.union(k.geometry.boundingBox)});this.displayMaterial.offset=g.center()}this._videoTexture1=this._videoTexture0=
null;this._landscape=!0;this._displayLandscape.visible=!Mo;this._displayPortrait.visible=!1;this._soundThreshold=140;this._maxHighlight=.5;this._highlightStepDown=.05}Wo.prototype=Object.create(C.Object3D.prototype);Wo.prototype.constructor=Wo;Wo.prototype.switchToPortrait=function(){this._landscape&&(this._landscape=!1,this._displayLandscape.visible=!1,this._displayPortrait.visible=!0,Mo||(this._head.rotation.y=Math.PI/2,this._torso.position.z-=.05))};
Wo.prototype.switchToLandscape=function(){this._landscape||(this._landscape=!0,this._displayLandscape.visible=!0,this._displayPortrait.visible=!1,Mo||(this._head.rotation.y=0,this._torso.position.z+=.05))};Wo.prototype.hideBody=function(){this.traverse(function(a){return a.visible=!1});this.visible=!0;this._pointer.visible=!0;this._pointerLeader.visible=!0};Wo.prototype._updated=function(){this.dispatchEvent({type:"avatarUpdated",target:this})};
Wo.prototype.rotate=function(a,b){this._body.rotation.z=a;this._head.rotation.x=b};Wo.prototype.setOrientation=function(){this._videoTexture0.width<this._videoTexture0.height?this.switchToPortrait():this.switchToLandscape()};Wo.prototype.onVideoStreamStart=function(){Mo&&(this._displayLandscape.visible=!0,this._displayPortrait.visible=!1)};Wo.prototype.onVideoStreamStop=function(){Mo?(this._displayLandscape.visible=!1,this._displayPortrait.visible=!1):this.switchToLandscape()};
Wo.prototype.setVideoTexture0=function(a){var b=this;this._videoTexture0&&(this._videoTexture0.dispose(),this._videoTexture0=null);this._haveLightProbe&&(this.displayMaterial.disableLightProbe=!1);this.displayMaterial.baseColorTexture=null;this._updated();a?(this.onVideoStreamStart(),a.addLoadedListener(function(){b._videoTexture0=a;b.setOrientation();b.displayMaterial.disableLightProbe=!0;b.displayMaterial.baseColorTexture=a;a.addResizedListener(function(){b.setOrientation();b._updated()});b._updated()})):
(this.onVideoStreamStop(),this._updated())};Wo.prototype.getVideoTexture0=function(){return this._videoTexture0};Wo.prototype.setVideoTexture1=function(a){var b=this;this._videoTexture1&&(this._videoTexture1.dispose(),this._videoTexture1=null,this._updated());a&&a.addLoadedListener(function(){b._videoTexture1=a;b._updated()})};Wo.prototype.getVideoTexture1=function(){return this._videoTexture1};Wo.prototype.getMainMaterial=function(){return this.mainMaterial};
Wo.prototype._setClosestLightProbe=function(){var a=this._scene.closestLightProbe(this.position);if(void 0!==this._head.children[0].lightProbes)for(var b=m.makeIterator(this._head.children[0].lightProbes),c=b.next();!c.done;c=b.next())if(c.value===a)return;b=m.makeIterator([this._head,this._torso,this._displayPortrait,this._displayLandscape]);for(c=b.next();!c.done;c=b.next())c.value.children.forEach(function(d){d.lightProbes=[a]});this._pointer.lightProbes=[a];this._pointerLeader.lightProbes=[a]};
Wo.prototype.setPositionFromArray=function(a){this.position.fromArray(a);.5<this._lastLightProbeCheckPosition.distanceTo(this.position)&&(this._lastLightProbeCheckPosition.copy(this.position),this._setClosestLightProbe(this.position))};
Wo.prototype.placePointer=function(){var a=new C.Matrix4,b=new C.Vector3,c=new C.Vector3,d=new C.Vector3,e=new C.Vector3,f=new C.Matrix4,g=new C.Matrix4;g.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var k=new C.Matrix4;return function(h,l,n){this._pointer.position.set(h-this.position.x,l-this.position.y,n-this.position.z);this._pointer.visible=!0;a.makeRotationZ(this._body.rotation.z);b.set(this._pointerLeaderStartOffset.x,this._pointerLeaderStartOffset.y,this._pointerLeaderStartOffset.z);b.applyMatrix4(a);
c.set(this.position.x,this.position.y,this.position.z).add(b);d.set(h,l,n);e.set(h,l,n).sub(c);k.makeScale(1,e.length(),1);f.lookAt(c,d,C.Object3D.DefaultUp);f.multiply(g);k.multiplyMatrices(f,k);e.divideScalar(2).add(b);k.setPosition(e);this._pointerLeader.matrix.identity();this._pointerLeader.applyMatrix(k);this._pointerLeader.visible=!0}}();Wo.prototype.hidePointer=function(){this._pointerLeader.visible=!1;this._pointer.visible=!1};
Wo.prototype.onSoundVolumeUpdated=function(a){null!==a&&(a=this._computeHighlighMix(a),this.getMainMaterial().highlightMix!==a&&(this.getMainMaterial().highlightMix=a,Dg.requestFrame()))};Wo.prototype.onSoundSwitchedOff=function(){0<this.getMainMaterial().highlightMix&&(this.getMainMaterial().highlightMix=0,Dg.requestFrame())};
Wo.prototype._computeHighlighMix=function(a){var b=this.getMainMaterial().highlightMix;if(a<this._soundThreshold)return 0<b?Math.max(0,b-this._highlightStepDown):0;a=(a-this._soundThreshold)/(255-this._soundThreshold)*this._maxHighlight;return a>b?a:Math.max(a,b-this._highlightStepDown)};
Wo.prototype.dispose=function(){this.mainMaterial.dispose();this.displayMaterial.dispose();this._videoTexture0&&this._videoTexture0.dispose();this._videoTexture1&&this._videoTexture1.dispose();this._displayNameAnchor.dispose();this.dispatchEvent({type:"dispose"})};var Xo,Yo,Zo,$o;function ap(a,b,c,d,e){"grass"===b.type&&(c-=b.grassHeight*c*.5);var f=new C.SphereBufferGeometry(c,32,16);f.changePosition(d);f.computeBoundingSphere();f.convertNormalsToSpherical();d=new om(null,f,b);b.lightMapEnabled&&(d.lightMap=e);"grass"===b.type&&(d.grassScaleOverride=c);a.camera.getWorldPosition($o);d.lightProbes=[a.closestLightProbe($o)];d.frustumCulled=!1;d.userData.hideFromLightProbes=!0;return d}var bp=new C.Matrix4,cp=new C.Vector2;
function dp(a,b){Xo.setRGB(a,a,a);"rgbm"==b?De.rgbmEncode(Xo,Yo):De.ycocgmEncode(Xo,Yo,0);a=new Uint8Array(4);a[0]=Math.round(255*Yo.x);a[1]=Math.round(255*Yo.y);a[2]=Math.round(255*Yo.z);a[3]=Math.round(255*Yo.w);a=new ed(a,1,1);a.magFilter=Mb.NEAREST;a.minFilter=Mb.NEAREST;a.anisotropy=S.NO_ANISOTROPY;a.hasAlpha=!0;a.encoding=b;a.ycocgmThreshold=0;a.loaded=!0;a.needsUpdate=!0;return a}
function ep(a,b,c,d,e,f,g){function k(){return l(!1)}function h(){return l(!0)}function l(G){p.forEach(function(K){return K(G)})}var n=this;this.lightMap=null;this.meshes=[];var p=[],r=Math.max(2*d.camera.near,.1);Xo||(Xo=new C.Color,Yo=new C.Vector4,$o=new C.Vector3,Zo=new C.Vector3,$o=new C.Vector3);var q=d.camera.aspect,w=Math.tan(C.Math.degToRad(d.camera.fov/2))*r,x=-w;q=Math.abs(q*w-q*x);w=Math.abs(w-x);var t=.01*q,A=(q-a.length*t-t)/(2*a.length);A=Math.min(A,S.MATERIAL_PICKER_BALL_MAX_SIZE/
2*q);var D=a.length/2*-(2*A+t)+A+t;x=document.getElementById("menu-bar").getBoundingClientRect().top;var H=-w/2+(window.innerHeight-x)/window.innerHeight*w+A+t;a.some(function(G){return G.lightMapEnabled})&&(f=f.measureIncidentLuma(),0>f&&(f=1),this.lightMap=dp(f,d.sharedMaterialState.lightMapEncoding));a.forEach(function(G,K){if(G){Zo.set(D,H,-r);var W=ap(d,G,A,Zo,n.lightMap);D+=2*A+t;var O=null;if(b){O=new C.Matrix4;O.multiply(bp.makeTranslation(b.x,b.y,b.z));G=e.cameraWorldPosition();cp.x=G.x-
b.x;cp.y=G.y-b.y;G=O;var ea=G.multiply,ra=bp,va=ra.makeRotationZ;var I=Math.abs(cp.y)>Math.abs(cp.x)?0<cp.x?0:-Math.PI:0<cp.y?Math.PI/2:-Math.PI/2;ea.call(G,va.call(ra,I));O.multiply(bp.makeRotationX(-Math.PI/2));O.multiply(bp.makeScale(c,c,c));O.multiply(bp.makeTranslation(2.1*(K+1),0,0));O.multiply(bp.makeScale(1/A,1/A,1/A));O.multiply(bp.makeTranslation(-Zo.x,-Zo.y,-Zo.z))}n.meshes.push(W);p.push(function(V){V&&O?(W.matrix=O,W.matrixWorld=O):(W.matrix=d.camera.matrix,W.matrixWorld=d.camera.matrixWorld)})}});
g.addEventListener("modeEnabled",h);g.addEventListener("modeDisabled",k);this.dispose=function(){p.length=0;g.removeEventListener("modeEnabled",h);g.removeEventListener("modeDisabled",k);this.meshes.forEach(function(G){return G.geometry.dispose()});this.meshes=null;this.lightMap&&(this.lightMap.dispose(),this.lightMap=null)};l(g.modeIsEnabled())};var fp=null;
function gp(a,b,c){var d=!1,e=document.getElementById("ext-html-label"),f=e.querySelector("#ext-html-label-content");this.close=function(g){d?(e.classList.add("ui-out"),hh(),window.setTimeout(function(){e.classList.remove("ext-html-label-topleft");e.classList.remove("ext-html-label-horizontal-center");e.classList.remove("ext-html-label-vertical-center");e.classList.remove("ext-html-label-center");e.classList.remove("ui-out");f.innerHTML="";e.style.display="none";c&&c();g&&g();d=!1},400)):g()};this.open=
function(){var g=this;if(!d){if(a instanceof Node)f.appendChild(a);else{var k=tb("").slice(0,-1);k=a.replace(/\$EXTRA_ASSETS/g,k);f.innerHTML=k}f.style.padding=b.padding||void 0===b.padding?"":0;e.style.display="";b.centerVertically?b.centerHorizontally?e.classList.add("ext-html-label-center"):e.classList.add("ext-html-label-vertical-center"):b.centerHorizontally?e.classList.add("ext-html-label-horizontal-center"):e.classList.add("ext-html-label-topleft");e.classList.add("ui-out");e.classList.remove("ext-html-label-animated");
zb(e.offsetHeight);e.classList.add("ext-html-label-animated");e.classList.remove("ui-out");e.querySelector("#ext-html-label-close").onclick=function(){g.close()};d=!0}}}function hp(a,b,c){var d=new gp(a,b,c);null!==fp?fp.close(function(){return d.open()}):d.open();return fp=d};function vo(a,b,c){function d(U){return function(){console.assert(!1,"Can't "+U+" until the scene is ready to display")}}function e(){return null}function f(U){c.isMaterialEditable(U)||console.assert(!1,"Can't access material, call ViewerApi.setMaterialEditable('"+U+"') before the scene is loaded.")}function g(){for(var U=[],ua=m.makeIterator(J.materials),Na=ua.next();!Na.done;Na=ua.next())Na=Na.value,c.isMaterialEditable(Na.name)&&U.push(Na);return U}function k(){for(var U=[],ua=m.makeIterator(J.nodeConfigs),
Na=ua.next();!Na.done;Na=ua.next())Na=Na.value,c.isNodeTypeEditable(Na.name)&&U.push(Na.name);return U}function h(U){f(U);for(var ua=m.makeIterator(J.materials),Na=ua.next();!Na.done;Na=ua.next())if(Na=Na.value,Na.name===U)return Na;return null}function l(){Da.copy(aa.cameraWorldPosition());return Da}function n(){Va.yaw=aa.getYawAngle();Va.pitch=aa.getPitchAngle();Va.roll=0;return Va}function p(){return J.boundingBox}function r(U){var ua=[];f(U);for(var Na=m.makeIterator(J.gpuMeshes),eb=Na.next();!eb.done;eb=
Na.next())eb=eb.value,eb.material.name===U&&ua.push(eb);return ua}function q(U){return(U=J.findNodeConfig(U))?U.nodes.slice(0):[]}function w(U,ua){ua.geometry.isUvs0Repeating&&U.ensureTexturesRepeatable&&U.ensureTexturesRepeatable();ua.material=U;ka.requestFrame()}function x(U,ua){console.warn("setMaterialForNode() is deprecated, use setMaterialForMesh() instead");w(U,ua)}function t(U,ua,Na){var eb;(eb="string"===typeof U?J.findViewByName(U):U)?(!0===ua?ua=0:!1===ua&&(ua=void 0),L.isRunning()&&(ua=
0,L.stop()),Na?(na.activateSky(eb),na.updateHiddenMeshes(eb)):na.switchToView(eb,ua)):console.error("Unknown view: "+U)}function A(U){U=void 0===U?{}:U;var ua=U.isPanorama||!1,Na=U.width||(ua?4E3:window.innerWidth),eb=U.height||(ua?2E3:window.innerHeight);if(U.toDataUrl)return ia.monoScreenToDataUrl(ua,Na,eb);ia.monoScreenToLocalImage(ua,Na,eb)}function D(U){J.addAuxiliaryObject(U);U!==U.colliderMesh&&ca.uploadNewBuffers(U.colliderMesh);Q.addDynamicObstacle(U.colliderMesh)}function H(U){var ua=m.getRestArguments.apply(1,
arguments);try{return U.apply(null,m.arrayFromIterable(ua))}catch(Na){console.error(Na)}return!1}function G(U){var ua=m.getRestArguments.apply(1,arguments);if(U)for(var Na=m.makeIterator(U),eb=Na.next();!eb.done;eb=Na.next())H.apply(null,[eb.value].concat(m.arrayFromIterable(ua)))}function K(){G(Ba.nextPageInteraction);Ba.nextPageInteraction.length=0}function W(U,ua){U=new Ko(J,U);Ea.push(U);jb&&D(U);Ba.anchorClicked[U.colliderMesh.id]=ua;Y=!0;ka.requestFrame();return U}function O(U){delete Ba.anchorClicked[U.colliderMesh.id];
jb&&(J.removeAuxiliaryObject(U),Q.removeDynamicObstacle(U.colliderMesh));Ia(U,Ea);U.dispose();ka.requestFrame()}function ea(U,ua){U=new Wo(J,U,ua);Ga.push(U);J.addAuxiliaryObject(U,!0);ua=m.makeIterator(U.colliders);for(var Na=ua.next();!Na.done;Na=ua.next())Q.addDynamicObstacle(Na.value);G(Ba.avatarListChanged);return U}function ra(U){for(var ua=m.makeIterator(U.colliders),Na=ua.next();!Na.done;Na=ua.next())Q.removeDynamicObstacle(Na.value);J.removeAuxiliaryObject(U);Ia(U,Ga);U.dispose();G(Ba.avatarListChanged)}
function va(U){return Ga.find(function(ua){return ua.uuid===U})}function I(){for(var U=m.makeIterator(J.getAnimatedMaterials()),ua=U.next();!ua.done;ua=U.next())ua.value.sleepAnimation()}function V(){for(var U=m.makeIterator(J.getAnimatedMaterials()),ua=U.next();!ua.done;ua=U.next())ua.value.wakeAnimation();ka.requestFrame()}function pa(U,ua){return ma.getExtension(U,ua)}function T(){return M}function P(U,ua){var Na=U[ua];if(Na)return Na;Na=[];return U[ua]=Na}var ca,J=null,aa,na,L,Q,ia,Z,ka,ma,M,
fa,ja,ta,X,Y=!1,qa=!1,za=null,Ka=null,Ba={nextPageInteraction:[],viewerConfigLoaded:[],sceneReadyToDisplay:[],sceneLoadComplete:[],anchorClicked:{},materialPickerClicked:{},materialPickerClosed:null,nodeTypeClicked:{},anyNodeTypeClicked:[],materialClicked:{},nodeTypeHoverChanged:{},materialHoverChanged:{},viewSwitchStarted:[],viewSwitchDone:[],vrChange:[],beforeRender:[],anchorsVisibilityChanged:[],apiUserStateChanged:{},anyApiUserStateChanged:[],meetingJoined:[],avatarListChanged:[]},Ea=[],Ga=[],
Da=new C.Vector3,Va=new Ee;this.visibleViews=function(){return J.visibleViews()};document.addEventListener("keydown",K);document.addEventListener("mousedown",K);Bc.ios?document.addEventListener("touchstart",K):document.addEventListener("touchend",K);var jb=!0;Object.defineProperty(this,"anchorsVisible",{get:function(){return jb},set:function(U){U!==jb&&((jb=U)?Ea.forEach(function(ua){return D(ua)}):Ea.forEach(function(ua){J.removeAuxiliaryObject(ua);Q.removeDynamicObstacle(ua.colliderMesh)}),this.requestFrame(),
G(Ba.anchorsVisibilityChanged,jb))}});var hc=function(){function U(N,la,Aa){Na.set(N.x,N.y,bb.z).sub(bb);N=Na.length();N>la&&(Na.normalize().multiplyScalar(N-la),Aa.add(Na))}var ua=new C.Vector3,Na=new C.Vector3,eb=new C.Vector3,ab=new C.Sphere,kb=new C.Vector3,Sb=new Ee,bb;return function(N){bb=aa.cameraWorldPosition();kb.copy(bb);N instanceof Eg&&"sun"===N.light.type?(Te(J,N.rotation,ua),N=ua):N instanceof al?(Ue(N,ab),N=ab.center,U(N,1+ab.radius,kb)):(N=N.position,U(N,1,kb));eb.copy(N).sub(kb).normalize();
Sb.setFromDirection(eb);na.switchToPoint(kb,Sb)}}();this.openMaterialPicker=function(U,ua,Na,eb,ab){console.assert(!za,"Only one material picker can be opened");za=new ep(U,eb,ab,J,aa,Z,ta);za.meshes.forEach(function(kb){J.addAuxiliaryObject(kb);Q.addDynamicObstacle(kb);Ba.materialPickerClicked[kb.id]=ua});Ba.materialPickerClosed=Na};this.closeMaterialPicker=function(){za&&(za.meshes.forEach(function(U){J.removeAuxiliaryObject(U);Q.removeDynamicObstacle(U);delete Ba.materialPickerClicked[U.id]}),
za.dispose(),za=null,Ba.materialPickerClosed&&(Ba.materialPickerClosed(),Ba.materialPickerClosed=null))};window.addEventListener("resize",this.closeMaterialPicker.bind(this));this._vrChange=function(U){G(Ba.vrChange,U)};this._update=function(U){G(Ba.beforeRender,U)};this._clickListener=function(U,ua,Na){function eb(kb,Sb){if(kb){kb=m.makeIterator(kb);for(var bb=kb.next();!bb.done;bb=kb.next())if(H(bb.value,Sb,ua,Na))return!0}return!1}if(!Y)return!1;if(za){var ab=Ba.materialPickerClicked[U.id];if(ab)return H(ab,
U.material,za.meshes.indexOf(U)),!0;this.closeMaterialPicker();return!0}if(ab=Ba.anchorClicked[U.id])return H(ab,U.anchor,ua,Na),!0;for(ab=U.node;ab;ab=ab.parent)if(eb(Ba.nodeTypeClicked[ab.type],U.node))return!0;return U.node&&eb(Ba.anyNodeTypeClicked,U.node)?!0:U.material?eb(Ba.materialClicked[U.material.name],U.material):!1};this._createHoverListener=function(){var U=Ba.nodeTypeHoverChanged,ua=Ba.materialHoverChanged,Na=[];return 0===Object.keys(U).length&&0===Object.keys(ua).length?null:function(eb,
ab){for(var kb=eb.node;kb;kb=kb.parent)for(var Sb=m.makeIterator(U[kb.type]||Na),bb=Sb.next();!bb.done;bb=Sb.next())if(H(bb.value,kb,ab))return!0;if(eb.material)for(kb=m.makeIterator(ua[eb.material.name]||Na),bb=kb.next();!bb.done;bb=kb.next())if(H(bb.value,eb.material,ab))return!0;return!1}};this._teleportStarted=function(U){U=U.view;null!==U&&G(Ba.viewSwitchStarted,U.name,U)};this._teleportDone=function(U){U=U.view;null!==U&&G(Ba.viewSwitchDone,U.name,U)};this._viewerConfigLoaded=function(U){fa=
U;G(Ba.viewerConfigLoaded,fa);Ba.viewerConfigLoaded=[]};this._sceneReadyToDisplay=function(U,ua,Na,eb,ab,kb,Sb,bb,N,la,Aa,ya,Pa,Wa){ca=U;J=ua;aa=Na;na=eb;L=ab;Q=kb;ia=Sb;Z=bb;ja=N;ta=la;X=Aa;ka=ya;ma=Pa;M=Wa;this.getEditableMaterials=g;this.getEditableNodeTypes=k;this.findMaterial=h;this.findMeshesWithMaterial=r;this.findNodesOfType=q;this.getCameraPosition=l;this.getCameraRotation=n;this.getSceneBoundingBox=p;this.setMaterialForNode=x;this.setMaterialForMesh=w;this.switchToView=t;this.captureImage=
A;this.addAnchor=W;this.removeAnchor=O;this.addAvatar=ea;this.removeAvatar=ra;this.findAvatar=va;this.seeItem=hc;this.sleepAnimatedMaterials=I;this.wakeAnimatedMaterials=V;this.getExtension=pa;this.getExposureController=T;G(Ba.sceneReadyToDisplay,J);Ba.sceneReadyToDisplay=[];na.addEventListener("teleportStarted",this._teleportStarted.bind(this));na.addEventListener("teleportDone",this._teleportDone.bind(this))};this._contextLost=function(){qa=!1;fa=J=na=L=Q=ia=X=ka=null;this.getExposureController=
this.getExtension=this.wakeAnimatedMaterials=this.sleepAnimatedMaterials=this.findAvatar=this.removeAnchor=this.addAvatar=this.addAnchor=this.captureImage=this.switchToView=this.setMaterialForMesh=this.setMaterialForNode=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=e};this._sceneLoadComplete=function(){G(Ba.sceneLoadComplete);Ba.sceneLoadComplete=[];qa=!0;for(var U=m.makeIterator(Ea),ua=U.next();!ua.done;ua=U.next())ua.value.enableLightProbe()};
this.openUrl=function(U,ua){if(ua||a)return window.open(U);window.location.href=U};this.onNextPageInteraction=function(U){Ba.nextPageInteraction.push(U)};this.onViewerConfigLoaded=function(U){fa?U(fa):Ba.viewerConfigLoaded.push(U)};this.isSceneReadyToDisplay=function(){return null!==J};this.onSceneReadyToDisplay=function(U){J?U(J):Ba.sceneReadyToDisplay.push(U)};this.onSceneLoadComplete=function(U){qa?U(J):Ba.sceneLoadComplete.push(U)};this.requestFrame=function(){ka&&ka.requestFrame()};this.setNodeTypeEditable=
function(U){console.assert(null===J,"setNodeTypeEditable must be called before the scene is loaded");c.setNodeTypeEditable(U)};this.setMaterialEditable=function(U){console.assert(null===J,"setMaterialEditable must be called before the scene is loaded");c.setMaterialEditable(U)};this.setAllMaterialsEditable=function(){console.assert(null===J,"setAllMaterialsEditable must be called before the scene is loaded");c.setAllMaterialsEditable()};this.onCameraPositionUpdated=function(U){J.camera.addEventListener("positionChanged",
U)};this.removeOnCameraPositionUpdated=function(U){J.camera.removeEventListener("positionChanged",U)};this.onNodeTypeClicked=function(U,ua){"function"===typeof U?Ba.anyNodeTypeClicked.push(U):P(Ba.nodeTypeClicked,U).push(ua);Y=!0};this.removeOnNodeTypeClicked=function(U,ua){"function"===typeof U?Ia(U,Ba.anyNodeTypeClicked):Ia(ua,Ba.nodeTypeClicked[U])};this.onMaterialClicked=function(U,ua){this.setMaterialEditable(U);P(Ba.materialClicked,U).push(ua);Y=!0};this.onNodeTypeHoverChanged=function(U,ua){this.setNodeTypeEditable(U);
P(Ba.nodeTypeHoverChanged,U).push(ua)};this.onMaterialHoverChanged=function(U,ua){this.setMaterialEditable(U);P(Ba.materialHoverChanged,U).push(ua)};this.onViewSwitchStarted=function(U){Ba.viewSwitchStarted.push(U)};this.onViewSwitchDone=function(U){Ba.viewSwitchDone.push(U)};this.onVrChange=function(U){Ba.vrChange.push(U)};this.onBeforeRender=function(U){Ba.beforeRender.push(U)};this.createTextureFromHtmlImage=function(U,ua){function Na(){ab.needsUpdate=!0;ab.width=U.naturalWidth;ab.height=U.naturalHeight;
C.Math.isPowerOfTwo(ab.width)&&C.Math.isPowerOfTwo(ab.height)||(ab.minFilter=Mb.LINEAR);ab.notifyLoaded()}function eb(){Na();kb&&kb();U.onload=kb}ua=void 0===ua?!1:ua;var ab=new cd;ab.image=U;ab.wrapS=ab.wrapT=Mb.REPEAT;ab.minFilter=Mb.LINEAR_MIPMAP_LINEAR;ab.anisotropy=S.DEFAULT_ANISOTROPY;ab.format=ua?Mb.RGBA:Mb.RGB;ab.hasAlpha=ua;var kb=null;U.complete&&0!==U.naturalHeight?Na():(kb=U.onload,U.onload=eb);return ab};this.createTextureFromHtmlVideo=function(U){var ua=new fd;ua.video=U;ua.minFilter=
Mb.LINEAR;ua.anisotropy=S.DEFAULT_ANISOTROPY;ua.format=Mb.RGB;ua.generateMipmaps=!1;U.setAttribute("playsinline","");U.setAttribute("webkit-playsinline","");U.crossOrigin="anonymous";cb(U,function(Na){ua.width=Na.videoWidth;ua.height=Na.videoHeight;C.Math.isPowerOfTwo(ua.width)&&C.Math.isPowerOfTwo(ua.height)?(ua.wrapS=Mb.REPEAT,ua.wrapT=Mb.REPEAT):(ua.wrapS=Mb.CLAMP_TO_EDGE,ua.wrapT=Mb.CLAMP_TO_EDGE);ua.notifyLoaded()});return ua};this.createStreamTextureFromHtmlVideo=function(U){U=this.createTextureFromHtmlVideo(U);
U._interruptible=!1;return U};this.addAnchor=function(){d("add anchors")};this.removeAnchor=function(){d("remove anchors")};this.addAvatar=function(){d("add avatars")};this.removeAvatar=function(){d("remove avatars")};this.findAvatar=function(){d("find avatars")};this.sleepAnimatedMaterials=function(){d("sleep animated materials")};this.wakeAnimatedMaterials=function(){d("wake animated materials")};this.getExtension=function(){d("get extension")};this.getExposureController=function(){d("get exposure controller")};
this.onAnchorsVisibilityChanged=function(U){Ba.anchorsVisibilityChanged.push(U)};this.removeAnchorsVisibilityChangedListener=function(U){Ba.anchorsVisibilityChanged=Ba.anchorsVisibilityChanged.filter(function(ua){return ua!==U})};this.seeItem=this.captureImage=this.switchToView=this.setMaterialForNode=this.getSceneBoundingBox=this.getCameraRotation=this.getCameraPosition=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=e;this.getViewerAssetUrl=
function(U){return ob(U)};this.addMenuButton=function(U){return b.addExtraButton(U)};this.removeMenuButton=function(U){b.removeExtraButton(U)};this.getMenuButtonIcon=function(U){return b.getExtraButonIcon(U)};Object.defineProperty(this,"menuVisible",{get:function(){return b.visible},set:function(U){b.visible=U}});this.onMenuVisibilityChanged=function(U){b.addEventListener("visibilityChanged",function(){U()})};Object.defineProperty(this,"helpVisible",{get:function(){return b.helpVisible},set:function(U){b.helpVisible=
U}});this.play=function(){Hn?po():In=!0};var Ib={};this.apiUserChangeState=function(U,ua){nb(Ib[U],ua)||(Ib[U]=mb(ua),ua=ib(ua),G(Ba.apiUserStateChanged[U],U,ua),G(Ba.anyApiUserStateChanged,U,ua))};this.onApiUserStateChanged=function(U,ua){"function"===typeof U?Ba.anyApiUserStateChanged.push(U):P(Ba.apiUserStateChanged,U).push(ua)};this.removeOnApiUserStateChanged=function(U,ua){"function"===typeof U?Ia(U,Ba.anyApiUserStateChanged):Ia(ua,Ba.apiUserStateChanged[U])};this.getApiUserState=function(U){if(void 0===
U)return ib(Ib);U=Ib[U];return void 0===U?void 0:ib(U)};this._meetingJoined=function(U){console.assert(null===Ka);Ka=U;G(Ba.meetingJoined,Ka)};this._isMeeting=function(){return S.urlHashContains("meeting-key")||S.urlHashContains("meeting")};this._onMeetingJoined=function(U){Ba.meetingJoined.push(U);null!==Ka&&U(Ka)};this._removeOnMeetingJoined=function(U){Ia(U,Ba.meetingJoined)};this._onAvatarListChanged=function(U){Ba.avatarListChanged.push(U)};this._removeOnAvatarListChanged=function(U){Ia(U,Ba.avatarListChanged)};
this._createPointerEventHelper=function(U){return new Se(X,U)};this._disableControls=function(){aa.disable()};this._enableControls=function(){aa.enable()};var Dc=new Qe;this._findIntersectionAtPosition=function(U,ua){Q.findIntersectionAtPosition(U,ua,!0,Dc);return Dc};this.getWalkMaxSpeed=function(){console.assert(J,"getWalkMaxSpeed must be called after the scene is loaded");return J.camera.moveMaxSpeed};this.setWalkMaxSpeed=function(U){console.assert(J,"setWalkMaxSpeed must be called after the scene is loaded");
J.camera.moveMaxSpeed=U};this.openPopup=function(U,ua,Na){ua=void 0===ua?{}:ua;return hp(U,ua,Na)};this.enableMinimap=function(){console.assert(J,"enableMinimap must be called after the scene is loaded");J.minimapConfig.enabled=!0};this.disableMinimap=function(){console.assert(J,"disableMinimap must be called after the scene is loaded");J.minimapConfig.enabled=!1};this.isMinimapEnabled=function(){console.assert(J,"isMinimapEnabled must be called after the scene is loaded");return J.minimapConfig.enabled};
this.vrEnabled=function(){console.assert(J,"vrEnabled must be called after the scene is loaded");return ja.vrEnabled()};this.enableVr=function(){console.assert(J,"enableVr must be called after the scene is loaded");ja.vrEnabled()||ja.enableVr(ca.context)};this.disableVr=function(){console.assert(J,"disableVr must be called after the scene is loaded");ja.vrEnabled()&&ja.disableVr()}};function ip(){Dd.call(this,"static_render_vertex.glsl","static_render_fragment.glsl");this.uniforms={staticRender:{type:"t",value:null},sizeInv:{type:"v2",value:new C.Vector2}}}ip.prototype=Object.create(Dd.prototype);ip.prototype.constructor=ip;function jp(a){a=yk(a,{antialias:!1});a.autoClear=!1;a.autoUpdateObjects=!1;a.sortObjects=!1;return a};function kp(){function a(h,l,n){return(0<=h?h-1:h+l/n)*n}var b=this,c=new C.Vector3,d=new C.Vector3,e=new C.Vector3,f=new C.Vector3,g=new C.Vector3;this.objects=[];var k=null;this.vertices=[];this.normals=[];this.uvs=[];this.startObject=function(h){k={name:h||"",vertices:[],normals:[],uvs:[],hasUvs:!1};this.objects.push(k)};this.addFace=function(h,l,n,p,r,q,w,x,t){var A=this.vertices.length;h=a(h,A,3);l=a(l,A,3);n=a(n,A,3);A=b.vertices;var D=k.vertices;D.push(A[h+0],A[h+1],A[h+2]);D.push(A[l+0],A[l+
1],A[l+2]);D.push(A[n+0],A[n+1],A[n+2]);void 0!==w?(h=this.normals.length,w=a(w,h,3),x=a(x,h,3),t=a(t,h,3),h=b.normals,l=k.normals,l.push(h[w+0],h[w+1],h[w+2]),l.push(h[x+0],h[x+1],h[x+2]),l.push(h[t+0],h[t+1],h[t+2])):(t=b.vertices,x=k.normals,c.fromArray(t,h),d.fromArray(t,l),e.fromArray(t,n),g.subVectors(e,d),f.subVectors(c,d),g.cross(f),g.normalize(),x.push(g.x,g.y,g.z),x.push(g.x,g.y,g.z),x.push(g.x,g.y,g.z));void 0!==p?(t=this.uvs.length,p=a(p,t,2),r=a(r,t,2),q=a(q,t,2),t=b.uvs,x=k.uvs,x.push(t[p+
0],t[p+1]),x.push(t[r+0],t[r+1]),x.push(t[q+0],t[q+1]),k.hasUvs=!0):(q=k.uvs,q.push(0,0),q.push(0,0),q.push(0,0))}}function lp(a){if(void 0!==a&&""!==a)return parseInt(a,10)};var mp={};function np(a){a.style.display=""}function op(a){a.style.display="none"}
function pp(a){var b=null,c=null;this.showDismiss=!0;this.onDismiss=this.onClose=null;this.position=pp.DEFAULT;this.modal=this.foremost=!1;this.open=function(){null===c&&(this.modal?(b=document.createElement("div"),b.className="modal-backdrop",document.body.appendChild(b),c=document.createElement("div"),b.appendChild(c)):(c=document.createElement("div"),document.body.appendChild(c)),this.update(a))};this.hide=function(){b?op(b):op(c)};this.unhide=function(){b?np(b):np(c)};this.update=function(d){var e=
this,f=this.showDismiss?'<div class="ext-popup-close-button-panel ui-close-hoverable">\n           <div class="ext-popup-close-button"></div>\n         </div>':"",g=function(){switch(e.position){case pp.TOP:return"ui-top ui-center";case pp.DEFAULT:return"ui-upper-half-center";case pp.CENTER:return"ui-all-center";default:return console.log("Invalid popup position: "+e.position),"ui-all-center"}}();c.innerHTML='\n       <div class="ext-popup '+g+" "+(this.foremost?"ui-foremost":"")+'">\n         <div class="ext-popup-content">\n           '+
d+"\n         </div>"+f+"\n       </div>";lh(c);this.showDismiss&&(d=c.getElementsByClassName("ext-popup-close-button-panel")[0],jh(d,function(){return e.dismiss()}))};this.getElementsByClassName=function(d){return c.getElementsByClassName(d)};this.dismiss=function(){if(null!==c&&(this.close(),this.onDismiss))this.onDismiss()};this.close=function(){if(null!==c&&(this.modal?(document.body.removeChild(b),b=null):document.body.removeChild(c),c=null,this.onClose))this.onClose()}}pp.CENTER="center";
pp.DEFAULT="default";pp.TOP="top";
mp={removeChildren:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},addChangeHandler:function(a,b){document.getElementById(a).onchange=b},show:np,hide:op,setVisibility:function(a,b){b?np(a):op(a)},setButtonHighlight:function(a,b){b?a.classList.add("ext-meeting-button-highlight"):a.classList.remove("ext-meeting-button-highlight")},highlightInput:function(a){a.classList.add("ext-meeting-input-missing");window.setTimeout(function(){a.classList.remove("ext-meeting-input-missing")},200)},highlightText:function(a){a.classList.add("ext-meeting-text-highlighted");
window.setTimeout(function(){a.classList.remove("ext-meeting-text-highlighted")},200)},UiPopup:pp,showMessage:function(a,b){var c="";b&&(c='<h3 class="ext-meeting-dialog-title">'+b+"</h3>");var d=new pp(c+('\n      <div class="ext-meeting-dialog-message">\n        '+a+'\n      </div>\n      <div class="ext-meeting-dialog-buttons">\n        <button class="ext-meeting-button">\n          Close\n        </button>\n      </div>\n    '));d.showDismiss=!1;d.foremost=!0;d.modal=!0;d.open();d.getElementsByClassName("ext-meeting-button")[0].onclick=
function(){d.close()}},showIframePopup:function(a,b,c){var d=new pp('\n      <div class="ext-meeting-dialog-iframe-container">\n        <h3 class="ext-meeting-dialog-title">'+a+'</h3>\n        <iframe src="'+b+'" class="ext-meeting-dialog-iframe">\n        </iframe>\n        <div>\n          <div class="ext-meeting-dialog-buttons">\n            <button class="ext-meeting-button">\n              Close\n            </button>\n          </div>\n        </div>\n      <div>\n    ');d.showDismiss=!1;d.position=
pp.CENTER;d.onClose=c;d.open();var e=d.getElementsByClassName("ext-meeting-dialog-iframe")[0];e.style.visibility="hidden";e.onload=function(){e.style.visibility="visible"};d.getElementsByClassName("ext-meeting-button")[0].onclick=function(){return d.close()}}};var qp={},rp=null;function sp(){null===rp&&(rp=new (window.AudioContext||window.webkitAudioContext));return rp}
function tp(a,b,c){this._frequencyDiv=b;this._noSoundThreshold=c;this._maxFrequencyIndex=this._minFrequencyIndex=-1;this._noSoundCalls=0;this._source=null;this._analyser=sp().createAnalyser();this._analyser.fftSize=2*this._frequencyDiv;this._analyser.smoothingTimeConstant=.5;a=new MediaStream([a.mediaStreamTrack]);this._source=sp().createMediaStreamSource(a);this._source.connect(this._analyser);a=sp().sampleRate/this._frequencyDiv;this._minFrequencyIndex=Math.floor(tp._minVoiceFrequency/a);this._maxFrequencyIndex=
Math.floor(tp._maxVoiceFrequency/a);this._dataArray=new Uint8Array(this._maxFrequencyIndex+1)}tp.prototype.measureSoundVolume=function(){var a=this._getOverallSoundVolume();return this._shouldSkipNoSoundNotification(a)?null:a};tp.prototype.dispose=function(){null!==this._source&&(this._source.disconnect(),this._source=null)};
tp.prototype._getOverallSoundVolume=function(){this._analyser.getByteFrequencyData(this._dataArray);for(var a=0,b=this._minFrequencyIndex;b<=this._maxFrequencyIndex;b++)this._dataArray[b]>a&&(a=this._dataArray[b]);return a};tp.prototype._shouldSkipNoSoundNotification=function(a){if(a<this._noSoundThreshold)return this._noSoundCalls++,this._noSoundCalls<tp._skippedNoSoundCalls;this._noSoundCalls=0;return!1};tp._minVoiceFrequency=85;tp._maxVoiceFrequency=350;tp._skippedNoSoundCalls=3;
function up(a,b,c,d){this._width=a;this._height=b;this._bottomMargin=void 0!==d?d:0;this._volumeRect=null;this._rectId=up._baseRectId+up._counter;up._counter++;this._noSoundThreshold=c;this._lengthCoef=a/(255-this._noSoundThreshold)}
up.prototype.getHTML=function(){this._volumeRect=null;return'\n        <svg style="filter: drop-shadow(0px 0px 1px black);\n                    margin-bottom: '+this._bottomMargin.toString()+'px;"\n             width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n          <rect id="'+this._rectId+'"\n                x = "'+(this._width/2-1).toString()+'" y = "0"\n                width="'+(1).toString()+'"\n                height="'+this._height.toString()+'"\n                fill="red"/>\n        </svg>\n      '};
up.prototype.getEmptyHTML=function(){return'\n        <svg width="'+this._width.toString()+'px"\n             height="'+this._height.toString()+'px">\n        </svg>\n      '};
up.prototype.update=function(a){null===this._volumeRect&&(this._volumeRect=document.getElementById(this._rectId));console.assert(null!==this._volumeRect,"Volume visualizer HTML not attached to any element");if(null!==a){var b=this._getColor(a),c=Math.max(up._minimalDisplayedValue,Math.max(a,this._noSoundThreshold)-this._noSoundThreshold);a=this._width/2-c*this._lengthCoef/2;c*=this._lengthCoef;this._volumeRect.setAttribute("fill",b);this._volumeRect.setAttribute("x",a.toString());this._volumeRect.setAttribute("width",
c.toString())}};up.prototype._getColor=function(a){return a<this._noSoundThreshold?"red":a<up._lowSoundThreshold?"orange":"green"};up._counter=0;up._baseRectId="ext-meeting-mic-bar-";up._lowSoundThreshold=180;up._minimalDisplayedValue=20;qp={VolumeMeter:tp,VolumeVisualizer:up};var vp,wp={name:"mic"},xp={name:"camera",facingMode:"user",width:480,height:360,frameRate:24};function yp(a,b){return a?b[0].toUpperCase()+b.slice(1):b[0].toLowerCase()+b.slice(1)}function zp(a,b){var c=void 0!==b;c=yp(!0,a.name)+(c?" and "+yp(!1,b.name):"");a=a.error.name;console.assert(void 0===b||b.error.name===a);return"NotFoundError"===a?c+" not found":"NotAllowedError"===a?c+" blocked":"Error"===a?"Error":c+" not available"}
function Ap(a,b){var c=void 0!==b,d=c?"they are":"it is",e=c?"them":"it",f=a.error.name;return"NotFoundError"===f?"Check if your "+(yp(!1,a.name)+(c?" and "+yp(!1,b.name):""))+" "+(c?"are":"is")+" properly connected.":"NotAllowedError"===f?Bc.mobile?Bc.ios?"Unblock "+e+" by clicking "+(c?a.unblockIcon+" and "+b.unblockIcon:"the "+a.unblockIcon)+" "+(c?"buttons":"button")+".":"Unblock "+e+" in the browser settings for this webpage.":"Unblock "+e+" by clicking the "+(c?b.unblockIcon:a.unblockIcon)+
" button in the browser\u2019s address bar and refresh the webpage.":"Error"===f?"Your browser doesn't support video meetings. Open the meeting link in another browser.":"If "+d+" connected, close all other applications using "+(e+" and refresh the webpage.")}function Bp(a,b,c,d){this._firstErrorDiv=document.getElementById(a);this._secondErrorDiv=document.getElementById(b);this._devicePreview1=c;this._devicePreview2=d}
Bp.prototype._reset=function(){this._devicePreview1.setErrorDiv(null);this._devicePreview2.setErrorDiv(null);mp.removeChildren(this._firstErrorDiv);mp.removeChildren(this._secondErrorDiv)};
Bp.prototype._displayAndLogErrorMessage=function(a,b,c){function d(g){if(void 0!==g)return g.device}var e=zp(b.device,d(c)),f=Ap(b.device,d(c));a.innerHTML='\n        <div class="ext-meeting-join-error-title">'+e+'</div>\n        <div class="ext-meeting-join-error-description">'+f+"</div>\n      ";b.setErrorDiv(a);b.device.logError();void 0!==c&&(c.setErrorDiv(a),c.device.logError())};
Bp.prototype.update=function(){this._reset();var a=this._devicePreview1.device.error,b=this._devicePreview2.device.error;if(null!==a||null!==b)null!==a&&null!==b?a.name===b.name?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1,this._devicePreview2):(this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1),this._displayAndLogErrorMessage(this._secondErrorDiv,this._devicePreview2)):null!==a?this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview1):
this._displayAndLogErrorMessage(this._firstErrorDiv,this._devicePreview2)};function Cp(a,b){this._name=a;this._active=!1;this._unblockIcon=b;this._error=this._track=this._trackOptions=null}Cp.prototype.logError=function(){null!==this._error&&zc.log("Can't create local "+this.name+" track : "+(this._error.name+", "+this._error.message))};Cp.prototype._getLabel=function(){return this._track?this._track.mediaStreamTrack.label:null};
Cp.prototype.getId=function(){return this._trackOptions&&this._trackOptions.deviceId?this._trackOptions.deviceId.exact:null};Cp.prototype.getErrorMessageInfo=function(){if(null===this._error)return null;var a=zp(this),b=Ap(this);return{title:a,description:b}};
m.global.Object.defineProperties(Cp.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},track:{configurable:!0,enumerable:!0,get:function(){return this._track},set:function(a){this._track=a}},active:{configurable:!0,enumerable:!0,get:function(){return this._active},set:function(a){this._active=a}},unblockIcon:{configurable:!0,enumerable:!0,get:function(){return this._unblockIcon}},error:{configurable:!0,enumerable:!0,get:function(){return this._error},set:function(a){this._error=
a}},trackOptions:{configurable:!0,enumerable:!0,get:function(){return this._trackOptions},set:function(a){this._trackOptions=a}}});
function Dp(a,b,c,d,e,f,g){this._device=new Cp(a,g);this._width=c;this._height=d;this._toggleButton=document.getElementById(e);this._previewContainer=document.getElementById(f);this._errorDiv=null;this._meetingStarter=b;kh(this._toggleButton.id,this._onToggleButtonClicked.bind(this));this._onStoppedBound=this._onStopped.bind(this);this._twilioCreateTrackFunction=null}Dp.prototype.isAvailable=function(){return null!==this._device.track};
Dp.prototype.dispose=function(){null!==this._device.track&&this._device.track.removeListener("stopped",this._onStoppedBound);this._close()};Dp.prototype._pauseMonitoringTrackBeforeReset=function(){this._device.track.removeListener("stopped",this._onStoppedBound)};Dp.prototype._resumeMonitoringTrackAfterReset=function(){this._device.track.addListener("stopped",this._onStoppedBound)};Dp.prototype.setErrorDiv=function(a){this._errorDiv=a};Dp.prototype.showInTestNeededMode=function(){this.setError({name:"Test needed"})};
Dp.prototype.showInPreviewMode=function(){this.setError({name:"Initializing"});this.setToggleButtonVisibility(!0)};Dp.prototype.createTrack=function(a){var b=this;return new Promise(function(c){var d=a?a:b._device.trackOptions;b._twilioCreateTrackFunction(ib(d)).then(function(e){b.setTrack(e,d)}).catch(function(e){b.setTrack(null,d,e)}).finally(function(){b._toggleButton.disabled=!1;c()})})};
Dp.prototype.updateTrackDeviceId=function(a){function b(d,e){return(d=d.find(function(f){return f.label===e}))?d.deviceId:null}if(this._device.track&&!this._device.trackOptions.deviceId){var c=this._device._getLabel();a=b(a,c);console.assert(null!==a,"deviceId not found");this._device.trackOptions={name:this._device.trackOptions.name,deviceId:{exact:a}}}};
Dp.prototype.setTrack=function(a,b,c){b&&(this._device.trackOptions=b);null!==a&&void 0!==c?console.assert("Invalid setTrack parameters : track and error set"):null===a&&void 0===c&&console.assert("Invalid setTrack parameters : track and error not set");this._disposeTrack();this._device.track=a;null!==this._device.track?(this._device.track.on("stopped",this._onStoppedBound),this._device.active=!0,this._showTrack(),this.setError(null)):(this._device.active=!1,this._hideTrack(),this.setError(c));this._meetingStarter.updateErrorMessage();
this._updateToggleButtonState()};Dp.prototype.setError=function(a){this._device.error=a};
Dp.prototype.restartTrack=function(a){var b=this;this._toggleButton.disabled=!0;this.isAvailable()?(this._pauseMonitoringTrackBeforeReset(),this._device.trackOptions=a,this._device.track.restart(ib(a)).then(function(){b._resumeMonitoringTrackAfterReset();b._meetingStarter.updateErrorMessage();b._toggleButton.disabled=!1}).catch(function(){zc.log("Second attempt to create track,device: "+b._device.name);window.setTimeout(function(){return b.createTrack(a)},1E3)})):this.createTrack(a)};
Dp.prototype.setToggleButtonVisibility=function(a){mp.setVisibility(this._toggleButton,a)};Dp.prototype._updateToggleButtonState=function(){this._device.active?(mp.setButtonHighlight(this._toggleButton,!1),mp.setVisibility(this._toggleButton.children[0],!0),mp.setVisibility(this._toggleButton.children[1],!1)):(mp.setButtonHighlight(this._toggleButton,!0),mp.setVisibility(this._toggleButton.children[0],!1),mp.setVisibility(this._toggleButton.children[1],!0))};
Dp.prototype._disposeTrack=function(){if(null!==this._device.track){var a=this._device.track;a.removeListener("stopped",this._onStoppedBound);a.detach();a.stop()}this._device.track=null};Dp.prototype._onStopped=function(){null!==this._device.track&&this.setTrack(null,null,{name:"NotReadableError",message:"Stopped"})};Dp.prototype._close=function(){mp.removeChildren(this._previewContainer)};Dp.prototype._setPreviewInnerHTML=function(a){this._close();this._previewContainer.innerHTML=a;mp.show(this._previewContainer)};
Dp.prototype._setPreviewElement=function(a){this._close();null!==a&&(a.style.width=this._width.toString()+"px",a.style.height=this._height.toString()+"px",this._previewContainer.appendChild(a),mp.show(this._previewContainer))};Dp.prototype._showTrack=function(){this._device.active=!0;this._device.track.enable()};Dp.prototype._hideTrack=function(){this._device.active=!1};
Dp.prototype._onToggleButtonClicked=function(){var a=this;this.isAvailable()?(this._device.active?this._onSwitchOff():this._onSwitchOn(),this._updateToggleButtonState()):this.createTrack().then(function(){a._device.error&&mp.highlightText(a._errorDiv)})};Dp.prototype._onSwitchOff=function(){this._hideTrack();this._device.track.disable()};Dp.prototype._onSwitchOn=function(){this._showTrack();this._device.track.enable()};
m.global.Object.defineProperties(Dp.prototype,{device:{configurable:!0,enumerable:!0,get:function(){return this._device}}});function Ep(a,b,c,d,e){Dp.call(this,"Camera",a,b,c,d,e,'<span class="fa-video-slash"></span>');this._twilioCreateTrackFunction=Twilio.Video.createLocalVideoTrack;this._device.trackOptions=xp}m.inherits(Ep,Dp);Ep.prototype.showInTestNeededMode=function(){Dp.prototype.showInTestNeededMode.call(this);this._showPlaceholder()};
Ep.prototype.showInPreviewMode=function(){Dp.prototype.showInPreviewMode.call(this);this._showPlaceholder()};Ep.prototype._showPlaceholder=function(){this._setPreviewInnerHTML('\n        <div class="ext-meeting-join-camera-preview-placeholder">\n          <span class="fa-video absolute-center"></span>\n        </div>\n      ')};Ep.prototype._hideTrack=function(){Dp.prototype._hideTrack.call(this);this._showPlaceholder()};Ep.prototype._showTrack=function(){Dp.prototype._showTrack.call(this);this._setPreviewElement(this._device.track.attach())};
Ep.prototype._onSwitchOff=function(){Dp.prototype._onSwitchOff.call(this);this.setTrack(null,null,null)};function Fp(a,b,c,d,e){Dp.call(this,"Microphone",a,b,c,d,e,'<span class="fa-microphone-slash"></span>');this._noSoundThreshold=80;this._volumeVisualizer=new qp.VolumeVisualizer(b,c,this._noSoundThreshold);this._measurementIntervalId=this._volumeMeter=null;this._twilioCreateTrackFunction=Twilio.Video.createLocalAudioTrack;this._device.trackOptions=wp}m.inherits(Fp,Dp);
Fp.prototype.showInTestNeededMode=function(){Dp.prototype.showInTestNeededMode.call(this);this._setPreviewElement(null)};Fp.prototype.showInPreviewMode=function(){Dp.prototype.showInPreviewMode.call(this);this._setPreviewElement(null)};Fp.prototype.dispose=function(){this._isMeasurementActive()&&this._stopMeasurement();Dp.prototype.dispose.call(this)};Fp.prototype._measure=function(){this._volumeVisualizer.update(this._volumeMeter.measureSoundVolume())};
Fp.prototype._hideTrack=function(){Dp.prototype._hideTrack.call(this);this._isMeasurementActive()&&this._stopMeasurement();this._setPreviewElement(null)};Fp.prototype._showTrack=function(){Dp.prototype._showTrack.call(this);this._setPreviewInnerHTML(this._volumeVisualizer.getHTML());this._startMeasurement()};Fp.prototype._startMeasurement=function(){var a=this;this._volumeMeter=new qp.VolumeMeter(this._device.track,512,this._noSoundThreshold);this._measurementIntervalId=setInterval(function(){return a._measure()})};
Fp.prototype._stopMeasurement=function(){clearInterval(this._measurementIntervalId);this._measurementIntervalId=null;this._volumeMeter.dispose();this._volumeMeter=null};Fp.prototype._isMeasurementActive=function(){return null!==this._measurementIntervalId};Fp.prototype._pauseMonitoringTrackBeforeReset=function(){Dp.prototype._pauseMonitoringTrackBeforeReset.call(this);this._isMeasurementActive()&&this._stopMeasurement()};
Fp.prototype._resumeMonitoringTrackAfterReset=function(){Dp.prototype._resumeMonitoringTrackAfterReset.call(this);this._startMeasurement()};Fp.prototype._disposeTrack=function(){this._isMeasurementActive()&&this._stopMeasurement();Dp.prototype._disposeTrack.call(this)};
vp=function(a,b){this._onJoinCallback=a;this._joinMode=!1;this._dialog=null;this._mediaInitialized=this._preflightTestDone=!1;this._micVolumePreview=this._cameraPreview=null;this._cameraPreviewHeight=198;this._cameraPreviewWidth=264;this._micVolumePreviewHeight=4;this._micVolumePreviewWidth=40;this._onDevicesChangedBound=this._onDevicesChanged.bind(this);this._errorMessageActive=!0;this._runPrefilghtTest(b)};
vp.prototype.show=function(){var a=this;this._blurHelp();this._createDialog();this._cameraPreview=new Ep(this,this._cameraPreviewWidth,this._cameraPreviewHeight,"ext-meeting-join-camera-toggle","ext-meeting-join-camera-preview-container");this._micVolumePreview=new Fp(this,this._micVolumePreviewWidth,this._micVolumePreviewHeight,"ext-meeting-join-mic-toggle","ext-meeting-join-mic-volume-container");this._errorMessageGenerator=new Bp("ext-meeting-join-first-error","ext-meeting-join-second-error",this._micVolumePreview,
this._cameraPreview);this._setupDevicesSelection();this._checkPermissions().then(function(){a._runPreviewMode(!1);a._createMediaTracksSeparately(xp,wp,function(){return a._onMediaInitialized()})}).catch(function(b){void 0!==b&&zc.log("Error checking audio/video devices permissions: "+b.name+": "+b.message);a._runTestNeededMode()})};
vp.prototype._checkPermissions=function(){return new Promise(function(a,b){return navigator.mediaDevices.enumerateDevices().then(function(c){var d=c.filter(function(e){return"audioinput"===e.kind&&""!==e.deviceId&&""!==e.label});c=c.filter(function(e){return"videoinput"===e.kind&&""!==e.deviceId&&""!==e.label});0<d.length||0<c.length?a():b()}).catch(function(c){b(c)})})};
vp.prototype._setupDevicesSelection=function(){var a=this;mp.addChangeHandler("ext-meeting-join-select-camera",function(b){a._cameraPreview.restartTrack({name:"camera",deviceId:{exact:b.currentTarget.value}})});mp.addChangeHandler("ext-meeting-join-select-microphone",function(b){a._micVolumePreview.restartTrack({name:"mic",deviceId:{exact:b.currentTarget.value}})});navigator.mediaDevices.addEventListener("devicechange",this._onDevicesChangedBound)};
vp.prototype._onDevicesChanged=function(){if(this._joinMode){var a=this._cameraPreview.device.error,b=this._micVolumePreview.device.error;a||b?this._createMediaTracksSeparately(a?xp:null,b?wp:null):this._fillDevicesSelectControls()}};
vp.prototype._fillDevicesSelectControls=function(){var a=this;navigator.mediaDevices.enumerateDevices().then(function(b){a._cameraPreview.updateTrackDeviceId(b);a._micVolumePreview.updateTrackDeviceId(b);var c=b.filter(function(d){return"audioinput"===d.kind});a._fillDevicesSelectControl(c,"ext-meeting-join-select-microphone-container","ext-meeting-join-select-microphone",a._micVolumePreview.device.getId());b=b.filter(function(d){return"videoinput"===d.kind});a._fillDevicesSelectControl(b,"ext-meeting-join-select-camera-container",
"ext-meeting-join-select-camera",a._cameraPreview.device.getId())})};vp.prototype._fillDevicesSelectControl=function(a,b,c,d){b=document.getElementById(b);var e=document.getElementById(c);mp.setVisibility(b,1<a.length);mp.removeChildren(e);1<a.length&&(a.forEach(function(f){var g=document.createElement("option");g.value=""+f.deviceId;Sa(g,""+f.label);e.appendChild(g)}),e.value=d)};
vp.prototype._createDialog=function(){var a=this;this._dialog=new mp.UiPopup('\n        <h3 class="ext-meeting-dialog-title">Join 3D meeting</h3>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-name-label">\n            Name:\n          </div>\n          <input type="text" id="ext-meeting-join-name"\n                 class="ext-meeting-join-input"\n                 autocomplete="off">\n          </input>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div class="ext-meeting-join-main-container">\n            <div id="ext-meeting-join-error-container"\n                 class="absolute-vertical-center">\n              <div id="ext-meeting-join-first-error"></div>\n              <div id="ext-meeting-join-second-error"></div>\n            </div>\n            <div id="ext-meeting-join-camera-preview-container"></div>\n            <div id="ext-meeting-join-mic-volume-container"></div>\n            <div id="ext-meeting-join-preview-toggle-container"\n                 class="absolute-horizontal-center">\n              <button id="ext-meeting-join-mic-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-microphone" style="display: none"></span>\n                <span class="fa-microphone-slash"></span>\n              </button>\n              <button id="ext-meeting-join-camera-toggle" style="display: none"\n                      class="ext-meeting-button ext-meeting-button-highlight\n                            ext-meeting-join-device-button">\n                <span class="fa-video" style="display: none"></span>\n                <span class="fa-video-slash"></span>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="ext-meeting-join-row">\n          <div id="ext-meeting-join-select-camera-container"\n               style="display: none">\n            Camera:\n            <select id="ext-meeting-join-select-camera"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n          <div id="ext-meeting-join-select-microphone-container"\n               style="display: none">\n            Microphone:\n            <select id="ext-meeting-join-select-microphone"\n                    class="ext-meeting-join-input">\n            </select>\n          </div>\n        </div>\n        <div id="ext-meeting-join-network-error-container" style="display: none">\n          <div>Network issues detected.</div>\n          <div>\n            <a href="https://networktest.twilio.com/" style="color: white" target="_blank">\n              Diagnose your connection.\n            </a>\n          </div>\n        </div>\n        <div id="ext-meeting-join-button-container"\n             class="ext-meeting-join-row">\n          <button id="ext-meeting-join-button"\n                  class="ext-meeting-button ext-meeting-dialog-buttons">\n                  Join\n          </button>\n        </div>\n        <div class="ext-meeting-join-footer">\n          By joining, you agree to the\n          <span id="terms-of-service-link" class="ext-meeting-terms-link"><u>\n            Terms of Service </u></span> and\n          <span id="privacy-policy-link" class="ext-meeting-terms-link"><u>\n            Privacy Policy</u></span>.\n        </div>\n      ');this._dialog.showDismiss=
!1;this._dialog.foremost=!0;this._dialog.open();document.getElementById("terms-of-service-link").onclick=function(){a._dialog.hide();mp.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Terms of Service","https://www.shapespark.com/terms#in-viewer",function(){return a._dialog.unhide()})};document.getElementById("privacy-policy-link").onclick=function(){a._dialog.hide();mp.showIframePopup("The 3D meeting infrastructure is provided by Shapespark under the following Privacy Policy",
"https://www.shapespark.com/privacy#in-viewer",function(){return a._dialog.unhide()})};this._initializeDisplayName()};vp.prototype._createMediaTracksSeparately=function(a,b,c){function d(){e._fillDevicesSelectControls();e._errorMessageActive=!0;e.updateErrorMessage();c&&c()}var e=this;this._errorMessageActive=!1;a&&b?this._cameraPreview.createTrack(a).then(function(){return e._micVolumePreview.createTrack(b)}).then(function(){d()}):a?this._cameraPreview.createTrack(a).then(function(){d()}):this._micVolumePreview.createTrack(b).then(function(){d()})};
vp.prototype._runTestNeededMode=function(){this._setTestNeededMode();this._cameraPreview.showInTestNeededMode();this._micVolumePreview.showInTestNeededMode()};vp.prototype._runPreviewMode=function(a){this._setPreviewMode(a);a?(this._cameraPreview.setToggleButtonVisibility(!0),this._micVolumePreview.setToggleButtonVisibility(!0)):(this._cameraPreview.showInPreviewMode(),this._micVolumePreview.showInPreviewMode())};
vp.prototype._onCreateMediaTracks=function(a,b,c){var d=a.filter(function(e){return"audio"===e.kind});a=a.filter(function(e){return"video"===e.kind});this._errorMessageActive=!1;0<d.length?this._micVolumePreview.setTrack(d[0],b):this._micVolumePreview.setTrack(null,b,{name:"Unknown error",message:""});0<a.length?this._cameraPreview.setTrack(a[0],c):this._cameraPreview.setTrack(null,c,{name:"Unknown error",message:""});this._errorMessageActive=!0;this.updateErrorMessage();this._fillDevicesSelectControls();
this._runPreviewMode(!0)};vp.prototype._testCamera=function(){var a=this,b={audio:ib(wp),video:ib(xp)};Twilio.Video.createLocalTracks(b).then(function(c){a._onCreateMediaTracks(c)}).catch(function(){a._createMediaTracksSeparately(xp,wp,function(){return a._runPreviewMode(!0)})})};
vp.prototype._setTestNeededMode=function(){var a=this;this._joinMode=!1;var b=document.getElementById("ext-meeting-join-button-container");mp.removeChildren(b);b.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-test-button">\n          Test camera\n        </button>\n      ';kh("ext-meeting-test-button",function(){return a._testCamera()})};
vp.prototype._setPreviewMode=function(a){var b=this;if(!this._joinMode){this._joinMode=!0;var c=document.getElementById("ext-meeting-join-button-container");mp.removeChildren(c);c.innerHTML='\n        <button class="ext-meeting-button ext-meeting-dialog-buttons"\n                id="ext-meeting-join-button">\n          Join\n        </button>\n      ';this._mediaInitialized=!0;this._updateJoinButtonState();kh("ext-meeting-join-button",function(){return b._joinMeeting()});a||this._setMediaInitialized(!1)}};
vp.prototype._onMediaInitialized=function(){this._setMediaInitialized(!0)};vp.prototype._updateJoinButtonState=function(){var a=document.getElementById("ext-meeting-join-button");a&&(a.disabled=!(this._preflightTestDone&&this._mediaInitialized))};vp.prototype._setMediaInitialized=function(a){this._mediaInitialized=a;this._updateJoinButtonState()};vp.prototype._setPreflightTestDone=function(){this._preflightTestDone=!0;this._updateJoinButtonState()};
vp.prototype._initializeDisplayName=function(){var a=document.getElementById("ext-meeting-join-name"),b=localStorage.getItem("extMtgDisplayName");b&&(a.value=b);a.focus();a.select()};vp.prototype._checkDisplayName=function(){var a=document.getElementById("ext-meeting-join-name"),b=a.value.trim();if(b)return b;mp.highlightInput(a)};vp.prototype._blurHelp=function(){document.getElementById("help-and-primary-progress").classList.add("ui-blur")};
vp.prototype._unblurHelp=function(){var a=document.getElementById("help-and-primary-progress");a.classList.remove("ui-blur");a.classList.add("ui-unblur")};
vp.prototype._runPrefilghtTest=function(a){var b=this,c=new Promise(function(e,f){var g=(new Date).getTime()/1E3;uc("https://pubsub.pubnub.com/time/0",null,null,function(k){console.warn("PubNub test completed, response time:",Math.abs(k[0]/1E7-g).toFixed(4)+"s");e()},function(k,h){console.error("PubNub test error:",k,h);f(Error("PubNub test failed"))})}),d=new Promise(function(e,f){var g=Twilio.Video.runPreflight(a,{duration:2E3});g.on("failed",function(k){console.error("Twilio test error:",k);f(Error("Twilio test failed"))});
g.on("completed",function(){e()})});Promise.all([c,d]).then(function(){b._setPreflightTestDone()}).catch(function(e){console.error(e);e=document.getElementById("ext-meeting-join-network-error-container");mp.show(e);b._setPreflightTestDone()})};vp.prototype._joinMeeting=function(){var a=this._checkDisplayName();if(void 0!==a){localStorage.setItem("extMtgDisplayName",a);var b=this._micVolumePreview.device,c=this._cameraPreview.device;this._dispose();this._onJoinCallback(a,b,c)}};
vp.prototype.updateErrorMessage=function(){this._errorMessageActive&&this._errorMessageGenerator.update()};vp.prototype._dispose=function(){this._dialog.close();this._unblurHelp();navigator.mediaDevices.removeEventListener("devicechange",this._onDevicesChangedBound);this._cameraPreview.dispose();this._micVolumePreview.dispose();this._micVolumePreview=this._cameraPreview=this._dialog=null};function Gp(){this._room=null;this._bars=[];this._crossLines=[];this._crossIsVisible=!1;this._updateBind=this._update.bind(this);this._qualityToBarIndex=[-1,0,0,1,2,2];this._create()}
Gp.prototype._create=function(){var a=document.getElementById("ext-meeting-quality-indicator-container");console.assert(null!==a,"Quality indicator container not found");var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("width",13);b.setAttribute("height",15);a.appendChild(b);for(a=0;3>a;a++){var c=5*(a+1);this._addBar(b,5*a,15-c,3,c)}this._addCrossLine(b,2,3,11,12);this._addCrossLine(b,2,12,11,3)};
Gp.prototype._addBar=function(a,b,c,d,e){var f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x",b);f.setAttribute("y",c);f.setAttribute("width",d);f.setAttribute("height",e);f.setAttribute("display","none");a.appendChild(f);this._bars.push(f)};
Gp.prototype._addCrossLine=function(a,b,c,d,e){var f=document.createElementNS("http://www.w3.org/2000/svg","line");f.setAttribute("x1",b);f.setAttribute("y1",c);f.setAttribute("x2",d);f.setAttribute("y2",e);f.setAttribute("stroke","red");f.setAttribute("stroke-width",2);f.setAttribute("display","none");a.appendChild(f);this._crossLines.push(f)};Gp.prototype._hideBars=function(){this._bars.forEach(function(a){a.setAttribute("display","none")})};
Gp.prototype._hideCross=function(){this._crossIsVisible&&(this._crossLines.forEach(function(a){a.setAttribute("display","none")}),this._crossIsVisible=!1)};Gp.prototype._showBars=function(){this._bars.forEach(function(a){a.setAttribute("display","block")})};Gp.prototype._showCross=function(){this._crossIsVisible||(this._crossLines.forEach(function(a){a.setAttribute("display","block")}),this._crossIsVisible=!0)};
Gp.prototype.onConnect=function(a){console.assert(null===this._room);this._room=a;this._showBars();this._update(this._room.localParticipant.networkQualityLevel);a.localParticipant.on("networkQualityLevelChanged",this._updateBind)};Gp.prototype.onDisconnect=function(){console.assert(this._room);this._room.localParticipant.removeListener("networkQualityLevelChanged",this._updateBind);this._room=null;this._hideBars();this._hideCross()};
Gp.prototype._getColor=function(a,b){return a<=this._qualityToBarIndex[b]?"white":"dimgray"};Gp.prototype._update=function(a){if(null!==a){for(var b=0;3>b;b++){var c=this._getColor(b,a);this._bars[b].setAttribute("fill",c);this._bars[b].setAttribute("stroke",c)}0===a?this._showCross():this._hideCross()}};function Hp(){function a(){var I=this;this._users=new Set;this._maxIntervalBetweenUpdates=100;this._idleCallback=new Jd(function(){return I._execute()},this._maxIntervalBetweenUpdates);Dg.onBeforeRender(function(){return I._onBeforeRender()})}function b(){var I=window.location.hostname;return I.endsWith(".shapespark.com")?"https://cloud"+I.substr(I.indexOf(".")):I.endsWith(".shapespark.com.cn")?"https://cloud.shapespark.com.cn":S.DEVEL_MEETING_CLOUD_URL||"https://cloud.shapespark.com"}function c(I){I=
new Date(I);var V=new Date;return V.getDate()===I.getDate()&&V.getMonth()===I.getMonth()&&V.getFullYear()===I.getFullYear()?I.toLocaleTimeString():I.toLocaleDateString()+" "+I.toLocaleTimeString()}function d(I,V,pa,T){var P=document.createElement("li");P.classList.add("ext-meeting-list-entry");var ca=P.appendChild(document.createElement("span"));ca.classList.add("ext-meeting-list-name");ca.innerText=I;ca.style.color=pa;T&&(jh(P,T),P.style.cursor="pointer");V&&(P.appendChild(document.createElement("br")),
I=P.appendChild(document.createElement("small")),I.innerText=V,I.style.color="white");return P}function e(I,V,pa){return{color:"#0775e8",icon:"edit",opacity:1,position:[I,V,pa],radius:.07,type:"sphere"}}function f(I,V,pa,T){T=void 0===T?!1:T;var P=new mp.UiPopup("<div>\n        <h3>"+I+'</h3>\n      </div>\n      <div class ="ext-meeting-dialog-buttons">\n        '+(V&&pa?'<button class="ext-meeting-dialog-ok ext-meeting-button">\n            '+V+"\n          </button>":"")+"\n        "+(T?'<button class="ext-meeting-dialog-cancel ext-meeting-button">\n          Cancel\n        </button>':
"")+"\n      </div>");P.showDismiss=!1;P.open();T&&(P.getElementsByClassName("ext-meeting-dialog-cancel")[0].onclick=function(){return P.dismiss()});V&&pa&&(P.getElementsByClassName("ext-meeting-dialog-ok")[0].onclick=function(){P.close();pa()})}function g(I,V){V=V.attach();I=I.createTextureFromHtmlVideo(V);I.play();return I}function k(I){I.detach().forEach(function(V){return V.remove()})}function h(I){return I&&I.isStarted&&I.isEnabled&&!I.isStopped}function l(I,V,pa){this._viewer=I;this._uuid=V;
I=parseInt(V.substring(2));this._color=S.AVATAR_COLORS[I%S.AVATAR_COLORS.length];this._twilioParticipant=this._avatar=this._displayName=null;this._lastRenderedPosition=[];this._lastRenderedPositionLength=0;this._audioTrack=this._screenTrack=this._cameraTrack=this._micTrack=this._dataTrack=null;this._noSoundThreshold=80;this._soundVolumeUpdatesScheduler=pa;this._volumeVisualizer=new qp.VolumeVisualizer(20,3,this._noSoundThreshold,3);this._volumeMeter=null}function n(I,V,pa,T,P,ca){l.call(this,I,V,
T,!0);this._displayName=pa;this._setUpAvatar();this._avatar.hideBody();this._isPublishingTracksDuringConnecting=!1;this._dataTrack=new Twilio.Video.LocalDataTrack({name:"data",maxPacketLifeTime:1E3});this._isCreatingCameraTrack=this._isCreatingMicTrack=!1;this._micDevice=P;this._cameraDevice=ca;this._micTrack=this._micDevice.track;null!==this._micTrack&&this._subscribeToMicEvents();this._updateSoundMeasurementState();this._cameraTrack=this._cameraDevice.track;null!==this._cameraTrack&&(console.assert(this._cameraDevice.active,
"Got inactive camera track from MeetingStarter"),this._subscribeToCameraEvents());this._lastPosition=null;this._positionMessage=[V,pa,null];this._onCameraTrackStateChanged=this._onMicTrackStateChanged=this._resendInterval=null}function p(I,V,pa,T){l.call(this,I,V,pa,!1);this._onUiRefreshNeeded=T;this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=this._micTrackStateChangedBound=null;this._trackSubscribedBound=this._trackSubscribed.bind(this);this._trackUnsubscribedBound=this._trackUnsubscribed.bind(this);
this._disposed=!1}function r(I,V,pa,T,P,ca){var J=new PubNub({publishKey:V.publishKey,subscribeKey:V.subscribeKey,authKey:V.authKey,uuid:I.uuid,ssl:!0}),aa=V.channel;J.subscribe({channels:[aa],withPresence:!0});J.addListener({message:function(na){zc.log("listener received message",na);"SceneState"===na.message.type&&P(na.message.state)},presence:function(na){na.uuid!==I.uuid&&(zc.log("listener presence event",na),"join"===na.action?pa(na.uuid):"leave"===na.action&&T(na.uuid))},status:function(na){"PNAccessDeniedCategory"!==
na.category&&"PNNetworkIssuesCategory"!==na.category&&"PNNetworkDownCategory"!==na.category&&"PNTimeoutCategory"!==na.category||ca(na.category)}});J.hereNow({channels:[aa],includeUUIDs:!0,includeState:!0},function(na,L){zc.log("herenow",na,L);L.channels[aa].occupants.forEach(function(Q){Q.uuid!==I.uuid&&pa(Q.uuid)})});this.dispose=function(){J.unsubscribeAll()}}function q(I,V,pa,T,P,ca,J,aa,na,L){function Q(za){var Ka=za.identity.match(/^u-\d+/);Ka=Ka&&Ka[0];return Ka?Ka:(S.warn("Unknown participant",
za.identity),null)}function ia(za){zc.log('Participant "%s" connected',za.identity);var Ka=Q(za);Ka&&pa(Ka,za)}function Z(za){zc.log('Participant "%s" disconnected',za.identity);var Ka=Q(za);Ka&&T(Ka,za)}function ka(za){za=null!==za?Q(za):null;L(za)}function ma(za){X&&(X=!1,ta.participants.forEach(Z),ta=null,I.disconnectedFromTwilio(),na(),0<Y?ca("TReconnectionDisconnected"+(za.code?" "+za.code:"")):J())}var M=V.avToken,fa=V.channel,ja=["NotAllowedError","NotFoundError","NotReadableError","OverconstrainedError",
"TypeError"],ta=null,X=!1,Y=0,qa=S.urlHashContains("av-turn");this.isConnectingOrConnected=function(){return X};this.disconnect=function(){X&&(X=!1,ta&&(ta.disconnect(),ta.participants.forEach(Z),ta=null,I.disconnectedFromTwilio(),na()))};this.dispose=function(){this.disconnect()};this.connect=function(){console.assert(!X);X=!0;I.startedConnectingToTwilio();zc.log('Connecting to room "%s"',fa);Twilio.Video.connect(M,{name:fa,tracks:I.getAllTracks(),preferredVideoCodecs:"auto",iceTransportPolicy:qa?
"relay":"all",region:va||"gll",networkQuality:{local:1,remote:1},dominantSpeaker:!0}).then(function(za){ta=za;zc.log("Connected to room");ta.participants.forEach(ia);ta.on("participantConnected",ia);ta.on("participantDisconnected",Z);ta.on("dominantSpeakerChanged",ka);ta.on("reconnecting",function(){Y+=1});ta.on("reconnected",function(){Y=0});ta.once("disconnected",ma);I.connectedToTwilio(ta.localParticipant);aa(ta)}).catch(function(za){I.failedToConnectToTwilio();ja.includes(za.name)?P(za):ca("T"+
za.code)})}}function w(I){function V(ma,M){var fa=document.createElement("span");fa.classList.add("ext-meeting-who-list-name");fa.innerText=ma;fa.style.color=M;return fa}function pa(ma){var M=document.createElement("span");M.classList.add("ext-meeting-who-list-mic-indicator");ma?M.classList.add("fa-microphone"):M.classList.add("fa-microphone-slash");return M}function T(){var ma=document.createElement("span");ma.classList.add("ext-meeting-who-list-mic-indicator");ma.classList.add("fa-file-audio-o");
return ma}function P(ma){console.assert(null!==ma.volumeVisualizer,"volumeVisualizer not initialized");var M=document.createElement("span");ma.isSoundMeasurementActive()?M.innerHTML=ma.volumeVisualizer.getHTML():M.innerHTML=ma.volumeVisualizer.getEmptyHTML();return M}var ca=document.getElementById("ext-meeting-who-list-folder"),J=document.getElementById("ext-meeting-status");lh(J);var aa=document.getElementById("ext-meeting-who-list"),na=new Gd(1E3),L=new Gd(3E3),Q=new Gd(1E3,function(){aa.style.overflowY=
"auto"});aa.addEventListener("scroll",function(){na.isRunning()||L.start()});var ia=!0;jh(ca,function(){Q.isRunning()||(ia?(ia=!1,aa.style.maxHeight=0,aa.style.margin=0,aa.style.overflowY="hidden",ca.children[0].style.transform="rotate(180deg)"):(ca.children[0].style.transform="",aa.style.maxHeight="",aa.style.margin="",Q.start(),ia=!0))});Bc.firefox&&(aa.style.paddingRight="16px");var Z=null,ka=new Map;this.onDominantSpeakerChanged=function(ma){Z&&ma!==Z&&(Z=null);if(!L.isRunning()&&null!==ma){var M=
ka.get(ma);M?(M.scrollIntoView({behavior:"smooth",block:"nearest"}),na.start()):Z=ma}};this.update=function(ma){ka.clear();mp.removeChildren(aa);var M=aa.appendChild,fa=document.createElement("li");fa.classList.add("ext-meeting-who-list-entry");fa.appendChild(P(I));fa.appendChild(V(I.displayName+" (me)",I.color));var ja=h(I.micTrack);fa.appendChild(pa(ja));I.audioTrack&&fa.appendChild(T(ja));M.call(aa,fa);ma=m.makeIterator(Object.values(ma));for(M=ma.next();!M.done;M=ma.next())if(M=M.value,M.hasDisplayName){fa=
document.createElement("li");fa.classList.add("ext-meeting-who-list-entry");fa.appendChild(P(M));ja=V(M.displayName,M.color);ja.style.cursor="pointer";fa.appendChild(ja);var ta=M.micTrack&&M.micTrack.isEnabled;fa.appendChild(pa(ta));M.audioTrack&&fa.appendChild(T(ta));jh(ja,M.seeAvatar.bind(M));aa.appendChild(fa);ka.set(M,fa)}Z&&ka.has(Z)&&(this.onDominantSpeakerChanged(Z),Z=null)};this.show=function(){mp.show(J)};this.hide=function(){mp.hide(J)};this.update([]);this.show()}function x(I){return'\n      <div>\n        <textarea id="ext-meeting-note-text"\n          class="ext-meeeting-note-edit"\n          placeholder="'+
I+'"></textarea>\n      </div>\n      <button id="ext-meeting-note-publish"\n        class="ext-meeting-button ext-meeting-dialog-buttons">\n        Publish\n      </button>\n    '}function t(I,V){function pa(P){var ca=T;null!==P.location&&(ca+=":"+P.location.join(":"));return ca}var T="extMtg:"+I+":"+V+":";this.getTimeStampOfLastReadNoteAtLocation=function(P){return localStorage.getItem(pa(P))||-1};this.isNoteRead=function(P){return P.ts<=this.getTimeStampOfLastReadNoteAtLocation(P)||P.author===
V};this.markAllNotesAtLocationAsRead=function(P){localStorage.setItem(pa(P),P.ts)}}function A(I,V,pa,T,P,ca){function J(X){if(X===V.displayName)return V.color;for(var Y=m.makeIterator(Object.values(pa)),qa=Y.next();!qa.done;qa=Y.next())if(qa=qa.value,qa.displayName===X)return qa.color;return"#ffffff"}function aa(){Z=!1;T.show();ra.style.cursor="default";ka.dismiss();ma.close()}function na(X){return ia.filter(function(Y){Y=Y.location;var qa=X.location;Y=null===Y||null===qa?!1:nb(Y,qa);return Y})}function L(X,
Y){function qa(Ea,Ga){if(!Z){Ba.classList.remove("ext-meeting-note-list-unread");Ba.classList.add("ext-meeting-note-list-selected");Ga&&Ba.scrollIntoView();Ea.material.highlightMix=.7;I.requestFrame();var Da="";Ga=new Map;for(var Va=P.getTimeStampOfLastReadNoteAtLocation(X),jb=null,hc=m.makeIterator(na(X)),Ib=hc.next();!Ib.done;Ib=hc.next()){jb=Ib.value;Ib="ext-meeting-note-text"+jb.id;var Dc="ext-meeting-note-author"+jb.id,U="ext-meeting-note-entry";jb.ts>Va&&jb.author!==V.displayName&&(U+=" ext-meeting-note-unread");
Da+='<div class="'+U+'">\n               <strong id="'+Dc+'"\n                   style="color: '+J(jb.author)+'">\n               </strong> <span>'+c(jb.ts)+'</span>\n               <div id="'+Ib+'">\n               </div>\n             </div>';Ga.set(Ib,jb.text);Ga.set(Dc,jb.author)}Da+=x("Type your response");M?M.update(Da):(M=new mp.UiPopup(Da),M.position=mp.UiPopup.TOP,M.onClose=function(){Ba.classList.remove("ext-meeting-note-list-selected");Ea.material.highlightMix=0;I.requestFrame();M=null});
P.markAllNotesAtLocationAsRead(jb);fa=X.location;M.open();Ga.forEach(function(ua,Na){document.getElementById(Na).innerText=ua});kh("ext-meeting-note-publish",function(){var ua=document.getElementById("ext-meeting-note-text"),Na=ua.value.trim();if(Na){var eb=Ea.position;ca(Na,[eb.x,eb.y,eb.z]);ua.value=""}else mp.highlightInput(ua)})}}var za=I.addAnchor(e(X.location[0],X.location[1],X.location[2],"#0775e8"),function(Ea){return qa(Ea,!0)});za.material.highlight=ea;za.material.setUniforms();Q.push(za);
var Ka=X.author;var Ba=d(Ka,c(X.ts),J(Ka),function(){I.seeItem(za);qa(za,!1)});P.isNoteRead(X)||Ba.classList.add("ext-meeting-note-list-unread");Y.appendChild(Ba);null!==M&&nb(fa,X.location)&&qa(za,!0)}var Q=[],ia=[],Z=!1,ka=new mp.UiPopup("\n      <h2>\n        Click a place to leave a note there.\n      </h2>");ka.position=mp.UiPopup.TOP;var ma=new mp.UiPopup(x("Type your note"));ma.position=mp.UiPopup.TOP;var M=null,fa=null;kh("ext-meeting-add-note",function(){Z=!0;T.hide();ra.style.cursor="pointer";
M&&M.close();I.onNodeTypeClicked(ta);ka.onDismiss=function(){I.removeOnNodeTypeClicked(ta);aa()};ka.open()});var ja=new C.Vector3;var ta=function(X,Y){ra.style.cursor="default";ja.copy(Y);tf(ja,I.getCameraPosition(),.1);I.removeOnNodeTypeClicked(ta);var qa=I.addAnchor(e(ja.x,ja.y,ja.z));qa.material.highlight=ea;qa.material.setUniforms();qa.material.highlightMix=.7;ka.close();ma.onClose=function(){I.removeAnchor(qa);aa()};ma.open();kh("ext-meeting-note-publish",function(){var za=document.getElementById("ext-meeting-note-text"),
Ka=za.value.trim();Ka?ca(Ka,[ja.x,ja.y,ja.z]):mp.highlightInput(za)});return!0};I.onApiUserStateChanged("MeetingNotes",function(X,Y){console.assert("MeetingNotes"===X);ia=Y.sort(function(Ba,Ea){var Ga=P.isNoteRead(Ba),Da=P.isNoteRead(Ea);return Ga!==Da?Ga?-1:1:Ba.ts-Ea.ts});aa();X=m.makeIterator(Q);for(Y=X.next();!Y.done;Y=X.next())I.removeAnchor(Y.value);Q.length=0;X=document.getElementById("ext-meeting-note-list");mp.removeChildren(X);Y=new Map;for(var qa=ia.length-1;0<=qa;qa--){var za=ia[qa];if(null!==
za.location){var Ka=za.location.join("/");Y.has(Ka)||(Y.set(Ka,qa),L(za,X),X.lastChild.scrollIntoView())}}})}function D(I,V){function pa(){aa=J=null;ca.pointerX=null;ca.pointerY=null;ca.pointerZ=null;I._enableControls()}function T(){ca.isEnabled()?(ra.style.cursor="default",pa(),L.disable(),na.close(),V.show()):(ra.style.cursor="pointer",na.open(),L.enable(),na.onDismiss=T,V.hide())}var P=this,ca=this,J=null,aa=null,na=new mp.UiPopup("\n      <h2>\n        Point a place by clicking.\n      </h2>");
na.position=mp.UiPopup.TOP;var L=I._createPointerEventHelper(0);L.disable();this.pointerZ=this.pointerY=this.pointerX=null;this.isEnabled=function(){return L.isEnabled()};this.showPointer=function(){return null!==this.pointerX};I.onBeforeRender(function(){if(null!==J){var Q=I._findIntersectionAtPosition(J,aa);Infinity!==Q.distance&&(P.pointerX=Q.point.x,P.pointerY=Q.point.y,P.pointerZ=Q.point.z)}});L.callbacks.onPointerDown=function(Q,ia){J=Q;aa=ia;I._disableControls();I.requestFrame();return!0};
L.callbacks.onPointerMove=function(Q,ia){if(null===J)return!1;J=Q;aa=ia;I.requestFrame();return!0};L.callbacks.onPointerUp=function(){pa();I.requestFrame();return!0};kh("ext-meeting-pointer",function(){T()})}function H(){var I=[0,0,0,0,0],V=[0,0,0,0,0,0,0,0],pa=null,T=!1;this.newUpdateWithPointer=function(){T=!1;pa!==V&&(T=!0,pa=V)};this.newUpdateNoPointer=function(){T=!1;pa!==I&&(T=!0,pa=I)};this.set=function(P,ca){pa[P]!==ca&&(pa[P]=ca,T=!0)};this.getFilledArray=function(){return T?pa:null}}function G(){function I(J){mp.setVisibility(J.children[0],
!0);mp.setVisibility(J.children[1],!1)}function V(J){mp.setVisibility(J.children[0],!1);mp.setVisibility(J.children[1],!0)}var pa=document.getElementById("ext-meeting-mic-toggle"),T=document.getElementById("ext-meeting-camera-toggle"),P=document.getElementById("ext-meeting-camera-preview");lh(P);var ca=null;this.refreshMicControls=function(J){h(J)?(mp.setButtonHighlight(pa,!1),I(pa)):(mp.setButtonHighlight(pa,!0),V(pa))};this.refreshCameraControls=function(J){h(J)?(ca||(ca=J.attach(),P.appendChild(ca)),
mp.show(P),mp.setButtonHighlight(T,!1),I(T)):(ca&&(J.detach(),ca.remove(),ca=null),mp.hide(P),mp.setButtonHighlight(T,!0),V(T))};this.setToggleButtonHandlers=function(J,aa){jh(pa,J);jh(T,aa)}}function K(I,V,pa,T){function P(){ja.dispose();Ga.dispose();Ea.dispose();for(var Da=m.makeIterator(Object.values(ta)),Va=Da.next();!Va.done;Va=Da.next())ta[Va.value].dispose();fa.dispose()}function ca(Da,Va){P();document.body.innerHTML='<div id="cover-image"></div>';f(Da,Va,Va?function(){return location.reload()}:
void 0)}function J(Da){ca("Meeting connection lost.</br>(Code: "+Da+").","Join again")}function aa(Da,Va){Da={meetingKey:za,author:I,text:Da,location:Va};uc(b()+"/meetings/"+qa+"/notes","application/json",JSON.stringify(Da),function(){return zc.log("Note added.")},function(){return zc.log("Failed to add note")})}function na(){X.update(ta)}function L(Da){var Va=ta[Da];Va||(Va=new p(ma,Da,fa,na),ta[Da]=Va);return Va}function Q(Da){Da in ta&&(ta[Da].dispose(),delete ta[Da],X.update(ta),Ga.isConnectingOrConnected()&&
0===Object.keys(ta).length&&Ga.disconnect())}function ia(Da){Ka=Da;for(var Va=m.makeIterator(Object.keys(Da)),jb=Va.next();!jb.done;jb=Va.next())jb=jb.value,ma.apiUserChangeState(jb,Da[jb])}function Z(){Ba.showPointer()?(M.newUpdateWithPointer(),M.set(5,Ua(Ba.pointerX,3)),M.set(6,Ua(Ba.pointerY,3)),M.set(7,Ua(Ba.pointerZ,3))):M.newUpdateNoPointer();var Da=ma.getCameraPosition(),Va=ma.getCameraRotation();M.set(0,Ua(Da.x,3));M.set(1,Ua(Da.y,3));M.set(2,Ua(Da.z,3));M.set(3,Ua(Va.yaw,1));M.set(4,Ua(Va.pitch,
1));(Da=M.getFilledArray())&&ja.updatePosition(Da)}function ka(){ca("The meeting has ended. Maximum duration of meeting reached.")}var ma=Dg,M=new H,fa=new a;this.myUuid=T.uuid;var ja=new n(ma,this.myUuid,I,fa,V,pa),ta={},X=new w(ja,ma),Y=new G,qa=T.id,za=T.meetingKey,Ka;Y.setToggleButtonHandlers(function(){ja.toggleMic()},function(){ja.toggleCamera()});ja.setAvTracksStateHandlers(function(Da){Y.refreshMicControls(Da);X.update(ta)},function(Da){Y.refreshCameraControls(Da)});Y.refreshMicControls(ja.micTrack);
Y.refreshCameraControls(ja.cameraTrack);var Ba=new D(ma,X);S.urlHashContains("meeting-notes")&&(mp.show(document.getElementById("ext-meeting-notes-preview")),A(ma,ja,ta,X,new t(qa,I),aa));null!==T.sceneState&&ia(T.sceneState);var Ea=new r(ja,T,function(Da){L(Da);Ga.isConnectingOrConnected()||Ga.connect()},Q,ia,J);V=new Gp;var Ga=new q(ja,T,function(Da,Va){L(Da).connectedToTwilio(Va)},function(Da){Q(Da)},function(Da){Cc.info("Failed to acquire media.<br/>"+Da.message,6E3)},J,function(){ca("The meeting has been ended.")},
V.onConnect.bind(V),V.onDisconnect.bind(V),function(Da){X.onDominantSpeakerChanged(Da in ta?ta[Da]:null)});kh("ext-meeting-leave",function(){f("Do you want to leave this meeting?","Leave meeting",function(){ca("You have left the meeting","Join again")},!0)});ma.onBeforeRender(Z);Z();ma.onApiUserStateChanged(function(Da,Va){Ka&&nb(Va,Ka[Da])||(Da={meetingKey:za,key:Da,state:Va},uc(b()+"/meetings/"+qa+"/scene-state","application/json",JSON.stringify(Da),function(){return zc.log("State updated.")},function(){return zc.log("Failed to update state.")}))});
this.startShareScreen=function(Da,Va,jb){zc.log("Screen share start requested");ja.startShareScreen(Da,Va,jb,function(){return X.update(ta)})};this.stopShareScreen=function(){zc.log("Screen share stop requested");ja.stopShareScreen()};null!==T.remainingTimeSeconds&&setTimeout(ka,1E3*(T.remainingTimeSeconds+5))}function W(I){(new vp(function(V,pa,T){V=new K(V,pa,T,I);Dg._meetingJoined(V)},I.avToken)).show()}function O(I,V){function pa(P){var ca,J,aa;return m.asyncExecutePromiseGeneratorProgram(function(na){switch(na.nextAddress){case 1:if(void 0===
P)return na.return();ca=P.split("/").slice(0,-1).join("/")+"/";na.setCatchFinallyBlocks(2);return na.yield(fetch(P),4);case 4:return J=na.yieldResult,na.yield(J.json(),5);case 5:return aa=na.yieldResult,T(ca,aa),na.return(!0);case 2:return na.enterCatchBlock(),na.return(!1)}})}function T(P,ca){fetch(P+ca.model).then(function(J){return J.text()}).then(function(J){var aa=J,na=/^[og]\s*(.+)?/,L=/^mtllib /,Q=/^usemtl /,ia=/^usemap /;J=new kp;-1!==aa.indexOf("\r\n")&&(aa=aa.replace(/\r\n/g,"\n"));-1!==
aa.indexOf("\\\n")&&(aa=aa.replace(/\\\n/g,""));aa=aa.split("\n");var Z;aa=m.makeIterator(aa);for(Z=aa.next();!Z.done;Z=aa.next()){var ka=Z.value;if(0!==ka.length&&"\x00"!==ka){var ma=ka.charAt(0);if("#"!==ma)if("v"===ma)switch(Z=ka.split(/\s+/),Z[0]){case "v":J.vertices.push(parseFloat(Z[1]),parseFloat(Z[2]),parseFloat(Z[3]));7<=Z.length&&console.assert(!1,"obj with vertex colors is not supported");break;case "vn":J.normals.push(parseFloat(Z[1]),parseFloat(Z[2]),parseFloat(Z[3]));break;case "vt":J.uvs.push(parseFloat(Z[1]),
parseFloat(Z[2]))}else if("f"===ma){ka=ka.substr(1).trim().split(/\s+/);Z=[];ka=m.makeIterator(ka);for(ma=ka.next();!ma.done;ma=ka.next())ma=ma.value,0<ma.length&&(ma=ma.split("/"),Z.push(ma));ka=Z[0];ma=1;for(var M=Z.length-1;ma<M;ma++){var fa=Z[ma],ja=Z[ma+1];J.addFace(lp(ka[0]),lp(fa[0]),lp(ja[0]),lp(ka[1]),lp(fa[1]),lp(ja[1]),lp(ka[2]),lp(fa[2]),lp(ja[2]))}}else"l"===ma?console.assert(!1,"line geometry is not supported"):"p"===ma?console.assert(!1,"obj point geometry not supported"):null!==(Z=
na.exec(ka))?(Z=(" "+Z[0].substr(1).trim()).substr(1),J.startObject(Z)):Q.test(ka)||L.test(ka)||ia.test(ka)||"s"!==ma&&console.warn('OBJLoader: Unexpected line: "'+ka+'"')}}na=new Map;J=m.makeIterator(J.objects);for(L=J.next();!L.done;L=J.next())L=L.value,0!==L.vertices.length&&(Q=new C.BufferGeometry,Q.addAttribute("position",new jm(new Float32Array(L.vertices),3)),0<L.normals.length&&Q.addAttribute("normal",new jm(new Float32Array(L.normals),3)),!0===L.hasUvs&&Q.addAttribute("uv",new jm(new Float32Array(L.uvs),
2)),Q.convertNormalsToSpherical(),Q.computeBoundingBox(),Q.computeBoundingSphere(),na.set(L.name,Q));Mo=ca.displayLookAtCamera||!1;J=ca.meshes;J.length!==na.size&&console.warn("Mismatch between avatar meshes count and geometries map size");J=m.makeIterator(J);for(L=J.next();!L.done;L=J.next())L=L.value,na.has(L.geometryName)||console.assert(!1,'Avatar "'+L.geometryName+'" mesh is missing'),Q={materialName:L.materialName?L.materialName:"mainMaterial",geometry:na.get(L.geometryName)},Oo[L.group].push(Q);
Vo(ca.materials,P);V()}).catch(function(){return Cc.error("Failed to load the meeting")})}Dg.onSceneLoadComplete(function(){var P,ca;return m.asyncExecutePromiseGeneratorProgram(function(J){if(1==J.nextAddress)return J.yield(pa(I),2);if(3!=J.nextAddress){if(P=J.yieldResult)return J.return();I=ob("3dassets/avatar.json");S.AVATAR_JSON_URL_OVERRIDE&&(I=S.AVATAR_JSON_URL_OVERRIDE);return J.yield(pa(I),3)}if(ca=J.yieldResult)return J.return();Cc.error("Failed to load the meeting");J.jumpToEnd()})})}S.FONT_FAMILIES_TO_LOAD.push("FontAwesomeSolid");
S.FONT_FAMILIES_TO_LOAD.push("FontAwesomeRegular");var ea=new C.Color(0,1,0),ra=document.getElementById("walk-canvas"),va=S.urlHashGetArgument("av-region");l.prototype={constructor:l,_setUpAvatar:function(){console.assert(this._displayName,"Display name must be known to set up the avatar");zc.log("Setting up avatar for %s:%s",this._uuid,this._displayName);this._avatar=this._viewer.addAvatar(this._uuid,{displayName:this._displayName,color:this._color})},get uuid(){return this._uuid},get color(){return this._color},
get displayName(){return this._displayName},get hasDisplayName(){return null!==this._displayName},_positionChanged:function(I){if(this._lastRenderedPositionLength!==I.length)return!0;for(var V=0;V<I.length;V++)if(1E-5<Math.abs(this._lastRenderedPosition[V]-I[V]))return!0;return!1},_setLastRenderedPosition:function(I){this._lastRenderedPositionLength=I.length;for(var V=0;V<I.length;V++)this._lastRenderedPosition[V]=I[V]},get volumeVisualizer(){return this._volumeVisualizer},updatePosition:function(I){if(this.hasDisplayName&&
this._positionChanged(I)){this._setLastRenderedPosition(I);var V=this._avatar;V.setPositionFromArray(I);V.rotate(I[3],I[4]);6<=I.length?V.placePointer(I[5],I[6],I[7]):V.hidePointer();V.visible&&(V.updateMatrixWorld(!0),this._viewer.requestFrame())}},updateSoundVolumeVisualization:function(){console.assert(null!==this._volumeMeter,"this._voulmeMeter not created");var I=this._volumeMeter.measureSoundVolume();this._onSoundVolumeUpdated(I)},_onSoundVolumeUpdated:function(I){this._volumeVisualizer.update(I)},
dispose:function(){this.isSoundMeasurementActive()&&this._stopSoundMeasurement();this._avatar&&(this._viewer.removeAvatar(this._avatar),this._avatar=null,this._viewer.requestFrame())},_updateSoundMeasurementState:function(){null!==this._micTrack&&this._micTrack.isEnabled?this._startSoundMeasurement():this._stopSoundMeasurement()},isSoundMeasurementActive:function(){return null!==this._volumeMeter},_startSoundMeasurement:function(){this.isSoundMeasurementActive()||(this._volumeMeter=new qp.VolumeMeter(this._micTrack,
512,this._noSoundThreshold),this._soundVolumeUpdatesScheduler.registerUser(this))},_stopSoundMeasurement:function(){this.isSoundMeasurementActive()&&(this._soundVolumeUpdatesScheduler.unregisterUser(this),this._volumeMeter.dispose(),this._volumeMeter=null,this._avatar.onSoundSwitchedOff())}};Object.defineProperty(l.prototype,"micTrack",{get:function(){return this._micTrack}});Object.defineProperty(l.prototype,"cameraTrack",{get:function(){return this._cameraTrack}});Object.defineProperty(l.prototype,
"audioTrack",{get:function(){return this._audioTrack}});n.prototype=Object.create(l.prototype);n.prototype.constructor=n;Object.defineProperty(n.prototype,"dataTrack",{get:function(){return this._dataTrack}});Object.defineProperty(n.prototype,"screenTrack",{get:function(){return this._screenTrack}});n.prototype.getAllTracks=function(){var I=[this._dataTrack];this._micTrack&&I.push(this._micTrack);this._cameraTrack&&I.push(this._cameraTrack);this._screenTrack&&I.push(this._screenTrack);this._audioTrack&&
I.push(this._audioTrack);return I};n.prototype._sendPosition=function(I){this._positionMessage[2]=I;this._dataTrack.send(JSON.stringify(this._positionMessage))};n.prototype._resendLastPosition=function(){null!==this._lastPosition&&this._sendPosition(this._lastPosition)};n.prototype.startedConnectingToTwilio=function(){this._isPublishingTracksDuringConnecting=!0};n.prototype.failedToConnectToTwilio=function(){this._isPublishingTracksDuringConnecting=!1};n.prototype.connectedToTwilio=function(I){var V=
this;this._twilioParticipant=I;I.publishTracks(this.getAllTracks()).finally(function(){V._isPublishingTracksDuringConnecting=!1});this._resendLastPosition();this._resendInterval=setInterval(function(){return V._resendLastPosition()},1E3)};n.prototype.disconnectedFromTwilio=function(){this._twilioParticipant=null;clearInterval(this._resendInterval);this._resendInterval=null};Object.defineProperty(n.prototype,"isConnectedToTwilio",{get:function(){return null!==this._twilioParticipant}});n.prototype.updatePosition=
function(I){l.prototype.updatePosition.call(this,I);this._lastPosition=I;this.isConnectedToTwilio&&this._sendPosition(I)};n.prototype.setAvTracksStateHandlers=function(I,V){this._onMicTrackStateChanged=I;this._onCameraTrackStateChanged=V};n.prototype._removeStoppedMicTrack=function(){console.assert(this._micTrack&&this._micTrack.isStopped);zc.log("Removing stopped local mic track");this._twilioParticipant&&(zc.log("Unpublishing stopped local mic track"),this._twilioParticipant.unpublishTrack(this._micTrack));
this._micTrack=null};n.prototype._subscribeToMicEvents=function(){function I(){V._updateSoundMeasurementState();V._onMicTrackStateChanged&&V._onMicTrackStateChanged(V._micTrack)}var V=this;this._micTrack.on("started",I);this._micTrack.on("enabled",I);this._micTrack.on("disabled",I);this._micTrack.on("stopped",function(){I();V._removeStoppedMicTrack()})};n.prototype._createMicTrack=function(){var I=this;zc.log("Creating local mic track");if(this._isCreatingMicTrack)zc.log("Local mic track is already being created");
else{this._isCreatingMicTrack=!0;var V=null;Twilio.Video.createLocalAudioTrack(this._micDevice.trackOptions).then(function(pa){V=pa;if(I.isConnectedToTwilio)return zc.log("Publishing local mic track"),I._twilioParticipant.publishTrack(V)}).then(function(pa){pa?zc.log("Local mic track created and published"):zc.log("Local mic track created but not yet published");I._micTrack=V;I._subscribeToMicEvents();I._onMicTrackStateChanged&&I._onMicTrackStateChanged(I._micTrack);I._isCreatingMicTrack=!1}).catch(function(pa){V&&
V.stop();I._micDevice.error=pa;I._showCreateTrackError(I._micDevice);I._isCreatingMicTrack=!1})}};n.prototype.toggleMic=function(){this._micTrack?this._micTrack.isEnabled?(zc.log("Disabling local mic track"),this._micTrack.disable()):(zc.log("Enabling local mic track"),this._micTrack.enable()):this._createMicTrack()};n.prototype._removeStoppedCameraTrack=function(){console.assert(this._cameraTrack&&this._cameraTrack.isStopped);zc.log("Removing stopped local camera track");this._twilioParticipant&&
(zc.log("Unpublishing stopped local camera track"),this._twilioParticipant.unpublishTrack(this._cameraTrack));this._cameraTrack=null};n.prototype._subscribeToCameraEvents=function(){function I(){V._onCameraTrackStateChanged&&V._onCameraTrackStateChanged(V._cameraTrack)}var V=this;this._cameraTrack.on("started",I);this._cameraTrack.on("enabled",I);this._cameraTrack.on("disabled",I);this._cameraTrack.on("stopped",function(){I();V._removeStoppedCameraTrack()})};n.prototype._createCameraTrack=function(){var I=
this;zc.log("Creating local camera track");if(this._isCreatingCameraTrack)zc.log("Local camera track is already being created");else{this._isCreatingCameraTrack=!0;var V=null;Twilio.Video.createLocalVideoTrack(this._cameraDevice.trackOptions).then(function(pa){V=pa;if(I.isConnectedToTwilio)return zc.log("Publishing local camera track"),I._twilioParticipant.publishTrack(V)}).then(function(pa){pa?zc.log("Local camera track created and published"):zc.log("Local camera track created but not yet published");
I._cameraTrack=V;I._subscribeToCameraEvents();I._onCameraTrackStateChanged&&I._onCameraTrackStateChanged(I._cameraTrack);I._isCreatingCameraTrack=!1}).catch(function(pa){V&&V.stop();I._cameraDevice.error=pa;I._showCreateTrackError(I._cameraDevice);I._isCreatingCameraTrack=!1})}};n.prototype._showCreateTrackError=function(I){I=I.getErrorMessageInfo();mp.showMessage(I.description,I.title)};n.prototype.toggleCamera=function(){this._cameraTrack?this._isPublishingTracksDuringConnecting?zc.log("Cannot disable the camera track during connection process"):
this._cameraTrack.stop():this._createCameraTrack()};n.prototype.startShareScreen=function(I,V,pa,T){var P=this;null!==this._screenTrack?I():(zc.log("Share screen start"),navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then(function(ca){zc.log("share screen - stream:",ca);var J=new Twilio.Video.LocalVideoTrack(ca.getVideoTracks()[0],{name:"screen"});P._screenTrack=J;ca=ca.getAudioTracks();var aa=null;0<ca.length?(aa=new Twilio.Video.LocalAudioTrack(ca[0],{name:"audio"}),P._audioTrack=aa,
T()):console.log("Audio track not available for sharing");ca=g(P._viewer,J);P._avatar.setVideoTexture1(ca);P._viewer.requestFrame();P.isConnectedToTwilio&&(P._twilioParticipant.publishTrack(J),aa&&P._twilioParticipant.publishTrack(aa));I();J.once("stopped",function(){zc.log("Screen track stopped");P.isConnectedToTwilio&&(P._twilioParticipant.unpublishTrack(J),null!==aa&&P._twilioParticipant.unpublishTrack(aa));P._avatar.setVideoTexture1(null);k(J);null!==aa&&k(aa);P._screenTrack=null;P._audioTrack&&
(P._audioTrack=null,T());P._viewer.requestFrame();V()})}).catch(function(){pa()}))};n.prototype.stopShareScreen=function(){null!==this._screenTrack&&(zc.log("Share screen stop"),this._screenTrack.stop())};n.prototype.dispose=function(){this._micTrack&&this._micTrack.stop();this._cameraTrack&&this._cameraTrack.stop();this._screenTrack&&this._screenTrack.stop();l.prototype.dispose.call(this)};p.prototype=Object.create(l.prototype);p.prototype.constructor=p;p.prototype._refreshUi=function(){this._onUiRefreshNeeded&&
this._onUiRefreshNeeded(this)};p.prototype._setUpMicTrack=function(){var I=this;zc.log("Setting up remote mic track for %s:%s",this._uuid,this._displayName);this._micTrackStateChangedBound=function(){I._updateSoundMeasurementState();I._refreshUi()};this._micTrack.on("enabled",this._micTrackStateChangedBound);this._micTrack.on("disabled",this._micTrackStateChangedBound);this._updateSoundMeasurementState();this._micTrack.attach()};p.prototype._tearDownMicTrack=function(){zc.log("Tearing down remote mic track for %s:%s",
this._uuid,this._displayName);k(this._micTrack);this._micTrack.removeListener("enabled",this._micTrackStateChangedBound);this._micTrack.removeListener("disabled",this._micTrackStateChangedBound);this._micTrackStateChangedBound=null};p.prototype._setUpAudioTrack=function(){zc.log("Setting up remote audio track for %s:%s",this._uuid,this._displayName);this._audioTrack.attach()};p.prototype._tearDownAudioTrack=function(){zc.log("Tearing down remote audio track for %s:%s",this._uuid,this._displayName);
k(this._audioTrack)};p.prototype._setUpCameraTrack=function(){var I=this;zc.log("Setting up remote camera track for %s:%s",this._uuid,this._displayName);var V=g(this._viewer,this._cameraTrack);this._cameraTrackEnabledBound=function(){I._avatar.setVideoTexture0(V)};this._cameraTrackDisabledBound=function(){I._avatar.setVideoTexture0(null)};this._cameraTrack.on("enabled",this._cameraTrackEnabledBound);this._cameraTrack.on("disabled",this._cameraTrackDisabledBound);this._avatar.setVideoTexture0(V)};
p.prototype._tearDownCameraTrack=function(){zc.log("Tearing down remote camera track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture0(null);k(this._cameraTrack);this._cameraTrack.removeListener("enabled",this._cameraTrackEnabledBound);this._cameraTrack.removeListener("disabled",this._cameraTrackDisabledBound);this._cameraTrackDisabledBound=this._cameraTrackEnabledBound=null};p.prototype._setUpScreenTrack=function(){zc.log("Setting up remote screen track for %s:%s",this._uuid,
this._displayName);var I=g(this._viewer,this._screenTrack);this._avatar.setVideoTexture1(I)};p.prototype._tearDownScreenTrack=function(){zc.log("Tearing down remote screen track for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture1(null);k(this._screenTrack)};p.prototype._setDisplayName=function(I){zc.log("Remote display name known for %s:%s",this._uuid,I);this._displayName=I;this._setUpAvatar();this._micTrack&&this._setUpMicTrack();this._cameraTrack&&this._setUpCameraTrack();this._screenTrack&&
this._setUpScreenTrack();this._audioTrack&&this._setUpAudioTrack();this._refreshUi()};p.prototype._trackSubscribed=function(I){var V=this;zc.log("Remote %s:%s track subscribed for %s:%s",I.kind,I.name,this._uuid,this._displayName);this._disposed||("data"===I.kind&&"data"===I.name?this._dataTrack?zc.log("Ignoring duplicate data track"):(this._dataTrack=I,I.on("message",function(pa){pa=JSON.parse(pa);var T=pa[1];pa=pa[2];V.hasDisplayName||V._setDisplayName(T);V.updatePosition(pa)})):"audio"===I.kind&&
"mic"===I.name?this._micTrack?zc.log("Ignoring duplicate mic track"):(this._micTrack=I,this.hasDisplayName&&(this._setUpMicTrack(),this._refreshUi())):"video"===I.kind?"camera"===I.name?this._cameraTrack?zc.log("Ignoring duplicate camera track"):(this._cameraTrack=I,this._avatar&&(this._setUpCameraTrack(),this._viewer.requestFrame())):"screen"===I.name&&(this._screenTrack?zc.log("Ignoring duplicate screen track"):(this._screenTrack=I,this._avatar&&(this._setUpScreenTrack(),this._viewer.requestFrame()))):
"audio"===I.kind&&"audio"===I.name&&(this._audioTrack?zc.log("Ignoring duplicate audio track"):(this._audioTrack=I,this.hasDisplayName&&(this._setUpAudioTrack(),this._refreshUi()))))};p.prototype._trackUnsubscribed=function(I){zc.log("Remote %s:%s track unsubscribed for %s:%s",I.kind,I.name,this._uuid,this._displayName);this._disposed||(I===this._dataTrack?this._dataTrack=null:I===this._micTrack?(this.hasDisplayName&&this._tearDownMicTrack(),this._micTrack=null,this._refreshUi()):I===this._cameraTrack?
(this._avatar&&(this._tearDownCameraTrack(),this._viewer.requestFrame()),this._cameraTrack=null):I===this._screenTrack?(this._avatar&&(this._tearDownScreenTrack(),this._viewer.requestFrame()),this._screenTrack=null):I===this._audioTrack&&(this.hasDisplayName&&this._tearDownAudioTrack(),this._audioTrack=null,this._refreshUi()))};p.prototype.connectedToTwilio=function(I){var V=this;this._twilioParticipant=I;I.on("trackSubscribed",this._trackSubscribedBound);I.on("trackUnsubscribed",this._trackUnsubscribedBound);
I.tracks.forEach(function(pa){pa.isSubscribed&&V._trackSubscribed(pa.track)})};p.prototype.seeAvatar=function(){this._avatar&&this._viewer.seeItem(this._avatar)};p.prototype._onSoundVolumeUpdated=function(I){l.prototype._onSoundVolumeUpdated.call(this,I);this._avatar.onSoundVolumeUpdated(I)};p.prototype.dispose=function(){this._onUiRefreshNeeded=null;this._micTrack&&this._trackUnsubscribed(this._micTrack);this._cameraTrack&&this._trackUnsubscribed(this._cameraTrack);this._screenTrack&&this._trackUnsubscribed(this._screenTrack);
this._audioTrack&&this._trackUnsubscribed(this._audioTrack);this.isConnectedToTwilio&&(this._twilioParticipant.removeListener("trackSubscribed",this._trackSubscribedBound),this._twilioParticipant.removeListener("trackUnsubscribed",this._trackUnsubscribedBound),this._twilioParticipant=null);l.prototype.dispose.call(this);this._disposed=!0};a.prototype.registerUser=function(I){this._users.add(I)};a.prototype.unregisterUser=function(I){this._users.delete(I)};a.prototype.dispose=function(){this._users.clear()};
a.prototype._onBeforeRender=function(){this._execute();this._idleCallback.deferRun()};a.prototype._execute=function(){this._users.forEach(function(I){return I.updateSoundVolumeVisualization()})};Xc([ob("lib/pubnub.min.js"),ob("lib/twilio-video.min.js")],function(){var I=S.urlHashGetArgument("meeting"),V=S.urlHashGetArgument("meeting-key"),pa=S.urlHashGetArgument("av-mode"),T={url:S.DEVEL_MEETING_SCENE_URL||window.location.href};I&&(T.meetingName=I);V&&(T.meetingKey=V);pa&&(T.avMode=pa);va&&(T.avRegion=
va);uc(b()+"/meetings/join","application/json",JSON.stringify(T),function(P){return O(P.avatarJsonUrl,function(){return W(P)})},function(P,ca){void 0!==ca?Cc.error(ca):Cc.error("Failed to join the meeting. Is your link valid?")})},function(){return Cc.error("Cannot load required library")});Hn?po():In=!0}Dg._isMeeting()&&Hp();S.Viewer=vo;S.View=Kg;S.getViewer=function(){return Dg};S.getExtraAssetUrl=tb;S.initEditMode=function(a){var b=document.createElement("base");b.target="_blank";document.head.appendChild(b);qb(Object.keys(pb),function(){uo(a)})};S.ColorUtils=De;S.TRANSFORM_MODE=ph;S.STRINGS=Ob;S.ICONS=Xb;
S.StaticRenderViewer=function(a){var b=jp(a),c=new ip,d=new C.OrthographicCamera(-1,1,1,-1,0,1),e=new C.Scene;a=new C.Mesh(new C.PlaneBufferGeometry(2,2),c);b.uploadNewBuffers(a);e.add(a);this.update=function(f){var g=new Float32Array(f,0,f.byteLength/4);f=g[0];var k=g[1];g=g.subarray(2);console.assert(f*k===g.length/3);g=new ed(g,f,k,Mb.RGB,Mb.FLOAT);g.minFilter=Mb.NEAREST;g.magFilter=Mb.NEAREST;g.generateMipmaps=!1;g.flipY=!1;g.needsUpdate=!0;c.uniforms.staticRender.value=g;c.uniforms.sizeInv.value.set(1/
f,1/k);b.setCanvasSize(f,k);b.render(e,d);g.dispose()}};S.SceneLoadConfig=ei;S.init=wo;S.updateViewerStrings=Wb;S.getViewerStrings=function(){return mb(Tb)};S.hasShiftKeyModifier=function(a){return a&Sf.SHIFT};S.hasCtrlEquivalentKeyModifier=function(a){return a&Sf.CTRL_EQUIVALENT};S.hasAltEquivalentModifier=function(a){return a&Sf.ALT_EQUIVALENT};S.StandardMaterial=bf;window.THREE=C;window.WALK=S;window.WebXRConfig=Nb;
window.addEventListener("load",function(){var a;return m.asyncExecutePromiseGeneratorProgram(function(b){if(1==b.nextAddress)return b.yield(Cj(),2);if(Kn)return b.return();a=new ei;wo(a);b.jumpToEnd()})});}).call(this);
